"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[589],{61837:function(e,a,o){o.d(a,{Z:function(){return C}});var t=o(73396);const l={class:"btn-group-vertical mt-1"},n={class:"btn-group"},c={class:"btn-group"},r={class:"btn-group"},i={class:"btn-group"},d={class:"btn-group"};function u(e,a,o,u,s,m){return(0,t.wg)(),(0,t.iD)("div",l,[(0,t._)("div",n,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[0]||(a[0]=e=>u.addTecla("1"))}," 1 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[1]||(a[1]=e=>u.addTecla("2"))}," 2 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[2]||(a[2]=e=>u.addTecla("3"))}," 3 ")]),(0,t._)("div",c,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[3]||(a[3]=e=>u.addTecla("4"))}," 4 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[4]||(a[4]=e=>u.addTecla("5"))}," 5 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[5]||(a[5]=e=>u.addTecla("6"))}," 6 ")]),(0,t._)("div",r,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[6]||(a[6]=e=>u.addTecla("7"))}," 7 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[7]||(a[7]=e=>u.addTecla("8"))}," 8 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[8]||(a[8]=e=>u.addTecla("9"))}," 9 ")]),(0,t._)("div",i,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[9]||(a[9]=e=>u.deleteTecla())}," < "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[10]||(a[10]=e=>u.addTecla("0"))}," 0 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[11]||(a[11]=e=>u.okValue(Number(u.cantidad)))}," OK ")]),(0,t._)("div",d,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonComa",onClick:a[12]||(a[12]=e=>u.addTecla("."))}," , ")])])}o(42492);var s=o(32066),m=o(86525),p=o(44870);const v=(0,s.io)("http://"+m.Z.state.TocGameURL+":5051");var g={props:{skipBalanza:{type:Boolean,default:!1}},name:"NumpadComponent",setup(e,{expose:a}){const o=(0,p.iH)("0"),l=(0,t.f3)("okValue"),n=(0,p.iH)("5.5rem"),c=(0,p.iH)("5.5rem");(0,t.Fl)((()=>m.Z.state.Weight.lastWeight));function r(e){"."===e&&(o.value=o.value.replace(".","")),o.value+=e,"0"==o.value[0]&&(o.value=o.value.slice(1))}function i(){o.value=o.value.slice(0,-1),""===o.value&&(o.value="0")}function d(e){o.value=Number(e).toString()}return v.on("setBalanzaValue",(a=>{a&&!e.skipBalanza&&d(a)})),a({cantidad:o,setValor:d}),(0,t.bv)((async()=>{e.skipBalanza||d((await(0,t.Fl)((()=>m.Z.state.Weight.lastWeight))).value)})),{okValue:l,cantidad:o,addTecla:r,deleteTecla:i,setValor:d,anchoTecla:n,altoTecla:c}}},_=o(40089);const b=(0,_.Z)(g,[["render",u],["__scopeId","data-v-6fec6be8"]]);var C=b},73252:function(e,a,o){o.r(a),o.d(a,{default:function(){return ce}});var t=o(73396),l=o(87139),n=o(49242);const c=e=>((0,t.dD)("data-v-cb5587aa"),e=e(),(0,t.Cn)(),e),r={id:"main"},i={id:"vueMenuEncargo"},d={class:"encargos"},u={class:""},s={class:"row"},m=c((()=>(0,t._)("div",{class:"col"},null,-1))),p={class:"col"},v={key:0},g={class:"btnEncargo lgEncargo float-right"},_=c((()=>(0,t._)("i",{class:"fas fa-search"},null,-1))),b=c((()=>(0,t._)("hr",null,null,-1))),C={class:"productos"},y={key:0,style:{"overflow-y":"scroll",height:"28vh"}},f={class:"d-flex flex-column juatify-content-center"},k={style:{"max-width":"270px"}},h=["onUpdate:modelValue"],D=c((()=>(0,t._)("br",null,null,-1))),w={key:1},T=c((()=>(0,t._)("hr",{class:"hrEncargo"},null,-1))),M={class:"recogida"},N={class:"opciones-recogida"},B={class:"fechas-recogida"},E={key:0},H={key:1},R={key:2},A=["id","onUpdate:modelValue","onClick"],x=c((()=>(0,t._)("hr",{class:"hrEncargo"},null,-1))),z={class:"encargos-footer"},V=c((()=>(0,t._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),j={class:"mb-0 mt-2"},I={class:"input-deja-a-cuenta"},$=c((()=>(0,t._)("small",{id:"emailHelp",class:"form-text text-muted"},"Deja a cuenta:",-1))),U={class:""},S=["disabled"],W={class:"row"},P={class:"col"},q={class:"input-group input-group-lg"},Z={class:"row"},F={class:"col text-center"};function Y(e,a,o,c,Y,L){const O=(0,t.up)("MDBModalTitle"),J=(0,t.up)("MDBModalHeader"),K=(0,t.up)("NumpadComponent"),Q=(0,t.up)("MDBModalBody"),G=(0,t.up)("MDBBtn"),X=(0,t.up)("MDBModalFooter"),ee=(0,t.up)("MDBModal"),ae=(0,t.up)("ModalClientesComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",r,[(0,t._)("div",i,[(0,t._)("div",null,[(0,t._)("div",d,[(0,t._)("div",u,[(0,t._)("div",s,[m,(0,t._)("div",p,[c.clienteData.idCliente?((0,t.wg)(),(0,t.iD)("h1",v,[(0,t._)("button",g,(0,l.zw)(c.clienteData.nombreCliente),1)])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:"btnEncargo float-right",onClick:a[0]||(a[0]=e=>c.refModalClientes.abrirModal())},[_,(0,t.Uk)(" Abrir modal cliente ")]))])]),b,(0,t._)("div",C,[c.productos.length?((0,t.wg)(),(0,t.iD)("div",y,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,t._)("div",f,[(0,t._)("span",k,"- "+(0,l.zw)(e.nombre),1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("span",{key:a},(0,l.zw)(e.nombre),1)))),128))]),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":a=>e.comentario=a},null,8,h),[[n.nr,e.comentario]])])))),128)),D])):((0,t.wg)(),(0,t.iD)("div",w,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),T,(0,t._)("div",M,[(0,t._)("div",N,[(0,t._)("button",{onClick:a[1]||(a[1]=(...e)=>c.onClickRecogida&&c.onClickRecogida(...e)),value:"1",class:(0,l.C_)({active:1===c.refEncargoRecogida})},(0,l.zw)(e.$t("toc_game_encargos_hoy","Hoy")),3),(0,t._)("button",{onClick:a[2]||(a[2]=(...e)=>c.onClickRecogida&&c.onClickRecogida(...e)),value:"2",class:(0,l.C_)({active:2===c.refEncargoRecogida})},(0,l.zw)(e.$t("toc_game_encargos_otro_dia","Otro día")),3),(0,t._)("button",{onClick:a[3]||(a[3]=(...e)=>c.onClickRecogida&&c.onClickRecogida(...e)),value:"3",class:(0,l.C_)({active:3===c.refEncargoRecogida})},(0,l.zw)(e.$t("toc_game_encargos_cada","Cada...")),3)]),(0,t._)("div",B,[1===c.refEncargoRecogida?((0,t.wg)(),(0,t.iD)("div",E,[(0,t._)("button",{onClick:a[4]||(a[4]=(...e)=>c.onClickAmPm&&c.onClickAmPm(...e)),value:"am",class:(0,l.C_)({active:"am"===c.refAmPm})},(0,l.zw)(e.$t("toc_game_encargos_por_la_manana","Turno de la mañana")),3),(0,t._)("button",{onClick:a[5]||(a[5]=(...e)=>c.onClickAmPm&&c.onClickAmPm(...e)),value:"pm",class:(0,l.C_)({active:"pm"===c.refAmPm})},(0,l.zw)(e.$t("toc_game_encargos_por_la_tarde","Turno de la tarde")),3)])):(0,t.kq)("",!0),2===c.refEncargoRecogida?((0,t.wg)(),(0,t.iD)("div",H,[(0,t.wy)((0,t._)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>c.fechaInput=e)},null,512),[[n.nr,c.fechaInput]]),(0,t.wy)((0,t._)("input",{type:"time",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>c.horaInput=e)},null,512),[[n.nr,c.horaInput]])])):(0,t.kq)("",!0),3===c.refEncargoRecogida?((0,t.wg)(),(0,t.iD)("div",R,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(c.dias,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t.wy)((0,t._)("input",{type:"button",id:e.dia,"onUpdate:modelValue":a=>e.dia=a,onClick:a=>c.clickDia(e),class:(0,l.C_)({active:c.refDia===e.nDia})},null,10,A),[[n.nr,e.dia]])])))),128))])):(0,t.kq)("",!0)])]),x,(0,t._)("div",z,[(0,t._)("div",null,[V,(0,t._)("p",j,(0,l.zw)(c.precioTotal)+"€",1)]),(0,t._)("div",I,[$,(0,t.wy)((0,t._)("input",{type:"number",class:"form-control",id:"cuenta",name:"dejaACuenta",placeholder:"0",min:"0","onUpdate:modelValue":a[8]||(a[8]=e=>c.dejaACuenta=e),onClick:a[9]||(a[9]=(...e)=>c.openTecladoNum&&c.openTecladoNum(...e)),readonly:""},null,512),[[n.nr,c.dejaACuenta]])]),(0,t._)("div",U,[(0,t._)("input",{type:"button",value:"Crear encargo",class:"btn btn-primary btn-lg",onClick:a[10]||(a[10]=(...e)=>c.crearEncargo&&c.crearEncargo(...e)),disabled:c.botonBloqueado},null,8,S)])])])])])])]),(0,t.Wm)(ee,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:c.modalTecladoNum,"onUpdate:modelValue":a[14]||(a[14]=e=>c.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,t.w5)((()=>[(0,t.Wm)(J,null,{default:(0,t.w5)((()=>[(0,t.Wm)(O,{id:"modalTecladoNumLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("deja_a_cuenta","Deja a cuenta")),1)])),_:1})])),_:1}),(0,t.Wm)(Q,null,{default:(0,t.w5)((()=>[(0,t._)("div",W,[(0,t._)("div",P,[(0,t._)("div",q,[c.numpadRef?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[11]||(a[11]=e=>c.numpadRef.cantidad=e)},null,512)),[[n.nr,c.numpadRef.cantidad]]):(0,t.kq)("",!0)])])]),(0,t._)("div",Z,[(0,t._)("div",F,[(0,t.Wm)(K,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,t.Wm)(X,null,{default:(0,t.w5)((()=>[(0,t.Wm)(G,{color:"danger",onClick:a[12]||(a[12]=e=>c.closeTecladoNum()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(G,{color:"success",size:"lg",onClick:a[13]||(a[13]=e=>c.finishTecladoNum())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(ae,{ref:"refModalClientes"},null,512)],64)}o(57658);var L=o(44870),O=o(74313),J=o(20065),K=o(10923),Q=o(61837),G=o(42492),X=o.n(G),ee=o(87853),ae=o(91076),oe=o(16797),te={name:"EncargosComponent",components:{ModalClientesComponent:K.Z,NumpadComponent:Q.Z,MDBCard:O.Yl,MDBCardBody:O.H7,MDBCardTitle:O.QM,MDBCardText:O.Pp,MDBBtn:O.$v,MDBCheckbox:O.IH,MDBModal:O.j3,MDBModalHeader:O.ol,MDBModalTitle:O.wo,MDBModalBody:O.Yz,MDBModalFooter:O.ab,MDBIcon:O.vm,MDBLoading:O.J$},setup(){const e=(0,L.iH)(!1),a=(0,L.iH)(null),o=(0,J.oR)(),{t:l}=(0,ee.QT)(),n=o.getters["Cestas/getCestaActiva"],c=o.getters["Cestas/getCestaActivaIndex"],r=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),i=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>r.value&&null!=i.value&&void 0!=i.value&&r.value[i.value]?r.value[i.value]:null)),u=(0,L.iH)(null),s=(0,L.iH)(null),m=(0,L.iH)(null),p=(0,L.iH)(null),v=(0,L.iH)([{dia:"Lunes",nDia:0,checked:!1},{dia:"Martes",nDia:1,checked:!1},{dia:"Miércoles",nDia:2,checked:!1},{dia:"Jueves",nDia:3,checked:!1},{dia:"Viernes",nDia:4,checked:!1},{dia:"Sábado",nDia:5,checked:!1},{dia:"Domingo",nDia:6,checked:!1}]),g=(0,L.iH)(null),_=(0,L.iH)(0),b={idCliente:n.idCliente,nombreCliente:n.nombreCliente},C=(0,L.iH)(null),y=(0,L.iH)(null),f=(0,L.iH)(n.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),k=(0,L.iH)(null),h=e=>{u.value=parseInt(e.target.value)},D=e=>{s.value=e.target.value},w=e=>{g.value=e.nDia;for(let a=0;a<v.value.length;a++)v.value[a].nDia==g.value?v.value[a].checked=!0:v.value[a].checked=!1},T=()=>v.value.filter((e=>e.checked)),M=()=>{let e=n.detalleIva.importe1+n.detalleIva.importe2+n.detalleIva.importe3+n.detalleIva.importe4+n.detalleIva.importe5;return e=Math.round(100*e)/100,e},N=()=>{if(e.value=!0,!f.value.length)return B(l("toc_game_encargos_error_no_productos","Tienes que haber al menos un producto para crear el encargo."),"error"),void(e.value=!1);if(!u.value)return B(l("toc_game_encargos_error_no_recogida","Tienes que elegir una opción de recogida (hoy, otro día o cada...)"),"error"),void(e.value=!1);if(1===u.value&&!s.value)return B(l("toc_game_encargos_error_no_am_pm","Tienes que elegir por la mañana o por la tarde"),"error"),void(e.value=!1);if(2===u.value&&(!m.value||!p.value))return B(l("toc_game_encargos_error_fecha_hora","Tienes que elegir la fecha y la hora del encargo"),"error"),void(e.value=!1);if(3===u.value&&!T().length)return B(l("toc_game_encargos_error_dias_seleccionados","Tienes que elegir al menos un día"),"error"),void(e.value=!1);if(1===u.value){const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,t=e.getDate();m.value=`${a}-${o.toString().padStart(2,"0")}-${t.toString().padStart(2,"0")}`}if(3===u.value){let e=new Date,a=e.getDay(),o=T()[0].nDia+1,t=(o-a+7)%7,l=new Date(e.getTime()+24*t*60*60*1e3);const n=l.getFullYear(),c=l.getMonth()+1,r=l.getDate();m.value=`${n}-${c.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`}const a={idCliente:b.idCliente,nombreCliente:b.nombreCliente,opcionRecogida:u.value,amPm:s.value,fecha:m.value,hora:p.value,dias:T(),dejaCuenta:_.value||0,total:M(),productos:f.value,cesta:n,idTrabajador:d.value._id,nombreDependienta:d.value.nombre};ae.Z.post("encargos/setEncargo",a).then((({data:a})=>a&&a.msg?a.error?(B(a.msg,"error"),void(e.value=!1)):(_.value>0&&ae.Z.post("movimientos/nuevoMovimiento",{cantidad:_.value,concepto:"dejaACuentaEncargo",idTrabajador:d.value._id,tipo:"ENTRADA_DINERO",nombreCliente:b.nombreCliente}).then((a=>{if(!a.data)throw e.value=!1,Error("No se ha podido realizar la entrada de dinero")})).catch((a=>{e.value=!1,X().fire("Oops...",a.message,"error")})),e.value=!1,void B(l("toc_game_encargos_ok","Encargo creado!"),"success",E)):(B(l("toc_game_encargos_error_general","Error general"),"error"),void(e.value=!1)))).catch((a=>{e.value=!1,B(l("toc_game_encargos_error_general","Error general"),"error")}))},B=(e,a,o=(()=>{}))=>{X().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>o()))},E=async()=>(await o.dispatch("Cestas/setModoCesta",{index:c,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:c,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset"),o.dispatch("Cestas/deleteLista",n._id),x("/main"),Promise.resolve()),H=()=>{y.value=!0},R=()=>{y.value=!1},A=()=>{let e=Number(C.value.cantidad);_.value=Number(e.toFixed(2)),R()},x=e=>oe.Z.push(e);return(0,t.bv)((()=>{k.value=M()})),(0,t.JJ)("okValue",(()=>y.value?A():H())),{refModalClientes:a,cestaActiva:n,clienteData:b,productos:f,refEncargoRecogida:u,refAmPm:s,dias:v,fechaInput:m,horaInput:p,dejaACuenta:_,onClickRecogida:h,onClickAmPm:D,clickDia:w,crearEncargo:N,precioTotal:k,refDia:g,botonBloqueado:e,numpadRef:C,modalTecladoNum:y,openTecladoNum:H,closeTecladoNum:R,finishTecladoNum:A}}},le=o(40089);const ne=(0,le.Z)(te,[["render",Y],["__scopeId","data-v-cb5587aa"]]);var ce=ne}}]);
//# sourceMappingURL=589.9a6a21dc.js.map