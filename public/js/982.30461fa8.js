"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[982],{48466:function(a,e,t){t.d(e,{Z:function(){return D}});var o=t(73396),i=t(87139);const n={class:"container"},r={key:0,class:"h3 text-center"},l={key:1,class:"h3 text-center"},c={key:2,class:"h3 text-center"},s={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},d={class:"again py-5"},m={class:"again py-5"},k={class:"again py-5"};function p(a,e,t,p,v,T){const f=(0,o.up)("MDBBtn"),g=(0,o.up)("MDBModalBody"),h=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(h,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":e[4]||(e[4]=a=>p.ModalErrorDatafonoQueHacerComponent=a),staticBackdrop:"",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o._)("div",n,[1==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",r," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,o.kq)("",!0),2==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",l," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,o.kq)("",!0),3==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",c," Ultimo pago fallido ¿Que hacemos? ")):(0,o.kq)("",!0)]),(0,o._)("div",s,[1==p.ticketExist?((0,o.wg)(),(0,o.j4)(f,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:e[0]||(e[0]=a=>p.darComoValido())},{default:(0,o.w5)((()=>[(0,o._)("span",u,(0,i.zw)(a.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),p.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":a.disabled,onClick:e[1]||(e[1]=a=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,o.w5)((()=>[(0,o._)("span",d,(0,i.zw)(a.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,o.kq)("",!0),p.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:e[2]||(e[2]=a=>p.pagoDependienta())},{default:(0,o.w5)((()=>[(0,o._)("span",m,(0,i.zw)(a.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,o.kq)("",!0),p.ticketExist>2?((0,o.wg)(),(0,o.j4)(f,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:e[3]||(e[3]=a=>p.esborrarTicket())},{default:(0,o.w5)((()=>[(0,o._)("span",k,(0,i.zw)(a.$t("anular","Anular ticket")),1)])),_:1})):(0,o.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}t(57658);var v=t(20065),T=t(91076),f=t(74313),g=t(42492),h=t.n(g),_=t(44870),w={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:f.j3,MDBModalBody:f.Yz,MDBBtn:f.$v},setup(a,{expose:e}){const t=(0,_.iH)(null),i=(0,_.iH)(0),n=(0,_.iH)(!1),r=(0,v.oR)(),l=(0,_.iH)(!1),c=(0,o.Fl)((()=>r.state.Trabajadores.arrayTrabajadores));let s=(0,_.iH)(!1);const u=(0,o.Fl)((()=>r.state.Trabajadores.indexActivo)),d=(0,o.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null));function m(a,e){if(4==e)return h().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});t.value=a,i.value=e,l.value=!0}async function k(){await T.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{l.value=!1,r.dispatch("Datafono/setEstado","APROBADA")})).catch((a=>{l.value=!0,h().fire("Oops...",a.message,"error")})),h().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function p(){null!=t.value&&(await g()?T.Z.post("tickets/anularTicket",{ticketId:t.value}).then((a=>{l.value=!1,a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo)?(n.value&&f(),h().fire({icon:"success",title:"Ticket anulado"+(n.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):a.data.res?router.push("/main"):h().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{h().fire(a.message)})):h().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function f(){T.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((a=>{h().fire("Oops...",a.message,"error")}))}async function g(){return await h().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async a=>!!a.isConfirmed))}function w(){s.value=!0,T.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{l.value=!1,s.value=!1,r.dispatch("Datafono/setEstado","PENDIENTE")})).catch((a=>{s.value=!1,l.value=!0,h().fire("Oops...",a.message,"error")})),s.value=!1,h().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function y(){h().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),l.value=!1}return e({abrirModal:m}),(0,o.bv)((async()=>{const{data:a}=await T.Z.post("parametros/getParametros");n.value="Si"==a.params?.TicketAlAnular})),{store:r,darComoValido:k,ModalErrorDatafonoQueHacerComponent:l,tarjetaUltimoTicket:w,esperandoConexion:s,TicketAlAnular:n,arrayTrabajadores:c,indexTrabajadorActivo:u,esborrarTicket:p,idSeleccionado:t,pagoDependienta:y,ticketExist:i}}},y=t(40089);const b=(0,y.Z)(w,[["render",p],["__scopeId","data-v-266e01f8"]]);var D=b},78982:function(a,e,t){t.r(e),t.d(e,{default:function(){return I}});var o=t(73396),i=t(87139);const n=a=>((0,o.dD)("data-v-2de1498c"),a=a(),(0,o.Cn)(),a),r={class:"col-md-7 listaTickets"},l={class:"th-sm"},c={class:"th-sm"},s={class:"th-sm"},u={class:"th-sm"},d=["onClick"],m={key:0,class:"col-md-5"},k={id:"detalleTicket"},p={class:"text-center"},v={class:"text-center"},T=n((()=>(0,o._)("br",null,null,-1))),f=n((()=>(0,o._)("hr",null,null,-1))),g={class:"contencionTicket"},h={class:"table"},_={class:"titulosTicket"},w={class:"titulosTicket"},y={class:"titulosTicket"},b=n((()=>(0,o._)("hr",null,null,-1))),D={class:"text-center"};function C(a,e,t,n,C,A){const E=(0,o.up)("MDBTable"),x=(0,o.up)("MDBIcon"),P=(0,o.up)("MDBBtn");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",r,[(0,o.Wm)(E,{hover:""},{default:(0,o.w5)((()=>[(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",l,(0,i.zw)(a.$t("numero_ticket","Número ticket")),1),(0,o._)("th",c,(0,i.zw)(a.$t("hora","Hora")),1),(0,o._)("th",s,(0,i.zw)(a.$t("tipo_pago","Tipo pago")),1),(0,o._)("th",u,(0,i.zw)(a.$t("total","Total")),1)])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.arrayTickets,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,class:(0,i.C_)({"table-active":a._id===n.idActivo}),onClick:t=>n.setActivo(a,e)},[(0,o._)("td",null,(0,i.zw)(a._id),1),(0,o._)("td",null,(0,i.zw)(n.getTiempo(a.timestamp)),1),(0,o._)("td",null,(0,i.zw)(a.tipoPago),1),(0,o._)("td",null,(0,i.zw)(a.total.toFixed(2))+" €",1)],10,d)))),128))])])),_:1})]),null!=n.indexTicket?((0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("div",k,[(0,o._)("h2",p,(0,i.zw)(a.$t("ticket","Ticket"))+" "+(0,i.zw)(n.arrayTickets[n.indexTicket]._id),1),(0,o._)("h6",v,(0,i.zw)(n.getTiempo(n.arrayTickets[n.indexTicket].timestamp)),1),T,f,(0,o._)("div",g,[(0,o._)("table",h,[(0,o._)("tr",null,[(0,o._)("th",_,(0,i.zw)(a.$t("producto","Producto")),1),(0,o._)("th",w,(0,i.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",y,(0,i.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.arrayTickets[n.indexTicket]?.cesta?.lista,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[(0,o._)("td",null,(0,i.zw)(a.nombre),1),(0,o._)("td",null,(0,i.zw)(a.subtotal.toFixed(2))+" €",1),(0,o._)("td",null,(0,i.zw)(a.unidades),1)])))),128))])]),b,(0,o._)("h1",D,(0,i.zw)(a.$t("total","Total"))+": "+(0,i.zw)(n.arrayTickets[n.indexTicket].total.toFixed(2)),1),(0,o.Wm)(P,{onClick:e[0]||(e[0]=a=>n.imprimirTicket()),color:"success",class:"w-100"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:"print",size:"3x"})])),_:1}),"DATAFONO_3G"!==n.arrayTickets[n.indexTicket].tipoPago&&"TARJETA"===n.arrayTickets[n.indexTicket].tipoPago||"DEVUELTO"===n.arrayTickets[n.indexTicket].tipoPago||"DEV_DATAFONO_PAYTEF"===n.arrayTickets[n.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(P,{key:0,onClick:e[1]||(e[1]=a=>n.imprimirTicketPaytef()),color:"info",class:"w-100 mt-3"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:"file-invoice-dollar",size:"3x"})])),_:1})):(0,o.kq)("",!0),"EFECTIVO"===n.arrayTickets[n.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(P,{key:1,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[2]||(e[2]=a=>n.cambiarTipoPago(n.arrayTickets[n.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_tarjeta","Pagar con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),"DATAFONO_3G"===n.arrayTickets[n.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(P,{key:2,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[3]||(e[3]=a=>n.pagarEfectivo(n.arrayTickets[n.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_efectivo","Pagar con efectivo")),1)])),_:1})):(0,o.kq)("",!0),n.prohibirAnularTicket||"DATAFONO_3G"===n.arrayTickets[n.indexTicket].tipoPago&&n.prohibirAnular3g||"ANULADO"==n.arrayTickets[n.indexTicket].tipoPago||"DEVUELTO"==n.arrayTickets[n.indexTicket].tipoPago||!n.mostrarPorAlbaran?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(P,{key:3,onClick:e[4]||(e[4]=a=>n.esborrarTicket()),color:"danger",class:"w-100 mt-4",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("devolucion_con_tarjeta_efectivo","Devolución con tarjeta/efectivo")),1)])),_:1}))])])):(0,o.kq)("",!0)],64)}t(57658);var A=t(74834),E=t(74313),x=t(44870),P=t(20065),B=t(36797),z=t.n(B),j=t(91076),M=t(42492),O=t.n(M),H=t(92136),Z=t(16797),F=t(48466),N={name:"TicketsComponent",components:{MDBTable:E.re,MDBBtn:E.$v,MDBIcon:E.vm,ModalErrorDatafonoComponent:F.Z},setup(a){const e=(0,P.oR)(),t=(0,x.iH)(null),i=(0,x.iH)(!1),n=(0,x.iH)(!1),r=(0,x.iH)(null),l=(0,x.iH)(!0),c=(0,x.iH)(!1),s=(0,x.iH)(!1),u=(e.getters["Configuracion/parametros"],(0,o.Fl)((()=>e.state.Trabajadores.arrayTrabajadores))),d=(0,o.Fl)((()=>e.state.Trabajadores.indexActivo)),m=(0,o.Fl)((()=>u.value&&void 0!=d.value&&null!=d.value&&u.value[d.value]?u.value[d.value]:null)),k=(0,o.Fl)((()=>e.state.Caja.arrayVentas)),p=(0,x.iH)(null);function v(a){const e=new Date(a);return z()(e).format("HH:mm:ss DD/MM/YYYY")}function T(){j.Z.post("impresora/imprimirTicket",{idTicket:k.value[r.value]._id}).catch((a=>{O().fire("Oops...",a.message,"error")}))}function f(){j.Z.post("impresora/imprimirTicketPaytef",{idTicket:k.value[r.value]._id}).catch((a=>{O().fire("Oops...",a.message,"error")}))}function g(a,e){t.value=a._id,r.value=e,h(a?.cesta?.idCliente)}const h=a=>{s.value?j.Z.post("/clientes/getClienteById",{idCliente:a}).then((a=>{l.value=!a.data?.albaran})).catch((a=>{console.log(a)})):l.value=!0};function _(a){j.Z.post("/movimientos/PayWithCash",{idTicket:a}).then((a=>{t.value=null,r.value=null,Z.Z.push("/main")})).catch((a=>{console.log(a)}))}async function w(a){function o(){j.Z.post("/movimientos/PayWith3G",{idTicket:a}).then((a=>{})).catch((a=>{console.log(a)}))}function i(){e.dispatch("Datafono/setEstado","PENDIENTE"),H.socket.emit("iniciarTransaccion",{idTicket:a,idTrabajador:m.value._id})}await j.Z.post("parametros/getParametros").then((a=>{"3G"===a.data?.tipoDatafono||"0.0.0.0"==a.data?.ipTefpay?o():i()})),t.value=null,r.value=null,Z.Z.push("/main")}function y(){null!=r.value?"DEUDA"!=k.value[r.value].tipoPago?confirm("¿Confirma ANULACIÓN de ticket?")&&j.Z.post("tickets/anularTicket",{ticketId:k.value[r.value]._id}).then((a=>{a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo)?(T(),O().fire({icon:"success",title:"Ticket anulado"+(c.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):a.data.res?Z.Z.push("/main"):O().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{O().fire(a.message)})):j.Z.post("deudas/getDeudaByIdTicket",{idTicket:k.value[r.value]._id,timestamp:k.value[r.value].timestamp}).then((a=>{let e=0;k.value[r.value].movimientos.length>0&&(e=k.value[r.value].movimientos.length-1),a&&(""==a.data&&"DEUDA"==k.value[r.value].movimientos[e].tipo||"SIN_PAGAR"==a.data.estado)?O().fire({icon:"info",title:"No se puede anular la deuda desde tickets",showConfirmButton:!0}):a&&""==a.data?O().fire({icon:"info",title:"Deuda ya saldada",showConfirmButton:!0}):a.data&&""!=a.data&&"ANULADO"==a.data.estado?O().fire({icon:"info",title:"Este ticket ya se ha anulado en deudas",showConfirmButton:!0}):"PAGADO"==a.data.estado&&O().fire({icon:"info",title:"Este ticket ya se ha pagado, Num ticket: "+a.data.idTicket,showConfirmButton:!0})})).catch((a=>{O().fire(a.message)})):O().fire("Primero selecciona el ticket")}function b(a){Z.Z.push(a)}return(0,o.bv)((async()=>{A.W.cargarVentas();const{data:a}=await j.Z.post("parametros/getParametros");i.value="Si"==a.params?.ProhibirAnulacioTicket,n.value="Si"==a.params?.prohibirAnular3g,s.value="Si"==a.params?.prohibirAnularTkAlbaran,c.value="Si"==a.params?.TicketAlAnular,k.value&&k.value.length>0&&g(k.value[0],0)})),{modalErrorDatafonoRef:p,arrayTickets:k,getTiempo:v,setActivo:g,idActivo:t,cambiarTipoPago:w,imprimirTicket:T,esborrarTicket:y,prohibirAnularTicket:i,goTo:b,pagarEfectivo:_,prohibirAnular3g:n,indexTicket:r,imprimirTicketPaytef:f,mostrarPorAlbaran:l}}},$=t(40089);const U=(0,$.Z)(N,[["render",C],["__scopeId","data-v-2de1498c"]]);var I=U}}]);
//# sourceMappingURL=982.30461fa8.js.map