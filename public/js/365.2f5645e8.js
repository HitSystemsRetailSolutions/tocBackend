"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[365],{9365:function(a,e,o){o.r(e),o.d(e,{default:function(){return H}});var r=o(3396),n=o(7139);const t={class:"row mt-2"},s={class:"row mt-4 divInferior"},l={class:"col anchoCajaConsumoPersonal"},i={key:0,class:"col tablaDescansando table-responsive d-inline",style:{"background-color":"white"}},c={class:"table"},d={class:"tituloDescanso"},u=["onClick"],f={class:"textoNombre d-inline-block text-truncate"};function m(a,e,o,m,p,h){const v=(0,r.up)("MDBCardTitle"),b=(0,r.up)("MDBIcon"),w=(0,r.up)("MDBCardBody"),_=(0,r.up)("MDBCard"),g=(0,r.up)("MDBBtn"),C=(0,r.up)("FichajesModal");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",t,[(0,r.Wm)(_,{onClick:e[0]||(e[0]=a=>m.modalFichajes.abrirModal()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("iniciar_turno","Iniciar turno")),1)])),_:1}),(0,r.Wm)(b,{class:"mt-3",icon:"play",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(_,{onClick:e[1]||(e[1]=a=>m.iniciarDescanso()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("iniciar_descanso","Iniciar descanso")),1)])),_:1}),(0,r.Wm)(b,{class:"mt-3",icon:"pause",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(_,{onClick:e[2]||(e[2]=a=>m.preguntarFinalizarTurno()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("finalizar_turno","Finalizar turno")),1)])),_:1}),(0,r.Wm)(b,{class:"mt-3",icon:"stop",iconStyle:"fas",size:"6x"})])),_:1})])),_:1})]),(0,r._)("div",s,[(0,r._)("div",l,[m.trabajadorActivo?((0,r.wg)(),(0,r.j4)(g,{key:0,onClick:e[3]||(e[3]=a=>m.activarConsumoPersonal()),color:"primary",class:"w-100 botonConsumoPersonal"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("consumo_personal","Consumo personal")),1)])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(g,{onClick:e[4]||(e[4]=a=>m.apagar_equipo()),color:"danger",class:"w-100 botonConsumoPersonal mt-4"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("apagar_equipo","Apagar equipo")),1)])),_:1}),null!=m.idActivoDescanso?((0,r.wg)(),(0,r.j4)(g,{key:1,onClick:e[5]||(e[5]=a=>m.preguntarFinalDescanso()),color:"primary",class:"w-100 botonConsumoPersonal mt-4"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("finalizar_descanso","Finalizar descanso")),1)])),_:1})):(0,r.kq)("",!0)]),m.arrayTrabajadoresDescanso&&m.arrayTrabajadoresDescanso.length>0?((0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("table",c,[(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",d,(0,n.zw)(a.$t("trabajadores_en_descanso_activo","Trabajadores en descanso activo")),1)])]),(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(m.arrayTrabajadoresDescanso,((a,e)=>((0,r.wg)(),(0,r.iD)("tr",{key:e,class:(0,n.C_)({activoTabla:a._id===m.idActivoDescanso}),onClick:e=>m.setActivo(a._id)},[(0,r._)("td",null,[(0,r._)("span",f,(0,n.zw)(a.nombre),1)])],10,u)))),128))])])])):(0,r.kq)("",!0)]),(0,r.Wm)(C,{ref:"modalFichajes"},null,512)],64)}o(7658);var p=o(4834),h=o(4161),v=o(4313),b=o(2492),w=o.n(b),_=o(4870),g=o(65),C=o(9242);const D={class:"row"},j={key:0,class:"row mt-2"},B={class:"table table-striped"},k={class:"textoNombre d-inline-block text-truncate"},M={key:1,class:"row"},y={class:"sinResultados position-relative"},T={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function F(a,e,o,t,s,l){const i=(0,r.up)("MDBModalTitle"),c=(0,r.up)("MDBModalHeader"),d=(0,r.up)("MDBBtn"),u=(0,r.up)("MDBModalBody"),f=(0,r.up)("MDBModalFooter"),m=(0,r.up)("MDBModal");return(0,r.wg)(),(0,r.j4)(m,{id:"modalFichajes",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:t.modalFichajes,"onUpdate:modelValue":e[2]||(e[2]=a=>t.modalFichajes=a),size:"xl",modalFichajes:""},{default:(0,r.w5)((()=>[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i,{id:"staticBackdropLabel"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("fichar","Fichar")),1)])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r._)("div",D,[(0,r.wy)((0,r._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":e[0]||(e[0]=a=>t.inputBusqueda=a)},null,512),[[C.nr,t.inputBusqueda]])]),t.arrayTrabajadores&&t.arrayTrabajadores.length>0?((0,r.wg)(),(0,r.iD)("div",j,[(0,r._)("table",B,[(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.arrayTrabajadores,((e,o)=>((0,r.wg)(),(0,r.iD)("tr",{key:o},[(0,r._)("td",null,[(0,r._)("span",k,(0,n.zw)(e.nombre),1)]),(0,r._)("td",null,[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:a=>t.fichar(e._id),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("fichar","Fichar")),1)])),_:2},1032,["onClick"])])])))),128))])])])):((0,r.wg)(),(0,r.iD)("div",M,[(0,r._)("div",y,[(0,r._)("span",T,(0,n.zw)(a.$t("sin_resultados","Sin resultados")),1)])]))])),_:1}),(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:e[1]||(e[1]=a=>t.modalFichajes=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var z={name:"FichajesModal",components:{MDBModal:v.j3,MDBModalHeader:v.ol,MDBModalTitle:v.wo,MDBModalBody:v.Yz,MDBModalFooter:v.ab,MDBBtn:v.$v},setup(){const a=(0,_.iH)(null),e=(0,_.iH)([]),o=(0,_.iH)("");function n(){a.value=!0}function t(){h.Z.post("trabajadores/buscar",{busqueda:o.value}).then((a=>{e.value=a.data})).catch((a=>{w().fire("Oops...",a.message,"error")}))}function s(e){h.Z.post("trabajadores/fichar",{idTrabajador:e}).then((e=>{if(!e.data)throw Error("Error, no se ha podido fichar");p.W.cargarTrabajadoresFichados(),a.value=!1})).catch((a=>{w().fire("Oops...",a.message,"error")}))}return(0,r.YP)(o,(()=>{t()})),{modalFichajes:a,abrirModal:n,arrayTrabajadores:e,inputBusqueda:o,fichar:s}}},W=o(89);const x=(0,W.Z)(z,[["render",F],["__scopeId","data-v-6f9e5052"]]);var q=x,$=o(250),A={name:"fichajesView",components:{MDBIcon:v.vm,FichajesModal:q,MDBCard:v.Yl,MDBCardBody:v.H7,MDBCardTitle:v.QM,MDBBtn:v.$v},setup(){const a=(0,g.oR)(),e=(0,_.iH)(null),o=(0,_.iH)([]),n=(0,_.iH)(null),t=(0,r.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),s=(0,r.Fl)((()=>a.state.Trabajadores.indexActivo)),l=(0,r.Fl)((()=>t.value&&void 0!=s.value&&null!=s.value&&t.value[s.value]?t.value[s.value]:null)),i=(0,r.Fl)((()=>a.state.Cestas.arrayCestas)),c=(0,r.Fl)((()=>{if(i.value)for(let a=0;a<i.value.length;a++)if(i.value[a]._id==t.value[s.value].idCesta)return i.value[a];return null}));function d(a){n.value=a}function u(){n.value=null}function f(){h.Z.post("trabajadores/desfichar",{idTrabajador:l.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido registrar el fin de turno (backend)");p.W.cargarTrabajadoresFichados(),w().fire("OK","Fin de turno registrado correctamente","success")})).catch((a=>{w().fire("Oops...",a.message,"error")}))}function m(a){for(let e=0;e<o.value.length;e++)if(a===o.value[e]._id)return o.value[e];return null}function v(){if(n.value){const a=m(n.value);a&&w().fire({title:"Por favor, confirma el descanso para: ",html:`${a.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&j(n.value)}))}}function b(){w().fire({title:"¿Desea realmente apagar el equipo? ",html:"¡Esta funcion apagará instantaneamente su equipo!",showCancelButton:!0,confirmButtonText:"Apagar",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.4)"}).then((a=>{a.isConfirmed&&h.Z.post("controlTpv/ApagarOrdenador",{}).then((a=>{a.data?w().fire("¡Apagando!","Su equipo se apagará en unos instantes...","success"):w().fire("¡No hemos podido apagar el equipo!","Si el error se mantiene, pruebe a forzar un apagado!","error")})).catch((a=>{w().fire("¡No hemos podido apagar el equipo!","Si el error se mantiene, pruebe a forzar un apagado!"+a,"error")}))}))}async function C(){if(i.value&&c.value)for(let e=0;e<i.value.length;e++)if(i.value[e]._id===c.value._id){await a.dispatch("Cestas/setModoCesta",{modo:"CONSUMO_PERSONAL",index:e}),$.Z.push("/main");break}}function D(){l.value&&w().fire({title:"Confirma. Fin de turno para: ",html:`${l.value.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&f()}))}function j(a){h.Z.post("trabajadores/finDescanso",{idTrabajador:a}).then((a=>{if(!a.data)throw Error("Error, no se  ha podido iniciar el descanso");p.W.cargarTrabajadoresFichados(),u(),k(),w().fire("Descanso finalizado","","success")})).catch((a=>{w().fire("Oops...",a.message,"error")}))}function B(){l.value._id?h.Z.post("trabajadores/inicioDescanso",{idTrabajador:l.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido iniciar el descanso");k(),p.W.cargarTrabajadoresFichados(),w().fire("OK","Descanso iniciado correctamente","success")})).catch((a=>{w().fire("Oops...",a.message,"error")})):w().fire("Importante....","Es necesario un trabajador activo para realizar esta acción","warning")}function k(){h.Z.get("trabajadores/descansando").then((a=>{if(!a.data)throw Error("Error, no se han podido obtener los trabajadores en descanso");o.value=a.data})).catch((a=>{w().fire("Oops...",a.message,"error")}))}return(0,r.bv)((()=>{k()})),{modalFichajes:e,arrayTrabajadoresDescanso:o,idActivoDescanso:n,setActivo:d,trabajadorActivo:l,finDeTurno:f,iniciarDescanso:B,preguntarFinalDescanso:v,resetidActivoDescansando:u,preguntarFinalizarTurno:D,activarConsumoPersonal:C,apagar_equipo:b}}};const E=(0,W.Z)(A,[["render",m],["__scopeId","data-v-ed33376e"]]);var H=E}}]);
//# sourceMappingURL=365.2f5645e8.js.map