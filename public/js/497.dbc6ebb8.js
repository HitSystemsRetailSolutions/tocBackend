"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[497],{4286:function(a,e,t){t.d(e,{Z:function(){return y}});var o=t(73396),i=t(87139);const r={class:"container"},n={key:0,class:"h3 text-center"},l={key:1,class:"h3 text-center"},c={key:2,class:"h3 text-center"},s={class:"row mt-2 container botonesCaja"},d={class:"again py-5"},u={class:"again py-5"},k={class:"again py-5"};function p(a,e,t,p,m,T){const v=(0,o.up)("MDBBtn"),f=(0,o.up)("MDBModalBody"),g=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(g,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":e[3]||(e[3]=a=>p.ModalErrorDatafonoQueHacerComponent=a),staticBackdrop:"",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o._)("div",r,[1==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",n," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,o.kq)("",!0),2==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",l," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,o.kq)("",!0),3==p.ticketExist?((0,o.wg)(),(0,o.iD)("p",c," Ultimo pago cancelado, que hacemos? ¿Que hacemos? ")):(0,o.kq)("",!0)]),(0,o._)("div",s,[1==p.ticketExist?((0,o.wg)(),(0,o.j4)(v,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:e[0]||(e[0]=a=>p.darComoValido())},{default:(0,o.w5)((()=>[(0,o._)("span",d,(0,i.zw)(a.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),p.ticketExist>1?((0,o.wg)(),(0,o.j4)(v,{key:1,color:"warning  ",size:"lg",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":a.disabled,onClick:e[1]||(e[1]=a=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,o.w5)((()=>[(0,o._)("span",u,(0,i.zw)(a.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,o.kq)("",!0),p.ticketExist>1?((0,o.wg)(),(0,o.j4)(v,{key:2,color:"primary  ",size:"lg",class:"botonEstado my-3 botones",onClick:e[2]||(e[2]=a=>p.pagoDependienta())},{default:(0,o.w5)((()=>[(0,o._)("span",k,(0,i.zw)(a.$t("pago en efectivo","PAGO EN EFECTIVO O EN 3G")),1)])),_:1})):(0,o.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}var m=t(20065),T=t(44161),v=t(74313),f=t(42492),g=t.n(f),_=t(44870),w={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:v.j3,MDBModalBody:v.Yz,MDBBtn:v.$v},setup(a,{expose:e}){const t=(0,_.iH)(null),i=(0,_.iH)(0),r=(0,m.oR)(),n=(0,_.iH)(!1),l=(0,o.Fl)((()=>r.state.Trabajadores.arrayTrabajadores));let c=(0,_.iH)(!1);const s=(0,o.Fl)((()=>r.state.Trabajadores.indexActivo)),d=(0,o.Fl)((()=>l.value&&void 0!=s.value&&null!=s.value&&l.value[s.value]?l.value[s.value]:null));function u(a,e){if(4==e)return g().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});t.value=a,i.value=e,n.value=!0}async function k(){await T.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{n.value=!1,r.dispatch("Datafono/setEstado","APROBADA")})).catch((a=>{n.value=!0,g().fire("Oops...",a.message,"error")})),g().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}function p(){c.value=!0,T.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{n.value=!1,c.value=!1,r.dispatch("Datafono/setEstado","PENDIENTE")})).catch((a=>{c.value=!1,n.value=!0,g().fire("Oops...",a.message,"error")})),c.value=!1,g().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function v(){g().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),n.value=!1}return e({abrirModal:u}),(0,o.bv)((()=>{})),{store:r,darComoValido:k,ModalErrorDatafonoQueHacerComponent:n,tarjetaUltimoTicket:p,esperandoConexion:c,arrayTrabajadores:l,indexTrabajadorActivo:s,idSeleccionado:t,pagoDependienta:v,ticketExist:i}}},h=t(40089);const b=(0,h.Z)(w,[["render",p],["__scopeId","data-v-1ca4de76"]]);var y=b},497:function(a,e,t){t.r(e),t.d(e,{default:function(){return q}});var o=t(73396),i=t(87139);const r=a=>((0,o.dD)("data-v-794e45b3"),a=a(),(0,o.Cn)(),a),n={class:"col-md-7 listaTickets"},l={class:"th-sm"},c={class:"th-sm"},s={class:"th-sm"},d={class:"th-sm"},u=["onClick"],k={key:0,class:"col-md-5"},p={id:"detalleTicket"},m={class:"text-center"},T={class:"text-center"},v=r((()=>(0,o._)("br",null,null,-1))),f=r((()=>(0,o._)("hr",null,null,-1))),g={class:"contencionTicket"},_={class:"table"},w={class:"titulosTicket"},h={class:"titulosTicket"},b={class:"titulosTicket"},y=r((()=>(0,o._)("hr",null,null,-1))),D={class:"text-center"};function x(a,e,t,r,x,C){const E=(0,o.up)("MDBTable"),z=(0,o.up)("MDBIcon"),j=(0,o.up)("MDBBtn"),A=(0,o.up)("ModalErrorDatafonoComponent");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",n,[(0,o.Wm)(E,{hover:""},{default:(0,o.w5)((()=>[(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",l,(0,i.zw)(a.$t("numero_ticket","Número ticket")),1),(0,o._)("th",c,(0,i.zw)(a.$t("hora","Hora")),1),(0,o._)("th",s,(0,i.zw)(a.$t("tipo_pago","Tipo pago")),1),(0,o._)("th",d,(0,i.zw)(a.$t("total","Total")),1)])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.arrayTickets,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,class:(0,i.C_)({"table-active":a._id===r.idActivo}),onClick:t=>r.setActivo(a,e)},[(0,o._)("td",null,(0,i.zw)(a._id),1),(0,o._)("td",null,(0,i.zw)(r.getTiempo(a.timestamp)),1),(0,o._)("td",null,(0,i.zw)(a.tipoPago),1),(0,o._)("td",null,(0,i.zw)(a.total.toFixed(2))+" €",1)],10,u)))),128))])])),_:1})]),null!=r.indexTicket?((0,o.wg)(),(0,o.iD)("div",k,[(0,o._)("div",p,[(0,o._)("h2",m,(0,i.zw)(a.$t("ticket","Ticket"))+" "+(0,i.zw)(r.arrayTickets[r.indexTicket]._id),1),(0,o._)("h6",T,(0,i.zw)(r.getTiempo(r.arrayTickets[r.indexTicket].timestamp)),1),v,f,(0,o._)("div",g,[(0,o._)("table",_,[(0,o._)("tr",null,[(0,o._)("th",w,(0,i.zw)(a.$t("producto","Producto")),1),(0,o._)("th",h,(0,i.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",b,(0,i.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.arrayTickets[r.indexTicket]?.cesta?.lista,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[(0,o._)("td",null,(0,i.zw)(a.nombre),1),(0,o._)("td",null,(0,i.zw)(a.subtotal.toFixed(2))+" €",1),(0,o._)("td",null,(0,i.zw)(a.unidades),1)])))),128))])]),y,(0,o._)("h1",D,(0,i.zw)(a.$t("total","Total"))+": "+(0,i.zw)(r.arrayTickets[r.indexTicket].total.toFixed(2)),1),(0,o.Wm)(j,{onClick:e[0]||(e[0]=a=>r.imprimirTicket()),color:"success",class:"w-100"},{default:(0,o.w5)((()=>[(0,o.Wm)(z,{icon:"print",size:"3x"})])),_:1}),!1===r.arrayTickets[r.indexTicket].datafono3G&&"TARJETA"===r.arrayTickets[r.indexTicket].tipoPago||"DEVUELTO"===r.arrayTickets[r.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(j,{key:0,onClick:e[1]||(e[1]=a=>r.imprimirTicketPaytef()),color:"info",class:"w-100 mt-3"},{default:(0,o.w5)((()=>[(0,o.Wm)(z,{icon:"file-invoice-dollar",size:"3x"})])),_:1})):(0,o.kq)("",!0),"EFECTIVO"===r.arrayTickets[r.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(j,{key:1,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[2]||(e[2]=a=>r.cambiarTipoPago(r.arrayTickets[r.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_tarjeta","Pagar con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),"DATAFONO_3G"===r.arrayTickets[r.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(j,{key:2,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[3]||(e[3]=a=>r.pagarEfectivo(r.arrayTickets[r.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_efectivo","Pagar con efectivo")),1)])),_:1})):(0,o.kq)("",!0),r.prohibirAnularTicket||"DATAFONO_3G"===r.arrayTickets[r.indexTicket].tipoPago&&r.prohibirAnular3g||"ANULADO"==r.arrayTickets[r.indexTicket].tipoPago||"DEVUELTO"==r.arrayTickets[r.indexTicket].tipoPago?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(j,{key:3,onClick:e[4]||(e[4]=a=>r.esborrarTicket()),color:"danger",class:"w-100 mt-4",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("devolucion_con_tarjeta_efectivo","Devolución con tarjeta/efectivo")),1)])),_:1}))])])):(0,o.kq)("",!0),(0,o.Wm)(A,{ref:"modalErrorDatafonoRef"},null,512)],64)}t(57658);var C=t(74834),E=t(74313),z=t(44870),j=t(20065),A=t(36797),P=t.n(A),M=t(44161),B=t(42492),H=t.n(B),O=t(92136),$=t(6109),F=t(4286),Z={name:"TicketsComponent",components:{MDBTable:E.re,MDBBtn:E.$v,MDBIcon:E.vm,ModalErrorDatafonoComponent:F.Z},setup(){const a=(0,j.oR)(),e=(0,z.iH)(null),t=(0,z.iH)(!1),i=(0,z.iH)(!1),r=(0,z.iH)(null),n=(0,o.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),l=(0,o.Fl)((()=>a.state.Trabajadores.indexActivo)),c=(0,o.Fl)((()=>n.value&&void 0!=l.value&&null!=l.value&&n.value[l.value]?n.value[l.value]:null)),s=(0,o.Fl)((()=>a.state.Caja.arrayVentas)),d=(0,z.iH)(null);function u(a){const e=new Date(a);return P()(e).format("HH:mm:ss DD/MM/YYYY")}function k(){M.Z.post("impresora/imprimirTicket",{idTicket:s.value[r.value]._id}).catch((a=>{H().fire("Oops...",a.message,"error")}))}function p(){M.Z.post("impresora/imprimirTicketPaytef",{idTicket:s.value[r.value]._id}).catch((a=>{H().fire("Oops...",a.message,"error")}))}function m(a,t){e.value=a._id,r.value=t}function T(a){O.socket.emit("toggle3g",{idTicket:a,idTrabajador:c.value._id}),e.value=null,r.value=null,$.Z.push("/main")}function v(a){function t(){O.socket.emit("toggle3g",{idTicket:a,idTrabajador:c.value._id})}function o(){O.socket.emit("iniciarTransaccion",{idTicket:a,idTrabajador:c.value._id})}M.Z.post("parametros/getParametros").then((a=>{"3G"===a.data?.tipoDatafono||"0.0.0.0"==a.data?.ipTefpay?t():o()})),e.value=null,r.value=null,$.Z.push("/main")}function f(){null!=r.value&&(confirm("¿Confirma ANULACIÓN de ticket?")?M.Z.post("tickets/anularTicket",{ticketId:s.value[r.value]._id}).then((a=>{a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipoPago)?H().fire({icon:"success",title:"Ticket anulado",showConfirmButton:!1,timer:1200}):a.data.res?$.Z.push("/main"):H().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{H().fire(a.message)})):H().fire("Primero selecciona el ticket"))}function g(a){$.Z.push(a)}return(0,o.bv)((()=>{C.W.cargarVentas(),s.value&&s.value.length>0&&m(s.value[0],0),M.Z.post("parametros/getParametros").then((a=>{"Si"==a.data?.params?.ProhibirAnulacioTicket&&(t.value=!0),"Si"==a.data.params.prohibirAnular3g&&(i.value=!0)}))})),{modalErrorDatafonoRef:d,arrayTickets:s,getTiempo:u,setActivo:m,idActivo:e,cambiarTipoPago:v,imprimirTicket:k,esborrarTicket:f,prohibirAnularTicket:t,goTo:g,pagarEfectivo:T,prohibirAnular3g:i,indexTicket:r,imprimirTicketPaytef:p}}},U=t(40089);const V=(0,U.Z)(Z,[["render",x],["__scopeId","data-v-794e45b3"]]);var q=V}}]);
//# sourceMappingURL=497.dbc6ebb8.js.map