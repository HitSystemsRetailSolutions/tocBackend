"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[40],{18763:function(a,e,t){t.d(e,{Z:function(){return c}});var o=t(73396),l=t(87139);const i={class:"input-group position-absolute bottom-0 start-0"};function s(a,e,t,s,r,n){return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("button",{onClick:e[0]||(e[0]=a=>s.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px","margin-bottom":"0.5rem"}},(0,l.zw)(a.$t("volver","VOLVER")),1)])}var r=t(6411),n={name:"VolverComponent",setup(){function a(){r.Z.back()}return{volver:a}}},d=t(40089);const u=(0,d.Z)(n,[["render",s]]);var c=u},79066:function(a,e,t){t.d(e,{Z:function(){return D}});var o=t(73396),l=t(87139);const i={class:"row mt-2"},s={class:"col-md-3"},r={key:0,class:"sizeLetrasCambio"},n={class:"sizeLetrasCambio"},d={key:1,class:"estiloFalta sizeLetrasCambio"},u={key:2,class:"estiloPerfecto sizeLetrasCambio"},c={key:3,class:"estiloSobra sizeLetrasCambio"},m={class:"col-md-9"},v={class:"row"},g={class:"col text-end"},p={class:"row mt-2"},f={class:"col text-end"};function C(a,e,t,C,b,k){const w=(0,o.up)("MDBCardTitle"),_=(0,o.up)("MDBCardText"),T=(0,o.up)("MDBBtn"),D=(0,o.up)("MDBCardBody"),h=(0,o.up)("MDBCard");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("div",s,[(0,o.Wm)(h,{class:"cardInfoCambio"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("informacion_cambio","Información cambio")),1)])),_:1}),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[null!=C.cantidadTkrs&&void 0!=C.cantidadTkrs?((0,o.wg)(),(0,o.iD)("li",r,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(C.totalRecibido+C.cantidadTkrs).toFixed(2))+" € ",1)):(0,o.kq)("",!0),(0,o._)("li",n,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*C.aPagar)/100).toFixed(2))+" € ",1),null!=C.cuenta&&void 0!=C.cuenta&&C.cuenta>0?((0,o.wg)(),(0,o.iD)("li",d,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*C.cuenta)/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=C.cuenta&&void 0!=C.cuenta&&0==C.cuenta?((0,o.wg)(),(0,o.iD)("li",u,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,o.kq)("",!0),null!=C.cuenta&&void 0!=C.cuenta&&C.cuenta<0?((0,o.wg)(),(0,o.iD)("li",c,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(C.aPagar-C.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(T,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>C.deshacer()),class:"sizeBotones"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,o.Wm)(T,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>C.limpiar())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])),_:1})])),_:1})]),(0,o._)("div",m,[(0,o._)("div",v,[(0,o._)("div",g,[(0,o._)("img",{src:"/img/1cts.png",class:"sizeMonedas",onClick:e[2]||(e[2]=a=>C.sumar(.01))}),(0,o._)("img",{src:"/img/2cts.png",class:"sizeMonedas",onClick:e[3]||(e[3]=a=>C.sumar(.02))}),(0,o._)("img",{src:"/img/5cts.png",class:"sizeMonedas",onClick:e[4]||(e[4]=a=>C.sumar(.05))}),(0,o._)("img",{src:"/img/10cts.png",class:"sizeMonedas",onClick:e[5]||(e[5]=a=>C.sumar(.1))}),(0,o._)("img",{src:"/img/20cts.png",class:"sizeMonedas",onClick:e[6]||(e[6]=a=>C.sumar(.2))}),(0,o._)("img",{src:"/img/50cts.png",class:"sizeMonedas",onClick:e[7]||(e[7]=a=>C.sumar(.5))}),(0,o._)("img",{src:"/img/uneuro.png",class:"sizeMonedas",onClick:e[8]||(e[8]=a=>C.sumar(1))}),(0,o._)("img",{src:"/img/doseuros.png",class:"sizeMonedas",onClick:e[9]||(e[9]=a=>C.sumar(2))})])]),(0,o._)("div",p,[(0,o._)("div",f,[(0,o._)("img",{src:"/img/5euros.png",class:"sizeBilletes",onClick:e[10]||(e[10]=a=>C.sumar(5))}),(0,o._)("img",{src:"/img/10euros.png",class:"sizeBilletes",onClick:e[11]||(e[11]=a=>C.sumar(10))}),(0,o._)("img",{src:"/img/20euros.png",class:"sizeBilletes",onClick:e[12]||(e[12]=a=>C.sumar(20))}),(0,o._)("img",{src:"/img/50euros.png",class:"sizeBilletes",onClick:e[13]||(e[13]=a=>C.sumar(50))}),(0,o._)("img",{src:"/img/100euros.png",class:"sizeBilletes",onClick:e[14]||(e[14]=a=>C.sumar(100))}),(0,o._)("img",{src:"/img/200euros.png",class:"sizeBilletes",onClick:e[15]||(e[15]=a=>C.sumar(200))}),(0,o._)("img",{src:"/img/500euros.png",class:"sizeBilletes",onClick:e[16]||(e[16]=a=>C.sumar(500))})])])])])}t(57658);var b=t(44870),k=t(74313),w={name:"CambioComponent",components:{MDBCard:k.Yl,MDBCardBody:k.H7,MDBCardTitle:k.QM,MDBCardText:k.Pp,MDBBtn:k.$v},setup(a,{expose:e}){const t=(0,b.iH)(0),l=(0,o.f3)("total"),i=(0,b.iH)(l),s=(0,b.iH)([]),r=(0,b.iH)(0),n=(0,o.Fl)((()=>i.value-r.value<0?0:i.value-(t.value+r.value)));function d(a){t.value+=a,s.value.push(a)}function u(){s.value.pop();let a=0;s.value.forEach((e=>{a+=e})),t.value=a}function c(){t.value=0,s.value=[]}function m(a){r.value=Number(a)}return e({setTkrs:m}),{sumar:d,totalRecibido:t,aPagar:i,deshacer:u,limpiar:c,cantidadTkrs:r,cuenta:n}}},_=t(40089);const T=(0,_.Z)(w,[["render",C],["__scopeId","data-v-0e9fd9d8"]]);var D=T},38020:function(a,e,t){t.d(e,{Z:function(){return f}});var o=t(73396),l=t(87139);const i={class:"row"},s={key:0,class:"cantidad text-center"},r={class:"row mt-2"},n={class:"col text-center"};function d(a,e,t,d,u,c){const m=(0,o.up)("MDBModalTitle"),v=(0,o.up)("MDBModalHeader"),g=(0,o.up)("NumpadComponent"),p=(0,o.up)("MDBModalBody"),f=(0,o.up)("MDBBtn"),C=(0,o.up)("MDBModalFooter"),b=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(b,{id:"modalTkrs",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:d.modalTkrs,"onUpdate:modelValue":e[1]||(e[1]=a=>d.modalTkrs=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{id:"modalTkrsLabel"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("introduce_la_cantidad_del_tiquet_restaurante","Introduce la cantidad del tiquet restaurante")),1)])),_:1})])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o._)("div",i,[d.numPadRef?((0,o.wg)(),(0,o.iD)("span",s,(0,l.zw)(d.numPadRef.cantidad),1)):(0,o.kq)("",!0)]),(0,o._)("div",r,[(0,o._)("div",n,[(0,o.Wm)(g,{ref:"numPadRef"},null,512)])])])),_:1}),(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{color:"danger",size:"lg",onClick:e[0]||(e[0]=a=>d.modalTkrs=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var u=t(74313),c=t(86619),m=t(44870),v={name:"ModalTkrsComponent",components:{MDBModal:u.j3,MDBModalHeader:u.ol,MDBModalTitle:u.wo,MDBModalBody:u.Yz,MDBModalFooter:u.ab,MDBBtn:u.$v,NumpadComponent:c.Z},setup(a,{expose:e}){const t=(0,m.iH)(!1),l=(0,m.iH)(null),i=(0,o.f3)("setTkrs");function s(){t.value=!0}function r(){t.value=!1,i(l.value.cantidad)}return(0,o.JJ)("okValue",r),e({abrirModal:s}),{modalTkrs:t,numPadRef:l,okValue:r}}},g=t(40089);const p=(0,g.Z)(v,[["render",d],["__scopeId","data-v-b796d518"]]);var f=p},51040:function(a,e,t){t.d(e,{Z:function(){return va}});var o=t(73396),l=t(87139);const i=a=>((0,o.dD)("data-v-21dbe890"),a=a(),(0,o.Cn)(),a),s={class:"row"},r={class:"row mt-2"},n={class:"col-md-3"},d={class:"text-center"},u={class:"mt-4"},c={id:"detalleTicket"},m={class:"contencionTicket"},v={class:"table"},g={class:"titulosTicket"},p={class:"titulosTicket"},f={class:"titulosTicket"},C=i((()=>(0,o._)("hr",null,null,-1))),b={class:"sizeLetrasCambio"},k={key:0,class:"sizeLetrasCambio"},w={key:1,class:"estiloParcial sizeLetrasCambio"},_={key:2,class:"estiloFalta sizeLetrasCambio"},T={key:3,class:"estiloPerfecto sizeLetrasCambio"},D={key:4,class:"estiloSobra sizeLetrasCambio"},h={key:5,class:"estiloSobra sizeLetrasCambio"},z={key:6,class:"estiloPendiente sizeLetrasCambio"},M={class:"col-md-9",style:{"padding-left":"4vmin"}},y={class:"row"},B={class:"col text-end",style:{"margin-top":"2vmin"}},E=["src","onClick"],A={class:"row mt-2"},F={class:"col text-end",style:{"margin-top":"2vmin"}},P=["src","onClick"],j={class:"row"},R={class:"col mt-4"},O={class:"divBotones"},V=["disabled"],x=["disabled"],S=["disabled"],Z=["disabled"],I={class:"row"},N={class:"cantidad text-center"},$={class:"row mt-2"},W={class:"col text-center"},H={key:0,class:"estadoPaytef"},L=i((()=>(0,o._)("h3",null,"Estado:",-1))),q={style:{"margin-top":"1vm","font-weight":"300",color:"orangered","font-size":"1.3em"}},G={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function U(a,e,t,i,U,J){const Y=(0,o.up)("MDBCardTitle"),K=(0,o.up)("MDBCardText"),Q=(0,o.up)("MDBBtn"),X=(0,o.up)("MDBCardBody"),aa=(0,o.up)("MDBCard"),ea=(0,o.up)("ModalTkrsComponent"),ta=(0,o.up)("NumpadComponent"),oa=(0,o.up)("MDBModalBody"),la=(0,o.up)("MDBModal"),ia=(0,o.up)("MDBIcon");return(0,o.wg)(),(0,o.j4)(la,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:i.modalCobro,"onUpdate:modelValue":e[9]||(e[9]=a=>i.modalCobro=a),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,o.w5)((()=>[(0,o.Wm)(oa,{style:{"background-color":"#fff5e9"}},{default:(0,o.w5)((()=>[(0,o._)("div",s,[(0,o._)("div",r,[(0,o._)("div",n,[(0,o.Wm)(aa,{class:"cardInfoCambio",style:{height:"80vmin"}},{default:(0,o.w5)((()=>[(0,o.Wm)(X,{style:{display:"flex","flex-direction":"column","justify-content":"space-evenly"}},{default:(0,o.w5)((()=>[(0,o.Wm)(Y,null,{default:(0,o.w5)((()=>[(0,o._)("h2",d,(0,l.zw)(a.$t("ticket","Ticket"))+":",1)])),_:1}),(0,o._)("div",u,[(0,o._)("div",c,[(0,o._)("div",m,[(0,o._)("table",v,[(0,o._)("tr",null,[(0,o._)("th",g,(0,l.zw)(a.$t("producto","Producto")),1),(0,o._)("th",p,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",f,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.productos,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,style:(0,l.j5)(a.pagado?"text-decoration: line-through":"")},[(0,o._)("td",null,(0,l.zw)(a.nombre),1),(0,o._)("td",null,(0,l.zw)((a.subtotal-a.subtotal*i.DescuentoCliente).toFixed(2))+" € ",1),(0,o._)("td",null,(0,l.zw)(a.unidades),1)],4)))),128))])]),C])]),(0,o.Wm)(K,null,{default:(0,o.w5)((()=>[(0,o._)("li",b,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*i.aPagar)/100).toFixed(2))+" € ",1),null!=i.cantidadTkrs&&void 0!=i.cantidadTkrs?((0,o.wg)(),(0,o.iD)("li",k,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(i.totalRecibido+i.cantidadTkrs+i.dejaCuenta).toFixed(2))+" € ",1)):(0,o.kq)("",!0),i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,o.wg)(),(0,o.iD)("li",w,(0,l.zw)(a.$t("pago_parcial","Pago parcial"))+": "+(0,l.zw)(i.montoDeuda)+"€ ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta>0?((0,o.wg)(),(0,o.iD)("li",_,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*i.cuenta)/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&0==i.cuenta?((0,o.wg)(),(0,o.iD)("li",T,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0&&!(i.deudasSeleccionadas.length>0&&i.montoDeuda>0)?((0,o.wg)(),(0,o.iD)("li",D,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(i.aPagar-i.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0&&i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,o.wg)(),(0,o.iD)("li",h,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(i.montoDeuda-i.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,o.wg)(),(0,o.iD)("li",z,(0,l.zw)(a.$t("saldo_pendiente","Saldo pendiente"))+": "+(0,l.zw)((Math.round(100*(i.aPagar-i.montoDeuda-i.dejaCuenta))/100).toFixed(2))+"€ ",1)):(0,o.kq)("",!0)])),_:1}),(0,o._)("div",null,[(0,o.Wm)(Q,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>i.deshacer()),class:"sizeBotones"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,o.Wm)(Q,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>i.limpiar())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])])),_:1})])),_:1})]),(0,o._)("div",M,[(0,o._)("div",y,[(0,o._)("div",B,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([.01,.02,.05,.1,.2,.5,1,2],(a=>(0,o._)("img",{src:"/img/"+(a<1?100*a+"cts":1==a?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:e=>i.sumar(a)},null,8,E))),64))])]),(0,o._)("div",A,[(0,o._)("div",F,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([5,10,20,50,100,200,500],(a=>(0,o._)("img",{src:"/img/"+a+"euros.png",class:"sizeBilletes",onClick:e=>i.sumar(a)},null,8,P))),64))])]),(0,o._)("div",j,[(0,o._)("div",R,[(0,o._)("div",O,[(0,o._)("img",{disabled:i.loading,src:"img/img-efectivo.png",onClick:e[2]||(e[2]=a=>i.setFormaPago("EFECTIVO")),style:(0,l.j5)("EFECTIVO"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,12,V),i.modalTkrsRef&&!i.prohibirTkRestaurant?((0,o.wg)(),(0,o.iD)("img",{key:0,disabled:i.loading,src:"img/img-tkrs.png",onClick:e[3]||(e[3]=a=>i.loading?null:i.modalTkrsRef.abrirModal()),style:(0,l.j5)("TKRS"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,12,x)):(0,o.kq)("",!0),0===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:1,disabled:i.loading,src:"img/img-tarjetas.png",onClick:e[4]||(e[4]=a=>i.setFormaPago("TARJETA")),style:(0,l.j5)("TARJETA"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,12,S)):(0,o.kq)("",!0),1===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:2,disabled:i.loading,src:"img/img-3g.png",onClick:e[5]||(e[5]=a=>i.setFormaPago("DATAFONO_3G")),style:(0,l.j5)("DATAFONO_3G"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,12,Z)):(0,o.kq)("",!0)])])])])])]),(0,o.Wm)(ea,{ref:"modalTkrsRef"},null,512),(0,o.Wm)(la,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:i.modalNumpad,"onUpdate:modelValue":e[6]||(e[6]=a=>i.modalNumpad=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(oa,null,{default:(0,o.w5)((()=>[(0,o._)("div",I,[(0,o._)("span",N,(0,l.zw)(),1)]),(0,o._)("div",$,[(0,o._)("div",W,[(0,o.Wm)(ta,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(Q,{class:"ms-2 botoncicos-abajo volver",disabled:i.loading,color:"warning",onClick:e[7]||(e[7]=a=>i.cancelarVenta())},{default:(0,o.w5)((()=>[(0,o.Wm)(ia,{icon:"arrow-left"})])),_:1},8,["disabled"]),i.loading?((0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("div",null,[L,(0,o._)("span",q,(0,l.zw)(i.procesoDatafono),1)])])):(0,o.kq)("",!0),(0,o.Wm)(Q,{class:"botonCobrar botoncicos-abajo",color:"primary",disabled:i.loading,onClick:e[8]||(e[8]=a=>i.cobrar()),style:{right:"4vmin"}},{default:(0,o.w5)((()=>[i.loading?((0,o.wg)(),(0,o.iD)("span",G)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,l.zw)(a.$t("pagar","Pagar")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])}t(57658);var J=t(44870),Y=t(79066),K=t(18763),Q=t(38020),X=t(42492),aa=t.n(X),ea=t(86619),ta=t(91076),oa=t(74313),la=t(20065),ia=t(22483),sa=t(92136);function ra(a,e,t,o,l){sa.socket.emit("logFrontend",a,e,t,o,l)}let na={Debug:function(a,e,t,o){ra("Debug",a,e,t,o)},Trace:function(a,e,t,o){ra("Trace",a,e,t,o)},Info:function(a,e,t,o){ra("Info",a,e,t,o)},Warn:function(a,e,t,o){ra("Warn",a,e,t,o)},Error:function(a,e,t,o){ra("Error",a,e,t,o)},Fatal:function(a,e,t,o){ra("Fatal",a,e,t,o)},Log:function(a,e,t,o,l){ra(a,e,t,o,l)}};var da=na,ua={name:"CobroView",components:{CambioComponent:Y.Z,MDBCard:oa.Yl,MDBBtn:oa.$v,MDBCardBody:oa.H7,MDBCardText:oa.Pp,NumpadComponent:ea.Z,VolverComponent:K.Z,ModalTkrsComponent:Q.Z,MDBIcon:oa.vm,MDBModal:oa.j3,MDBModalBody:oa.Yz},setup(a,{expose:e}){const t=(0,la.oR)(),l=(0,J.iH)(!1),i=(0,J.iH)(!1),s=(0,ia.tv)(),r=(0,o.Fl)((()=>t.state.Datafono.procesoActual)),n=(0,J.iH)(null),d=(0,J.iH)("EFECTIVO"),u=(0,J.iH)(0),c=(0,J.iH)(null),m=(0,J.iH)(!1),v=(0,J.iH)(!1),g=(0,J.iH)(!1),p=(0,J.iH)(0),f=(0,J.iH)(!1),C=(0,J.iH)(0),b=(0,J.iH)(0),k=(0,J.iH)([]),w=(0,o.Fl)((()=>P.value?.lista)),_=((0,o.f3)("resetGeneral"),(0,J.iH)(null));let T=(0,o.Fl)((()=>{if(F.value&&F.value-p.value<0)return 0;if(F.value){let a=b.value==F.value?A.value:0;return F.value-(C.value+p.value+a)}if(b.value-p.value<0)return 0;{let a=b.value==F.value?A.value:0;return"RECOGER ENCARGO"!=P?.value?.modo&&"PAGO DEUDA"!=P?.value?.modo||(a=A.value),b.value-(C.value+p.value+a)}}));const D=(0,o.Fl)((()=>t.state.Trabajadores.indexActivo)),h=(0,o.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),z=(0,o.Fl)((()=>t.state.Cestas.arrayCestas)),M=(0,o.Fl)((()=>{const a=t.state.Cestas.Descuento;return void 0===a||isNaN(a)?0:a})),y=(0,o.Fl)((()=>h.value&&void 0!=D.value&&null!=D.value&&h.value[D.value]?h.value[D.value]:null)),B=(0,o.Fl)((()=>t.state.Deudas.deudasSeleccionadas)),E=(0,o.Fl)((()=>t.state.Encargos.encargoSeleccionado)),A=(0,o.Fl)((()=>{if(B.value.length>0){let a=0;for(const e of B.value)e.dejaCuenta&&(a+=e.dejaCuenta);return a}return E.value&&"RECOGER ENCARGO"==P?.value?.modo&&E.value.dejaCuenta||0})),F=(0,o.Fl)((()=>t.state.Deudas.totalAPagar));let P=(0,J.iH)(null);function j(a){p.value=Number(a),a>=q(P.value)?d.value="TKRS":d.value="EFECTIVO"}function R(a){f.value||(p.value<q(P.value)&&p.value>=0?"TARJETA"===a&&p.value>0?aa().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):d.value=a:aa().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error"))}async function O(a){P=(0,o.Fl)((()=>{if(z.value)for(let a=0;a<z.value.length;a++)if(z.value[a]._id==h.value[D.value].idCesta)return z.value[a];return null}));const e=P.value?P.value.lista.filter((a=>a.pagado)).reduce(((a,e)=>a+e.subtotal),0):0;b.value=P.value?q(P.value)-e:0,l.value=!0}async function V(){f.value?da.Warn(`cobrar loading.value: ${f.value}`,"modalCobroView.vue"):(f.value=!0,da.Info("cobrar inicio","modalCobroView.vue"),"PAGO DEUDA"==P.value.modo?await x():await S())}async function x(){try{let a;if(a="TARJETA"==d.value?await ta.Z.post("deudas/crearPagoDeudaPaytef",{total:q(P.value),pagoParcial:F.value,idCesta:P.value._id,idTrabajador:y.value._id,tipo:d.value,tkrsData:{cantidadTkrs:p.value,formaPago:"EFECTIVO"},arrayDeudas:B.value}):await ta.Z.post("deudas/crearPagoDeuda",{total:q(P.value),pagoParcial:F.value,idCesta:P.value._id,idTrabajador:y.value._id,tipo:d.value,tkrsData:{cantidadTkrs:p.value,formaPago:"EFECTIVO"},arrayDeudas:B.value}),!a.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el pago de deuda")}aa().fire({icon:"success",title:"Pago deuda registrada correctamente",showConfirmButton:!1,timer:500}),await ta.Z.post("impresora/saludo").catch((a=>{aa().fire("Oops...",a.message,"error")})),await ta.Z.post("cestas/deselectClient",{idCesta:t.getters["Cestas/getCestaBaseActivo"]}),I(),$(),await L(P.value._id),d.value="EFECTIVO",H(!0)}catch(a){aa().fire("Oops...",a.message,"error")}f.value=!1,K()}async function S(){try{const a=JSON.parse(JSON.stringify(P.value.lista)),e=a.some((a=>a.pagado));let o;const l="PAGO SEPARADO"==P.value.modo,i="RECOGER ENCARGO"==P.value.modo,s=l||i?A.value:0,r=i?P.value.nombreCliente:null;if("TARJETA"==d.value?(t.dispatch("Datafono/setEstado","PENDIENTE"),o=await ta.Z.post("tickets/crearTicketPaytef",{total:q(P.value),idCesta:P.value._id,idTrabajador:y.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:A.value})):o=await ta.Z.post("tickets/crearTicket",{total:q(P.value),idCesta:P.value._id,idTrabajador:y.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:A.value}),!o.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el ticket")}s>0&&i&&"TARJETA"!=d.value&&ta.Z.post("movimientos/nuevoMovimiento",{cantidad:s,concepto:"dejaACuenta",idTrabajador:y.value._id,tipo:"SALIDA",idTicket:o.data,nombreCliente:r}).then((a=>{if(!a.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((a=>{aa().fire("Oops...",a.message,"error")})),aa().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),await ta.Z.post("impresora/saludo").catch((a=>{aa().fire("Oops...",a.message,"error")})),g.value&&"TARJETA"!=d.value&&await ta.Z.post("tickets/getUltimoTicket").then((async a=>{a.data[0]?._id?await ta.Z.post("impresora/imprimirTicket",{idTicket:a.data[0]?._id}).catch((a=>{aa().fire("Oops...",a.message,"error")})):aa().fire("AVISO","Crea un ticket en esta caja abierta","info")})),i&&await ta.Z.post("cestas/deselectClient",{idCesta:t.getters["Cestas/getCestaBaseActivo"]}),(l||i)&&await L(P.value._id),i&&(ta.Z.post("encargos/setEntregado",{id:E.value._id}),N()),Z(),d.value="EFECTIVO",H(!0)}catch(a){aa().fire("Oops...",a.message,"error")}f.value=!1,K(),da.Info("cobrar fin","modalCobroView.vue")}function Z(){let a=!1;z.value.forEach((e=>{if(!a&&e.trabajador===h.value[D.value]._id&&"DEVOLUCION"!=e.modo){a=!0;let t=e._id;ta.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t,idTrabajador:h.value[D.value]._id})}}))}function I(){t.dispatch("Deudas/deleteDeudasSeleccionadas")}function N(){t.dispatch("Encargos/deleteEncargoSeleccionado")}function $(){t.dispatch("Deudas/deleteTotalAPagar")}async function W(){da.Info(`cancelarVenta loading:${f.value}`,"modalCobroView.vue"),H(),K(),"PAGO DEUDA"==P.value.modo?($(),I(),await L(P.value._id)):"PAGO SEPARADO"==P.value.modo&&await ta.Z.post("cestas/DevolverProductosACestaSep",{cesta:t.getters["Cestas/getCestaBaseActivo"],articulos:P.value.lista}).then((async a=>{await L(P.value._id)}))}function H(a=!1){const e=s.currentRoute.value.path;t.dispatch("ModalCobroView/cerrarModalCobroView"),"/cestas"===e&&a&&s.push("/main"),l.value=!1}async function L(a){ta.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((a=>{aa().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await ta.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t.getters["Cestas/getCestaBaseActivo"],idTrabajador:h.value[t.state.Trabajadores.indexActivo]._id}).then((a=>{t.dispatch("Cestas/setCestaBaseAction",null)}))}function q(a){const e=a.detalleIva,t=Object.keys(e).filter((a=>a.startsWith("importe"))).reduce(((a,t)=>a+e[t]),0);return Math.round(100*t)/100}function G(){ta.Z.get("caja/estadoCaja").then((a=>{1==a.data&&aa().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id&&s.push("/menu/fichajes"):s.push("/abrirCaja")})).catch((a=>{aa().fire("Oops...",a.message,"error")}))}function U(a){C.value+=a,k.value.push(a)}function Y(){k.value.pop();let a=0;k.value.forEach((e=>{a+=e})),C.value=a}function K(){C.value=0,p.value=0,k.value=[],T=(0,o.Fl)((()=>b.value-p.value<0?0:b.value-(C.value+p.value)))}function Q(a){b.value=Number(a)}return(0,o.JJ)("setTkrs",j),e({abrirModal:O}),(0,o.bv)((()=>{G(),ta.Z.post("parametros/getParametros").then((a=>{"3G"!==a.data?.tipoDatafono&&"0.0.0.0"!=a.data?.ipTefpay||(u.value=1),void 0!=a.data?.params?.SempreTicket?"Si"==a.data?.params?.SempreTicket&&(g.value=!0):g.value=!1,void 0!=a.data?.params?.prohibirTkRestaurant?"Si"==a.data?.params?.prohibirTkRestaurant&&(m.value=!0):m.value=!1,void 0!=a.data?.params?.TicketDFAuto?"Si"==a.data?.params?.TicketDFAuto&&(v.value=!0):v.value=!1}))})),{DescuentoCliente:M,cesta:P,getTotal:q,cobrar:V,formaPago:d,modalTkrsRef:c,prohibirTkRestaurant:m,setFormaPago:R,loading:f,tipoDatafono3G:u,eliminarAlPagarFnc:L,modalNumpad:i,cancelarVenta:W,modalCobro:l,abrirModal:O,sumar:U,totalRecibido:C,aPagar:b,numPadRef:n,deshacer:Y,limpiar:K,procesoDatafono:r,setTkrs:j,cantidadTkrs:p,setAPagar:Q,cuenta:T,productos:w,TicketDFAuto:v,cliente:_,dejaCuenta:A,deudasSeleccionadas:B,montoDeuda:F}}},ca=t(40089);const ma=(0,ca.Z)(ua,[["render",U],["__scopeId","data-v-21dbe890"]]);var va=ma}}]);
//# sourceMappingURL=40.b62b7800.js.map