"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[347],{48466:function(e,a,o){o.d(a,{Z:function(){return _}});var t=o(73396),n=o(87139);const i={class:"container"},r={key:0,class:"h3 text-center"},s={key:1,class:"h3 text-center"},l={key:2,class:"h3 text-center"},c={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},d={class:"again py-5"},m={class:"again py-5"},v={class:"again py-5"};function p(e,a,o,p,f,b){const k=(0,t.up)("MDBBtn"),g=(0,t.up)("MDBModalBody"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[4]||(a[4]=e=>p.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t._)("div",i,[1==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",l," Ultimo pago fallido ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",c,[1==p.ticketExist?((0,t.wg)(),(0,t.j4)(k,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>p.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,n.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(k,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",d,(0,n.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(k,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>p.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,n.zw)(e.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>2?((0,t.wg)(),(0,t.j4)(k,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:a[3]||(a[3]=e=>p.esborrarTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",v,(0,n.zw)(e.$t("anular","Anular ticket")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}o(57658);var f=o(20065),b=o(91076),k=o(74313),g=o(42492),w=o.n(g),h=o(44870),C={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:k.j3,MDBModalBody:k.Yz,MDBBtn:k.$v},setup(e,{expose:a}){const o=(0,h.iH)(null),n=(0,h.iH)(0),i=(0,h.iH)(!1),r=(0,f.oR)(),s=(0,h.iH)(!1),l=(0,t.Fl)((()=>r.state.Trabajadores.arrayTrabajadores));let c=(0,h.iH)(!1);const u=(0,t.Fl)((()=>r.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>l.value&&void 0!=u.value&&null!=u.value&&l.value[u.value]?l.value[u.value]:null));function m(e,a){if(4==a)return w().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,n.value=a,s.value=!0}async function v(){await b.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{s.value=!1,r.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{s.value=!0,w().fire("Oops...",e.message,"error")})),w().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function p(){null!=o.value&&(await g()?b.Z.post("tickets/anularTicket",{ticketId:o.value}).then((e=>{s.value=!1,e.data.res&&["EFECTIVO","DATAFONO_3G"].includes(e.data.tipo)?(i.value&&k(),w().fire({icon:"success",title:"Ticket anulado"+(i.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):e.data.res?router.push("/main"):w().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((e=>{w().fire(e.message)})):w().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function k(){b.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((e=>{w().fire("Oops...",e.message,"error")}))}async function g(){return await w().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async e=>!!e.isConfirmed))}function C(){c.value=!0,b.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{s.value=!1,c.value=!1,r.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{c.value=!1,s.value=!0,w().fire("Oops...",e.message,"error")})),c.value=!1,w().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function T(){w().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),s.value=!1}return a({abrirModal:m}),(0,t.bv)((async()=>{const{data:e}=await b.Z.post("parametros/getParametros");i.value="Si"==e.params?.TicketAlAnular})),{store:r,darComoValido:v,ModalErrorDatafonoQueHacerComponent:s,tarjetaUltimoTicket:C,esperandoConexion:c,TicketAlAnular:i,arrayTrabajadores:l,indexTrabajadorActivo:u,esborrarTicket:p,idSeleccionado:o,pagoDependienta:T,ticketExist:n}}},T=o(40089);const y=(0,T.Z)(C,[["render",p],["__scopeId","data-v-266e01f8"]]);var _=y},39347:function(e,a,o){o.r(a),o.d(a,{default:function(){return j}});var t=o(73396),n=o(87139);const i={class:"margenLateral position-relative"},r={key:0,class:"position-absolute start-0 mb-1 mt-4"},s={class:"sizeTrabajadores"},l={class:"btn-group",role:"group"},c=["onClick"];function u(e,a,o,u,d,m){const v=(0,t.up)("LateralComponent"),p=(0,t.up)("router-view");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v),(0,t._)("div",i,[(0,t.Wm)(p),"/menu/pedidos"!=u.actualPage?((0,t.wg)(),(0,t.iD)("div",r,[(0,t._)("div",s,[(0,t._)("div",l,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(u.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,type:"button",class:(0,n.C_)(["btn btn-lg sizeBotonesTrabajador d-inline-block text-truncate me-2",[a===u.indexActivo?"btn-primary":"btn-outline-primary"]]),onClick:e=>u.setIndexActivo(a)},(0,n.zw)(e.nombre),11,c)))),128))])])])):(0,t.kq)("",!0)])],64)}function d(e,a,o,i,r,s){const l=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBSideNavItem"),u=(0,t.up)("MDBSideNavMenu"),d=(0,t.up)("MDBSideNav");return(0,t.wg)(),(0,t.j4)(d,{modelValue:i.sidenavPositions,"onUpdate:modelValue":a[6]||(a[6]=e=>i.sidenavPositions=e),id:"sidenavPositions",mode:i.mode,slim:!0,backdrop:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"mx-auto text-center"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{onClick:a[0]||(a[0]=e=>i.botonesBloqueados?null:i.goTo("/main"))},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"money-bill-alt",size:"5x"})])),_:1}),(0,t.Wm)(c,{class:(0,n.C_)(["mt-5",{activo:i.router.currentRoute.value.path.startsWith("/menu/caja")}]),onClick:a[1]||(a[1]=e=>i.botonesBloqueados?null:i.goTo("/menu/caja"))},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"piggy-bank",size:"5x"})])),_:1},8,["class"]),(0,t.Wm)(c,{onClick:a[2]||(a[2]=e=>i.botonesBloqueados?null:i.goTo("/menu/fichajes")),class:(0,n.C_)(["mt-5",{activo:i.router.currentRoute.value.path.startsWith("/menu/fichajes")}])},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"door-open",size:"5x"})])),_:1},8,["class"]),(0,t.Wm)(c,{onClick:a[3]||(a[3]=e=>i.botonesBloqueados?null:i.activarDevolucion()),class:(0,n.C_)(["mt-5",{activo:i.router.currentRoute.value.path.startsWith("/menu/devolver")}])},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"trash-alt",size:"5x"})])),_:1},8,["class"]),(0,t.Wm)(c,{onClick:a[4]||(a[4]=e=>i.botonesBloqueados?null:i.goTo("/menu/pedidos")),class:(0,n.C_)(["mt-5",{activo:i.router.currentRoute.value.path.startsWith("/menu/pedido")}])},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"globe",size:"5x"})])),_:1},8,["class"]),(0,t.Wm)(c,{onClick:a[5]||(a[5]=e=>i.botonesBloqueados?null:i.goTo("/tecnico")),class:"mt-5"},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{icon:"key",size:"5x"})])),_:1})])),_:1})])),_:1},8,["modelValue","mode"])}o(57658);var m=o(74313),v=o(44870),p=o(22483),f=o(20065),b=o(91076),k=o(42492),g=o.n(k),w={name:"LateralComponent",components:{MDBSideNav:m.Bv,MDBSideNavMenu:m.g5,MDBSideNavItem:m.Yx,MDBIcon:m.vm},setup(){const e=(0,p.tv)(),a=(0,f.oR)(),o=(0,v.iH)(!0),n=(0,v.iH)("over"),i=e=>{n.value=e},r=(0,t.Fl)((()=>a.state.Cestas.arrayCestas)),s=(0,t.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),l=(0,t.Fl)((()=>a.state.BtnMenuPrincipal.botonesBloqueados)),c=(0,t.Fl)((()=>a.state.Trabajadores.indexActivo));(0,t.Fl)((()=>{if(r.value)for(let e=0;e<r.value.length;e++)if(r.value[e]._id==s.value[c.value].idCesta)return r.value[e];return null}));function u(a){e.push(a)}async function d(){try{const a=s.value[c.value].idTrabajador;let o=await b.Z.post("cestas/findCestaDevolucion",{idTrabajador:a});if(!o.data&&(o=await b.Z.post("cestas/crearCestaDevolucion",{idTrabajador:a}),!o.data))throw new Error("No se ha podido crear la devolución.");return await g().fire({icon:"success",title:"¡Activando modo devolución!",showConfirmButton:!1,timer:500}),e.push("/main")}catch(a){g().fire("Oops...",a.message,"error")}}return{sidenavPositions:o,mode:n,setMode:i,router:e,goTo:u,activarDevolucion:d,botonesBloqueados:l}}},h=o(40089);const C=(0,h.Z)(w,[["render",d]]);var T=C,y=o(48466),_=o(32066),B={name:"MenuPrincipalView",components:{LateralComponent:T,ModalErrorDatafonoComponentVue:y.Z},setup(){const e=(0,f.oR)(),a=(0,v.iH)(null),o=(0,_.io)("http://"+e.state.TocGameURL+":5051"),n=(0,p.tv)(),i=(0,t.Fl)((()=>n.currentRoute.value.path)),r=(0,t.Fl)((()=>e.state.Trabajadores.arrayTrabajadores)),s=(0,t.Fl)((()=>e.state.Trabajadores.indexActivo));function l(a){e.dispatch("Trabajadores/setIndexActivo",a)}return o.on("consultaPaytefRefund",(e=>{e.ok})),{arrayTrabajadores:r,setIndexActivo:l,modalErrorDatafonoRef:a,indexActivo:s,actualPage:i}}};const D=(0,h.Z)(B,[["render",u],["__scopeId","data-v-eac28408"]]);var j=D}}]);
//# sourceMappingURL=347.3d49fcd4.js.map