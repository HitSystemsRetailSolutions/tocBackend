"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[267],{42267:function(e,a,t){t.r(a),t.d(a,{default:function(){return Z}});var l=t(73396),s=t(87139);const i=e=>((0,l.dD)("data-v-ba6bcc0e"),e=e(),(0,l.Cn)(),e),n={id:"main"},o={id:"vueMenuEncargo"},r={class:"encargos"},c={class:""},d={class:"row"},u=i((()=>(0,l._)("div",{class:"col"},null,-1))),v={class:"col"},p={key:0},_={class:"btnEncargo lgEncargo float-right"},m={key:1,class:"btnEncargo float-right"},g=i((()=>(0,l._)("i",{class:"fas fa-search"},null,-1))),C=i((()=>(0,l._)("hr",null,null,-1))),b={class:"productos"},f={key:0},D={class:"d-flex flex-column py-1"},w={class:"d-flex flex-column justify-content-center"},h={class:""},k={key:1},y={class:"encargos-footer"},T=i((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),x={class:"mb-0 mt-2"},E={class:""};function A(e,a,t,i,A,F){return(0,l.wg)(),(0,l.iD)("div",n,[(0,l._)("div",o,[(0,l._)("div",null,[(0,l._)("div",r,[(0,l._)("div",c,[(0,l._)("div",d,[u,(0,l._)("div",v,[i.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",p,[(0,l._)("button",_,(0,s.zw)(i.clienteData.nombreCliente),1)])):((0,l.wg)(),(0,l.iD)("button",m,[g,(0,l.Uk)(" Abrir modal cliente ")]))])]),C,(0,l._)("div",b,[i.cestaActiva.lista.length?((0,l.wg)(),(0,l.iD)("div",f,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(i.cestaActiva.lista,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,l._)("div",D,[(0,l._)("span",null,"- "+(0,s.zw)(e.nombre),1),(0,l._)("div",w,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,((e,a)=>((0,l.wg)(),(0,l.iD)("span",{class:"ms-3",key:a},(0,s.zw)(e.nombre),1)))),128))])]),(0,l._)("div",null,[(0,l._)("span",h,(0,s.zw)(e.unidades)+" unidad(es)",1)])])))),128))])):((0,l.wg)(),(0,l.iD)("div",k,(0,s.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),(0,l._)("div",y,[(0,l._)("div",null,[T,(0,l._)("p",x,(0,s.zw)(i.precioTotal)+"€",1)]),(0,l._)("div",E,[(0,l._)("input",{type:"button",value:"Crear deuda",class:"btn btn-primary btn-lg",onClick:a[0]||(a[0]=(...e)=>i.crearDeuda&&i.crearDeuda(...e))})])])])])])])])}t(57658);var F=t(44870),I=t(20065),j=t(42492),z=t.n(j),H=t(87853),O=t(44161),M=t(54455),N={name:"DeudasComponent",setup(){const e=(0,I.oR)(),{t:a}=(0,H.QT)(),t=(0,F.iH)(0),s=(0,l.Fl)((()=>e.state.Cestas.arrayCestas)),i=e.getters["Cestas/getCestaActiva"],n=e.getters["Cestas/getCestaActivaIndex"],o=(0,l.Fl)((()=>e.state.Trabajadores.arrayTrabajadores)),r=(0,l.Fl)((()=>e.state.Trabajadores.indexActivo)),c=(0,l.Fl)((()=>o.value&&null!=r.value&&void 0!=r.value&&o.value[r.value]?o.value[r.value]:null)),d=(0,l.Fl)((()=>{if(s.value)for(let e=0;e<s.value.length;e++)if(s.value[e]._id==o.value[r.value].idCesta)return s.value[e];return null})),u=(0,l.Fl)((()=>e.state.Cestas.Descuento)),v=(0,F.iH)(null),p={idCliente:i.idCliente,nombreCliente:i.nombreCliente};function _(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5,t=Math.round(100*a)/100;return parseFloat(t)}const m=async()=>{try{const e=await O.Z.post("tickets/crearTicket",{total:_(d.value),idCesta:d.value._id,idTrabajador:c.value._id,tipo:"DEUDA",tkrsData:{cantidadTkrs:t.value,formaPago:"EFECTIVO"},concepto:"DEUDA"});if(!e.data)throw Error("No se ha podido crear el ticket");C(a("toc_game_encargos_ok","Deuda creada!"),"success",g)}catch(e){z().fire("Oops...",e.message,"error")}},g=async()=>(await e.dispatch("Cestas/setModoCesta",{index:n,modo:"VENTA"}),e.dispatch("Cestas/setClienteCesta",{index:n,idCliente:null,nombreCliente:null}),e.dispatch("EstadoDinamico/reset"),e.dispatch("Cestas/deleteLista",i._id),b("/main"),Promise.resolve()),C=(e,a,t=(()=>{}))=>{z().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>t()))},b=e=>M.Z.push(e);return(0,l.bv)((()=>{v.value=_(d.value)})),{crearDeuda:m,cestaActiva:i,clienteData:p,precioTotal:v,cantidadTkrs:t,cesta:d,arrayCestas:s,getTotal:_,DescuentoCliente:u}}},P=t(40089);const U=(0,P.Z)(N,[["render",A],["__scopeId","data-v-ba6bcc0e"]]);var Z=U}}]);
//# sourceMappingURL=267.c34cd4d0.js.map