"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[207],{1464:function(e,a,o){o.d(a,{Z:function(){return F}});var l=o(3396),t=o(7139),n=o(9242);const r={class:"row"},i={class:"d-inline-block text-center"},c={class:"row mt-1 p-4"},s={class:"col-md-8"},d={class:"col-md-4"},u={key:0,class:"row"},m={class:"col"},_={class:"table-responsive w-100",style:{height:"400px"}},v={class:"table table-striped mt-1"},p={class:"textoNombre d-inline-block text-truncate"},g={key:1,class:"row"},C={class:"sinResultados position-relative"},f={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function b(e,a,o,b,k,w){const h=(0,l.up)("MDBBtn"),y=(0,l.up)("MDBModalBody"),D=(0,l.up)("MDBModal"),B=(0,l.up)("ModalNuevoCliente");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(D,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:b.modalClientes,"onUpdate:modelValue":a[7]||(a[7]=e=>b.modalClientes=e),staticBackdrop:"",size:"xl"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l._)("div",i,[(0,l.Wm)(h,{color:"warning",class:"sizeBotones",onClick:a[0]||(a[0]=e=>b.clickClienteAtajo("CliBoti_000_{A83B364B-252F-464B-B0C3-AA89DA258F64}"))},{default:(0,l.w5)((()=>[(0,l.Uk)("Glovo")])),_:1}),(0,l.Wm)(h,{color:"dark",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>b.clickClienteAtajo("CliBoti_000_{2713C1E3-06C0-4099-851D-33018FD4851C}"))},{default:(0,l.w5)((()=>[(0,l.Uk)("Uber")])),_:1}),(0,l.Wm)(h,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>b.clickClienteAtajo("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"))},{default:(0,l.w5)((()=>[(0,l.Uk)("To Go")])),_:1}),(0,l.Wm)(h,{color:"success",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>b.modalNuevoClienteRef.abrirModal())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("nuevo","Nuevo")),1)])),_:1}),(0,l.Wm)(h,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>b.modalClientes=!1)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("salir","Salir")),1)])),_:1})])]),(0,l._)("div",c,[(0,l._)("div",s,[(0,l.wy)((0,l._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":a[5]||(a[5]=e=>b.inputBusqueda=e)},null,512),[[n.nr,b.inputBusqueda]])]),(0,l._)("div",d,[(0,l.Wm)(h,{color:"secondary",class:"botonBusqueda w-100",onClick:a[6]||(a[6]=e=>b.buscar())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("buscar","Buscar")),1)])),_:1})])]),b.arrayClientes?.length>0?((0,l.wg)(),(0,l.iD)("div",u,[(0,l._)("div",m,[(0,l._)("div",_,[(0,l._)("table",v,[(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(b.arrayClientes,((a,o)=>((0,l.wg)(),(0,l.iD)("tr",{key:o},[(0,l._)("td",null,[(0,l._)("span",p,(0,t.zw)(a.nombre),1)]),(0,l._)("td",null,[(0,l.Wm)(h,{color:"primary",size:"lg",onClick:e=>b.selectCliente(a.id,a.nombre),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):((0,l.wg)(),(0,l.iD)("div",g,[(0,l._)("div",C,[(0,l._)("span",f,(0,t.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(B,{ref:"modalNuevoClienteRef"},null,512)],64)}var k=o(4161),w=o(4313),h=o(2492),y=o.n(h),D=o(4870),B=o(65);const M={class:"row mt-1 p-4"},z={class:"col-md-8"},A={class:"col-md-4"},E={class:"row p-4"},x={class:"col-md-8"},j={class:"col-md-4 sizeModalClientes"},N={class:"row"},H={class:"d-inline-block text-end"};function T(e,a,o,r,i,c){const s=(0,l.up)("MDBBtn"),d=(0,l.up)("MDBModalBody"),u=(0,l.up)("MDBModal");return(0,l.wg)(),(0,l.j4)(u,{id:"modalNuevoCliente",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:r.modalNuevoCliente,"onUpdate:modelValue":a[4]||(a[4]=e=>r.modalNuevoCliente=e),staticBackdrop:"",size:"xl"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l._)("div",M,[(0,l._)("div",z,[(0,l.wy)((0,l._)("input",{class:"form-control inputNombreCliente w-100",type:"text",placeholder:"Nombre del cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>r.inputNombreCliente=e)},null,512),[[n.nr,r.inputNombreCliente]])]),(0,l._)("div",A,[(0,l.Wm)(s,{color:"secondary",class:"botonBusqueda w-100",disabled:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("nombre","Nombre")),1)])),_:1})])]),(0,l._)("div",E,[(0,l._)("div",x,[(0,l.wy)((0,l._)("input",{class:"form-control inputNombreCliente w-100",type:"text",placeholder:"Código tarjeta","aria-label":".form-control-lg example","onUpdate:modelValue":a[1]||(a[1]=e=>r.inputCodigoTarjeta=e)},null,512),[[n.nr,r.inputCodigoTarjeta]])]),(0,l._)("div",j,[(0,l.Wm)(s,{color:"secondary",class:"botonBusqueda w-100",disabled:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("cod_tarjeta","Cód. tarjeta")),1)])),_:1})])]),(0,l._)("div",N,[(0,l._)("div",H,[(0,l.Wm)(s,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>r.crearCliente())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("crear","Crear")),1)])),_:1}),(0,l.Wm)(s,{color:"danger",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>r.modalNuevoCliente=!1)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("atras","Atrás")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"])}var U={name:"ModalNuevoClienteComponent",components:{MDBModal:w.j3,MDBModalBody:w.Yz,MDBBtn:w.$v},setup(e,a){const o=(0,D.iH)(!1),l=(0,D.iH)(""),t=(0,D.iH)("");function n(){o.value=!0}function r(){k.Z.post("clientes/crearNuevoCliente",{idTarjetaCliente:t.value,nombreCliente:l.value}).then((e=>{if(!e.data)throw Error("No se ha podido crear el cliente. backend");y().fire({icon:"success",title:"Cliente creado correctamente",showConfirmButton:!1,timer:2e3}),o.value=!1})).catch((e=>{y().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:n}),{inputCodigoTarjeta:t,modalNuevoCliente:o,inputNombreCliente:l,crearCliente:r}}},R=o(89);const $=(0,R.Z)(U,[["render",T],["__scopeId","data-v-d5ef2184"]]);var V=$,q={name:"ModalClientesComponent",components:{MDBModal:w.j3,MDBModalBody:w.Yz,MDBBtn:w.$v,ModalNuevoCliente:V},setup(e,a){const o=(0,B.oR)(),t=(0,D.iH)(!1),n=(0,D.iH)(0),r=(0,D.iH)(""),i=(0,D.iH)(),c=(0,D.iH)(null),s=(0,l.f3)("actualizarPuntos"),d=(0,l.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,l.Fl)((()=>o.state.Trabajadores.indexActivo)),m=(0,l.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),_=(0,l.Fl)((()=>o.state.Cestas.arrayCestas));function v(){t.value=!0}function p(){n.value++}function g(e){k.Z.post("clientes/getClienteById",{idCliente:e}).then((a=>{if(!a.data)throw Error("No se ha podido obtener la información del cliente. backend");C(e,a.data.nombre)})).catch((e=>{y().fire("Oops...",e.message,"error")}))}function C(e,a){if(_.value)for(let l=0;l<_.value.length;l++)if(m.value.idCesta===_.value[l]._id){o.dispatch("Cestas/setClienteCesta",{index:l,idCliente:e,nombreCliente:a}),o.dispatch("EstadoDinamico/setVistaCliente",!0),s(),t.value=!1;break}}function f(){k.Z.post("clientes/buscar",{busqueda:r.value}).then((e=>{i.value=e.data})).catch((e=>{y().fire("Oops...",e.message,"error")}))}return(0,l.YP)(r,(()=>{f()})),a.expose({abrirModal:v,datoBorrar:n,selectCliente:C}),{test:p,datoBorrar:n,modalClientes:t,inputBusqueda:r,arrayClientes:i,selectCliente:C,buscar:f,modalNuevoClienteRef:c,clickClienteAtajo:g}}};const W=(0,R.Z)(q,[["render",b],["__scopeId","data-v-7b36cf97"]]);var F=W},6207:function(e,a,o){o.r(a),o.d(a,{default:function(){return L}});var l=o(3396),t=o(7139),n=o(9242);const r=e=>((0,l.dD)("data-v-6c5f9444"),e=e(),(0,l.Cn)(),e),i={id:"main"},c={id:"vueMenuEncargo"},s={class:"encargos"},d={class:""},u={class:"row"},m=r((()=>(0,l._)("div",{class:"col"},null,-1))),_={class:"col"},v={key:0},p={class:"btnEncargo lgEncargo float-right"},g=r((()=>(0,l._)("i",{class:"fas fa-search"},null,-1))),C=r((()=>(0,l._)("hr",null,null,-1))),f={class:"productos"},b={class:"producto"},k={class:"d-flex flex-column juatify-content-center"},w=["onUpdate:modelValue"],h={key:1},y=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),D={class:"recogida"},B={class:"opciones-recogida"},M={class:"fechas-recogida"},z={key:0},A={key:1},E={key:2},x=["id","onUpdate:modelValue","onClick"],j=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),N={class:"encargos-footer"},H=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),T={class:"mb-0 mt-2"},U={class:"input-deja-a-cuenta"},R=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Deja a cuenta:",-1))),$={class:""};function V(e,a,o,r,V,q){const W=(0,l.up)("ModalClientesComponent");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",i,[(0,l._)("div",c,[(0,l._)("div",null,[(0,l._)("div",s,[(0,l._)("div",d,[(0,l._)("div",u,[m,(0,l._)("div",_,[r.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",v,[(0,l._)("button",p,(0,t.zw)(r.clienteData.nombreCliente),1)])):((0,l.wg)(),(0,l.iD)("button",{key:1,class:"btnEncargo float-right",onClick:a[0]||(a[0]=e=>r.refModalClientes.abrirModal())},[g,(0,l.Uk)(" Abrir modal cliente ")]))])]),C,(0,l._)("div",f,[r.productos.length?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(r.productos,(e=>((0,l.wg)(),(0,l.iD)("div",b,[(0,l._)("div",k,[(0,l._)("span",null,(0,t.zw)(e.nombre),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,(e=>((0,l.wg)(),(0,l.iD)("span",null,(0,t.zw)(e.nombre),1)))),256))]),(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":a=>e.comentario=a},null,8,w),[[n.nr,e.comentario]])])))),256)):((0,l.wg)(),(0,l.iD)("div",h,(0,t.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),y,(0,l._)("div",D,[(0,l._)("div",B,[(0,l._)("button",{onClick:a[1]||(a[1]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"1",class:(0,t.C_)({active:1===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_hoy","Hoy")),3),(0,l._)("button",{onClick:a[2]||(a[2]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"2",class:(0,t.C_)({active:2===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_otro_dia","Otro día")),3),(0,l._)("button",{onClick:a[3]||(a[3]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"3",class:(0,t.C_)({active:3===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_cada","Cada...")),3)]),(0,l._)("div",M,[1===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",z,[(0,l._)("button",{onClick:a[4]||(a[4]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"am",class:(0,t.C_)({active:"am"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_manana","Turno de la mañana")),3),(0,l._)("button",{onClick:a[5]||(a[5]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"pm",class:(0,t.C_)({active:"pm"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_tarde","Turno de la tarde")),3)])):(0,l.kq)("",!0),2===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",A,[(0,l.wy)((0,l._)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>r.fechaInput=e)},null,512),[[n.nr,r.fechaInput]]),(0,l.wy)((0,l._)("input",{type:"time",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>r.horaInput=e)},null,512),[[n.nr,r.horaInput]])])):(0,l.kq)("",!0),3===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",E,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.dias,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.wy)((0,l._)("input",{type:"button",id:e.dia,"onUpdate:modelValue":a=>e.dia=a,onClick:a=>r.clickDia(e),class:(0,t.C_)({active:r.refDia===e.nDia})},null,10,x),[[n.nr,e.dia]])])))),128))])):(0,l.kq)("",!0)])]),j,(0,l._)("div",N,[(0,l._)("div",null,[H,(0,l._)("p",T,(0,t.zw)(r.precioTotal)+"€",1)]),(0,l._)("div",U,[R,(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",id:"cuenta",name:"dejaACuenta",placeholder:"0",min:"0","onUpdate:modelValue":a[8]||(a[8]=e=>r.dejaACuenta=e)},null,512),[[n.nr,r.dejaACuenta]])]),(0,l._)("div",$,[(0,l._)("input",{type:"button",value:"Crear encargo",class:"btn btn-primary btn-lg",onClick:a[9]||(a[9]=(...e)=>r.crearEncargo&&r.crearEncargo(...e))})])])])])])])]),(0,l.Wm)(W,{ref:"refModalClientes"},null,512)],64)}o(7658);var q=o(4870),W=o(65),F=o(1464),I=o(2492),P=o.n(I),S=o(5658),Z=o(4161),Y=o(250),O={name:"EncargosComponent",components:{ModalClientesComponent:F.Z},setup(){const e=(0,q.iH)(null),a=(0,W.oR)(),{t:o}=(0,S.QT)(),t=a.getters["Cestas/getCestaActiva"],n=a.getters["Cestas/getCestaActivaIndex"],r=(0,l.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),i=(0,l.Fl)((()=>a.state.Trabajadores.indexActivo)),c=(0,l.Fl)((()=>r.value&&null!=i.value&&void 0!=i.value&&r.value[i.value]?r.value[i.value]:null)),s=(0,q.iH)(null),d=(0,q.iH)(null),u=(0,q.iH)(null),m=(0,q.iH)(null),_=(0,q.iH)([{dia:"Lunes",nDia:0,checked:!1},{dia:"Martes",nDia:1,checked:!1},{dia:"Miércoles",nDia:2,checked:!1},{dia:"Jueves",nDia:3,checked:!1},{dia:"Viernes",nDia:4,checked:!1},{dia:"Sábado",nDia:5,checked:!1},{dia:"Domingo",nDia:6,checked:!1}]),v=(0,q.iH)(null),p=(0,q.iH)(0),g={idCliente:t.idCliente,nombreCliente:t.nombreCliente},C=(0,q.iH)(t.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos})))),f=(0,q.iH)(null),b=e=>{s.value=parseInt(e.target.value)},k=e=>{d.value=e.target.value},w=e=>{v.value=e.nDia;for(let a=0;a<_.value.length;a++)_.value[a].nDia==v.value?_.value[a].checked=!0:_.value[a].checked=!1},h=()=>_.value.filter((e=>e.checked)),y=()=>{const e=t.lista.reduce(((e,a)=>e+a.subtotal),0);return Number(e.toFixed(2))},D=()=>{if(!C.value.length)return void B(o("toc_game_encargos_error_no_productos","Tienes que haber al menos un producto para crear el encargo."),"error");if(!s.value)return void B(o("toc_game_encargos_error_no_recogida","Tienes que elegir una opción de recogida (hoy, otro día o cada...)"),"error");if(1===s.value&&!d.value)return void B(o("toc_game_encargos_error_no_am_pm","Tienes que elegir por la mañana o por la tarde"),"error");if(2===s.value&&(!u.value||!m.value))return void B(o("toc_game_encargos_error_fecha_hora","Tienes que elegir la fecha y la hora del encargo"),"error");if(3===s.value&&!h().length)return void B(o("toc_game_encargos_error_dias_seleccionados","Tienes que elegir al menos un día"),"error");if(1===s.value){const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();u.value=`${a}-${o.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")}`}const e={idCliente:g.idCliente,nombreCliente:g.nombreCliente,opcionRecogida:s.value,amPm:d.value,fecha:u.value,hora:m.value,dias:h(),dejaCuenta:p.value,total:y(),productos:C.value,cesta:t,idTrabajador:c.value._id};Z.Z.post("encargos/setEncargo",e).then((({data:e})=>{e&&e.msg?e.error?B(e.msg,"error"):(p.value>0&&Z.Z.post("movimientos/nuevoMovimiento",{cantidad:p.value,concepto:"Entrada",idTrabajador:c.value._id,tipo:"ENTRADA_DINERO"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la entrada de dinero")})).catch((e=>{P().fire("Oops...",e.message,"error")})),B(o("toc_game_encargos_ok","Encargo creado!"),"success",M)):B(o("toc_game_encargos_error_general","Error general"),"error")})).catch((e=>{B(o("toc_game_encargos_error_general","Error general"),"error")}))},B=(e,a,o=(()=>{}))=>{P().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>o()))},M=async()=>(await a.dispatch("Cestas/setModoCesta",{index:n,modo:"VENTA"}),a.dispatch("Cestas/setClienteCesta",{index:n,idCliente:null,nombreCliente:null}),a.dispatch("EstadoDinamico/reset"),a.dispatch("Cestas/deleteLista",t._id),z("/"),Promise.resolve()),z=e=>Y.Z.push(e);return(0,l.bv)((()=>{f.value=y()})),{refModalClientes:e,cestaActiva:t,clienteData:g,productos:C,refEncargoRecogida:s,refAmPm:d,dias:_,fechaInput:u,horaInput:m,dejaACuenta:p,onClickRecogida:b,onClickAmPm:k,clickDia:w,crearEncargo:D,precioTotal:f,refDia:v}}},K=o(89);const G=(0,K.Z)(O,[["render",V],["__scopeId","data-v-6c5f9444"]]);var L=G}}]);
//# sourceMappingURL=207.d0f5d0f2.js.map