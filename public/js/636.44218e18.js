"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[636],{83636:function(e,a,t){t.r(a),t.d(a,{default:function(){return S}});var l=t(73396),s=t(87139);const n=e=>((0,l.dD)("data-v-b9454b8e"),e=e(),(0,l.Cn)(),e),i={id:"main"},o={id:"vueMenuEncargo"},r={class:"encargos"},c={class:""},d={class:"row"},u=n((()=>(0,l._)("div",{class:"col"},null,-1))),v={class:"col"},p={key:0},m={class:"btnEncargo lgEncargo float-right"},g={key:1,class:"btnEncargo float-right"},_=n((()=>(0,l._)("i",{class:"fas fa-search"},null,-1))),C=n((()=>(0,l._)("hr",null,null,-1))),f={class:"productos"},D={key:0},b={class:"d-flex flex-column py-1"},w={class:"d-flex flex-column justify-content-center"},y={class:""},h={key:1},k={class:"encargos-footer"},x=n((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),T={class:"mb-0 mt-2"},E={class:""},A={key:0,class:"spinner"},I={key:1,class:"m-0"};function j(e,a,t,n,j,F){const z=(0,l.up)("MDBBtn");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l._)("div",o,[(0,l._)("div",null,[(0,l._)("div",r,[(0,l._)("div",c,[(0,l._)("div",d,[u,(0,l._)("div",v,[n.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",p,[(0,l._)("button",m,(0,s.zw)(n.clienteData.nombreCliente),1)])):((0,l.wg)(),(0,l.iD)("button",g,[_,(0,l.Uk)(" Abrir modal cliente ")]))])]),C,(0,l._)("div",f,[n.cestaActiva.lista.length?((0,l.wg)(),(0,l.iD)("div",D,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(n.cestaActiva.lista,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,l._)("div",b,[(0,l._)("span",null,"- "+(0,s.zw)(e.nombre),1),(0,l._)("div",w,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,((e,a)=>((0,l.wg)(),(0,l.iD)("span",{class:"ms-3",key:a},(0,s.zw)(e.nombre),1)))),128))])]),(0,l._)("div",null,[(0,l._)("span",y,(0,s.zw)(e.unidades)+" unidad(es)",1)])])))),128))])):((0,l.wg)(),(0,l.iD)("div",h,(0,s.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),(0,l._)("div",k,[(0,l._)("div",null,[x,(0,l._)("p",T,(0,s.zw)(n.precioTotal)+"€",1)]),(0,l._)("div",E,[(0,l.Wm)(z,{color:"primary",onClick:a[0]||(a[0]=e=>n.crearDeuda()),disabled:n.loading,class:"btnSpinner d-flex align-items-center justify-content-center"},{default:(0,l.w5)((()=>[n.loading?((0,l.wg)(),(0,l.iD)("span",A)):((0,l.wg)(),(0,l.iD)("p",I,"Crear deuda"))])),_:1},8,["disabled"])])])])])])])])}t(57658);var F=t(44870),z=t(74313),H=t(20065),M=t(42492),B=t.n(M),O=t(87853),N=t(44161),P=t(54455),U={name:"DeudasComponent",components:{MDBBtn:z.$v},setup(){const e=(0,H.oR)(),{t:a}=(0,O.QT)(),t=(0,F.iH)(0),s=(0,l.Fl)((()=>e.state.Cestas.arrayCestas)),n=e.getters["Cestas/getCestaActiva"],i=e.getters["Cestas/getCestaActivaIndex"],o=(0,l.Fl)((()=>e.state.Trabajadores.arrayTrabajadores)),r=(0,l.Fl)((()=>e.state.Trabajadores.indexActivo)),c=(0,l.Fl)((()=>o.value&&null!=r.value&&void 0!=r.value&&o.value[r.value]?o.value[r.value]:null)),d=(0,l.Fl)((()=>{if(s.value)for(let e=0;e<s.value.length;e++)if(s.value[e]._id==o.value[r.value].idCesta)return s.value[e];return null})),u=(0,l.Fl)((()=>e.state.Cestas.Descuento)),v=(0,F.iH)(null),p={idCliente:n.idCliente,nombreCliente:n.nombreCliente},m=(0,F.iH)(!1);function g(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5,t=Math.round(100*a)/100;return t}const _=async()=>{try{const e=await N.Z.post("tickets/crearTicket",{total:g(d.value),idCesta:d.value._id,idTrabajador:c.value._id,tipo:"DEUDA",tkrsData:{cantidadTkrs:t.value,formaPago:"EFECTIVO"},concepto:"DEUDA"});if(!e.data)throw Error("No se ha podido crear el ticket");f(a("toc_game_encargos_ok","Deuda creada!"),"success",C)}catch(e){B().fire("Oops...",e.message,"error")}finally{m.value=!1}};const C=async()=>(await e.dispatch("Cestas/setModoCesta",{index:i,modo:"VENTA"}),e.dispatch("Cestas/setClienteCesta",{index:i,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),e.dispatch("EstadoDinamico/reset"),e.dispatch("Cestas/deleteLista",n._id),D("/main"),Promise.resolve()),f=(e,a,t=(()=>{}))=>{B().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>t()))},D=e=>P.Z.push(e);return(0,l.bv)((()=>{v.value=g(d.value)})),{crearDeuda:_,cestaActiva:n,clienteData:p,precioTotal:v,cantidadTkrs:t,cesta:d,arrayCestas:s,getTotal:g,DescuentoCliente:u,loading:m}}},Z=t(40089);const K=(0,Z.Z)(U,[["render",j],["__scopeId","data-v-b9454b8e"]]);var S=K}}]);
//# sourceMappingURL=636.44218e18.js.map