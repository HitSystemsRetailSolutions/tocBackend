"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[239],{59193:function(e,a,o){o.r(a),o.d(a,{default:function(){return W}});var l=o(73396),t=o(87139),n=o(49242);const r=e=>((0,l.dD)("data-v-47b99f22"),e=e(),(0,l.Cn)(),e),i={id:"main"},c={id:"vueMenuEncargo"},d={class:"encargos"},s={class:""},u={class:"row"},g=r((()=>(0,l._)("div",{class:"col"},null,-1))),v={class:"col"},m={key:0},_={class:"btnEncargo lgEncargo float-right"},p=r((()=>(0,l._)("i",{class:"fas fa-search"},null,-1))),C=r((()=>(0,l._)("hr",null,null,-1))),h={class:"productos"},f={key:0},k={class:"d-flex flex-column juatify-content-center"},b=["onUpdate:modelValue"],D={key:1},w=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),y={class:"recogida"},E={class:"opciones-recogida"},A={class:"fechas-recogida"},H={key:0},R={key:1},T={key:2},I=["id","onUpdate:modelValue","onClick"],j=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),M={class:"encargos-footer"},x=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),S={class:"mb-0 mt-2"},$={class:"input-deja-a-cuenta"},z=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Deja a cuenta:",-1))),P={class:""},q=["disabled"];function V(e,a,o,r,V,U){const F=(0,l.up)("ModalClientesComponent");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",i,[(0,l._)("div",c,[(0,l._)("div",null,[(0,l._)("div",d,[(0,l._)("div",s,[(0,l._)("div",u,[g,(0,l._)("div",v,[r.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",m,[(0,l._)("button",_,(0,t.zw)(r.clienteData.nombreCliente),1)])):((0,l.wg)(),(0,l.iD)("button",{key:1,class:"btnEncargo float-right",onClick:a[0]||(a[0]=e=>r.refModalClientes.abrirModal())},[p,(0,l.Uk)(" Abrir modal cliente ")]))])]),C,(0,l._)("div",h,[r.productos.length?((0,l.wg)(),(0,l.iD)("div",f,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.productos,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"producto",key:a},[(0,l._)("div",k,[(0,l._)("span",null,(0,t.zw)(e.nombre),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,((e,a)=>((0,l.wg)(),(0,l.iD)("span",{key:a},(0,t.zw)(e.nombre),1)))),128))]),(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":a=>e.comentario=a},null,8,b),[[n.nr,e.comentario]])])))),128))])):((0,l.wg)(),(0,l.iD)("div",D,(0,t.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),w,(0,l._)("div",y,[(0,l._)("div",E,[(0,l._)("button",{onClick:a[1]||(a[1]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"1",class:(0,t.C_)({active:1===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_hoy","Hoy")),3),(0,l._)("button",{onClick:a[2]||(a[2]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"2",class:(0,t.C_)({active:2===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_otro_dia","Otro día")),3),(0,l._)("button",{onClick:a[3]||(a[3]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"3",class:(0,t.C_)({active:3===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_cada","Cada...")),3)]),(0,l._)("div",A,[1===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",H,[(0,l._)("button",{onClick:a[4]||(a[4]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"am",class:(0,t.C_)({active:"am"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_manana","Turno de la mañana")),3),(0,l._)("button",{onClick:a[5]||(a[5]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"pm",class:(0,t.C_)({active:"pm"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_tarde","Turno de la tarde")),3)])):(0,l.kq)("",!0),2===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",R,[(0,l.wy)((0,l._)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>r.fechaInput=e)},null,512),[[n.nr,r.fechaInput]]),(0,l.wy)((0,l._)("input",{type:"time",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>r.horaInput=e)},null,512),[[n.nr,r.horaInput]])])):(0,l.kq)("",!0),3===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",T,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.dias,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.wy)((0,l._)("input",{type:"button",id:e.dia,"onUpdate:modelValue":a=>e.dia=a,onClick:a=>r.clickDia(e),class:(0,t.C_)({active:r.refDia===e.nDia})},null,10,I),[[n.nr,e.dia]])])))),128))])):(0,l.kq)("",!0)])]),j,(0,l._)("div",M,[(0,l._)("div",null,[x,(0,l._)("p",S,(0,t.zw)(r.precioTotal)+"€",1)]),(0,l._)("div",$,[z,(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",id:"cuenta",name:"dejaACuenta",placeholder:"0",min:"0","onUpdate:modelValue":a[8]||(a[8]=e=>r.dejaACuenta=e)},null,512),[[n.nr,r.dejaACuenta]])]),(0,l._)("div",P,[(0,l._)("input",{type:"button",value:"Crear encargo",class:"btn btn-primary btn-lg",onClick:a[9]||(a[9]=(...e)=>r.crearEncargo&&r.crearEncargo(...e)),disabled:r.botonBloqueado},null,8,q)])])])])])])]),(0,l.Wm)(F,{ref:"refModalClientes"},null,512)],64)}o(57658);var U=o(44870),F=o(20065),N=o(89131),Y=o(42492),O=o.n(Y),Z=o(5658),K=o(44161),B=o(54455),L={name:"EncargosComponent",components:{ModalClientesComponent:N.Z},setup(){const e=(0,U.iH)(!1),a=(0,U.iH)(null),o=(0,F.oR)(),{t:t}=(0,Z.QT)(),n=o.getters["Cestas/getCestaActiva"],r=o.getters["Cestas/getCestaActivaIndex"],i=(0,l.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),c=(0,l.Fl)((()=>o.state.Trabajadores.indexActivo)),d=(0,l.Fl)((()=>i.value&&null!=c.value&&void 0!=c.value&&i.value[c.value]?i.value[c.value]:null)),s=(0,U.iH)(null),u=(0,U.iH)(null),g=(0,U.iH)(null),v=(0,U.iH)(null),m=(0,U.iH)([{dia:"Lunes",nDia:0,checked:!1},{dia:"Martes",nDia:1,checked:!1},{dia:"Miércoles",nDia:2,checked:!1},{dia:"Jueves",nDia:3,checked:!1},{dia:"Viernes",nDia:4,checked:!1},{dia:"Sábado",nDia:5,checked:!1},{dia:"Domingo",nDia:6,checked:!1}]),_=(0,U.iH)(null),p=(0,U.iH)(0),C={idCliente:n.idCliente,nombreCliente:n.nombreCliente},h=(0,U.iH)(n.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),f=(0,U.iH)(null),k=e=>{s.value=parseInt(e.target.value)},b=e=>{u.value=e.target.value},D=e=>{_.value=e.nDia;for(let a=0;a<m.value.length;a++)m.value[a].nDia==_.value?m.value[a].checked=!0:m.value[a].checked=!1},w=()=>m.value.filter((e=>e.checked)),y=()=>{let e=n.detalleIva.importe1+n.detalleIva.importe2+n.detalleIva.importe3+n.detalleIva.importe4+n.detalleIva.importe5;return Number(e.toFixed(2))},E=()=>{if(e.value=!0,!h.value.length)return A(t("toc_game_encargos_error_no_productos","Tienes que haber al menos un producto para crear el encargo."),"error"),void(e.value=!1);if(!s.value)return A(t("toc_game_encargos_error_no_recogida","Tienes que elegir una opción de recogida (hoy, otro día o cada...)"),"error"),void(e.value=!1);if(1===s.value&&!u.value)return A(t("toc_game_encargos_error_no_am_pm","Tienes que elegir por la mañana o por la tarde"),"error"),void(e.value=!1);if(2===s.value&&(!g.value||!v.value))return A(t("toc_game_encargos_error_fecha_hora","Tienes que elegir la fecha y la hora del encargo"),"error"),void(e.value=!1);if(3===s.value&&!w().length)return A(t("toc_game_encargos_error_dias_seleccionados","Tienes que elegir al menos un día"),"error"),void(e.value=!1);if(1===s.value){const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();g.value=`${a}-${o.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")}`}if(3===s.value){let e=new Date,a=e.getDay(),o=w()[0].nDia+1,l=(o-a+7)%7,t=new Date(e.getTime()+24*l*60*60*1e3);const n=t.getFullYear(),r=t.getMonth()+1,i=t.getDate();g.value=`${n}-${r.toString().padStart(2,"0")}-${i.toString().padStart(2,"0")}`}const a={idCliente:C.idCliente,nombreCliente:C.nombreCliente,opcionRecogida:s.value,amPm:u.value,fecha:g.value,hora:v.value,dias:w(),dejaCuenta:p.value,total:y(),productos:h.value,cesta:n,idTrabajador:d.value._id,nombreDependienta:d.value.nombre};K.Z.post("encargos/setEncargo",a).then((({data:a})=>a&&a.msg?a.error?(A(a.msg,"error"),void(e.value=!1)):(p.value>0&&K.Z.post("movimientos/nuevoMovimiento",{cantidad:p.value,concepto:"dejaACuenta",idTrabajador:d.value._id,tipo:"ENTRADA_DINERO"}).then((a=>{if(!a.data)throw e.value=!1,Error("No se ha podido realizar la entrada de dinero")})).catch((a=>{e.value=!1,O().fire("Oops...",a.message,"error")})),e.value=!1,void A(t("toc_game_encargos_ok","Encargo creado!"),"success",H)):(A(t("toc_game_encargos_error_general","Error general"),"error"),void(e.value=!1)))).catch((a=>{e.value=!1,A(t("toc_game_encargos_error_general","Error general"),"error")}))},A=(e,a,o=(()=>{}))=>{O().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>o()))},H=async()=>(await o.dispatch("Cestas/setModoCesta",{index:r,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:r,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset"),o.dispatch("Cestas/deleteLista",n._id),R("/main"),Promise.resolve()),R=e=>B.Z.push(e);return(0,l.bv)((()=>{f.value=y()})),{refModalClientes:a,cestaActiva:n,clienteData:C,productos:h,refEncargoRecogida:s,refAmPm:u,dias:m,fechaInput:g,horaInput:v,dejaACuenta:p,onClickRecogida:k,onClickAmPm:b,clickDia:D,crearEncargo:E,precioTotal:f,refDia:_,botonBloqueado:e}}},J=o(40089);const Q=(0,J.Z)(L,[["render",V],["__scopeId","data-v-47b99f22"]]);var W=Q}}]);
//# sourceMappingURL=239.7d1921b1.js.map