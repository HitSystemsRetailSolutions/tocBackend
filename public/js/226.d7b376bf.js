"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[226],{7767:function(e,a,o){o.d(a,{Z:function(){return f}});var t=o(3396);const l={class:"btn-group-vertical mt-1"},n={class:"btn-group"},r={class:"btn-group"},i={class:"btn-group"},s={class:"btn-group"},c={class:"btn-group"};function d(e,a,o,d,u,m){return(0,t.wg)(),(0,t.iD)("div",l,[(0,t._)("div",n,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[0]||(a[0]=e=>d.addTecla("1"))}," 1 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[1]||(a[1]=e=>d.addTecla("2"))}," 2 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[2]||(a[2]=e=>d.addTecla("3"))}," 3 ")]),(0,t._)("div",r,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[3]||(a[3]=e=>d.addTecla("4"))}," 4 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[4]||(a[4]=e=>d.addTecla("5"))}," 5 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[5]||(a[5]=e=>d.addTecla("6"))}," 6 ")]),(0,t._)("div",i,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[6]||(a[6]=e=>d.addTecla("7"))}," 7 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[7]||(a[7]=e=>d.addTecla("8"))}," 8 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[8]||(a[8]=e=>d.addTecla("9"))}," 9 ")]),(0,t._)("div",s,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[9]||(a[9]=e=>d.deleteTecla())}," < "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[10]||(a[10]=e=>d.addTecla("0"))}," 0 "),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:a[11]||(a[11]=e=>d.okValue(Number(d.cantidad)))}," OK ")]),(0,t._)("div",c,[(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonComa",onClick:a[12]||(a[12]=e=>d.addTecla("."))}," , ")])])}var u=o(4870),m={name:"NumpadComponent",setup(e,{expose:a}){const o=(0,u.iH)("0"),l=(0,t.f3)("okValue"),n=(0,u.iH)("5.5rem"),r=(0,u.iH)("5.5rem");function i(e){"."===e&&(o.value=o.value.replace(".","")),o.value+=e,"0"==o.value[0]&&(o.value=o.value.slice(1))}function s(){o.value=o.value.slice(0,-1),""===o.value&&(o.value="0")}function c(e){o.value=e.toString()}return a({cantidad:o,setValor:c}),{okValue:l,cantidad:o,addTecla:i,deleteTecla:s,setValor:c,anchoTecla:n,altoTecla:r}}},p=o(89);const v=(0,p.Z)(m,[["render",d],["__scopeId","data-v-6bb950cc"]]);var f=v},1464:function(e,a,o){o.d(a,{Z:function(){return V}});var t=o(3396),l=o(7139),n=o(9242);const r={class:"row"},i={class:"d-inline-block text-center"},s={class:"row mt-1 p-4"},c={class:"col-md-8"},d={class:"col-md-4"},u={key:0,class:"row"},m={class:"col"},p={class:"table-responsive w-100",style:{height:"400px"}},v={class:"table table-striped mt-1"},f={class:"textoNombre d-inline-block text-truncate"},b={key:1,class:"row"},C={class:"sinResultados position-relative"},w={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function g(e,a,o,g,_,y){const M=(0,t.up)("MDBBtn"),h=(0,t.up)("MDBModalBody"),D=(0,t.up)("MDBModal"),k=(0,t.up)("ModalNuevoCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(D,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:g.modalClientes,"onUpdate:modelValue":a[7]||(a[7]=e=>g.modalClientes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t._)("div",i,[(0,t.Wm)(M,{color:"warning",class:"sizeBotones",onClick:a[0]||(a[0]=e=>g.clickClienteAtajo("CliBoti_000_{A83B364B-252F-464B-B0C3-AA89DA258F64}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("Glovo")])),_:1}),(0,t.Wm)(M,{color:"dark",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>g.clickClienteAtajo("CliBoti_000_{2713C1E3-06C0-4099-851D-33018FD4851C}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("Uber")])),_:1}),(0,t.Wm)(M,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>g.clickClienteAtajo("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("To Go")])),_:1}),(0,t.Wm)(M,{color:"success",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>g.modalNuevoClienteRef.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("nuevo","Nuevo")),1)])),_:1}),(0,t.Wm)(M,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>g.modalClientes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("salir","Salir")),1)])),_:1})])]),(0,t._)("div",s,[(0,t._)("div",c,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":a[5]||(a[5]=e=>g.inputBusqueda=e)},null,512),[[n.nr,g.inputBusqueda]])]),(0,t._)("div",d,[(0,t.Wm)(M,{color:"secondary",class:"botonBusqueda w-100",onClick:a[6]||(a[6]=e=>g.buscar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("buscar","Buscar")),1)])),_:1})])]),g.arrayClientes?.length>0?((0,t.wg)(),(0,t.iD)("div",u,[(0,t._)("div",m,[(0,t._)("div",p,[(0,t._)("table",v,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(g.arrayClientes,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",f,(0,l.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(M,{color:"primary",size:"lg",onClick:e=>g.selectCliente(a.id,a.nombre),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):((0,t.wg)(),(0,t.iD)("div",b,[(0,t._)("div",C,[(0,t._)("span",w,(0,l.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(k,{ref:"modalNuevoClienteRef"},null,512)],64)}var _=o(4161),y=o(4313),M=o(2492),h=o.n(M),D=o(4870),k=o(65);const B={class:"row mt-1 p-4"},x={class:"col-md-8"},T={class:"col-md-4"},A={class:"row p-4"},z={class:"col-md-8"},E={class:"col-md-4 sizeModalClientes"},I={class:"row"},S={class:"d-inline-block text-end"};function U(e,a,o,r,i,s){const c=(0,t.up)("MDBBtn"),d=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(u,{id:"modalNuevoCliente",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:r.modalNuevoCliente,"onUpdate:modelValue":a[4]||(a[4]=e=>r.modalNuevoCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",B,[(0,t._)("div",x,[(0,t.wy)((0,t._)("input",{class:"form-control inputNombreCliente w-100",type:"text",placeholder:"Nombre del cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>r.inputNombreCliente=e)},null,512),[[n.nr,r.inputNombreCliente]])]),(0,t._)("div",T,[(0,t.Wm)(c,{color:"secondary",class:"botonBusqueda w-100",disabled:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("nombre","Nombre")),1)])),_:1})])]),(0,t._)("div",A,[(0,t._)("div",z,[(0,t.wy)((0,t._)("input",{class:"form-control inputNombreCliente w-100",type:"text",placeholder:"Código tarjeta","aria-label":".form-control-lg example","onUpdate:modelValue":a[1]||(a[1]=e=>r.inputCodigoTarjeta=e)},null,512),[[n.nr,r.inputCodigoTarjeta]])]),(0,t._)("div",E,[(0,t.Wm)(c,{color:"secondary",class:"botonBusqueda w-100",disabled:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("cod_tarjeta","Cód. tarjeta")),1)])),_:1})])]),(0,t._)("div",I,[(0,t._)("div",S,[(0,t.Wm)(c,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>r.crearCliente())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("crear","Crear")),1)])),_:1}),(0,t.Wm)(c,{color:"danger",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>r.modalNuevoCliente=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("atras","Atrás")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"])}var j={name:"ModalNuevoClienteComponent",components:{MDBModal:y.j3,MDBModalBody:y.Yz,MDBBtn:y.$v},setup(e,a){const o=(0,D.iH)(!1),t=(0,D.iH)(""),l=(0,D.iH)("");function n(){o.value=!0}function r(){_.Z.post("clientes/crearNuevoCliente",{idTarjetaCliente:l.value,nombreCliente:t.value}).then((e=>{if(!e.data)throw Error("No se ha podido crear el cliente. backend");h().fire({icon:"success",title:"Cliente creado correctamente",showConfirmButton:!1,timer:2e3}),o.value=!1})).catch((e=>{h().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:n}),{inputCodigoTarjeta:l,modalNuevoCliente:o,inputNombreCliente:t,crearCliente:r}}},N=o(89);const H=(0,N.Z)(j,[["render",U],["__scopeId","data-v-d5ef2184"]]);var F=H,O={name:"ModalClientesComponent",components:{MDBModal:y.j3,MDBModalBody:y.Yz,MDBBtn:y.$v,ModalNuevoCliente:F},setup(e,a){const o=(0,k.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(0),r=(0,D.iH)(""),i=(0,D.iH)(),s=(0,D.iH)(null),c=(0,t.f3)("actualizarPuntos"),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),p=(0,t.Fl)((()=>o.state.Cestas.arrayCestas));function v(){l.value=!0}function f(){n.value++}function b(e){_.Z.post("clientes/getClienteById",{idCliente:e}).then((a=>{if(!a.data)throw Error("No se ha podido obtener la información del cliente. backend");C(e,a.data.nombre)})).catch((e=>{h().fire("Oops...",e.message,"error")}))}function C(e,a){if(p.value)for(let t=0;t<p.value.length;t++)if(m.value.idCesta===p.value[t]._id){o.dispatch("Cestas/setClienteCesta",{index:t,idCliente:e,nombreCliente:a}),o.dispatch("EstadoDinamico/setVistaCliente",!0),c(),l.value=!1;break}}function w(){_.Z.post("clientes/buscar",{busqueda:r.value}).then((e=>{i.value=e.data})).catch((e=>{h().fire("Oops...",e.message,"error")}))}return(0,t.YP)(r,(()=>{w()})),a.expose({abrirModal:v,datoBorrar:n,selectCliente:C}),{test:f,datoBorrar:n,modalClientes:l,inputBusqueda:r,arrayClientes:i,selectCliente:C,buscar:w,modalNuevoClienteRef:s,clickClienteAtajo:b}}};const W=(0,N.Z)(O,[["render",g],["__scopeId","data-v-7b36cf97"]]);var V=W},4286:function(e,a,o){o.d(a,{Z:function(){return h}});var t=o(3396),l=o(7139);const n={class:"container"},r={key:0,class:"h3 text-center"},i={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},c={class:"row mt-2 container botonesCaja"},d={class:"again py-5"},u={class:"again py-5"},m={class:"again py-5"};function p(e,a,o,p,v,f){const b=(0,t.up)("MDBBtn"),C=(0,t.up)("MDBModalBody"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[3]||(a[3]=e=>p.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t._)("div",n,[1==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago cancelado, que hacemos? ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",c,[1==p.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>p.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",d,(0,l.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",size:"lg",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,l.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",size:"lg",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>p.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,l.zw)(e.$t("pago en efectivo","PAGO EN EFECTIVO O EN 3G")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}var v=o(65),f=o(4161),b=o(4313),C=o(2492),w=o.n(C),g=o(4870),_={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,g.iH)(null),l=(0,g.iH)(0),n=(0,v.oR)(),r=(0,g.iH)(!1),i=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores));let s=(0,g.iH)(!1);const c=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>i.value&&void 0!=c.value&&null!=c.value&&i.value[c.value]?i.value[c.value]:null));function u(e,a){if(4==a)return w().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,l.value=a,r.value=!0}async function m(){await f.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,n.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{r.value=!0,w().fire("Oops...",e.message,"error")})),w().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}function p(){s.value=!0,f.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,s.value=!1,n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{s.value=!1,r.value=!0,w().fire("Oops...",e.message,"error")})),s.value=!1,w().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function b(){w().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return a({abrirModal:u}),(0,t.bv)((()=>{})),{store:n,darComoValido:m,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:p,esperandoConexion:s,arrayTrabajadores:i,indexTrabajadorActivo:c,idSeleccionado:o,pagoDependienta:b,ticketExist:l}}},y=o(89);const M=(0,y.Z)(_,[["render",p],["__scopeId","data-v-1ca4de76"]]);var h=M},6226:function(e,a,o){o.r(a),o.d(a,{default:function(){return Ft}});var t=o(3396);const l={class:"row mt-1"},n={class:"col-md-3"},r={class:"col-md-6"},i={class:"col-md-3"};function s(e,a,o,s,c,d){const u=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),v=(0,t.up)("MenuIzquierdaComponent"),f=(0,t.up)("CestaComponent"),b=(0,t.up)("MenuDerechaComponent"),C=(0,t.up)("ModalErrorDatafonoVentaComponent"),w=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",l,[(0,t._)("div",n,[(0,t.Wm)(v,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(f,{ref:"cestaRef"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(b)])]),(0,t.Wm)(C,{ref:"modalErrorVentaDatafonoRef"},null,512),(0,t.Wm)(w,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(7658);var c=o(7139);const d={class:"row",id:"menu",style:{"margin-top":"1px"}},u={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,l,n,r){return(0,t.wg)(),(0,t.iD)("div",d,[(0,t._)("div",u,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,class:(0,c.C_)([{activo:a==l.indexMenuActivo},"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"]),onClick:e=>l.setActivo(a)},(0,c.zw)(e.nombre),11,m)))),128))])])}var v=o(65),f={name:"MenusComponent",setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo));function r(e){o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{r(0)})),a({indexMenuActivo:n}),{teclado:l,indexMenuActivo:n,setActivo:r}}},b=o(89);const C=(0,b.Z)(f,[["render",p],["__scopeId","data-v-c3a97fe6"]]);var w=C;const g={class:"row",id:"submenu",style:{"margin-top":"1px"}},_={key:0,class:"btn-group shadow-none",style:{padding:"0px 16px 0px 16px"},role:"group"},y=["onClick"];function M(e,a,o,l,n,r){return(0,t.wg)(),(0,t.iD)("div",g,[l.teclado&&l.teclado[l.indexMenuActivo]&&l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",_,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado[l.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{style:{padding:"0px 0px 0px 0px"},key:a},[(0,t._)("button",{class:(0,c.C_)([{activo:a==l.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>l.setIndexSubmenu(a)},(0,c.zw)(e.nombre),11,y)])))),128))])):(0,t.kq)("",!0)])}var h={name:"SubmenusComponent",setup(){const e=(0,v.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),l=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo));function n(a){e.dispatch("Teclado/setIndexSubmenuActivo",a)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:l,setIndexSubmenu:n}}};const D=(0,b.Z)(h,[["render",M],["__scopeId","data-v-5e11cc3b"]]);var k=D;const B={key:0},x=["onClick"];function T(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("PesoComponent"),d=(0,t.up)("SuplementosComponent"),u=(0,t.up)("ModalEditarProducto"),m=(0,t.up)("ModalCrearProducto"),p=(0,t.up)("ModalAlergenosVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[l.arrayTeclas&&l.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,c.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,n)=>(0,t._)("div",{class:(0,c.C_)(["col",[l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:n},[l.arrayTeclas[n+6*o].idArticle?((0,t.wg)(),(0,t.j4)(i,{key:0,onClick:e=>l.clickTecla(l.arrayTeclas[n+6*o],e),onContextmenu:e=>l.abrirFicha(l.arrayTeclas[n+6*o].idArticle),class:(0,c.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?"teclasConSubmenu":"teclas"]]),style:(0,c.j5)({"background-color":"#"+l.arrayTeclas[n+6*o].color.toString(16),color:l.getTextColor("#"+l.arrayTeclas[n+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(l.arrayTeclas[n+6*o].nombreArticulo)+" ",1),l.precioTecla?((0,t.wg)(),(0,t.iD)("p",B,(0,c.zw)(l.arrayTeclas[n+6*o].precioConIva.toFixed(2))+"€",1)):(0,t.kq)("",!0)])),_:2},1032,["onClick","onContextmenu","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,c.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==l.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==l.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==l.isEditarArticulos(!1)},null==l.teclado[l.indexMenuActivo].arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>l.editarArticulo(l.arrayTeclas[n+6*o].pos)},(0,c.zw)(e.$t("vacio","Vacío"))+" "+(0,c.zw)(l.isEditarArticulos(!0)),11,x))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(s,{ref:"modalPesoRef"},null,512),(0,t.Wm)(d,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(u,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(m,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(p,{ref:"modalAlergenosRef"},null,512)],64)}var A=o(4870);const z={class:"row"},E={class:"row"};function I(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBInput"),u=(0,t.up)("NumpadComponent"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBBtn"),v=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(f,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalPeso,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalPeso=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("introduce_los_gramos","Introduce los gramos")),1)])),_:1})])),_:1}),(0,t.Wm)(m,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",z,[l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(d,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>l.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",E,[(0,t.Wm)(u,{ref:"numpadRef"},null,512)])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,{color:"danger",onClick:a[1]||(a[1]=e=>l.modalPeso=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(p,{color:"success",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var S=o(4313),U=o(7767),j=o(4161),N=o(2492),H=o.n(N),F={name:"PesoComponent",components:{MDBModal:S.j3,MDBModalHeader:S.ol,MDBModalTitle:S.wo,MDBModalBody:S.Yz,MDBModalFooter:S.ab,MDBBtn:S.$v,MDBInput:S.u2,NumpadComponent:U.Z},setup(e,{expose:a}){const o=(0,A.iH)(!1),l=(0,A.iH)(null),n=(0,A.iH)({idArticulo:null,idCesta:null});function r(e,a){n.value.idArticulo=e,n.value.idCesta=a,o.value=!0}function i(e){j.Z.post("teclado/clickTeclaArticulo",{idArticulo:n.value.idArticulo,gramos:e,idCesta:n.value.idCesta,unidades:1,arraySuplementos:null}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");n.value.idArticulo=null,n.value.idCesta=null,o.value=!1})).catch((e=>{H().fire("Oops...",e.message,"error")}))}function s(){}return a({abrirModal:r}),(0,t.JJ)("okValue",i),{modalPeso:o,numpadRef:l,infoArticulo:n,test:s}}};const O=(0,b.Z)(F,[["render",I]]);var W=O;const V=e=>((0,t.dD)("data-v-356d6521"),e=e(),(0,t.Cn)(),e),P={class:"row"},R=["onClick"],$=V((()=>(0,t._)("br",null,null,-1))),Z={class:"row"},q={key:0,class:"table-responsive divCesta reverso"},L={class:"table colorFuente"},Y={class:"tableBody"},G=["onClick"],J={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}};function K(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,c.zw)(l.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(d,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",P,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,c.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:l.checkSuplementoActivo(e._id)}]]),onClick:a=>l.addSuplemento(e)},[(0,t.Uk)((0,c.zw)(e.nombre)+" ",1),$,(0,t.Uk)(" "+(0,c.zw)(e.precioConIva)+" € ",1)],10,R)])))),128))]),(0,t._)("div",Z,[l.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",q,[(0,t._)("table",L,[(0,t._)("tbody",Y,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,c.C_)(["itemCesta",{seleccionado:l.itemSeleccionado===a}]),onClick:e=>l.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",J,(0,c.zw)(e.nombre),1)]),(0,t._)("td",null,(0,c.zw)(e.precioConIva.toFixed(2))+" €",1)],10,G)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"danger",onClick:a[0]||(a[0]=e=>l.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(u,{color:"secondary",onClick:a[1]||(a[1]=e=>l.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Q={name:"SuplementosComponent",components:{MDBModal:S.j3,MDBModalHeader:S.ol,MDBModalTitle:S.wo,MDBModalBody:S.Yz,MDBModalFooter:S.ab,MDBBtn:S.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,A.iH)(!1),n=(0,A.iH)(null),r=(0,A.iH)(null),i={idArticulo:null,idCesta:null,cliente:null,suplementos:null},s=(0,A.iH)([]),c=(0,A.iH)([]);let d=0;const u=(0,t.Fl)((()=>{if(s.value&&s.value.length>0){let e=0;for(let a=0;a<s.value.length;a++)e+=s.value[a].precioConIva;return e}return 0}));async function m(e,a,t,n,r){i.idArticulo=e,i.idCesta=a,i.cliente=t,d=r;const s=await j.Z.post("articulos/getSuplementos",{arrayIdSuplementos:n});if(!s)throw Error("No se ha podido obtener la lista de suplementos");c.value=s.data,o.dispatch("Unidades/setUnidades",1),l.value=!0}function p(e){try{s.value.push(e)}catch(a){H().fire("Oops...",a.message,"error")}}function f(e){const a=s.value.findIndex((a=>a.suplemento===e));return-1!==a}function b(e){r.value=e}function C(){s.value.splice(r.value,1)}async function w(){try{let e;for(let a=0;a<d;a++)e=await j.Z.post("teclado/clickTeclaArticulo",{idArticulo:i.idArticulo,gramos:0,idCesta:i.idCesta,unidades:1,arraySuplementos:s.value});if(i.idArticulo=null,i.idCesta=null,s.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos");l.value=!1}catch(e){H().fire("Oops...",e.message,"error")}}function g(){}return a({abrirModal:m}),(0,t.JJ)("okValue",w),{modalSuplementos:l,addSuplemento:p,checkSuplementoActivo:f,numpadRef:n,arrayCompletoSuplementos:c,suplementosSeleccionados:s,itemSeleccionado:r,insertarArticulo:w,setIndex:b,eliminarActivo:C,totalSuplementos:u,test:g}}};const X=(0,b.Z)(Q,[["render",K],["__scopeId","data-v-356d6521"]]);var ee=X,ae=o(9242);const oe=e=>((0,t.dD)("data-v-9c9d6e02"),e=e(),(0,t.Cn)(),e),te={class:"row"},le={for:"nombre"},ne=oe((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),re=oe((()=>(0,t._)("option",{value:"4"},"0%",-1))),ie=oe((()=>(0,t._)("option",{value:"1"},"4%",-1))),se=oe((()=>(0,t._)("option",{value:"5"},"5%",-1))),ce=oe((()=>(0,t._)("option",{value:"2"},"10%",-1))),de=oe((()=>(0,t._)("option",{value:"3"},"21%",-1))),ue=[re,ie,se,ce,de],me=oe((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),pe=oe((()=>(0,t._)("option",{value:"true"},"Si",-1))),ve=oe((()=>(0,t._)("option",{value:"false"},"No",-1))),fe=[pe,ve],be={for:"precioIva"};function Ce(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:l.modalEditarProd,"onUpdate:modelValue":a[8]||(a[8]=e=>l.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",te,[(0,t._)("label",le,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,512),[[ae.nr,l.nombre]])]),ne,(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[1]||(a[1]=e=>l.tipoIva=e),class:"form-control"},ue,512),[[ae.bM,l.tipoIva]]),me,(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[2]||(a[2]=e=>l.esSumable=e),class:"form-control"},fe,512),[[ae.bM,l.esSumable]]),(0,t._)("label",be,[(0,t.Uk)("Precio con "+(0,c.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>l.precioConIva=e)},null,512),[[ae.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(u,{color:"warning",size:"lg",onClick:a[5]||(a[5]=e=>l.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[6]||(a[6]=e=>l.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(u,{color:"secondary",size:"lg",onClick:a[7]||(a[7]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var we=o(4834),ge={name:"ModalEditarProducto",components:{MDBModal:S.j3,MDBModalHeader:S.ol,MDBModalTitle:S.wo,MDBModalBody:S.Yz,MDBModalFooter:S.ab,MDBBtn:S.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,A.iH)(0),n=(0,A.iH)(!1),r=(0,A.iH)(0),i=(0,A.iH)(0),s=[4,10,21,0,5],c=(0,A.iH)(""),d=(0,A.iH)(-1),u=(0,A.iH)(""),m=(0,A.iH)(!0);async function p(){await j.Z.post("articulos/editarArticulo",{idArticulo:d.value,nombre:c.value,precioBase:parseFloat(r.value)/parseFloat(i.value),precioConIva:parseFloat(r.value),tipoIva:i.value,essumable:JSON.parse(m.value)}).then((e=>{n.value=!1,H().fire("Producto guardado","Producto guardado correctamente","success"),we.W.cargarTeclado()}))}function f(){n.value=!1}function b(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function C(e,a){await j.Z.post("articulos/moverArticulo",{id:d.value,posicion:e,menu:a}).then((a=>{H().fire("Producto establecido","Se ha movido el producto "+c.value+" correctamente a la celda "+e,"success"),we.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function w(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await j.Z.post("articulos/eliminarArticulo",{id:d.value}).then((e=>{H().fire("Producto eliminado","Se eliminado el producto "+c.value+" correctamente a la celda","success"),we.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),n.value=!1)}async function g(e,a,o,t,l,s){c.value=e,r.value=a,d.value=o,i.value=t,m.value=l,n.value=!0,u.value=s}return(0,t.bv)((()=>{})),a({abrirModal:g,botonVacio:C}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:c,precioBase:l,precioConIva:r,id:d,modalEditarProd:n,tipoIva:i,confirmar:p,menus:u,cambiarPosicion:b,esSumable:m,tiposIva:s,salirSinGuardar:f,EliminarTecla:w}}};const _e=(0,b.Z)(ge,[["render",Ce],["__scopeId","data-v-9c9d6e02"]]);var ye=_e;const Me=e=>((0,t.dD)("data-v-3c7ff1ac"),e=e(),(0,t.Cn)(),e),he={class:"row"},De={for:"nombre"},ke=Me((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),Be=Me((()=>(0,t._)("option",{value:"4"},"0%",-1))),xe=Me((()=>(0,t._)("option",{value:"1"},"4%",-1))),Te=Me((()=>(0,t._)("option",{value:"5"},"5%",-1))),Ae=Me((()=>(0,t._)("option",{value:"2"},"10%",-1))),ze=Me((()=>(0,t._)("option",{value:"3"},"21%",-1))),Ee=[Be,xe,Te,Ae,ze],Ie=Me((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Se=Me((()=>(0,t._)("option",{value:"true"},"Si",-1))),Ue=Me((()=>(0,t._)("option",{value:"false"},"No",-1))),je=[Se,Ue],Ne={for:"precioIva"};function He(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:l.modalCrearProd,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",he,[(0,t._)("label",De,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,512),[[ae.nr,l.nombre]])]),ke,(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[1]||(a[1]=e=>l.tipoIva=e),class:"form-control"},Ee,512),[[ae.bM,l.tipoIva]]),Ie,(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[2]||(a[2]=e=>l.esSumable=e),class:"form-control"},je,512),[[ae.bM,l.esSumable]]),(0,t._)("label",Ne,[(0,t.Uk)("Precio con "+(0,c.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>l.precioConIva=e)},null,512),[[ae.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[5]||(a[5]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Fe={name:"modalCrearProducto",components:{MDBModal:S.j3,MDBModalHeader:S.ol,MDBModalTitle:S.wo,MDBModalBody:S.Yz,MDBModalFooter:S.ab,MDBBtn:S.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,A.iH)(0),n=(0,A.iH)(!1),r=(0,A.iH)(0),i=(0,A.iH)(0),s=(0,A.iH)(0),c=[4,10,21,0,5],d=(0,A.iH)(""),u=(0,A.iH)(""),m=(0,A.iH)(-1),p=(0,A.iH)(""),f=(0,A.iH)(!0);async function b(){j.Z.post("articulos/anadirProducto",{nombreArticulo:d.value,precioConIva:parseFloat(r.value),esSumable:JSON.parse(f.value),precioBase:parseFloat(r.value)/parseFloat(i.value),tipoIva:parseFloat(i.value),menus:p.value,posicion:s.value}).then((e=>{u.value="",l.value=0,r.value=0,i.value=3,f.value=!1,n.value=!1,H().fire("Producto creado","Producto creado correctamente","success"),we.W.cargarTeclado()}))}function C(){n.value=!1}function w(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function g(e,a){s.value=e,d.value="Nombre",r.value="0.0",i.value="3",f.value=!0,n.value=!0,p.value=a}return(0,t.bv)((()=>{})),a({abrirModal:g}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:d,precioBase:l,precioConIva:r,id:m,modalCrearProd:n,tipoIva:i,confirmar:b,menus:p,cambiarPosicion:w,esSumable:f,tiposIva:c,salirSinGuardar:C}}};const Oe=(0,b.Z)(Fe,[["render",He],["__scopeId","data-v-3c7ff1ac"]]);var We=Oe;const Ve=["src"];function Pe(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),d=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(d,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:l.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:l.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,Ve),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>l.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Re={name:"ModalAlergenosComponent",components:{MDBModal:S.j3,MDBModalFooter:S.ab,MDBBtn:S.$v},setup(e,{expose:a}){const o=(0,A.iH)(!1),t=(0,A.iH)(""),l=(0,v.oR)(),n=l.getters["Configuracion/parametros"];function r(e){i(e),o.value=!0}function i(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${n?.licencia}`}return a({abrirModal:r}),{modalAlergenos:o,abrirModal:r,url:t}}};const $e=(0,b.Z)(Re,[["render",Pe]]);var Ze=$e,qe=o(2483),Le={name:"TeclasComponent",components:{PesoComponent:W,MDBBtn:S.$v,SuplementosComponent:ee,ModalEditarProducto:ye,ModalCrearProducto:We,ModalAlergenosVue:Ze},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,qe.tv)(),n=(0,t.Fl)((()=>o.state.modoActual)),r=(0,t.Fl)((()=>o.state.Configuracion.parametros)),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),c=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),p=(0,A.iH)(null),f=(0,A.iH)(!1),b=(0,A.iH)(null),C=(0,A.iH)(null),w=(0,A.iH)(null),g=(0,A.iH)(null),_=(0,t.Fl)((()=>o.state.Unidades.unidades)),y=(0,A.iH)(!1),M=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(c.value[e]._id==d.value[u.value].idCesta)return c.value[e];return null}));function h(e){g.value.abrirModal(e)}function D(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}async function k(e,a=undefined){if(void 0!=a&&-1==a.pointerId)return;let t=e.idArticle,l=c.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===n.value||"MOVER_ARTICULO"===n.value)return"MOVER_ARTICULO"===n.value?void H().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void j.Z.post("articulos/getArticulo",{idArticulo:t,idCliente:l}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");C.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!M.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=r?.value?.prohibirSuplementos&&e.suplementos?.length>0)b.value.abrirModal(e.idArticle,M.value._id,M.value.idCliente,e.suplementos,_.value);else{const a=await j.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:M.value._id,unidades:_.value,arraySuplementos:null});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}else p.value.abrirModal(e.idArticle,M.value._id)}catch(i){H().fire("Oops...",i.message,"error")}}const B=(0,t.Fl)((()=>{let e=D();if(i.value&&i.value[s.value]&&i.value[s.value].arraySubmenus&&i.value[s.value].arraySubmenus[m.value])for(let a=0;a<i.value[s.value].arraySubmenus[m.value].arrayTeclas.length;a++)e[i.value[s.value].arraySubmenus[m.value].arrayTeclas[a].pos]=i.value[s.value].arraySubmenus[m.value].arrayTeclas[a];else if(i.value&&i.value[s.value]&&i.value[s.value].arrayTeclas)for(let a=0;a<i.value[s.value].arrayTeclas.length;a++)e[i.value[s.value].arrayTeclas[a].pos]=i.value[s.value].arrayTeclas[a];return e}));function x(e){return parseInt(e,16)||e}function T(e){return x(e)/255<=.03928?x(e)/255/12.92:Math.pow((x(e)/255+.055)/1.055,2.4)}function z(e){return.2126*T(e.substr(1,2))+.7152*T(e.substr(3,2))+.0722*T(e.substr(-2))}function E(e,a){const o=z(e),t=z(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function I(e){const a=E(e,"#ffffff"),o=E(e,"#000000");return a>o?"#ffffff":"#000000"}function S(e){}function U(e){return e?"MOVER_ARTICULO"==n.value?"Mover aqui":"Vacío":n.value}function N(e){let a=i.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[m.value].nombre,t=`[${a.nombre}] ${o}`),"MOVER_ARTICULO"==n.value)return C.value.botonVacio(e,t);w.value.abrirModal(e,t)}return(0,t.JJ)("addItem",S),(0,t.bv)((()=>{d.value&&0!==d.value?.length||l.push("menu/fichajes"),j.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(y.value=!0):y.value=!1})),j.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(f.value=!0):f.value=!1}))})),a({clickTecla:k}),{teclado:i,precioTecla:f,indexMenuActivo:s,arrayTeclas:B,getTextColor:I,modalPesoRef:p,modalSuplementosRef:b,modalAlergenosRef:g,modalEditarProdRef:C,modalCrearProdRef:w,abrirFicha:h,clickTecla:k,NoSuplementos:y,isEditarArticulos:U,editarArticulo:N}}};const Ye=(0,b.Z)(Le,[["render",T],["__scopeId","data-v-1c99c4f2"]]);var Ge=Ye;const Je={key:0,class:"table-responsive divCesta reverso"},Ke={class:"table colorFuente"},Qe={class:"tableBody"},Xe=["onClick"],ea={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}},aa={class:"xUnidades ms-2 d-inline"},oa={key:0,class:"col-12"},ta={"d-flex":"","justify-content-around":""},la={style:{"max-width":"10rem","min-width":"10rem"}},na={class:"pe-1"},ra={class:"xUnidades ms-2 d-inline"},ia={key:1,class:"d-flex row col-12"},sa={class:"col-12"},ca={"d-flex":"","justify-content-around":""},da={style:{"max-width":"10rem","min-width":"10rem"}},ua={class:"pe-1"},ma={class:"xUnidades ms-2 d-inline"},pa={class:"col-12"},va={"d-flex":"","justify-content-around":""},fa={style:{"max-width":"10rem","min-width":"10rem"}},ba={class:"pe-1"},Ca={class:"xUnidades ms-2 d-inline"},wa={key:0,style:{"max-width":"6rem","min-width":"10rem"}},ga={key:1},_a={key:0,class:"fw-bold"};function ya(e,a,o,l,n,r){const i=(0,t.up)("MDBCardTitle"),s=(0,t.up)("MDBCardText"),d=(0,t.up)("MDBBtn"),u=(0,t.up)("MDBCardBody"),m=(0,t.up)("MDBCard");return l.cesta&&l.cesta.lista?((0,t.wg)(),(0,t.iD)("div",Je,[(0,t._)("table",Ke,[(0,t._)("tbody",Qe,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cesta.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,c.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:l.indexItemCestaActivo===a,sePuedeRegalar:l.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>l.clickItem(a)},[(0,t._)("td",null,[(0,t._)("span",ea,(0,c.zw)(e.nombre),1),(0,t._)("span",aa," x"+(0,c.zw)(e.unidades),1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,c.zw)(e.nombre),1)))),128)),null==e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("li",oa,[(0,t._)("span",ta,[(0,t._)("td",la,(0,c.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",na,(0,c.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",ra," x"+(0,c.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])])):null!=e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("tr",ia,[(0,t._)("li",sa,[(0,t._)("span",ca,[(0,t._)("td",da,(0,c.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",ua,(0,c.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",ma," x"+(0,c.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])]),(0,t._)("li",pa,[(0,t._)("span",va,[(0,t._)("td",fa,(0,c.zw)(l.recortarNombreArtSec(e)),1),(0,t._)("td",ba,(0,c.zw)(e.promocion.precioRealArticuloSecundario)+" € ",1),(0,t._)("td",Ca," x"+(0,c.zw)(e.unidades*e.promocion.cantidadArticuloSecundario),1)])])])):(0,t.kq)("",!0)]),"CONSUMO_PERSONAL"!==l.cesta.modo&&"DEVOLUCION"!==l.cesta.modo?((0,t.wg)(),(0,t.iD)("td",wa,(0,c.zw)(e.subtotal.toFixed(2))+" € ",1)):(0,t.kq)("",!0)],10,Xe)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",ga,[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),l.arrayTrabajadores&&l.arrayTrabajadores[l.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",_a,(0,c.zw)(l.arrayTrabajadores[l.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(d,{color:"primary",onClick:a[0]||(a[0]=e=>l.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,c.zw)(l.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})]))}var Ma={name:"CestaComponent",components:{MDBCard:S.Yl,MDBCardBody:S.H7,MDBCardTitle:S.QM,MDBCardText:S.Pp,MDBBtn:S.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),n=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),r=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),i=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),s=(0,t.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(r.value&&r.value[i.value]&&l.value[e]._id==r.value[i.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",l.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),l.value[e];return null})),c=(0,A.iH)(0);function d(){s.value?.idCliente?j.Z.post("clientes/consultarPuntos",{idCliente:s.value?.idCliente}).then((e=>{"number"===typeof e.data?c.value=e.data:c.value=0})).catch((e=>{H().fire("Oops...",e.message,"error"),c.value=0})):c.value=0}function u(){if(r.value&&void 0!=i.value&&null!=i.value&&r.value[i.value]){let e=!0;if(void 0!=s.value&&"DEVOLUCION"==s?.value?.modo)return;for(let a=0;a<l.value.length;a++)if(l.value[a].trabajador==r.value[i.value].idTrabajador){j.Z.post("cestas/cambiarCestaTrabajador",{idCesta:l.value[a]._id,idTrabajador:r.value[i.value]._id}),e=!1;break}if(!e)return;m(),e=!1}else r.value&&void 0!=i.value&&null!=i.value?H().fire("Oops...","Error desconocido #123","error"):H().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function m(){r.value&&void 0!=i.value&&null!=i.value&&r.value[i.value]?await j.Z.post("cestas/crearCesta",{idTrabajador:r.value[i.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{H().fire("Oops...",e.message,"error")})):r.value&&void 0!=i.value&&null!=i.value||H().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function p(e){return Math.trunc(.03*e*.02)}function f(e){const a=[8641,8654,8640,8675,99,315,314,312,5603];if(null==s.value.idCliente||void 0==s.value.idCliente||""==s.value.idCliente)return!1;for(let o=0;o<a.length;o++)if(a[o]===e.idArticulo&&p(c.value)>=e.subtotal&&!e.regalo)return!0;return!1}function b(e){j.Z.post("cestas/regalarProducto",{idCesta:s.value._id,indexLista:e}).then((e=>{e.data?H().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):H().fire("Oops...","No se ha podido regalar el producto","error")}))}function C(e){f(s.value.lista[e])?H().fire({title:"¿Regalar este artículo?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?b(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)})):o.dispatch("Cestas/setActivoAction",e)}function w(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function g(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}return a({actualizarPuntos:d,BuscarCestas:u}),(0,t.bv)((()=>{d()})),{cesta:s,arrayTrabajadores:r,indexTrabajadorActivo:i,indexItemCestaActivo:n,clickItem:C,inicializarCesta:m,BuscarCestas:u,sePuedeRegalar:f,puntos:c,recortarNombreArtPrinc:w,recortarNombreArtSec:g}}};const ha=(0,b.Z)(Ma,[["render",ya],["__scopeId","data-v-36c541b0"]]);var Da=ha;const ka={class:"modoVenta d-block text-center"},Ba={key:0,class:"d-block textoNombreCliente text-center"},xa={class:"text-truncate",style:{"max-width":"10rem"}},Ta={key:1,class:"d-block text-center textoNombreCliente"};function Aa(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBBtnGroup"),u=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),v=(0,t.up)("ModalUnidadesComponent"),f=(0,t.up)("tarjetaClienteNumero");return(0,t.wg)(),(0,t.iD)(t.HY,null,[l.vistaEspecial&&l.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,c.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==l.cesta.modo,fondoCliente:l.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",ka,(0,c.zw)(l.cesta.modo),1),l.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",Ba,[(0,t._)("span",xa,(0,c.zw)(l.cesta.nombreCliente),1),(0,t.Wm)(i,{onClick:a[0]||(a[0]=e=>l.consultarPuntos(l.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",Ta,(0,c.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(d,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>l.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[2]||(a[2]=e=>l.refModalArticulos.abrirModal()),outline:"secondary",class:(0,c.C_)(["botones ms-1",{oculto:l.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),l.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>l.refModalClientesSeleccionado.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"secondary",class:"botones ms-1",onClick:a[4]||(a[4]=e=>l.refModalClientes.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1}))])),_:1})),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(d,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{onClick:a[5]||(a[5]=e=>l.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[6]||(a[6]=e=>l.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[7]||(a[7]=e=>l.goTo("/cestas")),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1})])),_:1})),(0,t.Wm)(d,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==l.indexActivoCesta||null==l.indexActivoCesta?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"secondary",class:"botones",onClick:a[8]||(a[8]=e=>l.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"secondary",class:"botones",onClick:a[9]||(a[9]=e=>l.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(i,{onClick:a[10]||(a[10]=e=>l.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(i,{outline:"secondary",onClick:a[11]||(a[11]=e=>l.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",size:"4x"})])),_:1})])),_:1}),(0,t.Wm)(u,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(v,{ref:"refModalUnidades"},null,512),(0,t.Wm)(f,{ref:"tarjetaNum"},null,512)],64)}var za=o(250),Ea=o(1464);const Ia={class:"row mt-1 p-4"},Sa={class:"col-md-8"},Ua={class:"col-md-4"},ja={key:0,class:"row"},Na={class:"col"},Ha={class:"table-responsive w-100",style:{height:"400px"}},Fa={class:"table table-striped mt-1"},Oa={class:"textoNombre d-inline-block text-truncate"},Wa={key:1,class:"row"},Va={class:"sinResultados position-relative"},Pa={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function Ra(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(d,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:l.modalArticulos,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ia,[(0,t._)("div",Sa,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>l.inputBusqueda=e)},null,512),[[ae.nr,l.inputBusqueda]])]),(0,t._)("div",Ua,[(0,t.Wm)(i,{color:"secondary",class:"botonBusqueda w-100",onClick:a[1]||(a[1]=e=>l.buscar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("buscar","Buscar")),1)])),_:1})])]),l.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",ja,[(0,t._)("div",Na,[(0,t._)("div",Ha,[(0,t._)("table",Fa,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",Oa,(0,c.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(i,{color:"primary",size:"lg",onClick:e=>l.selectArticulo({idArticle:a._id,esSumable:a.esSumable}),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):((0,t.wg)(),(0,t.iD)("div",Wa,[(0,t._)("div",Va,[(0,t._)("span",Pa,(0,c.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})])),_:1},8,["modelValue"])}var $a={name:"ModalArticulosComponent",components:{MDBModal:S.j3,MDBModalBody:S.Yz,MDBBtn:S.$v},setup(e,a){const o=(0,A.iH)(!1),l=(0,A.iH)(0),n=(0,A.iH)(""),r=(0,A.iH)(),i=(0,t.f3)("clickTecla");function s(e){i(e),o.value=!1}function c(){o.value=!0}function d(){l.value++}function u(){j.Z.post("articulos/buscar",{busqueda:n.value}).then((e=>{r.value=e.data})).catch((e=>{H().fire("Oops...",e.message,"error")}))}return(0,t.YP)(n,(()=>{u()})),a.expose({abrirModal:c,datoBorrar:l}),{test:d,datoBorrar:l,modalArticulos:o,inputBusqueda:n,arrayArticulos:r,buscar:u,selectArticulo:s}}};const Za=(0,b.Z)($a,[["render",Ra],["__scopeId","data-v-1b7d2910"]]);var qa=Za;const La={class:"row"},Ya={class:"row"},Ga={class:"text-center"};function Ja(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("NumpadComponent"),u=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:l.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("introduce","Introduce"))+" "+(0,c.zw)(e.$t("las_unidades","las unidades"))+" "+(0,c.zw)(e.$t("y_marca","y marca"))+" "+(0,c.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",La,[l.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>l.refUnidadesComponent.cantidad=e)},null,512)),[[ae.nr,l.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",Ya,[(0,t._)("div",Ga,[(0,t.Wm)(d,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Ka={name:"UnidadesComponent",components:{NumpadComponent:U.Z,MDBModal:S.j3,MDBModalBody:S.Yz,MDBModalHeader:S.ol,MDBModalTitle:S.wo},setup(){const e=(0,A.iH)(null),a=(0,A.iH)(null),o=(0,v.oR)();function l(){a.value=!0}function n(e){o.dispatch("Unidades/setUnidades",e),a.value=!1}return(0,t.JJ)("okValue",n),{refUnidadesComponent:e,modalUnidades:a,abrirModal:l}}};const Qa=(0,b.Z)(Ka,[["render",Ja],["__scopeId","data-v-37288cef"]]);var Xa=Qa;const eo={class:"text-center col-12 p3"},ao={class:"text-center h2"},oo={class:"row"},to={class:"d-inline-block text-center"},lo={id:"salir"};function no(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal"),u=(0,t.up)("ModalEncargosComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(d,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalClientesSeleccionado,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",eo,[(0,t._)("span",ao,(0,c.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,c.zw)(l.cesta.nombreCliente),1)]),(0,t._)("div",oo,[(0,t._)("div",to,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>l.refModalEncargos.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("encargos","Encargos")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("Deudas","deudas")),1)])),_:1})]),(0,t._)("div",lo,[(0,t.Wm)(i,{color:"danger",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>l.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"refModalEncargos"},null,512)],64)}const ro=e=>((0,t.dD)("data-v-f5bb26fc"),e=e(),(0,t.Cn)(),e),io={class:"row"},so={class:"d-inline-block text-center"},co={class:"p-0"},uo={class:"text-center"},mo=ro((()=>(0,t._)("option",{value:"1",selected:""},"todo",-1))),po=ro((()=>(0,t._)("option",{value:"2"},"hoy",-1))),vo=[mo,po],fo={id:"lista"},bo=["onClick"],Co={class:"d-flex m-0 p-0 justify-content-between"},wo={key:0,class:"p-0"},go={key:0},_o={key:1},yo={key:1,class:"p-0",type:"button"},Mo={key:2,class:"p-0",type:"button"},ho={class:"d-flex justify-content-between px-0 py-2 m-0"},Do={class:"productos"},ko={class:"col-12"},Bo={class:"col-3"},xo={class:"col-1"},To={class:"col-1"},Ao={class:"col-2"},zo={class:"col-2"},Eo={class:"col-3"},Io={class:"d-flex flex-column justify-content-center"},So={key:1},Uo={id:"salir"},jo={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},No=ro((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),Ho={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},Fo=ro((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1)));function Oo(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(d,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalEncargos,"onUpdate:modelValue":a[4]||(a[4]=e=>l.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",io,[(0,t._)("div",so,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/encargos"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.recoger},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.anular},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",co,[(0,t._)("h3",uo,[(0,t.Uk)(" Listado de "),(0,t.wy)((0,t._)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>l.listado=e),id:"encargo",onChange:a[2]||(a[2]=e=>l.mostrar())},vo,544),[[ae.bM,l.listado]]),(0,t.Uk)(": ")]),(0,t._)("div",fo,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.encargos,((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>l.onClickEncargo(o),class:(0,c.C_)({active:l.seleccionado===o,horaTarde:1==l.horaTarde(a),diaTarde:1==l.diaTarde(a)})},[(0,t._)("div",Co,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",wo,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",go,(0,c.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,c.zw)(a?.fecha)+" "+(0,c.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",_o,(0,c.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,c.zw)(a?.fecha)+" "+(0,c.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",yo,[(0,t._)("p",null,(0,c.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,c.zw)(a?.fecha)+" "+(0,c.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Mo,[(0,t._)("p",null,(0,c.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,c.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,c.zw)(a?.nombreCliente),1)]),(0,t._)("div",ho,[(0,t._)("p",null,(0,c.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,c.zw)(a?.total)+"€ ",1),(0,t._)("p",null,(0,c.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,c.zw)(a?.dejaCuenta)+"€ ",1),(0,t._)("p",null,(0,c.zw)(e.$t("faltan","Faltan"))+": "+(0,c.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,(0,c.zw)(e.$t("productos","Productos"))+": "+(0,c.zw)(a?.productos?.length),1),(0,t._)("div",Do,[(0,t._)("table",ko,[(0,t._)("tr",null,[(0,t._)("th",Bo,(0,c.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",xo,(0,c.zw)(e.$t("precio","Precio")),1),(0,t._)("th",To,(0,c.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",Ao,(0,c.zw)(e.$t("total","Total")),1),(0,t._)("th",zo,(0,c.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",Eo,(0,c.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,c.zw)(e?.nombre),1),(0,t._)("td",null,(0,c.zw)(l.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,c.zw)(e?.unidades),1),(0,t._)("td",null,(0,c.zw)(l.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",Io,[e?.arraySuplementos?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("span",null,(0,c.zw)(e.nombre),1)))),256)):((0,t.wg)(),(0,t.iD)("span",So,"Ninguno"))]),(0,t._)("td",null,(0,c.zw)(e?.comentario),1)])))),128))])])],10,bo)])))),128))])]),(0,t._)("div",Uo,[(0,t._)("div",jo,[No,(0,t._)("span",null,(0,c.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(i,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[3]||(a[3]=e=>{l.seleccionado=-1,l.modalEncargos=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,c.zw)(e.$t("salir","Salir")),1)])),_:1}),(0,t._)("div",Ho,[Fo,(0,t._)("span",null,(0,c.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"])}var Wo={name:"modalEncargosComponent",components:{MDBModal:S.j3,MDBModalBody:S.Yz,MDBBtn:S.$v},setup(e,a){const o=(0,v.oR)(),l=(0,qe.tv)(),n=(0,A.iH)(null),r=((0,A.iH)(0),(0,A.iH)()),i=((0,t.f3)("actualizarPuntos"),(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores))),s=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>i.value&&void 0!=s.value&&null!=s.value&&i.value[s.value]?i.value[s.value]:null)),d=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),u=(0,t.Fl)((()=>{if(d.value)for(let e=0;e<d.value.length;e++)if(i.value&&i.value[s.value]&&d.value[e]._id==i.value[s.value].idCesta)return d.value[e];return null})),m=new Date,p=(0,A.iH)(-1),f=new Date(m.getFullYear(),m.getMonth(),m.getDate(),0,0,0);f.setDate(f.getDate()+1);let b="1";const C=(0,A.iH)(null),w=(0,A.iH)(null);function g(){n.value=!0,_()}function _(){j.Z.post("/encargos/getEncargos").then((e=>{C.value=e.data,I(),M()}))}function y(e){l.push(e)}function M(){p.value=-1;let e=document.getElementById("encargo");w.value=e&&1!=e?.value?h():C.value,w.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function h(){const e=(0,A.iH)([]);for(let a=0;a<C.value.length;a++){const o=C.value[a];1==o.opcionRecogida&&"am"==o.amPm?o.hora="14:59":(1==o.opcionRecogida&&"pm"==o.amPm||3==o.opcionRecogida)&&(o.hora="23:59");const t=new Date(`${o.fecha}T${o.hora}`);t.getDate()>=m.getDate()&&t.getDate()<f.getDate()&&e.value.push(o)}return console.log(e.value),e.value}function D(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),l=a.getMinutes(),n=o.getHours(),r=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getDate()==o.getDate()&&(n<t||n==t&&r<=l)}function k(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()>o.getDate()}function B(e){p.value=e}function x(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}async function T(){-1!=p.value?await H().fire({title:"Precio por pagar: "+x(w.value[p.value].total-w.value[p.value].dejaCuenta,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar compra",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed)try{const e=await j.Z.post("tickets/crearTicketEncargo",{idEncargo:w.value[p.value]._id,total:w.value[p.value].total,dejaCuenta:w.value[p.value].dejaCuenta,tipo:"EFECTIVO",idTrabajador:c.value._id});if(!e.data)throw Error("No se ha podido crear el ticket");w.value.splice(p.value,1),p.value=-1,_(),H().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),l.push("/main")}catch(a){H().fire("Oops...",a.message,"error")}})):H().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function z(){-1!=p.value?H().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((e=>{e.isConfirmed&&(w.value[p.value].dejaCuenta>0&&j.Z.post("movimientos/nuevoMovimiento",{cantidad:w.value[p.value].dejaCuenta,concepto:"Entrega Diària",idTrabajador:c.value._id,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{H().fire("Oops...",e.message,"error")})),j.Z.post("/encargos/setEntregado",{id:w.value[p.value]._id}).then((e=>{e?.data?(w.value.splice(p.value,1),p.value=-1,_(),H().fire("Perfecto","Encargo anulado correctamente","success")):H().fire("Oops...","Encargo no anulado","error")})).catch((e=>{H().fire("Oops...",e.message,"error")})))})):H().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function E(){H().fire({title:"Imprimir encargos de hoy",text:"orden de la lista:",icon:"info",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Producto",denyButtonText:"Cliente",denyButtonColor:"green",confirmButtonColor:"green",customClass:{actions:"my-actions",cancelButton:"order-3 right-gap",confirmButton:"order-1",denyButton:"order-2"}}).then((e=>{if(!e.isDismissed){let a;const o=(0,A.iH)([]);o.value=h(),e.isConfirmed?(a="Producto",H().fire("Saved!","","success")):e.isDenied&&(a="Cliente",H().fire("Changes are not saved","","info")),j.Z.post("/encargos/imprimirEncargosHoy",{orden:a,array:o.value}).then((e=>{e?.data?H().fire("Perfecto","imprimiendo encargos","success"):H().fire("Oops...","Encargo no anulado","error")})).catch((e=>{H().fire("Oops...",e.message,"error")}))}}))}function I(){let e=new Date,a=(e.getDate(),e.getDate(),e.getMonth()+1);a<10&&(a="0"+a);e.getFullYear();let o=!1;for(let t=0;t<C.value.length&&!o;t++)if(3==C.value[t].opcionRecogida){for(let a=0;a<C.value[t].dias.length&&!o;a++)if(C.value[t].dias[a].checked){let l=e.getDay(),n=C.value[t].dias[a].nDia+1,r=(n-l+7)%7,i=new Date(e.getTime()+24*r*60*60*1e3);C.value[t].fecha=i.toISOString().slice(0,10),o=!0}o=!1}}return a.expose({abrirModal:g}),{modalEncargos:n,arrayClientes:r,cesta:u,goTo:y,encargos:w,mostrar:M,listado:b,seleccionado:p,onClickEncargo:B,recoger:T,anular:z,redondearDecimales:x,diaTarde:k,horaTarde:D,cargarEncargos:_,imprimir:E}}};const Vo=(0,b.Z)(Wo,[["render",Oo],["__scopeId","data-v-f5bb26fc"]]);var Po=Vo,Ro={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:S.j3,MDBModalBody:S.Yz,MDBBtn:S.$v,ModalEncargosComponent:Po},setup(e,a){const o=(0,v.oR)(),l=(0,A.iH)(null),n=((0,A.iH)(0),(0,A.iH)()),r=(0,A.iH)(null),i=((0,t.f3)("actualizarPuntos"),(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores))),s=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=((0,t.Fl)((()=>i.value&&void 0!=s.value&&null!=s.value&&i.value[s.value]?i.value[s.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),d=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(i.value&&i.value[s.value]&&c.value[e]._id==i.value[s.value].idCesta)return c.value[e];return null}));function u(){l.value=!0}async function m(){if(c.value&&d.value)for(let e=0;e<c.value.length;e++)if(c.value[e]._id===d.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}l.value=!1}return a.expose({abrirModal:u}),{modalClientesSeleccionado:l,arrayClientes:n,cesta:d,resetGeneral:m,refModalEncargos:r}}};const $o=(0,b.Z)(Ro,[["render",no],["__scopeId","data-v-d22992ca"]]);var Zo=$o,qo={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:S.Ff,MDBBtn:S.$v,MDBIcon:S.vm,ModalClientesComponent:Ea.Z,ModalArticulosComponent:qa,ModalUnidadesComponent:Xa,CestaComponentVue:Da,ModalClientesSeleccionadoComponent:Zo},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Configuracion.parametros)),n=(0,A.iH)(null),r=(0,A.iH)(null),i=(0,A.iH)(null),s=(0,A.iH)(null),c=(0,A.iH)(null),d=(0,A.iH)(null),u=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),m=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),p=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),f=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),b=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let C="";const w=(0,A.iH)(!1),g=(0,t.Fl)((()=>{if(m.value)for(let e=0;e<m.value.length;e++)if(p.value&&p.value[b.value]&&m.value[e]._id==p.value[b.value].idCesta)return m.value[e];return null}));function _(){null!=f.value&&void 0!=f.value&&g.value&&o.dispatch("Cestas/deleteIndex",{index:f.value,idCesta:g.value._id})}function y(){g.value&&o.dispatch("Cestas/deleteLista",g.value._id)}function M(){u.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function h(e){za.Z.push(e)}function D(e){j.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");H().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{H().fire("Oops...",e.message,"error")}))}async function k(){if(m.value&&g.value)for(let e=0;e<m.value.length;e++)if(m.value[e]._id===g.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==g.value.modo)console.log("tambe2"),j.Z.post("cestas/fulminarCesta",{idCesta:g.value._id}).then((e=>{if(!e.data)throw Error("No se ha podido eliminar la cesta en el servidor")})).catch((e=>{H().fire("Oops...",e.message,"error")}));else if(console.log("tambe"),m.value&&g.value)for(let e=0;e<m.value.length;e++)if(m.value[e]._id===g.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}}function B(e){j.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((e=>{e.data?n.value.selectCliente(e.data.id,e.data.nombre):H().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}function x(e){if("Enter"==e)return B(C),void(C="");C+=e}function T(){j.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(d.value=e.data[0]._id,j.Z.post("impresora/imprimirTicket",{idTicket:d.value}).catch((e=>{H().fire("Oops...",e.message,"error")}))):H().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}return a({resetGeneral:k}),(0,t.bv)((()=>{g.value&&(g.value.idCliente||"VENTA"!=g.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),j.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?"Si"==e.data?.params?.prohibirBuscarArticulos&&(w.value=!0):w.value=!1}))})),{indexActivoCesta:f,borrarItem:_,borrarLista:y,vistaEspecial:u,changeVistaCliente:M,cesta:g,goTo:h,refModalClientes:n,refModalArticulos:r,refModalUnidades:i,CestaComponent:s,resetGeneral:k,consultarPuntos:D,parametros:l,NoBuscarProducte:w,imprimirUltimoTicket:T,idTicket:d,getTarjetaCliente:x,tarjetaClienteNumero:C,refModalClientesSeleccionado:c}},methods:{onKeydown(e){this.getTarjetaCliente(e.key)}},mounted(){document.addEventListener("keydown",this.onKeydown)}};const Lo=(0,b.Z)(qo,[["render",Aa],["__scopeId","data-v-68aa9cbe"]]);var Yo=Lo;const Go=e=>((0,t.dD)("data-v-56937e7d"),e=e(),(0,t.Cn)(),e),Jo={class:"row"},Ko={key:0,class:"nombreTrabajador text-center d-inline-block text-truncate"},Qo={key:1,class:"nombreMesa d-inline-block text-truncate"},Xo={class:"row"},et={class:"disponible"},at={class:"nodisponible"},ot={class:"again"},tt={class:"esperandoVenta"},lt={key:4,class:"d-inline text-center grupoContento pt-1"},nt=Go((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1))),rt=[nt],it={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},st={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},ct={class:"row mt-1"},dt=Go((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),ut={class:"letraTotal ms-3 mt-2"},mt={class:"text-start fst-italic informacion"};function pt(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Jo,[l.trabajadorActivo?((0,t.wg)(),(0,t.iD)("span",Ko,(0,c.zw)(l.trabajadorActivo.nombreCorto),1)):(0,t.kq)("",!0),l.cesta&&l.cesta.indexMesa&&l.arrayMesas&&l.arrayMesas[l.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",Qo,(0,c.zw)(e.$t("mesa","Mesa"))+" "+(0,c.zw)(l.arrayMesas[l.cesta.indexMesa].nombre),1)):(0,t.kq)("",!0)]),(0,t._)("div",Xo,["ONLINE"===l.estadoDatafono?((0,t.wg)(),(0,t.j4)(i,{key:0,onClick:a[0]||(a[0]=e=>l.datafonoDisponible()),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",et,(0,c.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1})):(0,t.kq)("",!0),"OFFLINE"===l.estadoDatafono?((0,t.wg)(),(0,t.j4)(i,{key:1,onClick:a[1]||(a[1]=e=>l.datafonoDisponible()),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",at,(0,c.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})):(0,t.kq)("",!0),"AGAIN"===l.estadoDatafono?((0,t.wg)(),(0,t.j4)(i,{key:2,outline:"warning",class:"botonEstado",onClick:a[2]||(a[2]=e=>l.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",ot,(0,c.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})):(0,t.kq)("",!0),"PENDIENTE"===l.estadoDatafono?((0,t.wg)(),(0,t.j4)(i,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",tt,(0,c.zw)(l.procesoDatafono),1)])),_:1})):(0,t.kq)("",!0),"BUSCANDO"===l.estadoDatafono?((0,t.wg)(),(0,t.iD)("div",lt,rt)):(0,t.kq)("",!0),"APROBADA"===l.estadoDatafono?((0,t.wg)(),(0,t.iD)("div",it,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"3x"})])):(0,t.kq)("",!0),"DENEGADA"===l.estadoDatafono?((0,t.wg)(),(0,t.iD)("div",st,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"})])):(0,t.kq)("",!0)]),(0,t._)("div",ct,[l.cesta&&l.getTotal(l.cesta)>0&&"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&("CONSUMO_PERSONAL"===l.cesta.modo||"DEVOLUCION"===l.cesta.modo)?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"primary",class:"botonPagar",onClick:a[3]||(a[3]=e=>l.handleCobro())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),dt])),_:1})):l.cesta&&l.getTotal(l.cesta)>0&&"CONSUMO_PERSONAL"!==l.cesta.modo?((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"primary",class:"botonPagar",onClick:a[4]||(a[4]=e=>l.handleCobro())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",ut,(0,c.zw)(l.getTotal(l.cesta).toFixed(2))+" € ",1)])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.j4)(i,{key:2,onClick:a[5]||(a[5]=e=>l.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&l.cesta&&0===l.getTotal(l.cesta)?((0,t.wg)(),(0,t.j4)(i,{key:3,outline:"primary",class:"botonPagar",onClick:a[6]||(a[6]=e=>l.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",mt,"(v"+(0,c.zw)(l.tocVersion)+") ("+(0,c.zw)(l.nombreTienda)+") "+(0,c.zw)(l.getClock),1)])],64)}var vt={name:"MenuDerechaComponent",components:{MDBIcon:S.vm,MDBBtn:S.$v},setup(){const e=(0,A.iH)(""),a=(0,A.iH)(""),o=(0,A.iH)(""),l=(0,v.oR)(),n=(0,A.iH)(!1),r=(0,qe.tv)(),i=(0,A.iH)([]),s=(0,t.Fl)((()=>l.state.Cestas.Descuento)),c=(0,t.f3)("resetGeneral"),d=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),p=(0,t.Fl)((()=>l.state.Datafono.estado)),f=(0,t.Fl)((()=>l.state.Datafono.procesoActual)),b=(0,t.Fl)((()=>l.state.modoActual)),C=(0,t.Fl)((()=>d.value&&void 0!=m.value&&null!=m.value&&d.value[m.value]?d.value[m.value]:null)),w=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(d.value&&d.value[m.value]&&u.value[e]._id==d.value[m.value].idCesta)return u.value[e];return null}));function g(e){_();let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return Number(a-a*s.value)}async function _(){if(!w?.value?.idCliente)return l.dispatch("Cestas/setDescuentoAction",0);await j.Z.post("clientes/isClienteDescuento",{idCliente:w.value.idCliente}).then((e=>e.data?l.dispatch("Cestas/setDescuentoAction",Number(e.data/100)):l.dispatch("Cestas/setDescuentoAction",0)))}function y(){j.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");i.value=e.data})).catch((e=>{H().fire("Oops...",e.message,"error")}))}function M(){"PENDIENTE"!=p.value&&(l.dispatch("Datafono/setEstado","BUSCANDO"),j.Z.post("paytef/comprobarDisponibilidad").then((e=>l.dispatch("Datafono/setEstado",e.data))).catch((e=>l.dispatch("Datafono/setEstado","OFFLINE"))))}function h(e){r.push(e)}function D(){n.value||(j.Z.post("impresora/abrirCajon"),H().fire("AVISO","elige un artículo para ir a cobrar","info"))}function k(){l.dispatch("setModoActual","NORMAL")}function B(){j.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:C.value._id}).then((()=>{l.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{H().fire("Oops...",e.message,"error")}))}async function x(){if(w.value)if("VENTA"===w.value.modo)if(w.value.idCliente&&""!=w.value.idCliente){const e=(await j.Z.post("clientes/getClienteById",{idCliente:w.value.idCliente})).data;!0===e?.albaran&&!0===e?.noPagaEnTienda?j.Z.post("tickets/crearTicket",{total:g(w.value),idCesta:w.value._id,idTrabajador:C.value._id,tipo:"DEUDA",tkrsData:null}).then((e=>{if(!e.data)throw Error("No se ha podido registrar la venta en modo deuda");H().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:2e3})})).catch((e=>{H().fire("Oops...",e.message,"error")})):(await j.Z.post("impresora/despedida",{precioTotal:g(w.value).toFixed(2)}),h("/cobro"))}else await j.Z.post("impresora/despedida",{precioTotal:g(w.value).toFixed(2)}),h("/cobro");else"DEVOLUCION"===w.value.modo?j.Z.post("devoluciones/nuevaDevolucion",{total:g(w.value),idCesta:w.value._id,idTrabajador:C.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await H().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),c()})).catch((e=>{H().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===w.value.modo&&j.Z.post("tickets/crearTicket",{total:g(w.value),idCesta:w.value._id,idTrabajador:C.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");c(),H().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{H().fire("Oops...",e.message,"error")}));else H().fire("Oops...","El modo de la cesta es incorrecto","error")}function T(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),l=e.getHours();o.value=("0"+l).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(T,1e3),(0,t.bv)((()=>{y(),M(),j.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{H().fire("Error en getVersion CATCH")})),j.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.CalaixTancat?"Si"==e.data?.params?.CalaixTancat&&(n.value=!0):n.value=!1}))})),_(),{trabajadorActivo:C,DescuentoCliente:s,estadoDatafono:p,DescuentoCliente:s,cesta:w,arrayMesas:i,getTotal:g,goTo:h,abrirCajon:D,tarjetaUltimoTicket:B,modoActual:b,handleCobro:x,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:k,datafonoDisponible:M,procesoDatafono:f,isDescuento:_}}};const ft=(0,b.Z)(vt,[["render",pt],["__scopeId","data-v-56937e7d"]]);var bt=ft,Ct=o(2066),wt=o(4286);const gt={class:"container"},_t={class:"h3 text-center"},yt={key:0,class:"row mt-2 container"},Mt=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),ht={class:"h5",style:{"text-align":"center"}},Dt={key:1,class:"row mt-2 container"},kt={class:"h3"},Bt={key:0,class:"d-inline text-center grupoContento pt-1"},xt=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),Tt=[xt],At={key:1,class:"h5",style:{"text-align":"center",color:"red"}},zt={class:"again py-5"},Et={class:"again py-5"};function It(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal"),u=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(d,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:l.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",gt,[(0,t._)("p",_t,(0,c.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),l.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",yt,[Mt,(0,t._)("span",ht,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,c.zw)(l.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),l.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Dt,[(0,t._)("p",kt,(0,c.zw)(e.$t("seleccione","seleccione"))+":",1),l.tryCount>0?((0,t.wg)(),(0,t.iD)("div",Bt,Tt)):(0,t.kq)("",!0),l.tryCount>3?((0,t.wg)(),(0,t.iD)("span",At,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),l.tryCount<=0?((0,t.wg)(),(0,t.j4)(i,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>l.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",zt,(0,c.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(i,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>l.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",Et,(0,c.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var St={name:"modalDatafonoConexion",components:{MDBModal:S.j3,MDBModalBody:S.Yz,MDBBtn:S.$v,ModalErrorDatafonoQueHacerComponent:wt.Z},setup(e,{expose:a}){const o=(0,A.iH)(0),l=(0,A.iH)(!0),n=(0,A.iH)(0),r=(0,A.iH)(null),i=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,v.oR)(),c=(0,A.iH)(0),d=(0,A.iH)(!1),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>u.value&&void 0!=m.value&&null!=m.value&&u.value[m.value]?u.value[m.value]:null));function p(e){c.value=e,d.value=!0,b(),s.dispatch("Datafono/setEstado","OFFLINE")}async function f(){try{H().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){const e=await j.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});if(!e.data)throw Error("Error al guardar la IP del datafono.");H().fire("OK","¡El datáfono se ha apagado correctamente!","success"),d.value=!1}}))}catch(e){H().fire("Oops...",e.message,"error")}}async function b(){n.value=60;let e=setInterval((async()=>{n.value-=1,await j.Z.post("paytef/comprobarDisponibilidad").then((async a=>{"ONLINE"===a.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await j.Z.post("paytef/comprobarUltimoTicket",{idticket:c.value}).then((a=>{clearInterval(e),r.value.abrirModal(c.value,a.data),d.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE"))))})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE"))),n.value<=0&&(clearInterval(e),H().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),l.value=!1)}),1e3)}async function C(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),j.Z.post("paytef/comprobarDisponibilidad").then((async e=>"OFFLINE"===e.data&&o.value<10?C():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await j.Z.post("paytef/comprobarUltimoTicket",{idticket:c.value}).then((e=>{r.value.abrirModal(c.value,e.data),d.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:d,apagarDatafono:f,reconectarDatafon:C,estadoDatafono:i,tryCount:o,ModalErrorQueHacerRef:r,conexionAutomatica:l,counterAutomatico:n}}};const Ut=(0,b.Z)(St,[["render",It]]);var jt=Ut,Nt=(o(2781),{name:"MainView",components:{MenusComponent:w,SubmenusComponent:k,TeclasComponent:Ge,CestaComponent:Da,MenuIzquierdaComponent:Yo,MenuDerechaComponent:bt,modalDatafonoConexion:jt,ModalErrorDatafonoVentaComponent:wt.Z},setup(){const e=(0,qe.tv)(),a=(0,A.iH)(null),o=(0,A.iH)(null),l=(0,A.iH)(null),n=(0,A.iH)(null),r=(0,A.iH)(null);function i(e){a.value.clickTecla(e)}const s=(0,v.oR)(),c=(0,Ct.io)("http://"+s.state.TocGameURL+":5051"),d=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null));function p(){o.value.resetGeneral()}function f(){l.value.actualizarPuntos()}return(0,t.JJ)("clickTecla",i),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",f),c.on("consultaPaytefRefund",(e=>{try{e.ok||n.value.abrirModal(e.id)}catch(a){}})),(0,t.bv)((()=>{j.Z.get("caja/estadoCaja").then((a=>{!a.data&&m.value?e.push("/abrirCaja"):m.value||e.push("/menu/fichajes")})).catch((e=>{H().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:d,indexTrabajadorActivo:u,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:l,modalErrorConexionDatafonoRef:n,modalErrorVentaDatafonoRef:r}}});const Ht=(0,b.Z)(Nt,[["render",s]]);var Ft=Ht}}]);
//# sourceMappingURL=226.d7b376bf.js.map