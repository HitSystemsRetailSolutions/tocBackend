"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[571],{48466:function(e,a,o){o.d(a,{Z:function(){return D}});var t=o(73396),l=o(87139);const n={class:"container"},i={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},d={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},c={class:"again py-5"},m={class:"again py-5"},p={class:"again py-5"};function v(e,a,o,v,f,g){const b=(0,t.up)("MDBBtn"),C=(0,t.up)("MDBModalBody"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:v.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[4]||(a[4]=e=>v.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t._)("div",n,[1==v.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==v.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==v.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago fallido ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",d,[1==v.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>v.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,l.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),v.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:v.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{v.tarjetaUltimoTicket(),v.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",c,(0,l.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),v.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>v.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,l.zw)(e.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,t.kq)("",!0),v.ticketExist>2?((0,t.wg)(),(0,t.j4)(b,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:a[3]||(a[3]=e=>v.esborrarTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",p,(0,l.zw)(e.$t("anular","Anular ticket")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}o(57658);var f=o(20065),g=o(91076),b=o(74313),C=o(42492),w=o.n(C),y=o(44870),h={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,y.iH)(null),l=(0,y.iH)(0),n=(0,y.iH)(!1),i=(0,f.oR)(),r=(0,y.iH)(!1),s=(0,t.Fl)((()=>i.state.Trabajadores.arrayTrabajadores));let d=(0,y.iH)(!1);const u=(0,t.Fl)((()=>i.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>s.value&&void 0!=u.value&&null!=u.value&&s.value[u.value]?s.value[u.value]:null));function m(e,a){if(4==a)return w().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,l.value=a,r.value=!0}async function p(){await g.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,i.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{r.value=!0,w().fire("Oops...",e.message,"error")})),w().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function v(){null!=o.value&&(await C()?g.Z.post("tickets/anularTicket",{ticketId:o.value}).then((e=>{r.value=!1,e.data.res&&["EFECTIVO","DATAFONO_3G"].includes(e.data.tipo)?(n.value&&b(),w().fire({icon:"success",title:"Ticket anulado"+(n.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):e.data.res?router.push("/main"):w().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((e=>{w().fire(e.message)})):w().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function b(){g.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((e=>{w().fire("Oops...",e.message,"error")}))}async function C(){return await w().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async e=>!!e.isConfirmed))}function h(){d.value=!0,g.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,d.value=!1,i.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{d.value=!1,r.value=!0,w().fire("Oops...",e.message,"error")})),d.value=!1,w().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function _(){w().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return a({abrirModal:m}),(0,t.bv)((async()=>{const{data:e}=await g.Z.post("parametros/getParametros");n.value="Si"==e.params?.TicketAlAnular})),{store:i,darComoValido:p,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:h,esperandoConexion:d,TicketAlAnular:n,arrayTrabajadores:s,indexTrabajadorActivo:u,esborrarTicket:v,idSeleccionado:o,pagoDependienta:_,ticketExist:l}}},_=o(40089);const M=(0,_.Z)(h,[["render",v],["__scopeId","data-v-266e01f8"]]);var D=M},37877:function(e,a,o){o.r(a),o.d(a,{default:function(){return sd}});var t=o(73396);const l={class:"row mt-1"},n={class:"col-md-3"},i={class:"col-md-6"},r={class:"col-md-3"};function s(e,a,o,s,d,u){const c=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),v=(0,t.up)("MenuIzquierdaComponent"),f=(0,t.up)("CestaComponent"),g=(0,t.up)("MenuDerechaComponent"),b=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",l,[(0,t._)("div",n,[(0,t.Wm)(v,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(f,{ref:"cestaRef"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(g)])]),(0,t.Wm)(b,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(57658);var d=o(87139);const u={class:"row",id:"menu",style:{"margin-top":"1px"}},c={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,l,n,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",u,[(0,t._)("div",c,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(null)),class:"newMenu btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"}," + Nuevo ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,style:(0,d.j5)(a==l.activo?"  background-color: #d45600 !important;color: #fffaee !important;border-color: #d45600 !important;":""),class:"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan",onClick:e=>l.setActivo(a)},(0,d.zw)(e.nombre),13,m)))),128))])]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var v=o(20065),f=o(49242);const g=e=>((0,t.dD)("data-v-00a5a4d2"),e=e(),(0,t.Cn)(),e),b={class:"row"},C={key:0},w=g((()=>(0,t._)("br",null,null,-1))),y={class:"row"};function h(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),v=(0,t.up)("MenusComponent"),g=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalCrearMenus",tabindex:"-1",labelledby:"modalCrearMenus",modelValue:l.modalCrearMenus,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalCrearMenus=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",b,[l.isSubmenu?((0,t.wg)(),(0,t.iD)("label",C,[(0,t.Uk)("Nombre del menu "),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreMenu=e),readonly:"",onClick:a[1]||(a[1]=e=>l.openKeyBoardCampos("nombreMenu"))},null,4),[[f.nr,l.nombreMenu]])])):(0,t.kq)("",!0),w,(0,t._)("label",null,[(0,t.Uk)("Nombre del Submenú "+(0,d.zw)(""!==l.nombreMenu?"para ":"")+" ",1),(0,t._)("b",null,(0,d.zw)(""!==l.nombreMenu?l.nombreMenu:""),1),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>l.nombreSubMenu=e),readonly:"",onClick:a[3]||(a[3]=e=>l.openKeyBoardCampos("nombreSubMenu"))},null,4),[[f.nr,l.nombreSubMenu]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>l.crearMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear menu")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[5]||(a[5]=e=>l.modalCrearMenus=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(p,{id:"modalEditarMenu",tabindex:"-1",labelledby:"modalEditarMenu",modelValue:l.modalEditarMenu,"onUpdate:modelValue":a[12]||(a[12]=e=>l.modalEditarMenu=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",y,[(0,t._)("label",null,[(0,t.Uk)("Elija un nuevo nombre "+(0,d.zw)(l.editarEsMenu)+" ",1),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>l.editarNombreTxt=e),readonly:"",onClick:a[8]||(a[8]=e=>l.openKeyBoardCampos("editarNombreTxt"))},null,512),[[f.nr,l.editarNombreTxt]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[9]||(a[9]=e=>l.editarEsMenu?l.editMenuName():l.editSubMenuName())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[10]||(a[10]=e=>l.editarEsMenu?l.deleteAllProductsMenu():l.deleteAllProductsSubMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Eliminar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>l.modalEditarMenu=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"MenusComponentRef"},null,512),(0,t.Wm)(g,{ref:"keyboardRef"},null,512)],64)}var _=o(74834),M=o(74313),D=o(44870),k=o(91076),B=o(42492),x=o.n(B),T=o(78400),E={name:"ModalCrearProductoMenus",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MenusComponent:P,KeyBoardComponent:T.Z},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(!1),s=(0,D.iH)(!1),d=(0,D.iH)(!1),u=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),c=(0,D.iH)(!1),m=(0,D.iH)(""),p=(0,D.iH)(!1),f=(0,D.iH)(null),g=(0,D.iH)(0),b=(0,D.iH)(null),C=(0,D.iH)(null),w={nombreMenu:n,nombreSubMenu:i,editarNombreTxt:m};async function y(e){s.value=null==e,n.value=null==e?"":e,l.value=!0}async function h(){if(""==n.value||""==i.value&&d.value)return r.value=!0,void x().fire("Oops...","Algún campo está vacío o es incorrecto.","error");let e=n.value,a=Number(u.value.length);s.value&&(a+=1);let o=1==a.toString().length?"0"+a:a;d.value&&(e=`[${n.value}]${o} ${i.value}`),k.Z.post("articulos/anadirProducto",{nombreArticulo:"Producto por defecto",precioConIva:0,esSumable:!1,precioBase:0,tipoIva:0,menus:e,posicion:0,articuloExistente:!1}).then((e=>{x().fire("Menú creado","Se ha creado el menú correctamente","success"),_.W.cargarTeclado(),l.value=!1}))}async function M(e,a,o){1==o&&(m.value=e.nombre.substring(3)),0==o&&(m.value=e.nombre),p.value=0==o,g.value=a,f.value=e,c.value=!0}async function B(){let e=f.value,a=m.value;for(let o=0;o<u.value.length;o++)if(u.value[o].nombre.toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let o=0;o<e.arraySubmenus.length;o++)for(let t=0;t<e.arraySubmenus[o].arrayTeclas.length;t++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arraySubmenus[o].arrayTeclas[t].idArticle,nuevaPos:e.arraySubmenus[o].arrayTeclas[t].pos,nombreMenu:`[${a}]${e.arraySubmenus[o].nombre}`});x().fire("Menú editado","Se ha editado el menú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function T(){let e=f.value,a=m.value,o=g.value.value+1,t=1==o.toString().length?"0"+o:o,l=u.value[o-1].nombre;if(e.nombre.split(" ")[1].toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let n=0;n<e.arrayTeclas.length;n++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arrayTeclas[n].idArticle,nuevaPos:e.arrayTeclas[n].pos,nombreMenu:`[${l}]${t} ${a}`});x().fire("Submenú editado","Se ha editado el submenú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function E(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((e=>{if(e.isDismissed)return;let a=f.value;for(let o=0;o<4;o++)for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e].idArticle});o.dispatch("Teclado/setIndexMenuActivo",0),c.value=!1,_.W.cargarTeclado(),x().fire("Submenú eliminado","Se ha eliminado el Submenú correctamente","success")}))}async function A(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((async e=>{let a=f.value;if(!e.isDismissed){if(a.arraySubmenus?.length&&a.arraySubmenus?.length>0)for(let e=0;e<4;e++)for(let o=0;o<a.arraySubmenus?.length;o++)for(let e=0;e<a.arraySubmenus[o]?.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arraySubmenus[o]?.arrayTeclas[e]?.idArticle});else for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e]?.idArticle});await o.dispatch("Teclado/setIndexMenuActivo",0),_.W.cargarTeclado(),c.value=!1,x().fire("Menú eliminado","Se ha eliminado el menú correctamente","success")}}))}let z;function I(e){S(w[e])}async function S(e){try{C.value.abrirModal(e.value),z=setInterval((()=>{const a=C.value.getValue()[0];a!==e.value&&(e.value=a),C.value.getValue()[1]||clearInterval(z)}),100)}catch(a){console.log(a),z=void 0}}return a({openEditModal:M,abrirModal:y}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.DosNivells?"Si"==e.data?.DosNivells&&(d.value=!0):d.value=!1}))})),{modalCrearMenus:l,nombreMenu:n,nombreSubMenu:i,abrirModal:y,editMenuName:B,deleteAllProductsMenu:A,deleteAllProductsSubMenu:E,createProductCheckFields:r,crearMenu:h,MenusComponentRef:b,isSubmenu:s,editarMenuTeclado:f,editarEsMenu:p,haveSubmenu:d,modalEditarMenu:c,editSubMenuName:T,editarNombreTxt:m,editarTagCount:g,openKeyBoardCampos:I,keyboardRef:C}}},A=o(40089);const z=(0,A.Z)(E,[["render",h],["__scopeId","data-v-00a5a4d2"]]);var I=z,S={name:"MenusComponent",components:{ModalCrearProductoMenus:I},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.modoActual)),r=(0,D.iH)(null),s=(0,D.iH)(-1);function d(e){e==s.value&&"MODIFICAR_ARTICULO"==i.value&&r.value.openEditModal(l.value[e],e,0),s.value=e,o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{d(0)})),a({setActivo:d,indexMenuActivo:n}),{teclado:l,indexMenuActivo:n,setActivo:d,activo:s,modoActual:i,ModalCrearMenusRef:r}}};const H=(0,A.Z)(S,[["render",p],["__scopeId","data-v-2687fc6f"]]);var P=H;const F={class:"row",id:"submenu",style:{"margin-top":"1px","margin-right":"0px"}},U={key:0,class:"btn-group shadow-none",role:"group"},j={key:0},W=["onClick"];function V(e,a,o,l,n,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",F,[l.teclado&&l.teclado[l.indexMenuActivo]&&l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",U,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("div",j,[(0,t._)("button",{onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(l.teclado[l.indexMenuActivo].nombre)),class:"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100 newSubMenu"}," + Nuevo ")])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado[l.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t._)("button",{class:(0,d.C_)([{activo:a==l.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>l.setIndexSubmenu(a)},(0,d.zw)(e.nombre),11,W)])))),128))])):(0,t.kq)("",!0)]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var R={name:"SubmenusComponent",components:{ModalCrearProductoMenus:I},setup(){const e=(0,v.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),l=(0,D.iH)(null),n=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo)),i=(0,t.Fl)((()=>e.state.modoActual)),r=(0,D.iH)(0);function s(t){t==r.value&&"MODIFICAR_ARTICULO"==i.value&&l.value.openEditModal(a.value[o.value].arraySubmenus[t],o,1),r.value=t,e.dispatch("Teclado/setIndexSubmenuActivo",t)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:n,setIndexSubmenu:s,modoActual:i,ModalCrearMenusRef:l}}};const O=(0,A.Z)(R,[["render",V],["__scopeId","data-v-4386dc8f"]]);var N=O;const $={key:0},Z={key:1},q=["onClick"];function L(e,a,o,l,n,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBtn"),u=(0,t.up)("PesoComponent"),c=(0,t.up)("SuplementosComponent"),m=(0,t.up)("ModalEditarProducto"),p=(0,t.up)("ModalCrearProducto"),v=(0,t.up)("ModalAlergenosVue"),f=(0,t.up)("ModalVaris");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[l.arrayTeclas&&l.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,n)=>(0,t._)("div",{class:(0,d.C_)(["col",[l.teclado[l.indexMenuActivo]?.arraySubmenus&&l.teclado[l.indexMenuActivo]?.arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:n},[l.arrayTeclas[n+6*o].idArticle?((0,t.wg)(),(0,t.j4)(s,{key:0,disabled:l.disabledTeclas,onMousedown:e=>l.startPress(l.arrayTeclas[n+6*o],e),onMouseup:e=>l.endPress(l.arrayTeclas[n+6*o],e),onTouchstartPassive:e=>l.startPress(l.arrayTeclas[n+6*o],e),onTouchendPassive:e=>l.endPress(l.arrayTeclas[n+6*o],e),class:(0,d.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[l.teclado[l.indexMenuActivo]?.arraySubmenus&&l.teclado[l.indexMenuActivo]?.arraySubmenus.length>0?"teclasConSubmenu":"teclas"]]),style:(0,d.j5)({"background-color":"#"+l.arrayTeclas[n+6*o].color.toString(16),color:l.getTextColor("#"+l.arrayTeclas[n+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{icon:l.arrayTeclas[n+6*o].esSumable?"":"balance-scale"},null,8,["icon"]),(0,t.Uk)("  "+(0,d.zw)(l.arrayTeclas[n+6*o].nombreArticulo)+" ",1),l.precioTecla&&0==l.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",$,(0,d.zw)(l.arrayTeclas[n+6*o]?.precioConIva?.toFixed(2))+"€ ",1)):l.precioTecla&&1==l.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",Z,(0,d.zw)((Math.round(100*l.arrayTeclas[n+6*o]?.precioBase)/100).toFixed(2))+"€ ",1)):(0,t.kq)("",!0),l.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:2,class:"stock",style:(0,d.j5)({fontSize:(l.arrayStock["stock-"+l.arrayTeclas[n+6*o]?.idArticle]?.fontSize||3.5)+"px",color:l.arrayStock["stock-"+l.arrayTeclas[n+6*o]?.idArticle]?.fontColor})},(0,d.zw)(void 0!==l.arrayStock["stock-"+l.arrayTeclas[n+6*o]?.idArticle]?.stock?l.arrayStock["stock-"+l.arrayTeclas[n+6*o]?.idArticle]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:2},1032,["disabled","onMousedown","onMouseup","onTouchstartPassive","onTouchendPassive","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,d.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==l.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==l.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==l.isEditarArticulos(!1)},null==l.teclado[l.indexMenuActivo]?.arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>l.editarArticulo(l.arrayTeclas[n+6*o].pos)},(0,d.zw)(e.$t("vacio","Vacío"))+" "+(0,d.zw)(l.isEditarArticulos(!0)),11,q))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(u,{ref:"modalPesoRef"},null,512),(0,t.Wm)(c,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(m,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(p,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(v,{ref:"modalAlergenosRef"},null,512),(0,t.Wm)(f,{ref:"modalVarisRef"},null,512)],64)}const Y=e=>((0,t.dD)("data-v-7d1b1c95"),e=e(),(0,t.Cn)(),e),K=Y((()=>(0,t._)("div",{"data-v-95b64bf4":"",class:"modal-header"},[(0,t._)("h5",{"data-v-95b64bf4":"",class:"modal-title",id:"staticBackdropLabel"}," Introduce los gramos ")],-1))),G={class:"row"},J={class:"row"};function Q(e,a,o,l,n,i){const r=(0,t.up)("MDBInput"),s=(0,t.up)("NumpadComponent"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalPeso,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalPeso=e),staticBackdrop:"",onShow:l.onModalShow,onShown:l.onModalShown,onHide:l.onModalHide,onHidden:l.onModalHidden},{default:(0,t.w5)((()=>[K,(0,t.Wm)(u,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",G,[l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(r,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>l.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",J,[((0,t.wg)(),(0,t.j4)(s,{disabled:l.isTransitioning,ref:"numpadRef",key:l.modalPeso},null,8,["disabled"]))])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[1]||(a[1]=e=>l.closeModal()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo(l.numpadRef.cantidad))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onShow","onShown","onHide","onHidden"])}var X=o(33727),ee={name:"PesoComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBInput:M.u2,NumpadComponent:X.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),l=(0,v.oR)(),n=(0,t.Fl)((()=>l.state.Teclado.objTeclado)),i=(0,t.Fl)((()=>l.state.Teclado.indexMenuActivo)),r=(0,D.iH)(null),s=(0,D.iH)({idArticulo:null,idCesta:null,nombre:""}),d=(0,D.iH)(!0),u=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo));function m(e,a,t){s.value.idArticulo=e,s.value.idCesta=a,s.value.nombre=t,setTimeout((()=>{o.value=!0}),1)}function p(){o.value=!1}function f(e){k.Z.post("teclado/clickTeclaArticulo",{idArticulo:s.value.idArticulo,gramos:e,idCesta:s.value.idCesta,unidades:1,arraySuplementos:null,nombre:s.value.nombre,menu:n.value[i.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(s.value.nombre),worker:encodeURIComponent(u.value[c.value].nombre)}}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");s.value.idArticulo=null,s.value.idCesta=null,o.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function g(){d.value=!0}function b(){d.value=!1}function C(){d.value=!0}function w(){d.value=!1}function y(){}return a({abrirModal:m}),(0,t.JJ)("okValue",f),{modalPeso:o,numpadRef:r,closeModal:p,infoArticulo:s,test:y,insertarArticulo:f,isTransitioning:d,onModalShow:g,onModalShown:b,onModalHide:C,onModalHidden:w}}};const ae=(0,A.Z)(ee,[["render",Q],["__scopeId","data-v-7d1b1c95"]]);var oe=ae;const te=e=>((0,t.dD)("data-v-4c3afa16"),e=e(),(0,t.Cn)(),e),le={class:"row"},ne=["onClick"],ie=te((()=>(0,t._)("br",null,null,-1))),re={key:0},se={key:1},de={class:"row"},ue={key:0,class:"table-responsive divCesta reverso"},ce={class:"table colorFuente"},me={class:"tableBody"},pe=["onClick"],ve={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}},fe={key:0},ge={key:1};function be(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,d.zw)(l.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(u,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",le,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,d.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:l.checkSuplementoActivo(e._id)}]]),onClick:a=>l.addSuplemento(e)},[(0,t.Uk)((0,d.zw)(e.nombre)+" ",1),ie,l.albaran&&l.precioTecla?((0,t.wg)(),(0,t.iD)("span",re,(0,d.zw)(e.precioBase)+" €",1)):l.precioTecla&&!l.albaran?((0,t.wg)(),(0,t.iD)("span",se,(0,d.zw)(e.precioConIva.toFixed(2)),1)):(0,t.kq)("",!0)],10,ne)])))),128))]),(0,t._)("div",de,[l.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",ue,[(0,t._)("table",ce,[(0,t._)("tbody",me,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{seleccionado:l.itemSeleccionado===a}]),onClick:e=>l.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",ve,(0,d.zw)(e.nombre),1)]),l.albaran&&l.precioTecla?((0,t.wg)(),(0,t.iD)("td",fe,(0,d.zw)(e.precioBase)+" €",1)):!l.albaran&&l.precioTecla?((0,t.wg)(),(0,t.iD)("td",ge,(0,d.zw)(e.precioConIva.toFixed(2))+" € ",1)):(0,t.kq)("",!0)],10,pe)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[0]||(a[0]=e=>l.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(c,{color:"secondary",onClick:a[1]||(a[1]=e=>l.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ce={name:"SuplementosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d={idArticulo:null,idCesta:null,cliente:null,suplementos:null},u=(0,D.iH)(!1),c=(0,D.iH)([]),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),f=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let g=0;const b=(0,t.Fl)((()=>{if(c.value&&c.value.length>0){let e=0;for(let a=0;a<c.value.length;a++)e+=c.value[a].precioConIva;return e}return 0})),C=(0,D.iH)(!1);async function w(e,a,t,n,i,r){d.idArticulo=e,d.idCesta=a,d.cliente=t,g=i,C.value=r;const s=await k.Z.post("articulos/getSuplementos",{arrayIdSuplementos:n});if(!s)throw Error("No se ha podido obtener la lista de suplementos");m.value=s.data,m.value.sort(((e,a)=>e.nombre.localeCompare(a.nombre))),o.dispatch("Unidades/setUnidades",1),l.value=!0}function y(e){try{c.value.push(e)}catch(a){x().fire("Oops...",a.message,"error")}}function h(e){const a=c.value.findIndex((a=>a.suplemento===e));return-1!==a}function _(e){i.value=e}function M(){c.value.splice(i.value,1)}async function B(){l.value=!1;try{let e;for(let a=0;a<g;a++)e=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.idArticulo,gramos:0,idCesta:d.idCesta,unidades:1,arraySuplementos:c.value,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(d.idArticulo),worker:encodeURIComponent(p.value[f.value].nombre)}});if(d.idArticulo=null,d.idCesta=null,c.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos")}catch(e){x().fire("Oops...",e.message,"error")}}function T(){}return a({abrirModal:w}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(u.value=!0):u.value=!1}))})),(0,t.JJ)("okValue",B),{modalSuplementos:l,addSuplemento:y,checkSuplementoActivo:h,numpadRef:n,arrayCompletoSuplementos:m,suplementosSeleccionados:c,itemSeleccionado:i,insertarArticulo:B,setIndex:_,eliminarActivo:M,totalSuplementos:b,test:T,precioTecla:u,albaran:C}}};const we=(0,A.Z)(Ce,[["render",be],["__scopeId","data-v-4c3afa16"]]);var ye=we;const he=e=>((0,t.dD)("data-v-4e1acfb0"),e=e(),(0,t.Cn)(),e),_e={class:"row"},Me={for:"nombre"},De={for:"tipoIva"},ke=["value"],Be={for:"esSumable"},xe=he((()=>(0,t._)("option",{value:"true"},"Si",-1))),Te=he((()=>(0,t._)("option",{value:"false"},"No",-1))),Ee=[xe,Te],Ae={for:"precioIva"},ze={for:"precioConIva"},Ie={class:"row mt-3"},Se={class:"col text-center"};function He(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),v=(0,t.up)("KeyBoardComponent"),g=(0,t.up)("MDBInput"),b=(0,t.up)("NumpadComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:l.modalEditarProd,"onUpdate:modelValue":a[10]||(a[10]=e=>l.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",_e,[(0,t._)("label",Me,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e),readonly:"",onClick:a[1]||(a[1]=e=>l.openKeyboard())},null,512),[[f.nr,l.nombre]])]),(0,t._)("label",De,[(0,t.Uk)("Tipo de IVA "),(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[2]||(a[2]=e=>l.tipoIva=e),class:"form-control"},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.tiposIva,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.iva,value:parseInt(e.tipus)},(0,d.zw)(e.iva)+"% ",9,ke)))),128))],512),[[f.bM,l.tipoIva]])]),(0,t._)("label",Be,[(0,t.Uk)("¿Se vende a unidades? "),(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[3]||(a[3]=e=>l.esSumable=e),class:"form-control"},Ee,512),[[f.bM,l.esSumable]])]),(0,t._)("label",Ae,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1].iva))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=e=>l.precioConIva=e),readonly:"",onClick:a[5]||(a[5]=e=>l.openNumpad())},null,512),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[6]||(a[6]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[7]||(a[7]=e=>l.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[8]||(a[8]=e=>l.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(c,{color:"secondary",size:"lg",onClick:a[9]||(a[9]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"keyboardRef"},null,512),(0,t.Wm)(p,{id:"modalNumpad",tabindex:"-1",labelledby:"modalNumpadLabel",modelValue:l.modalNumpad,"onUpdate:modelValue":a[14]||(a[14]=e=>l.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalNumpadLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("precio_final","Precio final")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,d.C_)(["row",{shake:l.activarShake}])},[(0,t._)("label",ze,[(0,t.Uk)("Precio con IVA "),l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(g,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[11]||(a[11]=e=>l.numpadRef.cantidad=e),readonly:""},null,8,["modelValue"])):(0,t.kq)("",!0)])],2),(0,t._)("div",Ie,[(0,t._)("div",Se,[(0,t.Wm)(b,{max3EntersDigits:!0,skipBalanza:!0,onActivarShake:l.handleShake,ref:"numpadRef",onSetValue:l.setPrecioConIva},null,8,["onActivarShake","onSetValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"secondary",onClick:a[12]||(a[12]=e=>l.modalNumpad=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"primary",size:"lg",onClick:a[13]||(a[13]=a=>e.cerrarCaja()),disabled:e.botonesBloqueados},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("confirmar_cierre","Confirmar cierre")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])],64)}var Pe={name:"ModalEditarProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,KeyBoardComponent:T.Z,NumpadComponent:X.Z,MDBInput:M.u2},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(0),n=(0,D.iH)(!1),i=(0,D.iH)(0),r=(0,D.iH)(0),s=o.getters["TiposIva/getTiposIva"],d=(0,D.iH)(""),u=(0,D.iH)(-1),c=(0,D.iH)(""),m=(0,D.iH)(!0),p=(0,D.iH)(null),f=(0,D.iH)(null),g=(0,D.iH)(!1),b=(0,D.iH)(!1);async function C(){await k.Z.post("articulos/editarArticulo",{idArticulo:u.value,nombre:d.value,precioBase:parseFloat(i.value)/parseFloat(r.value),precioConIva:parseFloat(i.value),tipoIva:r.value,essumable:JSON.parse(m.value)}).then((e=>{n.value=!1,x().fire("Producto guardado","Producto guardado correctamente","success"),_.W.cargarTeclado()}))}function w(){n.value=!1}function y(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function h(e,a){await k.Z.post("articulos/moverArticulo",{id:u.value,posicion:e,menu:a}).then((a=>{x().fire("Producto establecido","Se ha movido el producto "+d.value+" correctamente a la celda "+e,"success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function M(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await k.Z.post("articulos/eliminarArticulo",{id:u.value}).then((e=>{x().fire("Producto eliminado","Se eliminado el producto "+d.value+" correctamente a la celda","success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),n.value=!1)}async function B(e,a,o,t,l,s){d.value=e,i.value=a,u.value=o,r.value=t,m.value=l,n.value=!0}let T;async function E(){try{p.value.abrirModal(d.value),T=setInterval((()=>{const e=p.value.getValue()[0];e!==d.value&&(d.value=e),p.value.getValue()[1]||clearInterval(T)}),100)}catch(e){console.log(e),T=void 0}}function A(){g.value=!0}function z(e){i.value=e}function I(){b.value=!0,setTimeout((()=>{b.value=!1}),500)}return(0,t.JJ)("okValue",(()=>g.value=!1)),(0,t.bv)((()=>{})),a({abrirModal:B,botonVacio:h}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:d,precioBase:l,precioConIva:i,id:u,modalEditarProd:n,tipoIva:r,confirmar:C,menus:c,cambiarPosicion:y,esSumable:m,tiposIva:s,salirSinGuardar:w,EliminarTecla:M,openKeyboard:E,keyboardRef:p,numpadRef:f,openNumpad:A,modalNumpad:g,setPrecioConIva:z,activarShake:b,handleShake:I}}};const Fe=(0,A.Z)(Pe,[["render",He],["__scopeId","data-v-4e1acfb0"]]);var Ue=Fe;const je=e=>((0,t.dD)("data-v-fb966688"),e=e(),(0,t.Cn)(),e),We={class:"row"},Ve={for:"nombre"},Re=["disabled"],Oe=je((()=>(0,t._)("label",{for:"nombre"},[(0,t.Uk)("Nombre articulo "),(0,t._)("br")],-1))),Ne={style:{display:"flex"}},$e={for:"tipoIva"},Ze=["disabled"],qe=je((()=>(0,t._)("option",{value:"4"},"0%",-1))),Le=je((()=>(0,t._)("option",{value:"1"},"4%",-1))),Ye=je((()=>(0,t._)("option",{value:"5"},"5%",-1))),Ke=je((()=>(0,t._)("option",{value:"2"},"10%",-1))),Ge=je((()=>(0,t._)("option",{value:"3"},"21%",-1))),Je=[qe,Le,Ye,Ke,Ge],Qe={for:"esSumable"},Xe=["disabled"],ea=je((()=>(0,t._)("option",{value:"true"},"Si",-1))),aa=je((()=>(0,t._)("option",{value:"false"},"No",-1))),oa=[ea,aa],ta={for:"precioIva"},la=["disabled"],na={class:"row"},ia={for:"nombre"},ra={key:0,class:"row"},sa={class:"col"},da={class:"table-responsive w-100",style:{height:"400px"}},ua={class:"table table-striped mt-1"},ca={class:"textoNombre d-inline-block text-truncate"},ma={for:"precioConIva"},pa={class:"row mt-3"},va={class:"col text-center"};function fa(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),g=(0,t.up)("KeyBoardComponent"),b=(0,t.up)("MDBInput"),C=(0,t.up)("NumpadComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:l.modalCrearProd,"onUpdate:modelValue":a[11]||(a[11]=e=>l.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",We,[(0,t._)("label",Ve,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e),readonly:"",onClick:a[1]||(a[1]=e=>l.openKeyBoardCampos("nombre"))},null,8,Re),[[f.nr,l.nombre]])]),Oe,(0,t._)("div",Ne,[null==l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>l.nombre=e)},null,512)),[[f.nr,l.nombre]]):(0,t.kq)("",!0),null!=l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:1,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>l.articuloSeleccionado.nombre=e)},null,512)),[[f.nr,l.articuloSeleccionado.nombre]]):(0,t.kq)("",!0),(0,t.Wm)(c,{onClick:a[4]||(a[4]=e=>l.articuloModal=!0),color:"secondary",floating:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"search",size:"0.5x"})])),_:1})]),(0,t._)("label",$e,[(0,t.Uk)("Tipo de IVA "),(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[5]||(a[5]=e=>l.tipoIva=e),class:"form-control"},Je,8,Ze),[[f.bM,l.tipoIva]])]),(0,t._)("label",Qe,[(0,t.Uk)("¿Se vende a unidades? "),(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"esSumable",id:"esSumable","onUpdate:modelValue":a[6]||(a[6]=e=>l.esSumable=e),class:"form-control"},oa,8,Xe),[[f.bM,l.esSumable]])]),(0,t._)("label",ta,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>l.precioConIva=e),readonly:"",onClick:a[8]||(a[8]=e=>l.openNumpad())},null,8,la),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[9]||(a[9]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[10]||(a[10]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{id:"articuloModal",tabindex:"-1",labelledby:"articuloModal",modelValue:l.articuloModal,"onUpdate:modelValue":a[15]||(a[15]=e=>l.articuloModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",na,[(0,t._)("label",ia,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[12]||(a[12]=e=>l.inputBusqueda=e),readonly:"",onClick:a[13]||(a[13]=e=>l.openKeyBoardCampos("inputBusqueda"))},null,512),[[f.nr,l.inputBusqueda]])]),l.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",ra,[(0,t._)("div",sa,[(0,t._)("div",da,[(0,t._)("table",ua,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",ca,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(c,{color:"primary",size:"lg",onClick:e=>l.selectArticulo({articulo:a}),class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{onClick:a[14]||(a[14]=e=>l.deleteArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Borrar selección")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(g,{ref:"keyboardRef"},null,512),(0,t.Wm)(v,{id:"modalNumpad",tabindex:"-1",labelledby:"modalNumpadLabel",modelValue:l.modalNumpad,"onUpdate:modelValue":a[19]||(a[19]=e=>l.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalNumpadLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("precio_final","Precio final")),1)])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,d.C_)(["row",{shake:l.activarShake}])},[(0,t._)("label",ma,[(0,t.Uk)("Precio con IVA "),l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(b,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[16]||(a[16]=e=>l.numpadRef.cantidad=e),readonly:""},null,8,["modelValue"])):(0,t.kq)("",!0)])],2),(0,t._)("div",pa,[(0,t._)("div",va,[(0,t.Wm)(C,{max3EntersDigits:!0,skipBalanza:!0,onActivarShake:l.handleShake,ref:"numpadRef",onSetValue:l.setPrecioConIva},null,8,["onActivarShake","onSetValue"])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"secondary",onClick:a[17]||(a[17]=e=>l.modalNumpad=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"primary",size:"lg",onClick:a[18]||(a[18]=a=>e.cerrarCaja()),disabled:e.botonesBloqueados},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("confirmar_cierre","Confirmar cierre")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])],64)}var ga={name:"modalCrearProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBIcon:M.vm,MDBInput:M.u2,KeyBoardComponent:T.Z,NumpadComponent:X.Z},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(0),n=(0,D.iH)(!1),i=(0,D.iH)(!1),r=(0,D.iH)(0),s=(0,D.iH)(0),d=(0,D.iH)(0),u=[4,10,21,0,5],c=(0,D.iH)(""),m=(0,D.iH)(""),p=(0,D.iH)(-1),f=(0,D.iH)(""),g=(0,D.iH)(!0),b=(0,D.iH)(),C=(0,D.iH)(""),w=(0,D.iH)(null),y=(0,D.iH)(null),h=(0,D.iH)(null),M=(0,D.iH)(!1),B=(0,D.iH)(!1);function T(){k.Z.post("articulos/buscar",{busqueda:C.value,familia:"Todos",limit:20}).then((e=>{b.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function E(e){s.value=1,r.value=0,c.value="Nombre",g.value=!1,w.value=null,i.value=!1}async function A(e){s.value=e.articulo.tipoIva,r.value=e.articulo.precioConIva,c.value=e.articulo.nombre,g.value=e.articulo.esSumable,w.value=e.articulo,i.value=!1}async function z(){k.Z.post("articulos/anadirProducto",{nombreArticulo:c.value,precioConIva:parseFloat(r.value),esSumable:JSON.parse(g.value),precioBase:parseFloat(r.value)/parseFloat(s.value),tipoIva:parseFloat(s.value),menus:f.value,posicion:d.value,articuloExistente:null!=w.value,idArticulo:w.value?._id}).then((e=>{m.value="",l.value=0,r.value=0,s.value=3,g.value=!1,n.value=!1,x().fire("Producto creado","Producto creado correctamente","success"),_.W.cargarTeclado()}))}function I(){n.value=!1}function S(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function H(e,a){d.value=e,c.value="Nombre",r.value="0.0",s.value="3",g.value=!0,n.value=!0,f.value=a}(0,t.YP)(C,(()=>{T()}));const P={nombre:c,inputBusqueda:C};let F;function U(e){j(P[e])}async function j(e){try{y.value.abrirModal(e.value),F=setInterval((()=>{const a=y.value.getValue()[0];a!==e.value&&(e.value=a),y.value.getValue()[1]||clearInterval(F)}),100)}catch(a){console.log(a),F=void 0}}function W(){B.value=!0}function V(e){r.value=e}function R(){M.value=!0,setTimeout((()=>{M.value=!1}),500)}return(0,t.JJ)("okValue",(()=>B.value=!1)),(0,t.bv)((()=>{})),a({abrirModal:H}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:c,precioBase:l,precioConIva:r,id:p,modalCrearProd:n,tipoIva:s,confirmar:z,menus:f,inputBusqueda:C,arrayArticulos:b,cambiarPosicion:S,esSumable:g,tiposIva:u,salirSinGuardar:I,articuloModal:i,selectArticulo:A,articuloSeleccionado:w,deleteArticulo:E,openKeyboard:j,keyboardRef:y,numpadRef:h,openNumpad:W,modalNumpad:B,setPrecioConIva:V,activarShake:M,handleShake:R,openKeyBoardCampos:U}}};const ba=(0,A.Z)(ga,[["render",fa],["__scopeId","data-v-fb966688"]]);var Ca=ba;const wa=["src"];function ya(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),u=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(u,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:l.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:l.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,wa),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>l.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var ha={name:"ModalAlergenosComponent",components:{MDBModal:M.j3,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,D.iH)(!1),t=(0,D.iH)(""),l=(0,v.oR)(),n=l.getters["Configuracion/parametros"];function i(e){r(e),o.value=!0}function r(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${n?.licencia}`}return a({abrirModal:i}),{modalAlergenos:o,abrirModal:i,url:t}}};const _a=(0,A.Z)(ha,[["render",ya]]);var Ma=_a;function Da(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),f=(0,t.up)("PesoComponent"),g=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalVaris",tabindex:"-1",labelledby:"tituloModalVaris",modelValue:l.modalVarisActivo,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalVarisActivo=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"tituloModalVaris"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("inserta_el_nombre","Inserta el nombre del articulo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:l.nombreArticulo,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreArticulo=e),"aria-placeholder":"{{ $t('nombre', 'Nombre') }}",type:"text",ref:"inputRef",readonly:"",onClick:a[1]||(a[1]=e=>l.openKeyboard())},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{color:"success",onClick:l.handleSubmit},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"modalPesoRef"},null,512),(0,t.Wm)(g,{ref:"keyboardRef"},null,512)],64)}var ka={name:"ModalVaris",components:{MDBBtn:M.$v,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalFooter:M.ab,MDBInput:M.u2,PesoComponent:oe,KeyBoardComponent:T.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),l=new Event("acabado"),n=(0,v.oR)(),i=(0,D.iH)(null),r=(0,t.Fl)((()=>n.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>n.state.Teclado.indexMenuActivo)),d=(0,D.iH)({idArticle:"",gramos:null,idCesta:"",unidades:0,arraySuplementos:null}),u=(0,D.iH)(""),c=(0,D.iH)(null),m=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),f=(0,D.iH)(null),g=async e=>{try{o.value=!0,u.value="",d.value=e}catch(a){console.log(a)}};a({abrirModal:g,nombreArticulo:u});const b=async()=>{let e=u.value;0===e.length&&(e=d.value.nom),d.value.idArticle?(d.value.peso?(o.value=!1,await i.value.abrirModal(d.value.idArticle,d.value.idCesta,e),u.value=void 0):async function(){const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.value.idArticle,gramos:d.value.gramos,idCesta:d.value.idCesta,unidades:d.value.unidades,arraySuplementos:null,nombre:e,menu:r.value[s.value].menu},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e),worker:encodeURIComponent(m.value[p.value].nombre)}});if(u.value="",!a.data)throw Error("No se ha podido añadir el artículo a la cesta");n.dispatch("Unidades/setUnidades",1)}(),u.value=void 0,o.value=!1):document.dispatchEvent(l)},C=()=>{c.value.focus()};let w;async function y(){try{f.value.abrirModal(u.value),w=setInterval((()=>{const e=f.value.getValue()[0];e!==u.value&&(u.value=e),f.value.getValue()[1]||clearInterval(w)}),100)}catch(e){console.log(e),w=void 0}}return{modalVarisActivo:o,nombreArticulo:u,handleSubmit:b,modalPesoRef:i,inputRef:c,getFocus:C,openKeyboard:y,keyboardRef:f}}};const Ba=(0,A.Z)(ka,[["render",Da]]);var xa=Ba,Ta=o(22483),Ea={name:"TeclasComponent",components:{PesoComponent:oe,MDBBtn:M.$v,SuplementosComponent:ye,ModalEditarProducto:Ue,ModalCrearProducto:Ca,ModalAlergenosVue:Ma,ModalVaris:xa,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,Ta.tv)(),n=(0,t.Fl)((()=>o.state.modoActual)),i=(0,t.Fl)((()=>o.state.Configuracion.parametros)),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d=(0,D.iH)(!1),u=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),c=(0,D.iH)(null),m=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),f=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),g=(0,D.iH)(null),b=(0,D.iH)(!1),C=(0,D.iH)(null),w=(0,D.iH)(null),y=(0,D.iH)(null),h=(0,D.iH)(null),_=(0,t.Fl)((()=>o.state.Unidades.unidades)),M=(0,D.iH)(!1),B=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(m.value&&m.value[p.value]&&u.value[e]._id==m.value[p.value].idCesta)return u.value[e];return null})),T=(0,D.iH)(null),E=(0,D.iH)(!1),A=(0,D.iH)(!1),z=(0,D.iH)(!1),I=(0,D.iH)(!1),S=(0,D.iH)(null),H=(0,t.Fl)((()=>{if(S.value!==B.value?.idCliente)return S.value=B.value?.idCliente,B.value?.idCliente})),P=(0,t.Fl)((()=>o.state.Stock.arrayStock));function F(e){h.value.abrirModal(e)}function U(e){z.value=e}function j(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}function W(){k.Z.get("caja/estadoCaja").then((e=>{1==e.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=e.data&&3!=e.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&l.push("/menu/fichajes"):l.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function V(e,a=undefined){W();const t=e.nombreArticulo&&null!=e.nombreArticulo.match(/(Varis|Varios)/i);if(void 0!=a&&-1==a.pointerId)return;let l=e.idArticle,d=u.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===n.value||"MOVER_ARTICULO"===n.value)return"MOVER_ARTICULO"===n.value?void x().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void k.Z.post("articulos/getArticulo",{idArticulo:l,idCliente:d}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");w.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!B.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=i?.value?.prohibirSuplementos&&e.suplementos?.length>0)C.value.abrirModal(e.idArticle,B.value._id,B.value.idCliente,e.suplementos,_.value>0?_.value:1,I.value);else if(t)c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,peso:!1,nom:e.nombreArticulo});else try{o.dispatch("Procesando/procesandoClickTecla",!0);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombreArticulo),worker:encodeURIComponent(m.value[p.value].nombre)}});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}finally{o.dispatch("Procesando/procesandoClickTecla",!1)}else t?await c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value,arraySuplementos:null,peso:!0,nom:e.nombreArticulo}):g.value.abrirModal(e.idArticle,B.value._id,e.nombreArticulo)}catch(v){x().fire("Oops...",v.message,"error")}}const R=(0,t.Fl)((()=>{let e=j();if(r.value&&r.value[s.value]&&r.value[s.value].arraySubmenus&&r.value[s.value].arraySubmenus[f.value])for(let a=0;a<r.value[s.value].arraySubmenus[f.value].arrayTeclas.length;a++)e[r.value[s.value].arraySubmenus[f.value].arrayTeclas[a].pos]=r.value[s.value].arraySubmenus[f.value].arrayTeclas[a];else if(r.value&&r.value[s.value]&&r.value[s.value].arrayTeclas)for(let a=0;a<r.value[s.value].arrayTeclas.length;a++)e[r.value[s.value].arrayTeclas[a].pos]=r.value[s.value].arrayTeclas[a];return e}));function O(e){return parseInt(e,16)||e}function N(e){return O(e)/255<=.03928?O(e)/255/12.92:Math.pow((O(e)/255+.055)/1.055,2.4)}function $(e){return.2126*N(e.substr(1,2))+.7152*N(e.substr(3,2))+.0722*N(e.substr(-2))}function Z(e,a){const o=$(e),t=$(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function q(e){const a=Z(e,"#ffffff"),o=Z(e,"#000000");return a>o?"#ffffff":"#000000"}function L(e){}function Y(e){return e?"MOVER_ARTICULO"==n.value?"Mover aqui":"Vacío":n.value}function K(e){let a=r.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[f.value].nombre,t=`[${a.nombre}]${o}`),"MOVER_ARTICULO"==n.value)return w.value.botonVacio(e,t);y.value.abrirModal(e,t)}async function G(e){return k.Z.post("clientes/getClienteById",{idCliente:e}).then((e=>!!e.data&&!(!e.data?.albaran&&!e.data?.vip))).catch((e=>(console.log("error comprobaralbaranNPT_o_vipPT",e),!1)))}function J(e,a=undefined){T.value=setTimeout((()=>{F(e.idArticle),T.value=null}),500)}function Q(e,a=undefined){T.value&&!E.value&&(clearTimeout(T.value),V(e,a),X()),clearTimeout(T.value)}function X(){E.value=!0,setTimeout((()=>{E.value=!1}),70)}function ee(e){if(!e)return 0;const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Math.round(100*o)/100}return(0,t.JJ)("addItem",L),(0,t.YP)((()=>H.value),(async()=>{try{if(B.value?.idCliente){const e=await G(B.value.idCliente);I.value=!0===e}else I.value=!1}catch(e){console.error("Error en watch:",e),I.value=!1}})),(0,t.bv)((async()=>{m.value&&0!==m.value?.length||l.push("menu/fichajes"),k.Z.post("parametros/getParametros").then((e=>{"Si"==e.data?.params?.textoStock&&(d.value=!0),void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(M.value=!0):M.value=!1,void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(b.value=!0):b.value=!1,void 0!=e.data?.nombreEmpresa&&void 0!=e.data?.params?.AlertaJoanets?"tena"==e.data?.nombreEmpresa?.toLowerCase()&&"Si"==e.data?.params?.AlertaJoanets&&(A.value=!0):A.value=!1})),H.value&&(I.value=await G(H.value))})),a({clickTecla:V,postDisabledTecla:U}),{teclado:r,precioTecla:b,indexMenuActivo:s,arrayTeclas:R,getTextColor:q,modalPesoRef:g,modalSuplementosRef:C,modalAlergenosRef:h,modalEditarProdRef:w,modalCrearProdRef:y,abrirFicha:F,clickTecla:V,NoSuplementos:M,isEditarArticulos:Y,editarArticulo:K,modalVarisRef:c,startPress:J,endPress:Q,pressTimeout:T,opBloquado:E,getAnimation:ee,AlertaJoanets:A,cesta:B,postDisabledTecla:U,disabledTeclas:z,albaranNPT_o_vipPT:I,textoStock:d,arrayStock:P}}};const Aa=(0,A.Z)(Ea,[["render",L],["__scopeId","data-v-61ffee65"]]);var za=Aa;const Ia=e=>((0,t.dD)("data-v-4ebfb548"),e=e(),(0,t.Cn)(),e),Sa={key:0,class:"table-responsive divCesta reverso"},Ha={key:0,class:"col-md-6 verifactu",src:"/img/verifactu.png"},Pa={class:"colorFuente",style:{"z-index":"20"}},Fa={class:"tableBody"},Ua=["onClick"],ja={class:"cantidad"},Wa={class:"d-inline-block text-truncate xUnidades"},Va={key:1,id:"suplementos"},Ra={id:"promocionDetalles"},Oa={key:0,class:"d-flex row col-12"},Na={class:"col-12"},$a={"d-flex":"","justify-content-around":""},Za={style:{"max-width":"6.5rem","min-width":"6.5rem"},class:"nombreArtPromocion"},qa={class:"pe-1"},La={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},Ya={class:"xUnidades d-inline",style:{width:"fit-content",margin:"0 0.07rem"}},Ka={key:0,style:{"max-width":"12.5rem","min-width":"12.5rem","vertical-align":"middle",padding:"0.5rem 1.4rem","font-weight":"bold","text-align":"center"}},Ga={key:0},Ja={key:1},Qa=Ia((()=>(0,t._)("br",null,null,-1))),Xa={key:2,class:"detallesAlbIva"},eo={key:3,class:"detallesAlbIva"},ao={key:4,class:"detallesAlbIva"},oo={key:1},to={key:2},lo={key:1},no={key:0,class:"fw-bold"};function io(e,a,o,l,n,i){const r=(0,t.up)("MDBPopover"),s=(0,t.up)("MDBBtn"),u=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBCardTitle"),m=(0,t.up)("MDBCardText"),p=(0,t.up)("MDBCardBody"),v=(0,t.up)("MDBCard"),f=(0,t.up)("ModalDescuentosTiendaComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(r,{style:{position:"absolute"},modelValue:l.popOverTarifaEsp,"onUpdate:modelValue":a[0]||(a[0]=e=>l.popOverTarifaEsp=e),direction:"right"},{header:(0,t.w5)((()=>[(0,t.Uk)("Tarifa especial")])),body:(0,t.w5)((()=>[(0,t.Uk)(" Precio preferencial para clientes específicos. ")])),_:1},8,["modelValue"]),l.cesta&&l.cesta.lista?((0,t.wg)(),(0,t.iD)("div",Sa,[l.haveNif?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("img",Ha)),(0,t._)("table",Pa,[(0,t._)("tbody",Fa,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cesta.lista,((e,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o,class:(0,d.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:l.indexItemCestaActivo===o&&l.parametros?.nif,seleccionadoNif:l.indexItemCestaActivo===o&&!l.parametros?.nif,sePuedeRegalar:l.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>l.clickItem(o)},[(0,t._)("td",ja,[(0,t._)("span",Wa,[e?.tarifaEsp?((0,t.wg)(),(0,t.iD)("span",{key:0,onMouseover:a[1]||(a[1]=(...e)=>l.showPopOver&&l.showPopOver(...e)),onMouseleave:a[2]||(a[2]=(...e)=>l.hidePopOver&&l.hidePopOver(...e)),class:"tarifaEsp"},"TE",32)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,d.zw)(e.nombre)+" ",1),e.arraySuplementos?.length>0?((0,t.wg)(),(0,t.iD)("div",Va,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,d.zw)(e.nombre),1)))),128))])):(0,t.kq)("",!0),(0,t._)("div",Ra,[e.promocion?((0,t.wg)(),(0,t.iD)("tr",Oa,[e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.promocion.grupos.flat(),((a,o)=>((0,t.wg)(),(0,t.iD)("li",Na,[(0,t._)("span",$a,[(0,t._)("td",Za,(0,d.zw)(a.nombre),1),(0,t._)("td",qa,(0,d.zw)(a.precioPromoPorUnidad.toFixed(2))+" € ",1),(0,t._)("td",La," x"+(0,d.zw)(e.unidades*a.unidades),1)])])))),256)):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])]),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:0,onClick:a=>l.restar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.unidades<=1||e.pagado||l.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" - ")])),_:2},1032,["onClick","disabled"])),(0,t._)("span",Ya," x"+(0,d.zw)(0!=e.gramos&&e.gramos?(e.gramos/1e3).toFixed(3)+"kg":e.unidades),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:1,onClick:a=>l.sumar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.pagado||l.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" + ")])),_:2},1032,["onClick","disabled"]))]),"DEVOLUCION"!==l.cesta.modo?((0,t.wg)(),(0,t.iD)("td",Ka,[e?.precioOrig?((0,t.wg)(),(0,t.iD)("span",Ja,(0,d.zw)(l.cOutPrecioOrig(e.precioOrig))+" €",1)):((0,t.wg)(),(0,t.iD)("span",Ga,(0,d.zw)(e.subtotal.toFixed(2))+" €",1)),Qa,e.subtotal>0&&e?.iva?((0,t.wg)(),(0,t.iD)("span",Xa,"+"+(0,d.zw)(e.iva)+"% IVA",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.descuentoTienda&&0!=e?.descuentoTienda?((0,t.wg)(),(0,t.iD)("span",eo," -"+(0,d.zw)(e.descuentoTienda)+"% DTO",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.dto?((0,t.wg)(),(0,t.iD)("span",ao," -"+(0,d.zw)(e.dto)+"% DTO",1)):(0,t.kq)("",!0)])):(0,t.kq)("",!0),l.sePuedeRegalar(e)?((0,t.wg)(),(0,t.iD)("td",oo,[(0,t.Wm)(s,{color:"secondary",onClick:a=>l.clickRegalo(o,e),size:"sm",disabled:l.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"gift",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0),("CONSUMO_PERSONAL"==l.cesta.modo||l.cesta?.dataVersion&&l.cesta.dataVersion>=l.versionDescuentosClient&&l.clienteNoFacturacion(l.cesta.idCliente))&&!e.regalo&&!e.promocion&&l.discountsShop?.length>0?((0,t.wg)(),(0,t.iD)("td",to,[(0,t.Wm)(s,{color:"secondary",onClick:a=>l.clickDiscountShop(o,e),size:"sm",disabled:l.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"percent",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0)],10,Ua)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",lo,[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),l.arrayTrabajadores&&l.arrayTrabajadores[l.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",no,(0,d.zw)(l.arrayTrabajadores[l.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(s,{color:"primary",onClick:a[3]||(a[3]=e=>l.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,d.zw)(l.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})])),(0,t.Wm)(f,{ref:"modalDescuentosTienda"},null,512)],64)}const ro={class:"custom-select"},so=(0,t._)("option",{value:"0"},"0%",-1),uo=(0,t._)("option",{value:"100"},"100%",-1),co=["value"];function mo(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBPopover"),m=(0,t.up)("MDBIcon"),p=(0,t.up)("MDBBtn"),v=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(g,{id:"modalDescuentosTienda",title:"Selecciona un Descuento","static-backdrop":"",centered:"",modelValue:l.isModalOpen,"onUpdate:modelValue":a[4]||(a[4]=e=>l.isModalOpen=e),"data-mdb-autofocus":"false",enforceFocus:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_un_descuento","Selecciona un descuento")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",ro,[(0,t.wy)((0,t._)("select",{name:"descuentoTienda",id:"descuentoTienda","onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedDiscount=e),class:"form-control",onChange:a[1]||(a[1]=(...e)=>l.removeFocus&&l.removeFocus(...e))},[so,uo,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.discountValues,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.discount,value:parseInt(e.value)},(0,d.zw)(e.value)+"% ",9,co)))),128))],544),[[f.bM,l.selectedDiscount]])])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:l.popOverHelp,"onUpdate:modelValue":a[2]||(a[2]=e=>l.popOverHelp=e),direction:"bottom"},{header:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ayuda","Ayuda")),1)])),body:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ayuda_descuentos_tienda","Si los descuentos del GDT no se muestran, dirígese a 'actualizar parámetros tienda'.")),1)])),_:1},8,["modelValue"]),(0,t.Wm)(p,{"aria-label":"Help",onClick:a[3]||(a[3]=e=>l.popOverHelp=!l.popOverHelp),color:"info"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{icon:"question-circle",size:"lg"})])),_:1}),(0,t.Wm)(p,{onClick:l.closeModal},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1},8,["onClick"]),(0,t.Wm)(p,{onClick:l.applyDiscount,disabled:!l.selectedDiscount},{default:(0,t.w5)((()=>[(0,t.Uk)("Aplicar")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["modelValue"])}var po={name:"ModalDescuentosTiendaComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE,MDBSelect:M.R3,MDBPopover:M.SW},setup(e,{expose:a,emit:o}){const l=(0,v.oR)(),n=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>l.state.Discounts.discounts)),s=(0,t.Fl)((()=>{if(!r.value)return[];const e=new Set;return r.value.filter((e=>null!==e.value&&0!=e.value&&100!=e.value)).filter((a=>{const o=parseInt(a.value);return!e.has(o)&&(e.add(o),!0)}))||[]})),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(!1);function m(e=0,a,o=0){d.value=a,u.value=o,i.value=e,n.value=!0}const p=()=>{n.value=!1},f=async()=>{const e=await k.Z.post("/cestas/setDiscountShop",{cesta:d.value,index:u.value,discount:i.value});e.data.error?alert(e.data.error):(o("discountSelected",i.value),p())},g=()=>{document.getElementById("descuentoTienda").blur()};return a({showModal:m}),{isModalOpen:n,selectedDiscount:i,discountValues:s,discountsShop:r,closeModal:p,applyDiscount:f,popOverHelp:c,removeFocus:g}}};const vo=(0,A.Z)(po,[["render",mo]]);var fo=vo,go=o(36852),bo=o(46375),Co=(o(17585),{name:"CestaComponent",components:{MDBCard:M.Yl,MDBCardBody:M.H7,MDBCardTitle:M.QM,MDBCardText:M.Pp,MDBBtn:M.$v,MDBIcon:M.vm,MDBPopover:M.SW,ModalDescuentosTiendaComponent:fo},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),r=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),s=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),u=(0,t.Fl)((()=>{let e=0;return m&&m.value?.lista&&m.value.lista.forEach((a=>{a.regalo&&(e+=a.puntos)})),e})),c=(0,D.iH)(go.U),m=(0,t.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(s.value&&s.value[d.value]&&l.value[e]._id==s.value[d.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",l.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),l.value[e];return null})),p=(0,D.iH)([]),f=(0,D.iH)(0),g=(0,t.Fl)((()=>o.state.Configuracion.parametros)),b=(0,D.iH)("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"),C=(0,D.iH)(!1),w=(0,D.iH)(!1),y=(0,t.f3)("postDisabledTecla"),h=(0,D.iH)(!1),_=(0,D.iH)(!0),M=(0,D.iH)(null),B=(0,D.iH)(null),T=(0,t.Fl)((()=>o.state.Discounts.discounts));function E(){m.value?.idCliente?k.Z.post("clientes/consultarPuntos",{idCliente:m.value?.idCliente}).then((e=>{"number"===typeof e.data?f.value=e.data:f.value=0})).catch((e=>{x().fire("Oops...",e.message,"error"),f.value=0})):f.value=0}const A=async e=>{if(e.regalo)return;await o.dispatch("Unidades/setUnidades",1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:m.value._id,unidades:1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[n.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[d.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",-1)},z=(0,D.iH)(!1),I=async e=>{if(e.unidades<=1||e.regalo||z.value)return;z.value=!0,await o.dispatch("Unidades/setUnidades",-1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:m.value._id,unidades:-1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[n.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[d.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",1),z.value=!1};function S(){if(s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]){let e=!0;if(void 0!=m.value&&"DEVOLUCION"==m?.value?.modo)return;for(let a=0;a<l.value.length;a++)if(l.value[a].trabajador==s.value[d.value].idTrabajador){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:l.value[a]._id,idTrabajador:s.value[d.value]._id}),e=!1;break}if(!e)return;H(),e=!1}else s.value&&void 0!=d.value&&null!=d.value?x().fire("Oops...","Error desconocido #123","error"):x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function H(){s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?await k.Z.post("cestas/crearCesta",{idTrabajador:s.value[d.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{x().fire("Oops...",e.message,"error")})):s.value&&void 0!=d.value&&null!=d.value||x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function P(e){return!(1==m.value?.albaran||1==m.value?.vip||null==m.value.idCliente||void 0==m.value.idCliente||""==m.value.idCliente||null==e.puntos||e.puntos<=0||e.subtotal<=0||"CONSUMO_PERSONAL"==m.value.modo)&&(f.value>u.value+e.puntos&&!e.regalo&&!p.value.includes(m.value.idCliente))}function F(e,a=null){k.Z.post("cestas/regalarProducto",{idCesta:m.value._id,indexLista:e,idPromoArtSel:a}).then((e=>{e.data?x().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):x().fire("Oops...","No se ha podido regalar el producto","error")}))}async function U(e,a){B.value=e,M.value?M.value.showModal(parseInt(a.descuentoTienda),m.value,e):console.error("modalDescuentosTienda no está definido.")}function j(e){return e&&!0!==m.value?.albaran&&!0!==m.value?.vip&&null!==m.value.idCliente&&void 0!==m.value.idCliente&&""!==m.value.idCliente}async function W(e,a){let t=a.promocion?a.promocion.grupos.flat():null;if(a.promocion&&t.length>1){let l='\n                <style>\n                input[type="radio"] {\n          appearance: none;\n          -webkit-appearance: none;\n          width: 20px;\n          height: 20px;\n          border: 2px solid black;\n          border-radius: 50%;\n\n          background-color: transparent;\n          position: relative;\n        }\n        .inputRegalo{\n          margin-left: 3rem ; /* Margen izquierdo de 2 columnas */\n          display: flex ; /* Display flex */\n          margin-top: 0.5rem ; /* Margen superior de 2 espacios */\n          margin-bottom: 0.5rem ;\n        }\n\n        label {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-left:5px;\n        }\n        .bloqueado {\n          pointer-events: none; /* Hace que el div no sea cliclable */\n          opacity: 0.6; /* Establece una opacidad inferior al normal (puedes ajustar el valor según tus preferencias) */\n        }\n        input[type="radio"]:checked::before {\n          content: "";\n          display: block;\n          width: 12px;\n          height: 12px;\n          background-color: #ca8489;\n          border-radius: 50%;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          animation: appear 0.8s;\n        }\n        @keyframes appear {\n          0% {\n            transform: translate(-50%, -50%) scale(0);\n            background-color: #fff;\n          }\n          45% {\n            transform: translate(-50%, -50%) scale(1.6);\n            background-color: #64aedf;\n          }\n          50% {\n            transform: translate(-50%, -50%) scale(1.7);\n            background-color: #ad97b3;\n          }\n          55% {\n            transform: translate(-50%, -50%) scale(1.6);\n          }\n          100% {\n            transform: translate(-50%, -50%) scale(1);\n            background-color: #ca8489;\n          }\n        }\n        </style>\n        <div class="col-12 mx-auto" >';for(let e of t){const o=(await k.Z.post("articulos/getArticuloById",{idArticulo:e.idArticulo})).data;l+=`<div class="inputRegalo ${null==o.puntos?"bloqueado":""}">\n              <input type="radio"  name="opcion" id="opcion1" value="${e.idArticulo}">\n              <label for="opcion1" class="col-9 d-flex">${e.nombre}\n                ${null==o.puntos?"":o.puntos*e.unidades*a.unidades+" p"}</label>\n            </div>`}l+="</div>",x().fire({title:"¿Cual articulo para regalar?",html:l,icon:"question",showDenyButton:!0,showConfirmButton:!0,confirmButtonText:"Si, regalar",denyButtonText:"No",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"},showClass:{popup:""},didOpen:()=>{const e=document.querySelector(".bloqueado");if(e){const a=e.querySelector("label").textContent;x().showValidationMessage(`${a} no se puede regalar`)}},preConfirm:()=>{const e=document.getElementsByName("opcion"),a=Array.from(e).find((e=>e.checked));return a?a.value:(x().showValidationMessage("Debes seleccionar una opción"),!1)}}).then((a=>{a.isConfirmed?(F(e,a.value),o.state.indexItemActivo=null):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}else x().fire({title:"¿Regalar este artículo?",text:`Se descontarán ${null!=a.puntos?a.puntos:0} puntos al cliente ${m.value.nombreCliente}`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?F(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}function V(e){o.dispatch("Cestas/setActivoAction",e)}function R(){const e=m.value.detalleIva,a=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((a,o)=>a+e[o]),0);return Number(a.toFixed(2))}function O(){if(!m.value)return;R();const e=m.value?.lista?m.value.lista.length:0;let a=0;for(let o=0;o<e;o++)a+=m.value.lista[o].subtotal;a>=12&&m.value?.idCliente==b.value&&!C.value?(w.value=!0,y(!0),C.value=!0):(m.value?.idCliente!=b.value||a<12||0==m.value.lista.length)&&C.value&&(w.value=!1,y(!1),C.value=!1,k.Z.post("/cestas/recalcularIvas",{idCesta:m.value._id}))}function N(){h.value=!0}function $(){h.value=!1}function Z(e){const a=new bo.Z(e).toDecimalPlaces(2).toFixed(2);return a}return(0,t.YP)((()=>m.value?.lista),(()=>{O()})),a({actualizarPuntos:E,BuscarCestas:S}),(0,t.bv)((()=>{E(),O(),k.Z.post("parametros/getParametros").then((e=>{e.data&&(_.value=e.data.nif.toString().length>6,console.log(_.value))})),k.Z.get("clientes/getEsClienteFacturacion").then((e=>{e.data&&(p.value=e.data)}))})),{cesta:m,arrayTrabajadores:s,indexTrabajadorActivo:d,indexItemCestaActivo:r,clickItem:V,inicializarCesta:H,BuscarCestas:S,sePuedeRegalar:P,haveNif:_,puntos:f,sumar:A,restar:I,clickRegalo:W,disabledCambiarUnidades:w,popOverTarifaEsp:h,showPopOver:N,hidePopOver:$,clickDiscountShop:U,parametros:g,modalDescuentosTienda:M,cOutPrecioOrig:Z,clienteNoFacturacion:j,versionDescuentosClient:c,discountsShop:T}}});const wo=(0,A.Z)(Co,[["render",io],["__scopeId","data-v-4ebfb548"]]);var yo=wo;const ho={class:"modoVenta d-block text-center"},_o={key:0,class:"d-block textoNombreCliente text-center"},Mo={class:"text-truncate",style:{"max-width":"10rem"}},Do={key:0,class:"d-flex justify-content-around mb-1"},ko={key:1,class:"d-block text-center textoNombreCliente"};function Bo(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBtnGroup"),c=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),v=(0,t.up)("ModalUnidadesComponent"),f=(0,t.up)("tarjetaClienteNumero"),g=(0,t.up)("ModalEncargosComponent"),b=(0,t.up)("ModalNuevoCliente"),C=(0,t.up)("ModalExtendidoClienteComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[l.vistaEspecial&&l.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==l.cesta.modo,fondoEncargo:"RECOGER ENCARGO"==l.cesta.modo,fondoCliente:l.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",ho,(0,d.zw)(l.cesta.modo),1),l.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",_o,[(0,t._)("span",Mo,(0,d.zw)(l.cesta.nombreCliente),1),l.clienteSeleccionado?((0,t.wg)(),(0,t.iD)("div",Do,[(0,t._)("span",null,"Encargos: "+(0,d.zw)(l.quantEncargo),1),(0,t._)("span",null,"Deudas: "+(0,d.zw)(l.quantDeuda),1)])):(0,t.kq)("",!0),(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>l.consultarPuntos(l.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",ko,(0,d.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(u,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>l.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[2]||(a[2]=e=>l.refModalArticulos.abrirModal()),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:l.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),l.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>l.refModalClientesSeleccionado.abrirModal(l.cesta.idCliente))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones ms-1",onMousedown:a[4]||(a[4]=e=>l.startPress()),onMouseup:a[5]||(a[5]=e=>l.endPress()),onTouchstartPassive:a[6]||(a[6]=e=>l.startPress()),onTouchendPassive:a[7]||(a[7]=e=>l.endPress()),disabled:"CONSUMO_PERSONAL"==l.cesta?.modo},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1},8,["disabled"]))])),_:1})),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(u,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{onClick:a[8]||(a[8]=e=>l.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[9]||(a[9]=e=>l.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[10]||(a[10]=e=>l.goTo("/cestas")),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:!l.siMesas}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1},8,["class"])])),_:1})),(0,t.Wm)(u,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==l.indexActivoCesta||null==l.indexActivoCesta?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones",onClick:a[11]||(a[11]=e=>l.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones",onClick:a[12]||(a[12]=e=>l.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(r,{onClick:a[13]||(a[13]=e=>l.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(r,{outline:"secondary",onClick:a[14]||(a[14]=e=>l.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",style:(0,d.j5)({fontSize:l.textoStock?"3em":"4em"})},null,8,["style"]),l.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:0,class:"stock",style:(0,d.j5)({fontSize:"16px",color:l.arrayStock["stock-IndicadorPos1"]?.fontColor})},(0,d.zw)(void 0!==l.arrayStock["stock-IndicadorPos1"]?.stock?l.arrayStock["stock-IndicadorPos1"]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(c,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(v,{ref:"refModalUnidades"},null,512),(0,t.Wm)(f,{ref:"tarjetaNum"},null,512),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512),(0,t.Wm)(b,{ref:"refModalNuevoCliente"},null,512),(0,t.Wm)(C,{ref:"refModalExtendidoCliente"},null,512)],64)}var xo=o(6411),To=o(46626);const Eo=e=>((0,t.dD)("data-v-87b8dff6"),e=e(),(0,t.Cn)(),e),Ao={class:"header"},zo={class:"col-md-8"},Io=["value"],So=Eo((()=>(0,t._)("div",{class:"col-md-12"},[(0,t._)("hr")],-1))),Ho={class:"textoNombre d-inline-block text-truncate"},Po={key:0,class:"spinner-border",role:"status",style:{margin:"2%"}},Fo=Eo((()=>(0,t._)("span",{class:"visually-hidden"},"Loading...",-1))),Uo=[Fo],jo={key:1,style:{margin:"2%"}},Wo={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function Vo(e,a,o,l,n,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBadge"),u=(0,t.up)("MDBListGroupItem"),c=(0,t.up)("MDBListGroup"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModal"),v=(0,t.up)("KeyBoardComponent"),g=(0,t.Q2)("mdb-infinite-scroll");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:l.modalArticulos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ao,[(0,t._)("div",zo,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",style:{"background-color":"#00ffff00"},placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example",readonly:"",onClick:a[0]||(a[0]=e=>l.openKeyboard()),"onUpdate:modelValue":a[1]||(a[1]=e=>l.inputBusqueda=e)},null,512),[[f.nr,l.inputBusqueda]])]),(0,t._)("select",{class:"Familia",onChange:a[2]||(a[2]=e=>l.selectFamilia(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.familias,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",value:l.familias[a].text},(0,d.zw)(l.familias[a].text),9,Io)))),256))],32)]),So,l.arrayArticulos?.length>0?(0,t.wy)(((0,t.wg)(),(0,t.j4)(c,{key:0,class:"container",style:{"max-height":"461px","overflow-y":"scroll"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.j4)(u,{key:e.i,style:{"justify-content":"space-between"},class:"d-flex align-items-center",onClick:e=>l.selectArticulo({nombreArticulo:a.nombre,idArticle:a._id,esSumable:a.esSumable})},{default:(0,t.w5)((()=>[(0,t._)("td",null,[(0,t.Wm)(r,{icon:"tag",size:"2x",class:"me-4"}),(0,t._)("span",Ho,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(s,{class:"textoFamilia d-inline-block text-truncate text-dark",badge:"info",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(a.familia),1)])),_:2},1024)])])),_:2},1032,["onClick"])))),128)),((0,t.wg)(),(0,t.j4)(u,{key:e.i,style:{"justify-content":"center"},class:"d-flex align-items-center"},{default:(0,t.w5)((()=>[l.maxLimit?((0,t.wg)(),(0,t.iD)("div",jo,[(0,t._)("span",Wo,(0,d.zw)(e.$t("sin_resultados","No hay mas resultados")),1)])):((0,t.wg)(),(0,t.iD)("div",Po,Uo))])),_:1}))])),_:1})),[[g,l.infiniteScroll]]):(0,t.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"keyboardRef"},null,512)],64)}var Ro={name:"ModalArticulosComponent",directives:{mdbInfiniteScroll:M.z9},components:{MDBModal:M.j3,MDBIcon:M.vm,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_,MDBSelect:M.R3,KeyBoardComponent:T.Z,MDBModalFooter:M.ab},setup(e,a){const o=(0,D.iH)(!1),l=(0,D.iH)(0),n=(0,D.iH)(null),i=(0,D.iH)(""),r=(0,D.iH)(),s=(0,D.iH)([{text:"Todos",value:"Todos"}]),d=(0,D.iH)("Todos"),u=(0,D.iH)(20),c=(0,D.iH)(!1),m=(0,t.f3)("clickTecla"),p=async()=>{u.value=u.value+20,await w()};function v(e){m(e),o.value=!1}async function f(){o.value=!0,u.value=20,c.value=!1,r.value=[],await b(),w()}function g(){l.value++}function b(){k.Z.post("articulos/familias").then((e=>{s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function C(e){d.value=e.target.value,u.value=20,c.value=!1,r.value=[],await w()}function w(){""!=i.value&&0==r.value.length&&(u.value=u.value+20*i.value.length),c.value=!1,k.Z.post("articulos/buscar",{busqueda:i.value,familia:d.value,limit:u.value}).then((e=>{r.value=e.data,u.value>r.value.length&&(c.value=!0)})).catch((e=>{x().fire("Oops...",e.message,"error")}))}let y;async function h(){try{n.value.abrirModal(i.value),y=setInterval((()=>{i.value=n.value.getValue()[0],n.value.getValue()[1]||clearInterval(y)}),100)}catch(e){console.log(e),y=void 0}}return(0,t.YP)(i,(()=>{w()})),a.expose({abrirModal:f,datoBorrar:l}),(0,t.bv)((async()=>{await b()})),{test:g,openKeyboard:h,maxLimit:c,datoBorrar:l,infiniteScroll:p,familias:s,keyboardRef:n,modalArticulos:o,selectFamilia:C,inputBusqueda:i,arrayArticulos:r,buscar:w,selectArticulo:v}}};const Oo=(0,A.Z)(Ro,[["render",Vo],["__scopeId","data-v-87b8dff6"]]);var No=Oo;const $o={class:"row"},Zo={class:"row"},qo={class:"text-center"};function Lo(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("NumpadComponent"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:l.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("introduce","Introduce"))+" "+(0,d.zw)(e.$t("las_unidades","las unidades"))+" "+(0,d.zw)(e.$t("y_marca","y marca"))+" "+(0,d.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",$o,[l.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>l.refUnidadesComponent.cantidad=e)},null,512)),[[f.nr,l.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",Zo,[(0,t._)("div",qo,[(0,t.Wm)(u,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Yo={name:"UnidadesComponent",components:{NumpadComponent:X.Z,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalTitle:M.wo},setup(){const e=(0,D.iH)(null),a=(0,D.iH)(null),o=(0,v.oR)();function l(){a.value=!0}function n(e){if(e>100)return x().fire({title:"Has añadido muchos productos.",html:`Vas a añadir <b>${e}<b/> productos,<br/><i> ¿estás segur@ de esta acción?</i>`,showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",confirmButtonColor:"info",cancelButtonColor:"green",iconColor:"info",icon:"info"}).then((t=>{t.isConfirmed&&(a.value=!1,o.dispatch("Unidades/setUnidades",e))}));a.value=!1,o.dispatch("Unidades/setUnidades",e)}return(0,t.JJ)("okValue",n),{refUnidadesComponent:e,modalUnidades:a,abrirModal:l}}};const Ko=(0,A.Z)(Yo,[["render",Lo],["__scopeId","data-v-7e0f404e"]]);var Go=Ko;const Jo={class:"text-center col-12 p3"},Qo={class:"text-center h2"},Xo={class:"row"},et={class:"d-inline-block text-center"},at={class:"d-inline-block text-center"},ot={id:"salir",class:"text-center"};function tt(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal"),c=(0,t.up)("ModalEncargosComponent"),m=(0,t.up)("ModalDeudasComponent"),p=(0,t.up)("ModalFichaCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalClientesSeleccionado,"onUpdate:modelValue":a[5]||(a[5]=e=>l.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Jo,[(0,t._)("span",Qo,(0,d.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,d.zw)(l.cesta?.nombreCliente),1)]),(0,t._)("div",Xo,[(0,t._)("div",et,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),void 0==l.cliente?.noPagaEnTienda||!1===l.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:0,color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>l.abrirModalEncargos())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1})):(0,t.kq)("",!0),void 0==l.cliente?.noPagaEnTienda||!1===l.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:1,disabled:l.recogiendoEncargos,color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>l.abrirModalDeuda())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("Deudas","deudas")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0)]),(0,t._)("div",at,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.nuevoPedido},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_pedido","Nuevo pedido")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>l.ficha())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ficha","Ficha")),1)])),_:1})]),(0,t._)("div",ot,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>l.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"refModalEncargos"},null,512),(0,t.Wm)(m,{ref:"refModalDeudas"},null,512),(0,t.Wm)(p,{ref:"refModalFichaCliente",callback:l.cambiosCliente},null,8,["callback"])],64)}const lt=e=>((0,t.dD)("data-v-0073e22a"),e=e(),(0,t.Cn)(),e),nt={class:"row"},it={class:"d-inline-block text-center"},rt={class:"p-0"},st={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},dt={class:"d-flex align-content-center ps-5"},ut={class:"content-date"},ct=["min","max"],mt=lt((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),pt={class:"content-date"},vt=["min","max"],ft={class:"d-flex pe-5 my-1"},gt={class:"m-auto px-2"},bt=["onClick"],Ct={class:"d-flex flex-row-reverse"},wt={class:"d-flex m-0 p-0 justify-content-between"},yt={key:0,class:"p-0"},ht={key:0},_t={key:1},Mt={key:1,class:"p-0",type:"button"},Dt={key:2,class:"p-0",type:"button"},kt={class:"d-flex justify-content-between px-0 py-2 m-0"},Bt={class:"d-flex m-0 p-0 justify-content-between"},xt={class:"productos"},Tt={class:"col-12"},Et={class:"col-3"},At={class:"col-1"},zt={class:"col-1"},It={class:"col-2"},St={class:"col-2"},Ht={class:"col-3"},Pt={class:"d-flex flex-column justify-content-center"},Ft={key:0},Ut={key:1},jt={key:1},Wt={class:"sinResultados position-relative"},Vt={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Rt={id:"salir"},Ot={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},Nt=lt((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),$t={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},Zt=lt((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1))),qt={class:"h4 mx-2 pb-2 border-bottom"},Lt={class:"d-flex justify-content-around"},Yt={class:"my-3 d-flex flex-column content-date"},Kt={for:"dateStart",class:"h5"},Gt=["min","max"],Jt={class:"my-3 d-flex flex-column content-date"},Qt={for:"dateFinal",class:"h5"},Xt=["min","max"],el={class:"h4 mx-2 pb-2 border-bottom"},al={class:"d-flex justify-content-around my-3"},ol=lt((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),tl={for:"orden1",class:"h6"},ll=lt((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),nl={for:"orden2",class:"h6"},il=lt((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),rl={for:"orden3",class:"h6"},sl={class:"h6"},dl=lt((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function ul(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),m=(0,t.up)("MDBModalTitle"),p=(0,t.up)("MDBModalHeader"),v=(0,t.up)("MDBModalFooter");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",labelledby:"tituloModalClientes",modelValue:l.modalEncargos,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",nt,[(0,t._)("div",it,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/encargos")),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1},8,["disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.recoger,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.anular,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.abrirModalImprimir,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick","disabled"])]),(0,t._)("div",rt,[(0,t._)("div",st,[(0,t._)("div",dt,[(0,t._)("div",ut,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>l.startSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[2]||(a[2]=e=>(l.mostrar(),l.currentPage=1))},null,40,ct),[[f.nr,l.startSelectedDate]])]),mt,(0,t._)("div",pt,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>l.finalSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[4]||(a[4]=e=>(l.mostrar(),l.currentPage=1))},null,40,vt),[[f.nr,l.finalSelectedDate]])])]),(0,t._)("div",ft,[(0,t._)("span",gt,(0,d.zw)(l.startRange)+" - "+(0,d.zw)(l.endRange)+" de "+(0,d.zw)(l.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:l.prevPage,disabled:1==l.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:l.nextPage,disabled:l.currentPage==l.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])])]),(0,t.Wm)(f.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[l.encargos&&l.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(l.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>l.onClickEncargo(o),class:(0,d.C_)({active:l.seleccionado===o,horaTarde:1==l.horaTarde(a),diaTarde:1==l.diaTarde(a)})},[(0,t._)("div",Ct,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>l.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",wt,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",yt,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",ht,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",_t,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Mt,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Dt,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a?.dias[0]?.dia)+" - "+(0,d.zw)(a?.dias[0]?.dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",kt,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",Bt,[(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,d.zw)(e.$t("dependienta","Dependienta"))+": "+(0,d.zw)(a?.nombreDependienta),1)]),(0,t._)("div",xt,[(0,t._)("table",Tt,[(0,t._)("tr",null,[(0,t._)("th",Et,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",At,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",zt,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",It,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",St,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",Ht,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",Pt,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Ft,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Ut,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,bt)])))),128)):((0,t.wg)(),(0,t.iD)("div",jt,[(0,t._)("div",Wt,[(0,t._)("span",Vt,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",Rt,[(0,t._)("div",Ot,[Nt,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[5]||(a[5]=e=>l.cerrarModal()),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1},8,["disabled"]),(0,t._)("div",$t,[Zt,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:l.modalImprimirEncargos,"onUpdate:modelValue":a[14]||(a[14]=e=>l.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:l.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("h2",qt,(0,d.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",Lt,[(0,t._)("div",Yt,[(0,t._)("label",Kt,(0,d.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[7]||(a[7]=e=>l.dateStart=e),min:l.startInputDate,max:l.finalInputDate},null,8,Gt),[[f.nr,l.dateStart]])]),(0,t._)("div",Jt,[(0,t._)("label",Qt,(0,d.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[8]||(a[8]=e=>l.dateFinal=e),min:l.startInputDate,max:l.finalInputDate},null,8,Xt),[[f.nr,l.dateFinal]])])]),(0,t._)("h2",el,(0,d.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",al,[(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>l.orden="producto")},[ol,(0,t._)("label",tl,(0,d.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[10]||(a[10]=e=>l.orden="Cliente")},[ll,(0,t._)("label",nl,(0,d.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[11]||(a[11]=e=>l.orden="producto_resumido")},[il,(0,t._)("label",rl,(0,d.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!l.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",sl,[dl,(0,t.Uk)(" "+(0,d.zw)(l.commentError),1)])],2)])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[12]||(a[12]=e=>l.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[13]||(a[13]=e=>l.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"])],64)}var cl={name:"modalEncargosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm},setup(e,a){const o=(0,D.iH)(!1),l=(0,v.oR)(),n=(0,Ta.tv)(),i=(0,D.iH)(null),r=((0,D.iH)(0),(0,D.iH)()),s=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),u=(0,t.Fl)((()=>s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?s.value[d.value]:null)),c=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(s.value&&s.value[d.value]&&c.value[e]._id==s.value[d.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(!1),f=new Date,g=(0,D.iH)(-1),b=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),C=(0,D.iH)(null),w=(0,D.iH)(null),y=(0,D.iH)(null),h=(0,D.iH)(null);b.setDate(b.getDate()+1);let _="1";const M=(0,D.iH)([]),B=(0,D.iH)(null),T=(0,D.iH)(!1),E=(0,D.iH)(null),A=(0,D.iH)(null),z=(0,D.iH)(null),I=(0,D.iH)(null),S=(0,D.iH)(!1),H=(0,D.iH)(null),P=(0,D.iH)(null),F=(0,t.Fl)((()=>l.state.Encargos.encargoToModalEnc));function U(e,a){P.value=e,H.value=a,i.value=!0,Z()}const j=(0,D.iH)(1),W=(0,D.iH)(20),V=(0,t.Fl)((()=>B.value?Math.ceil(B.value.length/W.value):0)),R=(0,t.Fl)((()=>(j.value-1)*W.value+1)),O=(0,t.Fl)((()=>Math.min(j.value*W.value,B.value?.length||0))),N=(0,t.f3)("cerrarModalClientesSeleccionado"),$=(0,t.f3)("eliminarCestaActual");async function Z(){await k.Z.post("/encargos/getEncargosByIdCliente",{idCliente:H.value}).then((e=>{M.value=e.data,M.value&&0!==M.value.length&&(q(M.value),K())}))}function q(e){let a=null,o=null;for(const t of e){1==t.opcionRecogida&&"am"==t.amPm&&(t.hora="14:59"),1==t.opcionRecogida&&"pm"==t.amPm&&(t.hora="23:59");const e=new Date(t.fecha);(null===a||e<a)&&(a=e),(null===o||e>o)&&(o=e)}y.value=a?.toISOString().slice(0,10),C.value=a?.toISOString().slice(0,10),w.value=o?.toISOString().slice(0,10),h.value=o?.toISOString().slice(0,10)}function L(e,a=!1){i.value=!0,p.value=!0,k.Z.post("/encargos/getEncargoById",{idEncargo:e}).then((async e=>{if(B.value=[e.data],"SIN_RECOGER"!=B.value[0].estado)return i.value=!1,void x().fire({icon:"info",title:"Este encargo ya se ha pagado/anulado",showConfirmButton:!0});if(1==B.value.length&&a&&(g.value=0),q(B.value),!a){Q(0);const e=ee();oe(e)}}))}function Y(e){n.push(e)}function K(){if(B.value=[],M.value=M.value||[],Array.isArray(M.value)){for(const e of M.value){const a=e.fecha;a>=C.value&&a<=w.value&&B.value.push(e)}B.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}}function G(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),l=a.getMinutes(),n=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(n<t||n==t&&i<l)}function J(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function Q(e){g.value=e}function X(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function ee(){return g.value+(j.value-1)*W.value}async function ae(){o.value=!0;const e=ee();if(-1!=g.value){let a=X(B.value[e].total-B.value[e].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+a+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cesta",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async a=>{a.isConfirmed?oe(e):o.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),o.value=!1}function oe(e){try{let a=X(B.value[e].total-B.value[e].dejaCuenta,2);l.dispatch("Cestas/setCestaBaseAction",P.value);const o=B.value[e].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:o}).then((async o=>{if(!o.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.data,idTrabajador:u.value._id}).then((async n=>{let i=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let e=0;e<i.value.length;e++)if(i.value[e]._id==o.data)return i.value[e]}));(r.value.modo="RECOGER ENCARGO")&&(l.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:a}),p.value||N(),me(),l.dispatch("Encargos/setEncargoSeleccionado",B.value[e]))}))}))}catch(a){}finally{o.value=!1}}function te(){const e=ee();-1!=g.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((a=>{a.isConfirmed&&(B.value[e].dejaCuenta>0?x().fire({title:"Devolver anticipo de "+B.value[e].dejaCuenta+"€ al cliente?",icon:"warning",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",denyButtonText:"No",confirmButtonText:"Si",cancelButtonText:"Cancelar",confirmButtonColor:"green",denyButtonColor:"red",cancelButtonColor:"gray"}).then((a=>{a.isConfirmed?k.Z.post("movimientos/nuevoMovimiento",{cantidad:B.value[e].dejaCuenta,concepto:"dejaACuenta",idTrabajador:u.value._id,tipo:"SALIDA",nombreCliente:B.value[e].nombreCliente}).then((a=>{if(a.data)return k.Z.post("impresora/abrirCajon"),void le(e);throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})):a.isDenied?le(e):o.value=!1})):le(e))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function le(e){k.Z.post("/encargos/anularEncargo",{id:B.value[e]._id}).then((async a=>{if(a?.data){const a=await l.dispatch("Encargos/cancelarEncargoEnUso",{id:B.value[e]._id});a&&$(),B.value.splice(g.value,1),g.value=-1,Z(),p.value&&me(),x().fire("Perfecto","Encargo anulado correctamente","success")}else x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function ne(){T.value=!0}function ie(){S.value=!1,I.value="",T.value=!1,z.value=null}function re(){if(!E.value||!A.value)return I.value="Por favor, ingresa ambas fechas",void(S.value=!0);if(A.value<E.value)return I.value="La fecha final no puede ser anterior a la fecha inicial",void(S.value=!0);if(null==z.value)return I.value="Elige una opción de orden",void(S.value=!0);{const e=[];for(const a of M.value){const o=a.fecha;o>=E.value&&o<=A.value&&e.push(a)}if(0==e.length)return I.value="El intervalo de fechas seleccionado no contiene encargos.",void(S.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:z.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),ie()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function se(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function de(){const e=(j.value-1)*W.value,a=e+W.value;return B.value.slice(e,a)}function ue(){j.value<V.value&&j.value++}function ce(){j.value>1&&j.value--}function me(){p.value=!1,g.value=-1,i.value=!1}return(0,t.YP)(j,(()=>{g.value=-1})),(0,t.YP)(B,(()=>{B.value.length<R.value&&(j.value=1)})),(0,t.YP)(F,((e,a)=>{if(e&&e._id&&e!==a){const a=e._id;H.value=e.idCliente,l.dispatch("Encargos/deleteEncargoToModalEnc"),L(a,!0)}}),{deep:!0}),a.expose({abrirModal:U,getEncargo:L}),{modalEncargos:i,arrayClientes:r,cesta:m,goTo:Y,encargos:B,mostrar:K,listado:_,seleccionado:g,onClickEncargo:Q,recoger:ae,anular:te,redondearDecimales:X,diaTarde:J,horaTarde:G,cargarEncargos:Z,imprimir:re,botonBloqueado:o,getEncargo:L,startSelectedDate:C,finalSelectedDate:w,startInputDate:y,finalInputDate:h,abrirModalImprimir:ne,modalImprimirEncargos:T,errorValidacionImp:S,dateStart:E,dateFinal:A,orden:z,commentError:I,cerrarModalImprimir:ie,currentPage:j,itemsPerPage:W,totalPages:V,paginatedItems:de,nextPage:ue,prevPage:ce,startRange:R,endRange:O,cerrarModal:me,printCharge:se}}};const ml=(0,A.Z)(cl,[["render",ul],["__scopeId","data-v-0073e22a"]]);var pl=ml;const vl=e=>((0,t.dD)("data-v-581484df"),e=e(),(0,t.Cn)(),e),fl={class:"row"},gl={class:"d-inline-block text-center"},bl={class:"p-0"},Cl={class:"d-flex justify-content-between px-5"},wl={class:"d-flex pe-5 my-1"},yl={class:"m-auto px-2"},hl={class:"d-flex"},_l={class:"text-center d-flex justify-content-center align-items-center"},Ml=vl((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),Dl={class:"size ps-2"},kl={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},Bl=vl((()=>(0,t._)("div",{class:"spinner"},null,-1))),xl=[Bl],Tl=["onClick"],El={class:"d-flex m-0 p-0 justify-content-between"},Al={class:"d-flex justify-content-between px-0 py-2 m-0"},zl={class:"productos"},Il={class:"col-12"},Sl=vl((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),Hl={class:"d-flex flex-column justify-content-center"},Pl={key:0},Fl={key:1},Ul={key:2},jl={class:"sinResultados position-relative"},Wl={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Vl={id:"salir"},Rl={key:0},Ol=vl((()=>(0,t._)("h5",{class:"mb-4"},"Selecciona el tipo de pago",-1))),Nl={class:"list-group"},$l={class:"list-group-item d-flex align-items-center"},Zl=vl((()=>(0,t._)("strong",null,"Pago total",-1))),ql=vl((()=>(0,t._)("br",null,null,-1))),Ll={class:"text-muted"},Yl={key:0,class:"list-group-item d-flex flex-column"},Kl={class:"d-flex align-items-center"},Gl=vl((()=>(0,t._)("div",null,[(0,t._)("strong",null,"Pago parcial")],-1))),Jl={key:0,class:"mt-2 ms-4"},Ql={key:1,class:"list-group-item d-flex align-items-center"},Xl=vl((()=>(0,t._)("strong",null,"Pago combinado",-1))),en=vl((()=>(0,t._)("br",null,null,-1))),an={class:"text-muted"},on={key:0,class:"alert alert-info mt-4"},tn={class:"row"},ln={class:"col"},nn={class:"input-group input-group-lg"},rn={class:"row"},sn={class:"col text-center"};function dn(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBadge"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal"),p=(0,t.up)("MDBInput"),v=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModalHeader"),b=(0,t.up)("NumpadComponent"),C=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(m,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalDeudas,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalDeudas=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",fl,[(0,t._)("div",gl,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/deudas"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nueva_deuda","Nueva deuda")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.findOutPagar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.eliminar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",bl,[(0,t._)("div",Cl,[(0,t._)("div",wl,[(0,t._)("span",yl,(0,d.zw)(l.startRange)+" - "+(0,d.zw)(l.endRange)+" de "+(0,d.zw)(l.arrayDeudas?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:l.prevPage,disabled:1==l.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:l.nextPage,disabled:l.currentPage==l.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])]),(0,t._)("div",hl,[(0,t.Wm)(r,{onClick:a[1]||(a[1]=e=>l.selectAllDebtsClient()),class:"bg-info text-white my-1 me-2"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1}),(0,t._)("div",_l,[Ml,(0,t._)("span",Dl,(0,d.zw)(l.seleccionados.length),1)])])]),(0,t.Wm)(f.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[l.loading?((0,t.wg)(),(0,t.iD)("div",kl,xl)):l.arrayDeudas&&l.arrayDeudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(l.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:o},[(0,t._)("div",{type:"button",onClick:e=>l.onClickDeuda(a._id),class:(0,d.C_)({active:l.seleccionados.includes(a._id)})},[(0,t._)("div",El,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(l.getFecha(a?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,d.zw)(a?.nombreCliente),1),a?.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",Al,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(a?.cesta?.lista?.length),1),(0,t._)("div",zl,[(0,t._)("table",Il,[Sl,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",Hl,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Pl,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Fl,"Ninguno"))])])))),128))])])],10,Tl)])))),128)):((0,t.wg)(),(0,t.iD)("div",Ul,[(0,t._)("div",jl,[(0,t._)("span",Wl,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",Vl,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[2]||(a[2]=e=>l.cerrarModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalPagoDeudasRef",tabindex:"-1",labelledby:"ModalPagoDeudas",modelValue:l.modalPagoDeudasRef,"onUpdate:modelValue":a[13]||(a[13]=e=>l.modalPagoDeudasRef=e),centered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[l.modalPagoDeudasRef?((0,t.wg)(),(0,t.iD)("div",Rl,[Ol,(0,t._)("div",Nl,[(0,t._)("label",$l,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoTotal",value:"total","onUpdate:modelValue":a[4]||(a[4]=e=>l.tipoPago=e),onChange:a[5]||(a[5]=e=>l.pagoParcial=l.totalAPagar)},null,544),[[f.G2,l.tipoPago]]),(0,t._)("div",null,[Zl,(0,t.Uk)(),ql,(0,t._)("small",Ll,"("+(0,d.zw)(l.totalAPagar.toFixed(2))+"€)",1)])]),l.hayArticulosEnCesta?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("label",Yl,[(0,t._)("div",Kl,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoParcial",value:"parcial","onUpdate:modelValue":a[6]||(a[6]=e=>l.tipoPago=e),onChange:a[7]||(a[7]=e=>l.pagoParcial=0)},null,544),[[f.G2,l.tipoPago]]),Gl]),"parcial"===l.tipoPago?((0,t.wg)(),(0,t.iD)("div",Jl,[(0,t.Wm)(p,{type:"number",id:"pagoDeudaInput",min:0,max:l.totalAPagar,step:"0.01",modelValue:l.pagoParcial,"onUpdate:modelValue":a[8]||(a[8]=e=>l.pagoParcial=e),onClick:a[9]||(a[9]=e=>l.openTecladoNum()),readonly:"",class:"form-control col-6",placeholder:"Ingresa el monto parcial"},null,8,["max","modelValue"])])):(0,t.kq)("",!0)])),l.hayArticulosEnCesta?((0,t.wg)(),(0,t.iD)("label",Ql,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoCombinado",value:"combinado","onUpdate:modelValue":a[10]||(a[10]=e=>l.tipoPago=e),onChange:a[11]||(a[11]=e=>l.pagoParcial=l.totalAPagar)},null,544),[[f.G2,l.tipoPago]]),(0,t._)("div",null,[Xl,en,(0,t._)("small",an," ("+(0,d.zw)(l.totalAPagar.toFixed(2))+"€ "+(0,d.zw)(e.$t("deuda","deuda"))+" + "+(0,d.zw)(l.getTotal(l.cestaMain).toFixed(2))+"€ "+(0,d.zw)(e.$t("en_cesta","en cesta"))+") ",1)])])):(0,t.kq)("",!0)]),l.hayArticulosEnCesta?((0,t.wg)(),(0,t.iD)("div",on,(0,d.zw)(e.$t("hay","Hay"))+" "+(0,d.zw)(l.cestaMain.lista.length)+" "+(0,d.zw)(e.$t("articulos","artículo"))+"(s) "+(0,d.zw)(e.$t("en_la_cesta_actual","en la cesta actual"))+". ",1)):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"primary",onClick:l.pagar},{default:(0,t.w5)((()=>[(0,t.Uk)(" Ir a Cobrar ")])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"danger",onClick:a[12]||(a[12]=e=>l.cerrarModalPagoDeudas())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:l.modalTecladoNum,"onUpdate:modelValue":a[17]||(a[17]=e=>l.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,t.w5)((()=>[(0,t.Wm)(g),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",tn,[(0,t._)("div",ln,[(0,t._)("div",nn,[l.numpadRef?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[14]||(a[14]=e=>l.numpadRef.cantidad=e)},null,512)),[[f.nr,l.numpadRef.cantidad]]):(0,t.kq)("",!0)])])]),(0,t._)("div",rn,[(0,t._)("div",sn,[(0,t.Wm)(b,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",onClick:a[15]||(a[15]=e=>l.closeTecladoNum()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[16]||(a[16]=e=>l.finishTecladoNum())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(C,{ref:"keyboardRef"},null,512)],64)}var un={name:"modaldeudasComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,KeyBoardComponentVue:T.Z,MDBBadge:M.m_,MDBIcon:M.vm,MDBModalFooter:M.ab,MDBInput:M.u2,NumpadComponent:X.Z},setup(e,a){const o=(0,D.iH)(null),l=(0,Ta.tv)(),n=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)([]),s=(0,D.iH)(-1),d=(0,D.iH)(null),u=(0,D.iH)(""),c=(0,D.iH)("1"),m=(0,v.oR)(),p=(0,D.iH)(null),f=(0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),g=(0,t.Fl)((()=>m.state.Trabajadores.arrayTrabajadores)),b=((0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),(0,t.Fl)((()=>g.value&&void 0!=f.value&&null!=f.value&&g.value[f.value]?g.value[f.value]:null))),C=(0,D.iH)(null),w=(0,t.Fl)((()=>m.state.ModalCobroView.modalCobroViewAbierto)),y=(0,D.iH)(null),h=(0,t.Fl)((()=>m.state.Cestas.arrayCestas)),_=(0,t.Fl)((()=>h.value?h.value.find((e=>e._id==p.value)):null)),M=(0,t.Fl)((()=>{if(!p.value||!_.value)return!1;const e=_?.value;return e&&e.lista&&e.lista.length>0})),B=(0,D.iH)(!1),T=(0,D.iH)(0),E=(0,D.iH)(0),A=(0,D.iH)("total"),z=()=>{T.value=0,B.value=!1},I=(0,D.iH)(null),S=(0,D.iH)(null);function H(e,a){p.value=e,y.value=a,o.value=!0,N()}const P=(0,D.iH)(!1),F=(0,t.f3)("cerrarModalClientesSeleccionado"),U=(0,t.Fl)((()=>m.state.Deudas.deudasToModal)),j=(0,D.iH)(1),W=(0,D.iH)(5),V=(0,t.Fl)((()=>i.value?Math.ceil(i.value.length/W.value):0)),R=(0,t.Fl)((()=>(j.value-1)*W.value+1)),O=(0,t.Fl)((()=>Math.min(j.value*W.value,i.value?.length||0)));function N(){P.value=!0,k.Z.post("/deudas/getDeudasByIdCliente",{idCliente:y.value}).then((async e=>{n.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),n.value.sort(((e,a)=>e.timestamp-a.timestamp));for(const a of n.value){const e=(await k.Z.post("clientes/getClienteById",{idCliente:a.idCliente})).data;a.albaran=e?.albaran,a.dejaCuenta||(a.dejaCuenta=0)}i.value=n.value,P.value=!1,$()})).catch((e=>{P.value=!1}))}function $(){switch(c.value){case"1":i.value.sort(((e,a)=>e.timestamp-a.timestamp));break;case"2":i.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":i.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function Z(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function q(){r.value=i.value.map((e=>e._id))}function L(e){const a=i.value.find((a=>a._id===e)).idCliente,o=i.value.find((a=>a._id===e))._id;r.value.includes(o)?r.value.splice(r.value.indexOf(o),1):C.value&&a!=C.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):r.value.push(o),Y()}function Y(){r.value.length>=1&&null==C.value&&(C.value=i.value.find((e=>e._id===r.value[0])).idCliente),0==r.value.length&&(C.value=null)}function K(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2),n=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+l+" "+n+":"+i+":"+r);return s}function G(){let e=0,a=i.value.filter((e=>r.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}function J(){let e=0;return e=G(),"combinado"===A.value&&(e+=ee(_.value)),e}function Q(){B.value=!0}async function X(){0!=r.value.length?(Q(),E.value=Z(G(),2)):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function ee(e){const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Number(o.toFixed(2))}async function ae(){if("total"!=A.value&&"combinado"!=A.value||(T.value=E.value),T.value<0)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser negativo"});if(T.value>E.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser mayor al total a pagar"});if(0==T.value&&0!=E.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser 0"});const e=i.value.filter((e=>r.value.includes(e._id))),a=Z(e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),2),o=Math.max(...e.map((e=>e.total-e.dejaCuenta))),l=Z(a-o,2);if(T.value<l)return void x().fire({icon:"info",title:"Oops...",text:"El pago debe superar el monto minimo de "+l});const n=r.value,s=[];try{m.dispatch("Cestas/setCestaBaseAction",p.value);const e=[];for(const o of n)e.push(i.value.find((e=>e._id===o)).cesta),s.push(i.value.find((e=>e._id===o)));"combinado"===A.value&&e.push(_.value);const a="combinado"===A.value?"cestas/cestaCombinada":"cestas/cestaDeudas";k.Z.post(a,{cestas:e}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:b.value._id}).then((async a=>{let o=(0,t.Fl)((()=>m.state.Cestas.arrayCestas)),l=await(0,t.Fl)((()=>{if(o.value)for(let a=0;a<o.value.length;a++)if(o.value[a]._id==e.data)return o.value[a]}));(l.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:G()}),m.dispatch("Deudas/setDeudasSeleccionadas",s),T.value!=E.value&&m.dispatch("Deudas/setTotalAPagar",T.value),m.dispatch("ModalCobroView/abrirModalCobroView"),z())}))}))}catch(d){console.log("Error",d),x().fire("Oops...",d.message,"error")}}function oe(){N(),u.value="",l.push("/main")}function te(){0!=r.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+r.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=r.value;try{const a=[];for(const o of e)a.push(await le(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success"),ce.value&&se()}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}oe()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function le(e){const a=i.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function ne(){const e=(j.value-1)*W.value,a=e+W.value;return i.value.slice(e,a)}function ie(){j.value<V.value&&j.value++}function re(){j.value>1&&j.value--}function se(){o.value=!1,j.value=1,s.value=-1,r.value=[],ce.value=!1}function de(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input">\n          </div>\n          <div id="fechas my-input-class"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function ue(){const e=u?.value,a=[];if(e&&e.length>0){for(let o=0;o<n.value.length;o++)n.value[o].nombreCliente.toLowerCase().includes(e.toLocaleLowerCase())&&a.push(n.value[o]);i.value=a}else i.value=n.value}const ce=(0,D.iH)(!1);function me(e){o.value=!0,r.value=e.map((e=>e._id)),ce.value=!0,i.value=e}const pe=()=>{I.value=!0},ve=()=>{I.value=!1},fe=()=>{let e=Number(S.value.cantidad);T.value=Number(e.toFixed(2)),ve()};function ge(e){l.push(e)}let be;async function Ce(){try{d.value.abrirModal(u.value),be=setInterval((()=>{u.value=d.value.getValue()[0],d.value.getValue()[1]||clearInterval(be)}),100)}catch(e){console.log(e),be=void 0}}return(0,t.JJ)("okValue",(()=>I.value?fe():pe())),(0,t.YP)(i,(()=>{i.value.length<R.value&&(j.value=1)})),(0,t.YP)(u,(()=>{ue()})),(0,t.YP)(w,(()=>{!w.value&&o.value&&(ce.value||(F(),k.Z.post("impresora/despedida",{precioTotal:J()})),se())})),(0,t.YP)(U,((e,a)=>{if(e&&JSON.stringify(e)!==JSON.stringify(a)&&e.length>0){const a=e;y.value=a[0].idCliente,me(a),m.dispatch("Deudas/deleteDeudasToModal")}})),(0,t.YP)(M,(e=>{e||"combinado"!==A.value?e&&"parcial"===A.value&&(A.value="total"):A.value="total"})),a.expose({abrirModal:H,getDeuda:me}),{modalDeudas:o,goTo:ge,cargarDeudas:N,redondearDecimales:Z,deudasFiltradas:n,arrayDeudas:i,onClickDeuda:L,seleccionado:s,seleccionados:r,pagar:ae,getFecha:K,eliminar:te,imprimir:de,buscar:ue,openKeyboard:Ce,keyboardRef:d,inputBusqueda:u,loading:P,filtrarLista:$,selectFiltro:c,cerrarModal:se,currentPage:j,itemsPerPage:W,totalPages:V,paginatedItems:ne,nextPage:ie,prevPage:re,startRange:R,endRange:O,getTotalSeleccionados:G,findOutPagar:X,modalPagoDeudasRef:B,pagoParcial:T,totalAPagar:E,cerrarModalPagoDeudas:z,tipoPago:A,modalTecladoNum:I,numpadRef:S,openTecladoNum:pe,closeTecladoNum:ve,finishTecladoNum:fe,selectAllDebtsClient:q,hayArticulosEnCesta:M,cestaMain:_,getTotal:ee}}};const cn=(0,A.Z)(un,[["render",dn],["__scopeId","data-v-581484df"]]);var mn=cn;const pn={class:"row"},vn={class:"col w-50"},fn={class:"col w-50 datos"},gn={key:0,class:"spinner"},bn={key:1};function Cn(e,a,o,l,n,i){const r=(0,t.up)("MDBModalHeader"),s=(0,t.up)("MDBInput"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),v=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:l.modalFichaCliente,"onUpdate:modelValue":a[14]||(a[14]=e=>l.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,d.zw)(l.nombre),1)])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",pn,[(0,t._)("div",vn,[(0,t.Wm)(s,{label:"Nombre",modelValue:l.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e),style:{"margin-top":"10px"},readonly:"",onClick:a[1]||(a[1]=e=>l.openKeyBoardCampos("nombre"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Teléfono",modelValue:l.telefono,"onUpdate:modelValue":a[2]||(a[2]=e=>l.telefono=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[3]||(a[3]=e=>l.openKeyBoardCampos("telefono"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Correo electrónico",modelValue:l.email,"onUpdate:modelValue":a[4]||(a[4]=e=>l.email=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[5]||(a[5]=e=>l.openKeyBoardCampos("email"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Dirección",modelValue:l.direccion,"onUpdate:modelValue":a[6]||(a[6]=e=>l.direccion=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[7]||(a[7]=e=>l.openKeyBoardCampos("direccion"))},null,8,["modelValue"])]),(0,t._)("div",fn,[(0,t.Wm)(s,{label:"Tarjeta cliente",modelValue:l.tarjeta,"onUpdate:modelValue":a[8]||(a[8]=e=>l.tarjeta=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[9]||(a[9]=e=>l.openKeyBoardCampos("tarjeta"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Documento de identidad",modelValue:l.nif,"onUpdate:modelValue":a[10]||(a[10]=e=>l.nif=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[11]||(a[11]=e=>l.openKeyBoardCampos("nif"))},null,8,["modelValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"primary",onClick:a[12]||(a[12]=e=>l.guardarCliente()),disabled:l.loading,class:"btnSpinner d-flex align-items-center justify-content-center"},{default:(0,t.w5)((()=>[l.loading?((0,t.wg)(),(0,t.iD)("span",gn)):((0,t.wg)(),(0,t.iD)("span",bn,"Guardar"))])),_:1},8,["disabled"]),(0,t.Wm)(c,{color:"danger",onClick:a[13]||(a[13]=e=>l.modalFichaCliente=!1),ref:"salirBoton",disabled:l.loading},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"keyboardRef"},null,512)],64)}var wn={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:M.$v,MDBInput:M.u2,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBModalHeader:M.ol,KeyBoardComponent:T.Z},setup(e,a){const o=(0,D.iH)(!1),l=e=>{o.value=!0,y(e)};a.expose({abrirModal:l});const n=(0,D.iH)(null),i=(0,D.iH)(""),r=(0,D.iH)(""),s=(0,D.iH)(""),d=(0,D.iH)(""),u=(0,D.iH)(""),c=(0,D.iH)(""),m=(0,D.iH)("0"),p=(0,D.iH)(null),v=(0,D.iH)(null),f=(0,D.iH)(null),g={nombre:i,email:s,direccion:d,tarjeta:u,nif:c,descuento:m,telefono:r},b=(0,t.f3)("cambiosCliente"),C=(0,D.iH)(!1),w=()=>{""!=i.value?isNaN(Number(m.value))?x().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):(C.value=!0,k.Z.post("clientes/actualizarCliente",{idCliente:p.value,nombre:i.value,telefono:r.value,email:s.value,direccion:d.value,tarjetaCliente:u.value,nif:c.value,descuento:m.value}).then((()=>{x().fire({title:"Cliente actualizado",icon:"success",confirmButtonText:"Aceptar"}),e.callback({nombre:i.value,descuento:m.value}),o.value=!1})).catch((e=>{x().fire({title:"Vaya...",text:"No se ha podido actualizar el cliente",icon:"error",confirmButtonText:"Aceptar"})})).finally((()=>{C.value=!1}))):x().fire({title:"Vaya...",text:"No se puede dejar el nombre vacio",icon:"error",confirmButtonText:"Aceptar"})},y=async e=>{const{data:a}=await k.Z.post("/clientes/getClienteById",{idCliente:e});if(!a)throw new Error("No se ha podido cargar el cliente");v.value=a,i.value="null"==a.nombre?"":a.nombre,r.value="null"==a.telefono?"":a.telefono,s.value="null"==a.email?"":a.email,d.value="null"==a.direccion?"":a.direccion,u.value="null"==a.tarjetaCliente?"":a.tarjetaCliente,c.value="null"==a.nif?"":a.nif,m.value="null"==a.descuento?"":a.descuento,p.value="null"==a.id?"":a.id};function h(e){const a=m.value;if(void 0===a||null===a||""===a)return;const o=a.replace(/[^0-9.]/g,""),[t,l]=o.split("."),i=l&&l.length>2?l.slice(0,2):l,r=t+(i?`.${i}`:""),s=parseFloat(r);let d="";isNaN(s)||(d=s<0?"0":s>100?"100":r),m.value!==d&&(m.value=d,n.value.setText(d))}let _;function M(e){B(g[e])}async function B(e){try{n.value.abrirModal(e.value),_=setInterval((()=>{const a=n.value.getValue()[0];a!==e.value&&(e.value=a),n.value.getValue()[1]||clearInterval(_)}),100)}catch(a){console.log(a),_=void 0}}return(0,t.YP)(m,(e=>{h()})),{modalFichaCliente:o,guardarCliente:w,nombre:i,telefono:r,email:s,direccion:d,tarjeta:u,nif:c,descuento:m,salirBoton:f,cambiosCliente:b,loading:C,clienteToc:v,validateDescuento:h,openKeyBoardCampos:M,keyboardRef:n}}};const yn=(0,A.Z)(wn,[["render",Cn],["__scopeId","data-v-c24c2208"]]);var hn=yn,_n={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalEncargosComponent:pl,ModalDeudasComponent:mn,ModalFichaCliente:hn},setup(e,a){const o=(0,v.oR)(),l=(0,D.iH)(null),n=((0,D.iH)(0),(0,D.iH)()),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=((0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(d.value&&d.value[u.value]&&c.value[e]._id==d.value[u.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(null),f=(0,D.iH)(null),g=(0,t.Fl)((()=>!!m.value&&"RECOGER ENCARGO"==m.value.modo));function b(e){C(e),l.value=!0}async function C(e){try{const a=await k.Z.post("clientes/getClienteById",{idCliente:e});a.data&&(f.value=a.data)}catch(a){}}async function w(){if(c.value&&m.value)for(let e=0;e<c.value.length;e++)if(c.value[e]._id===m.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),await o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset"),k.Z.post("cestas/recalcularIvas",{idCesta:m.value._id});break}h()}a.expose({abrirModal:b});const y=()=>{s.value.abrirModal(m.value.idCliente)};function h(){l.value=!1}function _({nombre:e,descuento:a}){m.value.nombreCliente=e,o.dispatch("Cestas/setDescuentoAction",Number(a/100))}function M(){k.Z.get("deudas/getUpdateDeudas").then((e=>{e.data?r.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando deudas",html:"Descargando deudas debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("deudas/descargarDeudas").then((e=>{e.data?(r.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar las deudas. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&r.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}function B(){k.Z.get("encargos/getUpdateEncargos").then((e=>{e.data?i.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando encargos",html:"Descargando encargos debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("encargos/descargarEncargos").then((e=>{e.data?(i.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar los encargos. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&i.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}async function T(){p.value?(await w(),setTimeout((()=>{E("/menu/nuevos-pedidos")}),200)):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function E(e){xo.Z.push(e)}return(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{p.value=e.data})).catch((e=>{p.value=!1}))})),(0,t.JJ)("cambiosClientes",_),(0,t.JJ)("cerrarModalClientesSeleccionado",h),{modalClientesSeleccionado:l,arrayClientes:n,cesta:m,resetGeneral:w,refModalEncargos:i,refModalDeudas:r,ficha:y,refModalFichaCliente:s,cambiosCliente:_,abrirModalDeuda:M,abrirModalEncargos:B,cliente:f,nuevoPedido:T,clientePedidosTienda:p,recogiendoEncargos:g}}};const Mn=(0,A.Z)(_n,[["render",tt],["__scopeId","data-v-5065ebca"]]);var Dn=Mn,kn=o(39072);const Bn={class:"d-flex justify-content-between"},xn={class:"d-flex"};function Tn(e,a,o,l,n,i){const r=(0,t.up)("MDBTabItem"),s=(0,t.up)("MDBTabNav"),u=(0,t.up)("MDBBtn"),c=(0,t.up)("ListadoEncargosComponent"),m=(0,t.up)("MDBTabPane"),p=(0,t.up)("ListadoDeudasComponent"),v=(0,t.up)("MDBTabContent"),f=(0,t.up)("MDBTabs"),g=(0,t.up)("MDBModalBody"),b=(0,t.up)("MDBModalFooter"),C=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(C,{id:"modalExtendidoClient",title:"Datos extendidos del cliente",modelValue:l.modalExtendidoCliente,"onUpdate:modelValue":a[4]||(a[4]=e=>l.modalExtendidoCliente=e),size:"xl","static-backdrop":""},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{class:"pb-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:l.activeTabId,"onUpdate:modelValue":a[2]||(a[2]=e=>l.activeTabId=e)},{default:(0,t.w5)((()=>[(0,t._)("div",Bn,[(0,t.Wm)(s,{tabsClasses:" text-center border-bottom d-flex tabMenuCliente"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:(0,d.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab1"===l.activeTabId}]),tag:"button",wrap:!1,tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1},8,["class"]),(0,t.Wm)(r,{tag:"button",class:(0,d.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab2"===l.activeTabId}]),wrap:!1,tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deudas","Deudas")),1)])),_:1},8,["class"])])),_:1}),(0,t._)("div",xn,["tab1"==l.activeTabId?((0,t.wg)(),(0,t.j4)(u,{key:0,onClick:a[0]||(a[0]=e=>l.sendToModalEncargos()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0),"tab2"==l.activeTabId?((0,t.wg)(),(0,t.j4)(u,{key:1,onClick:a[1]||(a[1]=e=>l.sendToModalDeudas()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0)])]),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref:"refListadoEncargos"},null,512)])),_:1}),(0,t.Wm)(m,{tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref:"refListadoDeudas"},null,512)])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{class:"d-flex justify-content-center"},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(u,{id:"salir",color:"danger",class:"ms-2 col-4",onClick:a[3]||(a[3]=a=>{e.seleccionado=-1,l.modalExtendidoCliente=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])),_:1})])),_:1},8,["modelValue"])}const En=e=>((0,t.dD)("data-v-2cdf9ebb"),e=e(),(0,t.Cn)(),e),An={class:"p-0"},zn={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},In={class:"d-flex align-content-center px-3"},Sn={class:"content-date"},Hn=["min","max"],Pn=En((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),Fn={class:"content-date"},Un=["min","max"],jn={class:"d-flex my-1"},Wn={class:"m-auto px-2 range"},Vn=["onClick"],Rn={class:"d-flex flex-row-reverse"},On={class:"d-flex m-0 p-0 justify-content-between"},Nn={key:0,class:"p-0"},$n={key:0},Zn={key:1},qn={key:1,class:"p-0",type:"button"},Ln={key:2,class:"p-0",type:"button"},Yn={class:"d-flex justify-content-between px-0 py-2 m-0"},Kn={class:"d-flex m-0 p-0 justify-content-between"},Gn={class:"productos"},Jn={class:"col-12"},Qn={class:"col-3"},Xn={class:"col-1"},ei={class:"col-1"},ai={class:"col-2"},oi={class:"col-2"},ti={class:"col-3"},li={class:"d-flex flex-column justify-content-center"},ni={key:0},ii={key:1},ri={key:1},si={class:"sinResultados position-relative"},di={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},ui={class:"h4 mx-2 pb-2 border-bottom"},ci={class:"d-flex justify-content-around"},mi={class:"my-3 d-flex flex-column content-date"},pi={for:"dateStart",class:"h5"},vi=["min","max"],fi={class:"my-3 d-flex flex-column content-date"},gi={for:"dateFinal",class:"h5"},bi=["min","max"],Ci={class:"h4 mx-2 pb-2 border-bottom"},wi={class:"d-flex justify-content-around my-3"},yi=En((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),hi={for:"orden1",class:"h6"},_i=En((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),Mi={for:"orden2",class:"h6"},Di=En((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),ki={for:"orden3",class:"h6"},Bi={class:"h6"},xi=En((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function Ti(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBModalTitle"),c=(0,t.up)("MDBModalHeader"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),g=(0,t.up)("ModalEncargos");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",An,[(0,t._)("div",zn,[(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>l.nuevoPedido()),class:"sizeBotones my-auto",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Nuevo pedido ")])),_:1}),(0,t._)("div",In,[(0,t._)("div",Sn,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>l.startSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[2]||(a[2]=e=>(l.mostrar(),l.currentPage=1))},null,40,Hn),[[f.nr,l.startSelectedDate]])]),Pn,(0,t._)("div",Fn,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>l.finalSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[4]||(a[4]=e=>(l.mostrar(),l.currentPage=1))},null,40,Un),[[f.nr,l.finalSelectedDate]])])]),(0,t._)("div",jn,[(0,t._)("span",Wn,(0,d.zw)(l.startRange)+" - "+(0,d.zw)(l.endRange)+" de "+(0,d.zw)(l.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:l.prevPage,disabled:1==l.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:l.nextPage,disabled:l.currentPage==l.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right",size:"1x"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{class:"ms-5",onClick:l.abrirModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])]),(0,t.Wm)(f.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[l.encargos&&l.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(l.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{onClick:e=>l.onClickEncargo(o),class:(0,d.C_)({active:l.seleccionado===o,horaTarde:1==l.horaTarde(a),diaTarde:1==l.diaTarde(a)})},[(0,t._)("div",Rn,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>l.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",On,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Nn,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",$n,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",Zn,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",qn,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Ln,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a?.dias[0]?.dia)+" - "+(0,d.zw)(a?.dias[0]?.dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",Yn,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",Kn,[(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,d.zw)(e.$t("dependienta","Dependienta"))+": "+(0,d.zw)(a?.nombreDependienta),1)]),(0,t._)("div",Gn,[(0,t._)("table",Jn,[(0,t._)("tr",null,[(0,t._)("th",Qn,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",Xn,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",ei,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",ai,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",oi,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",ti,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",li,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",ni,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",ii,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,Vn)])))),128)):((0,t.wg)(),(0,t.iD)("div",ri,[(0,t._)("div",si,[(0,t._)("span",di,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(v,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:l.modalImprimirEncargos,"onUpdate:modelValue":a[12]||(a[12]=e=>l.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:l.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("h2",ui,(0,d.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",ci,[(0,t._)("div",mi,[(0,t._)("label",pi,(0,d.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[5]||(a[5]=e=>l.dateStart=e),min:l.startInputDate,max:l.finalInputDate},null,8,vi),[[f.nr,l.dateStart]])]),(0,t._)("div",fi,[(0,t._)("label",gi,(0,d.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[6]||(a[6]=e=>l.dateFinal=e),min:l.startInputDate,max:l.finalInputDate},null,8,bi),[[f.nr,l.dateFinal]])])]),(0,t._)("h2",Ci,(0,d.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",wi,[(0,t._)("div",{class:"inputOrden",onClick:a[7]||(a[7]=e=>l.orden="producto")},[yi,(0,t._)("label",hi,(0,d.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[8]||(a[8]=e=>l.orden="Cliente")},[_i,(0,t._)("label",Mi,(0,d.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>l.orden="producto_resumido")},[Di,(0,t._)("label",ki,(0,d.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!l.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",Bi,[xi,(0,t.Uk)(" "+(0,d.zw)(l.commentError),1)])],2)])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[10]||(a[10]=e=>l.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>l.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"]),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512)],64)}var Ei={name:"ListadoEncargosComponent",components:{TransitionGroup:f.W3,MDBBtn:M.$v,MDBIcon:M.vm,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalBody:M.Yz,MDBModalFooter:M.ab,ModalEncargos:pl},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,Ta.tv)(),n=new Date,i=(new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0),(0,D.iH)(null)),r=(0,D.iH)(!1),s=(0,D.iH)(null),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),f=(0,D.iH)(null),g=(0,D.iH)(!1),b=(0,D.iH)(null),C=(0,D.iH)([]),w=(0,D.iH)(null),y=(0,D.iH)(!1),h=(0,D.iH)(-1),_=(0,D.iH)(1),M=(0,D.iH)(20),B=(0,t.Fl)((()=>w.value?Math.ceil(w.value.length/M.value):0)),T=(0,t.Fl)((()=>(_.value-1)*M.value+1)),E=(0,t.Fl)((()=>Math.min(_.value*M.value,w.value?.length||0))),A=(0,t.f3)("cerrarModalExtendidoCliente"),z=(0,D.iH)(null),I=(0,t.f3)("resetGeneral");function S(){k.Z.post("/encargos/getEncargos").then((e=>{C.value=e.data;let a=null,o=null;if(0!=C.length){for(const e of C.value){1==e.opcionRecogida&&"am"==e.amPm&&(e.hora="14:59"),1==e.opcionRecogida&&"pm"==e.amPm&&(e.hora="23:59");const t=new Date(e.fecha);(null===a||t<a)&&(a=t),(null===o||t>o)&&(o=t)}u.value=a?.toISOString().slice(0,10),s.value=a?.toISOString().slice(0,10),d.value=o?.toISOString().slice(0,10),c.value=o?.toISOString().slice(0,10),H()}}))}function H(){w.value=[];for(const e of C.value){const a=e.fecha;a>=s.value&&a<=d.value&&w.value.push(e)}w.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function P(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),l=a.getMinutes(),n=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(n<t||n==t&&i<l)}function F(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function U(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function j(e){h.value=e}function W(){return h.value+(_.value-1)*M.value}async function V(e,a){y.value=!0;const l=W();if(-1!=h.value){let n=U(w.value[l].total-w.value[l].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+n+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async i=>{if(i.isConfirmed)try{o.dispatch("Cestas/setCestaBaseAction",e);const i=w.value[l].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:i}).then((async e=>{if(!e.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:a}).then((async a=>{let i=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let a=0;a<i.value.length;a++)if(i.value[a]._id==e.data)return i.value[a]}));(r.value.modo="RECOGER ENCARGO")&&(o.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:n}),A(),o.dispatch("Encargos/setEncargoSeleccionado",w.value[l]),o.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(r){}finally{y.value=!1}else y.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),y.value=!1}function R(e){const a=W();-1!=h.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((o=>{o.isConfirmed&&(w.value[a].dejaCuenta>0&&k.Z.post("movimientos/nuevoMovimiento",{cantidad:w.value[a].dejaCuenta,concepto:"dejaACuenta",idTrabajador:e,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})),k.Z.post("/encargos/anularEncargo",{id:w.value[a]._id}).then((e=>{e?.data?(w.value.splice(h.value,1),h.value=-1,S(),x().fire("Perfecto","Encargo anulado correctamente","success")):x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")})))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function O(){if(-1==h.value)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"});const e=W();o.dispatch("Encargos/setEncargoToModalEnc",w.value[e]),A()}function N(){r.value=!0}function $(){g.value=!1,b.value="",r.value=!1,f.value=null}function Z(){if(!m.value||!p.value)return b.value="Por favor, ingresa ambas fechas",void(g.value=!0);if(p.value<m.value)return b.value="La fecha final no puede ser anterior a la fecha inicial",void(g.value=!0);if(null==f.value)return b.value="Elige una opción de orden",void(g.value=!0);{const e=[];for(const a of C.value){const o=a.fecha;o>=m.value&&o<=p.value&&e.push(a)}if(0==e.length)return b.value="El intervalo de fechas seleccionado no contiene encargos.",void(g.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:f.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),$()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function q(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function L(){const e=(_.value-1)*M.value,a=e+M.value;return w.value.slice(e,a)}function Y(){_.value<B.value&&_.value++}function K(){_.value>1&&_.value--}async function G(){z.value?(await I(),J("/menu/nuevos-pedidos")):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function J(e){l.push(e)}return(0,t.YP)(_,(()=>{h.value=-1})),(0,t.YP)(w,(()=>{w.value.length<T.value&&(_.value=1),h.value=-1})),a({cargarEncargos:S,recoger:V,anular:R,sendToModalEncargos:O}),(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{z.value=e.data})).catch((e=>{z.value=!1})),S()})),{startSelectedDate:s,finalSelectedDate:d,modalImprimirEncargos:r,startInputDate:u,finalInputDate:c,dateStart:m,dateFinal:p,orden:f,encargos:w,currentPage:_,itemsPerPage:M,totalPages:B,startRange:T,endRange:E,cargarEncargos:S,mostrar:H,horaTarde:P,diaTarde:F,redondearDecimales:U,paginatedItems:L,nextPage:Y,prevPage:K,abrirModalImprimir:N,cerrarModalImprimir:$,imprimir:Z,errorValidacionImp:g,commentError:b,nuevoPedido:G,clientePedidosTienda:z,seleccionado:h,onClickEncargo:j,refModalEncargos:i,printCharge:q}}};const Ai=(0,A.Z)(Ei,[["render",Ti],["__scopeId","data-v-2cdf9ebb"]]);var zi=Ai;const Ii=e=>((0,t.dD)("data-v-2f1433f4"),e=e(),(0,t.Cn)(),e),Si={class:"p-0"},Hi={class:"d-flex justify-content-around"},Pi={class:"d-flex justify-content-between py-2 col-12"},Fi={class:"d-flex col-6 align-items-center"},Ui={class:"col-md-2 text-center d-flex justify-content-center align-items-center"},ji=Ii((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),Wi={class:"size ps-2"},Vi={class:"d-flex col-4 justify-content-between"},Ri={class:"d-flex col-7"},Oi=Ii((()=>(0,t._)("div",{class:"d-flex align-items-center col-2 size"},[(0,t._)("i",{class:"fas fa-filter"})],-1))),Ni={class:"col-10"},$i={value:"1"},Zi={value:"2"},qi={value:"3"},Li={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},Yi=Ii((()=>(0,t._)("div",{class:"spinner"},null,-1))),Ki=[Yi],Gi=["onClick"],Ji={class:"clientStatusToggle"},Qi={key:1,class:"fas fa-chevron-up"},Xi={key:2,class:"fas fa-chevron-down"},er=["onClick"],ar={class:"d-flex m-0 p-0 justify-content-between"},or={class:"d-flex justify-content-between px-0 py-2 m-0"},tr={class:"productos"},lr={class:"col-12"},nr=Ii((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),ir={class:"d-flex flex-column justify-content-center"},rr={key:0},sr={key:1},dr={key:2},ur={class:"sinResultados position-relative"},cr={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function mr(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBadge"),c=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Si,[(0,t._)("div",Hi,[(0,t._)("div",Pi,[(0,t._)("div",Fi,[(0,t.wy)((0,t._)("input",{class:"form-control input w-100",type:"text",placeholder:"Buscar por cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>l.inputBusqueda=e),onClick:a[1]||(a[1]=e=>l.openKeyboard()),readonly:"",style:{"background-color":"white"}},null,512),[[f.nr,l.inputBusqueda]]),(0,t._)("div",Ui,[ji,(0,t._)("span",Wi,(0,d.zw)(l.seleccionados.length),1)]),(0,t.Wm)(r,{style:(0,d.j5)({visibility:l.viewedDebts?"visible":"hidden"}),onClick:a[2]||(a[2]=e=>l.selectAllDebtsClient()),class:"col-3 btn bg-info text-white"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1},8,["style"])]),(0,t._)("div",Vi,[(0,t._)("div",Ri,[Oi,(0,t._)("div",Ni,[(0,t.wy)((0,t._)("select",{id:"filtro",class:"form-select input",name:"filtro","aria-label":".form-control-lg example","onUpdate:modelValue":a[3]||(a[3]=e=>l.selectFiltro=e),onChange:a[4]||(a[4]=e=>l.filtrarLista())},[(0,t._)("option",$i,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("option",Zi,(0,d.zw)(e.$t("albaranes","Albaranes")),1),(0,t._)("option",qi,(0,d.zw)(e.$t("no_albaranes","No Albaranes")),1)],544),[[f.bM,l.selectFiltro]])])]),(0,t.Wm)(r,{class:"col-3 inputIcon",onClick:l.imprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])])]),(0,t.Wm)(f.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[l.loading?((0,t.wg)(),(0,t.iD)("div",Li,Ki)):l.arrayByClients&&l.arrayByClients.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(l.computedClientList,((a,o)=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("div",{class:"DebtsClient",onClick:e=>l.displayDebtsClient(a.idCliente)},[(0,t._)("span",null,(0,d.zw)(a.nombreCliente)+": "+(0,d.zw)(a.deudas.length)+" "+(0,d.zw)(1===a.deudas.length?"Deuda":"Deudas")+", total de "+(0,d.zw)(l.sumDebtClient(a.deudas))+"€",1),(0,t._)("div",Ji,[a.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark textoAlbaran",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0),l.viewedDebts==a.idCliente?((0,t.wg)(),(0,t.iD)("i",Qi)):((0,t.wg)(),(0,t.iD)("i",Xi))])],8,Gi),a.deudas&&a.deudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(a.deudas,((o,n)=>(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:n},[(0,t._)("div",{onClick:e=>l.onClickDeuda(o),class:(0,d.C_)({active:l.seleccionados.includes(o._id)})},[(0,t._)("div",ar,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(l.getFecha(o?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,d.zw)(o?.nombreCliente),1),o?.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",or,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(o?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(o?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(o?.total-o?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(o?.cesta?.lista?.length),1),(0,t._)("div",tr,[(0,t._)("table",lr,[nr,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(o?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",ir,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",rr,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",sr,"Ninguno"))])])))),128))])])],10,er)])),[[f.F8,l.viewedDebts==a.idCliente]]))),128)):(0,t.kq)("",!0)])))),256)):((0,t.wg)(),(0,t.iD)("div",dr,[(0,t._)("div",ur,[(0,t._)("span",cr,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(c,{class:"position-absolute",ref:"keyboardRef"},null,512)],64)}var pr={name:"ListadoDeudasComponent",components:{MDBBtn:M.$v,MDBBadge:M.m_,TransitionGroup:f.W3,KeyBoardComponentVue:T.Z,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,D.iH)([]),l=(0,D.iH)([]),n=(0,D.iH)([]),i=(0,t.Fl)((()=>n.value.filter((e=>!!e.nombreCliente&&e.nombreCliente.toLocaleLowerCase().includes(c.value.toLocaleLowerCase()))))),r=(0,D.iH)(""),s=(0,Ta.tv)(),d=(0,D.iH)([]),u=(0,D.iH)(null),c=(0,D.iH)(""),m=(0,D.iH)("1"),p=(0,v.oR)(),f=(0,D.iH)(null),g=(0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),b=(0,t.Fl)((()=>p.state.Trabajadores.arrayTrabajadores)),C=((0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),(0,D.iH)(!1)),w=(0,t.Fl)((()=>b.value&&void 0!=g.value&&null!=g.value&&b.value[g.value]?b.value[g.value]:null)),y=(0,D.iH)(null),h=(0,t.Fl)((()=>p.state.ModalCobroView.modalCobroViewAbierto)),_=(0,t.f3)("cerrarModalExtendidoCliente");function M(){C.value=!0,k.Z.post("/deudas/getDeudas").then((async e=>{o.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),o.value.sort(((e,a)=>e.timestamp-a.timestamp));const a={};for(const t of o.value){const e=t.idCliente;if(!a[e]){const o=(await k.Z.post("clientes/getClienteById",{idCliente:t.idCliente})).data;a[e]={idCliente:e,nombreCliente:t.nombreCliente,albaran:o?.albaran||!1,deudas:[]}}a[e].deudas.push(t)}n.value=Object.values(a),n.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente))),C.value=!1,T()})).catch((e=>{C.value=!1}))}function B(e){e&&(r.value=e==r.value?"":e)}function T(){switch(m.value){case"1":n.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente)));break;case"2":n.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":n.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function E(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function A(){if(r.value){const e=n.value.find((e=>e.idCliente==r.value));e&&(d.value=e.deudas.map((e=>e._id)))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un cliente"})}function z(e){const a=e.idCliente,o=e._id;d.value.includes(o)?d.value.splice(d.value.indexOf(o),1):y.value&&a!=y.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):d.value.push(o),I()}function I(){d.value.length>=1&&null==y.value&&(y.value=n.value.find((e=>e.deudas.some((e=>e._id===d.value[0])))).idCliente),0==d.value.length&&(y.value=null)}function S(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2),n=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+l+" "+n+":"+i+":"+r);return s}function H(){k.Z.post("impresora/abrirCajon")}function P(){let e=0,a=l.value.filter((e=>d.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}async function F(){if(0!=d.value.length){H();const e=P();await x().fire({title:"Dinero total: "+E(e,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=d.value,o=[];try{p.dispatch("Cestas/setCestaBaseAction",f.value);const a=[];for(const t of e)a.push(l.value.find((e=>e._id===t)).cesta),o.push(l.value.find((e=>e._id===t)));k.Z.post("cestas/cestaDeudas",{cestas:a}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:w.value._id}).then((async a=>{let l=(0,t.Fl)((()=>p.state.Cestas.arrayCestas)),n=await(0,t.Fl)((()=>{if(l.value)for(let a=0;a<l.value.length;a++)if(l.value[a]._id==e.data)return l.value[a]}));(n.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:P()}),p.dispatch("Deudas/setDeudasSeleccionadas",o),p.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}}}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function U(){M(),c.value="",s.push("/main")}function j(){0!=d.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+d.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=d.value;try{const a=[];for(const o of e)a.push(await W(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success")}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}U()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function W(e){const a=l.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function V(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input m-0">\n          </div>\n          <div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input m-0">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function R(e){const a=e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0);return Math.round(100*a)/100}function O(){if(0==d.value.length)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"});const e=[];for(const a of d.value)e.push(o.value.find((e=>e._id===a)));p.dispatch("Deudas/setDeudasToModal",e),_()}let N;async function $(){try{u.value.abrirModal(c.value),N=setInterval((()=>{c.value=u.value.getValue()[0],u.value.getValue()[1]||clearInterval(N)}),100)}catch(e){console.log(e),N=void 0}}return(0,t.YP)(i,(()=>{r.value="",d.value=[],y.value=null})),(0,t.YP)(h,(()=>{h.value||U()})),a({cargarDeudas:M,pagar:F,eliminar:j,sendToModalDeudas:O}),(0,t.bv)((()=>{M()})),{arrayDeudas:l,inputBusqueda:c,selectFiltro:m,filtrarLista:T,redondearDecimales:E,getFecha:S,imprimir:V,openKeyboard:$,keyboardRef:u,loading:C,openKeyboard:$,onClickDeuda:z,eliminar:j,seleccionados:d,arrayByClients:n,computedClientList:i,viewedDebts:r,displayDebtsClient:B,sumDebtClient:R,selectAllDebtsClient:A}}};const vr=(0,A.Z)(pr,[["render",mr],["__scopeId","data-v-2f1433f4"]]);var fr=vr,gr={name:"ModalExtendidoClienteComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,ListadoEncargosComponent:zi,ListadoDeudasComponent:fr,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE},setup(e,{expose:a}){const o=(0,D.iH)(null),l=(0,D.iH)(null),n=(0,D.iH)(null);function i(){o.value=!0}function r(){o.value=!1}const s=(0,v.oR)(),d=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),m=(0,t.Fl)((()=>s.state.Cestas.arrayCestas)),p=(0,t.Fl)((()=>{if(m.value)for(let e=0;e<m.value.length;e++)if(d.value&&d.value[u.value]&&m.value[e]._id==d.value[u.value].idCesta)return m.value[e];return null}));function f(){n.value.pagar()}function g(){n.value.eliminar()}function b(){n.value.sendToModalDeudas()}function C(){l.value.recoger(p.value._id,c.value._id)}function w(){l.value.anular(c.value._id)}function y(){l.value.sendToModalEncargos()}(0,t.JJ)("cerrarModalExtendidoCliente",r);const h=(0,D.iH)("tab1");return a({abrirModal:i}),{modalExtendidoCliente:o,refListadoEncargos:l,refListadoDeudas:n,activeTabId:h,pagarDeuda:f,eliminarDeuda:g,recogerEncargo:C,anularEncargo:w,sendToModalDeudas:b,sendToModalEncargos:y}}};const br=(0,A.Z)(gr,[["render",Tn],["__scopeId","data-v-cd69a014"]]);var Cr=br,wr={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:M.Ff,MDBBtn:M.$v,MDBIcon:M.vm,ModalClientesComponent:To.Z,ModalArticulosComponent:No,ModalNuevoCliente:kn.Z,ModalUnidadesComponent:Go,CestaComponentVue:yo,ModalClientesSeleccionadoComponent:Dn,ModalEncargosComponent:pl,ModalExtendidoClienteComponent:Cr},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Configuracion.parametros)),n=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),f=(0,D.iH)(!1),g=(0,D.iH)(null),b=(0,D.iH)(!1),C=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),w=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),y=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),h=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),_=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let M="",B="";const T=(0,D.iH)(!1),E=(0,D.iH)(!0),A=(0,t.Fl)((()=>{if(w.value)for(let e=0;e<w.value.length;e++)if(y.value&&y.value[_.value]&&w.value[e]._id==y.value[_.value].idCesta)return w.value[e];return null})),z=(0,D.iH)(!1),I=(0,t.Fl)((()=>o.state.Stock.arrayStock)),S=(0,t.Fl)((()=>A.value?.idCliente||null)),H=(0,D.iH)(0),P=(0,D.iH)(0);function F(){null!=h.value&&void 0!=h.value&&A.value&&o.dispatch("Cestas/deleteIndex",{index:h.value,idCesta:A.value._id})}async function U(){A.value&&(o.dispatch("Cestas/deleteLista",A.value._id),await k.Z.post("impresora/saludo").catch((e=>{x().fire("Oops...",e.message,"error")})))}function j(){C.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function W(e){xo.Z.push(e)}function V(e){k.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");x().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function R(){if(w.value&&A.value)for(let e=0;e<w.value.length;e++)if(w.value[e]._id===A.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==A.value.modo){for(let e=0;e<w.value.length;e++)if(w.value[e].trabajador==y.value[_.value].idTrabajador&&"DEVOLUCION"!==w.value[e].modo){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:w.value[e]._id,idTrabajador:y.value[_.value]._id});break}}else{if("RECOGER ENCARGO"==A.value.modo)return void await O(A.value._id);if(w.value&&A.value)for(let e=0;e<w.value.length;e++)if(w.value[e]._id===A.value._id){const a=w.value[e].modo;let t=!1;o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),null!=A.value.idCliente&&(t=!0,o.dispatch("Cestas/setDescuentoAction",Number(0))),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),(t||"CONSUMO_PERSONAL"==a)&&k.Z.post("cestas/recalcularIvas",{idCesta:A.value._id}),o.dispatch("EstadoDinamico/reset");break}}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset");break}}async function O(e=null){if(!A.value)return;const a=e||A.value._id;k.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((e=>{x().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:y.value[o.state.Trabajadores.indexActivo]._id}).then((e=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}async function N(e){const a=d.value;a&&k.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((async a=>{a.data?n.value.selectCliente(a.data.id,a.data.nombre,a.data.albaran,a.data.vip):e&&13==e.length?x().fire({title:"Tarjeta sin cliente",text:"¿Desea crear un nuevo cliente?",icon:"warning",showCancelButton:!0,confirmButtonColor:"green",cancelButtonColor:"#d33",confirmButtonText:"Crear",cancelButtonText:"Cancelar"}).then((a=>{a.isConfirmed&&d.value.abrirModal(e)})):x().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}async function $(e){const a=await k.Z.post("encargos/getEncargoByNumber",{idEncargo:e});return!!a.data&&(s.value?.getEncargo(a.data._id),!0)}async function Z(e){if("Shift"==e)return null;if("Enter"==e){const e=await $(B);return e||N(M),M="",void(B="")}B+=e,M+=e}function q(){k.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(g.value=e.data[0]._id,k.Z.post("impresora/imprimirTicket",{idTicket:g.value}).catch((e=>{x().fire("Oops...",e.message,"error")}))):x().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}function L(){p.value=setTimeout((()=>{m.value.abrirModal(),p.value=null}),360)}function Y(){f.value=!0,setTimeout((()=>{f.value=!1}),70)}function K(){p.value&&!f.value&&(clearTimeout(p.value),n.value.abrirModal(),Y()),clearTimeout(p.value)}(0,t.JJ)("eliminarCestaActual",O),a({resetGeneral:R});const G=e=>{if("Shift"==e.key)return null;const a=document.activeElement;"Enter"===e.key&&a&&a.blur(),Z(e.key)};async function J(e){await k.Z.post("clientes/getCantidadEncargosDeudas",{idCliente:e}).then((e=>{e.data?(H.value=e.data.cantidadEncargos,P.value=e.data.cantidadDeudas):(H.value=0,P.value=0)})).catch((e=>{P.value=0,H.value=0}))}return(0,t.bv)((()=>{document.addEventListener("keydown",G),A.value&&(A.value.idCliente||"VENTA"!=A.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),A.value&&A.value.idCliente&&J(A.value.idCliente),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?(E.value="Si"==e.data?.params?.mesas,T.value="Si"==e.data?.params?.prohibirBuscarArticulos):(T.value=!1,E.value=!0),"Si"==e.data?.params?.textoStock&&(z.value=!0)}))})),(0,t.YP)(S,((e,a)=>{e!=a&&null!=e&&J(e)})),{indexActivoCesta:h,borrarItem:F,borrarLista:U,vistaEspecial:C,changeVistaCliente:j,cesta:A,goTo:W,refModalClientes:n,refModalArticulos:i,refModalUnidades:r,CestaComponent:u,resetGeneral:R,consultarPuntos:V,parametros:l,NoBuscarProducte:T,siMesas:E,imprimirUltimoTicket:q,idTicket:g,getCodigo:Z,refModalNuevoCliente:d,tarjetaClienteNumero:M,refModalClientesSeleccionado:c,clickEncargoAtajo:$,refModalEncargos:s,hayPagados:b,textoStock:z,arrayStock:I,startPress:L,endPress:K,opBloqueado:f,refModalExtendidoCliente:m,clienteSeleccionado:S,quantEncargo:H,quantDeuda:P}}};const yr=(0,A.Z)(wr,[["render",Bo],["__scopeId","data-v-09a795ca"]]);var hr=yr;const _r=e=>((0,t.dD)("data-v-4365756e"),e=e(),(0,t.Cn)(),e),Mr={class:"row"},Dr={class:"nombreMesa d-inline-block text-truncate"},kr={key:0},Br={key:1},xr=["value"],Tr={class:"row rowEstadoDatafono"},Er={class:"col colEstadoDatafono"},Ar={class:"row"},zr={class:"disponible"},Ir={class:"nodisponible"},Sr={class:"again"},Hr={class:"esperandoVenta"},Pr={key:4,class:"d-inline text-center grupoContento pt-1"},Fr=_r((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"100",height:"35"},null,-1))),Ur=[Fr],jr={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},Wr={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},Vr={key:7,class:"d-inline text-center grupoContento pt-1"},Rr={class:"col-auto colEstadoCashlogy"},Or={class:"w-100 h-100",style:{margin:"0 0.12rem"}},Nr={class:"row mt-1"},$r=_r((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),Zr={class:"letraTotal ms-3 mt-2"},qr={class:"text-start fst-italic informacion"},Lr={class:"nomTienda"};function Yr(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("CashlogyMenuNotificaciones"),c=(0,t.up)("modalCobroViewVue"),m=(0,t.up)("modalUltimosImportes");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Mr,[(0,t._)("div",Dr,[l.cesta&&l.cesta.indexMesa>=0&&l.arrayMesas[l.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",kr,(0,d.zw)(l.arrayMesas[l.cesta?.indexMesa].nombre),1)):(0,t.kq)("",!0),(l.cesta||l.cesta?.indexMesa||l.arrayMesas)&&l.arrayMesas[l.cesta?.indexMesa]?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",Br,(0,d.zw)(e.$t("en_tu_cesta","En tu cesta")),1))]),(0,t.wy)((0,t._)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>l.indiceTrabajadorActivo=e),class:"nombreTrabajador selecTrabajador",onChange:a[1]||(a[1]=e=>l.selectDependienta(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{key:a,dropdownDirection:"up",value:a},(0,d.zw)(l.arrayTrabajadores[a].nombre),9,xr)))),128))],544),[[f.bM,l.indiceTrabajadorActivo]])]),(0,t._)("div",Tr,[(0,t._)("div",Er,[(0,t._)("div",Ar,["ONLINE"!==l.estadoDatafono||l.use3g?"OFFLINE"!==l.estadoDatafono||l.use3g?"AGAIN"!==l.estadoDatafono||l.use3g?"PENDIENTE"!==l.estadoDatafono||l.use3g?"BUSCANDO"!==l.estadoDatafono||l.use3g?"APROBADA"!==l.estadoDatafono||l.use3g?"DENEGADA"!==l.estadoDatafono||l.use3g?l.Cashlogy_activado?((0,t.wg)(),(0,t.iD)("div",Vr)):(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Wr,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",jr,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",Pr,Ur)):((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Hr,(0,d.zw)(l.procesoDatafono),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:2,outline:"warning",class:"botonEstado",onClick:a[4]||(a[4]=e=>l.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",Sr,(0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,onClick:a[3]||(a[3]=e=>{l.datafonoDisponible(),l.modalUltimosImportesRef.abrirModal(l.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Ir,(0,d.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:a[2]||(a[2]=e=>{l.datafonoDisponible(),l.modalUltimosImportesRef.abrirModal(l.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",zr,(0,d.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1}))])]),(0,t.wy)((0,t._)("div",Rr,[(0,t._)("div",Or,[(0,t.Wm)(u,{miniMenu:"",ref:"CashlogyMiniMenuRef"},null,512)])],512),[[f.F8,l.Cashlogy_activado&&l.showMiniMenuCashlogy]])]),(0,t._)("div",Nr,[l.cesta&&l.cesta.lista.length&&"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&"DEVOLUCION"===l.cesta.modo?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"primary",class:"botonPagar",disabled:l.disabledBtns,onClick:a[5]||(a[5]=e=>l.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),$r])),_:1},8,["disabled"])):l.cesta&&l.cesta.lista.length&&"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"primary",class:"botonPagar",disabled:l.disabledBtns,style:(0,d.j5)((l.getTotal(l.cesta)-l.dejaCuenta).toFixed(2)>=3e3&&!l.cesta?.idCliente?"color: darkgray; border-color: darkgray;":""),onClick:a[6]||(a[6]=e=>l.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",Zr,(0,d.zw)((l.getTotal(l.cesta)-l.dejaCuenta).toFixed(2))+" € ",1)])),_:1},8,["disabled","style"])):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:2,onClick:a[7]||(a[7]=e=>l.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&l.cesta&&!l.cesta.lista.length?((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonPagar",onClick:a[8]||(a[8]=e=>l.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",qr,[(0,t.Uk)("("+(0,d.zw)(l.conexionInternet)+")(v"+(0,d.zw)(l.tocVersion)+") (",1),(0,t._)("a",Lr,(0,d.zw)(l.nombreTienda),1),(0,t.Uk)(") "+(0,d.zw)(l.getClock),1)])]),(0,t.Wm)(c,{ref:"modalCobroViewVueRef"},null,512),(0,t.Wm)(m,{ref:"modalUltimosImportesRef"},null,512)],64)}var Kr=o(76017);const Gr=e=>((0,t.dD)("data-v-66e63997"),e=e(),(0,t.Cn)(),e),Jr=Gr((()=>(0,t._)("div",{class:"d-inline text-center mx-auto pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"300"})],-1))),Qr=Gr((()=>(0,t._)("h2",{class:"text-center mb-3"},"Últimos Importes",-1))),Xr={key:0,class:"Resultados d-flex flex-column col-8 mx-auto"},es={class:"col-12"},as=["onClick"],os={class:"m-0"},ts={class:"m-0"},ls={class:"m-0"},ns={class:"m-0"},is={class:"tcodPos"},rs={class:"divMain"},ss=Gr((()=>(0,t._)("span",{class:"h3 mb-3"},"Información de PayTef",-1))),ds=Gr((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Datos de la transacción ",-1))),us={class:"info paytef col-10 mx-auto"},cs=Gr((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Información de transacción:")],-1))),ms={class:"m-0"},ps={class:"m-0"},vs={class:"m-0"},fs={class:"m-0"},gs={class:"m-0"},bs=Gr((()=>(0,t._)("hr",null,null,-1))),Cs={class:"info paytef col-10 mx-auto"},ws=Gr((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Datos bancarios:")],-1))),ys={class:"m-0"},hs={class:"m-0"},_s=Gr((()=>(0,t._)("span",{class:"h3 mb-3"},"Información del ticket",-1))),Ms=Gr((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Productos del ticket ",-1))),Ds={class:"col-12"},ks={class:"ms-2 me-auto"},Bs={class:"col-12"},xs={class:"text-truncate"},Ts={class:"ms-2"},Es={class:"ms-2 me-auto text-truncate"},As={class:"ms-2 me-auto mb-0"};function zs(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBIcon"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),f=(0,t.up)("MDBBadge"),g=(0,t.up)("MDBListGroupItem"),b=(0,t.up)("MDBListGroup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalUltimosImportes,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUltimosImportes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Datos del datáfono")])),_:1})])),_:1}),l.loading?((0,t.wg)(),(0,t.j4)(u,{key:0,style:{"align-self":"center"}},{default:(0,t.w5)((()=>[Jr])),_:1})):((0,t.wg)(),(0,t.j4)(u,{key:1},{default:(0,t.w5)((()=>[Qr,(l.importeEncontrado,(0,t.wg)(),(0,t.iD)("div",Xr,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.array,((e,a)=>((0,t.wg)(),(0,t.iD)("div",es,[(0,t._)("div",{class:"d-flex justify-content-between border border-2 p-2",style:(0,d.j5)([{"margin-bottom":"2%"},e.approved?"background-color:rgb(5 213 5 / 20%)":"background-color: rgb(227 100 100 / 20%)"]),onClick:o=>l.abrirModalDetallesImpote(a,e.reference)},[(0,t._)("p",os,"#"+(0,d.zw)(a+1),1),(0,t._)("p",ts,"Fecha: "+(0,d.zw)(e.timestamp),1),(0,t._)("p",ls,"Núm Ticket: "+(0,d.zw)(e.reference),1),(0,t._)("p",ns,"Precio: "+(0,d.zw)(e.amountWithSign)+" €",1),(0,t._)("div",null,[(0,t.Wm)(c,{icon:e.approved?"check-circle":"times-circle",style:(0,d.j5)(e.approved?"color: #33bf61":"color: red;")},null,8,["icon","style"])])],12,as)])))),256))]))])),_:1})),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t._)("p",is,"TCod: "+(0,d.zw)(l.tcod),1),(0,t.Wm)(m,{color:"secondary",onClick:a[0]||(a[0]=e=>l.modalUltimosImportes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalDetallesImporte,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalDetallesImporte=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" Ref. Paytef #"+(0,d.zw)(l.selectedTicket.reference),1)])),_:1}),l.selectedTicket.approved?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(m,{key:0,class:"ms-auto ms-4 modalHeader",color:"danger",onClick:a[2]||(a[2]=e=>l.tarjetaTicketById(l.selectedTicket.reference))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1}))])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",rs,[(0,t._)("div",null,[ss,ds,(0,t._)("div",us,[cs,(0,t._)("p",ms,[(0,t.Wm)(c,{icon:"server"}),(0,t._)("span",{style:(0,d.j5)(1==l.selectedTicket.approved?"color:seagreen;":"color:indianred;")},"   "+(0,d.zw)(1==l.selectedTicket.approved?"Aprobado ✓":"Denegado ✖"),5)]),(0,t._)("p",ps,[(0,t.Wm)(c,{icon:"calendar-alt"}),(0,t.Uk)("    "+(0,d.zw)(l.fechaImporte),1)]),(0,t._)("p",vs,[(0,t.Wm)(c,{icon:"question"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.typeName),1)]),(0,t._)("p",fs,[(0,t.Wm)(c,{icon:"clipboard-check"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.reference),1)]),(0,t._)("p",gs,[(0,t.Wm)(c,{icon:"euro-sign"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.amountWithSign)+" € ",1)])]),bs,(0,t._)("div",Cs,[ws,(0,t._)("p",ys,[(0,t.Wm)(c,{icon:"university"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.issuerNameAndCountry),1)]),(0,t._)("p",hs,[(0,t.Wm)(c,{icon:"credit-card"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.hiddenCardNumber),1)]),(0,t._)("p",null,[(0,t.Wm)(c,{icon:"globe-europe"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.country),1)])])]),(0,t._)("div",null,[_s,Ms,(0,t._)("div",Ds,[(0,t.Wm)(b,{light:"",class:"productos"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.productosArray,((e,a)=>((0,t.wg)(),(0,t.j4)(g,{class:"d-flex justify-content-between align-items-center"},{default:(0,t.w5)((()=>[(0,t._)("div",ks,[(0,t._)("div",Bs,[(0,t._)("span",xs,(0,d.zw)(e.nombre),1),(0,t._)("span",Ts,"x"+(0,d.zw)(e.unidades),1)]),null!=e.arraySuplementos?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",Es," - "+(0,d.zw)(e.nombre.replace("(","")),1)))),256)):(0,t.kq)("",!0),null!=e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(e.promocion.grupos.flat(),(a=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("p",As,(0,d.zw)(a.nombre)+" x"+(0,d.zw)(e.unidades*a.unidades),1)])))),256)):(0,t.kq)("",!0)]),(0,t.Wm)(f,{class:"badge-primary",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.subtotal)+" €",1)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])])])])),_:1}),(0,t.Wm)(p)])),_:1},8,["modelValue"])],64)}var Is=o(36797),Ss=o.n(Is),Hs={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_},setup(e,a){const o=(0,v.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,D.iH)([]),u=(0,D.iH)("cargando..."),c=(0,D.iH)(null),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Caja.arrayVentas)),f=(0,D.iH)(!0),g=(0,D.iH)(null);function b(e){g.value=e,l.value=!0,h()}async function C(){for(const e of m.value){let{year:a,month:o,day:t,hour:l,minute:n,second:i,millisecond:r}=e.timestamp,s=`${a}-${(o<10?"0":"")+o}-${(t<10?"0":"")+t} ${(l<10?"0":"")+l}:${(n<10?"0":"")+n}:${(i<10?"0":"")+i}.${(r<10?"0":"")+r}`;e["timestamp"]=s}}async function w(e,a){try{y.value=m.value[e],Ss().locale("es"),s.value=Ss()(new Date(y.value.timestamp)).format("LLL"),d.value=await(0,t.Fl)((()=>p.value.find((e=>e._id==a)).cesta.lista)).value,n.value=!0}catch(o){console.log(o)}}const y=(0,D.iH)(null);async function h(){await k.Z.post("paytef/getLastFive").then((async e=>{e.data&&(m.value=e.data.reverse(),await C(),f.value=!1)}))}function _(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function M(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}function B(e){k.Z.post("paytef/cobrarTicketById",{idTrabajador:g.value.idTrabajador,idTicket:e}).then((()=>{o.dispatch("Datafono/setEstado","PENDIENTE"),l.value=!1,n.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:b}),(0,t.bv)((async()=>{u.value=await k.Z.post("parametros/getParametros").then((e=>e.data.payteftcod))})),{modalUltimosImportes:l,importeEncontrado:i,importe:r,tcod:u,fecha:c,array:m,productosArray:d,modalDetallesImporte:n,abrirModalDetallesImpote:w,selectedTicket:y,fechaImporte:s,loading:f,recortarNombreArtPrinc:_,recortarNombreArtSec:M,tarjetaTicketById:B,trabajadorActivo:g}}};const Ps=(0,A.Z)(Hs,[["render",zs],["__scopeId","data-v-66e63997"]]);var Fs=Ps,Us=o(69523),js={name:"MenuDerechaComponent",components:{MDBIcon:M.vm,MDBBtn:M.$v,MDBSelect:M.R3,modalCobroViewVue:Kr.Z,modalUltimosImportes:Fs,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,CashlogyMenuNotificaciones:Us.Z},setup(){const e=(0,D.iH)(""),a=(0,D.iH)(""),o=(0,D.iH)(""),l=(0,v.oR)(),n=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,Ta.tv)(),s=(0,D.iH)([]),d=(0,t.Fl)((()=>l.state.Cestas.Descuento)),u=(0,t.f3)("resetGeneral"),c=(0,D.iH)(""),m=(0,D.iH)(null),p=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),f=(0,D.iH)(null),g=(0,t.Fl)((()=>!(!f.value?.mini_menu_activo||!(n.value||["ONLINE","OFFLINE","BUSCANDO"].indexOf(B.value)>=0)))),b=(0,D.iH)(!1);(0,t.bv)((async()=>{b.value=await(f.value?.activado())}));const C=(0,t.Fl)((()=>{if(l.state.ModalCobroView.modalCobroViewAbierto)return!0}));(0,t.m0)((()=>{C.value&&i.value.abrirModal()}));let w=!1;async function y(){if(!w){try{let e=(await k.Z.post("checkers/internet_with_pings")).data;c.value=e?"🟢":"🔴"}catch(e){}setTimeout(y,1e4)}}(0,t.Ah)((()=>{w=!0})),y();const h=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),_=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),M=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),B=(0,t.Fl)((()=>l.state.Datafono.estado)),T=(0,t.Fl)((()=>l.state.Datafono.procesoActual)),E=(0,t.Fl)((()=>l.state.modoActual)),A=(0,t.Fl)((()=>h.value&&void 0!=M.value&&null!=M.value&&h.value[M.value]?h.value[M.value]:null)),z=(0,t.Fl)((()=>{if(_.value)for(let e=0;e<_.value.length;e++)if(h.value&&h.value[M.value]&&_.value[e]._id==h.value[M.value].idCesta)return _.value[e];return null})),I=(0,t.Fl)((()=>l.state.Deudas.deudasSeleccionadas)),S=(0,t.Fl)((()=>l.state.Encargos.encargoSeleccionado)),H=(0,t.Fl)((()=>{if(I.value.length>0){let e=0;for(const a of I.value)a.dejaCuenta&&(e+=a.dejaCuenta);return e}return S.value&&"RECOGER ENCARGO"==z?.value?.modo&&S.value.dejaCuenta||0})),P=(0,D.iH)(!1);function F(e){l.dispatch("Trabajadores/setIndexActivo",Number(e.target.value)),R("/main")}function U(e){let a=0;return e.forEach((e=>{a+=e.subtotal})),a=Math.round(100*a)/100,a}function j(e){const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Number(o.toFixed(2))}function W(){k.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function V(){"PENDIENTE"!=B.value&&(l.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((e=>l.dispatch("Datafono/setEstado",e.data))).catch((e=>l.dispatch("Datafono/setEstado","OFFLINE"))))}function R(e){r.push(e)}function O(){let e=!1;z.value&&z.value.lista.length>0&&z.value.lista.forEach((a=>{if(a?.regalo)return e=!0,void Z()})),e||(k.Z.post("impresora/abrirCajon"),x().fire("AVISO","elige un artículo para ir a cobrar","info"))}function N(){k.Z.post("articulos/saveTeclas"),l.dispatch("setModoActual","NORMAL")}function $(){k.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:A.value._id}).then((()=>{l.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function Z(){if((j(z.value)-H.value).toFixed(2)>=3e3&&!z.value?.idCliente)return x().fire({title:"Cliente Requerido",text:"Para cobrar mas de 3000€, debe seleccionar un cliente de facturación.",icon:"info"});if(!l.state.Procesando.clickTecla)if(Y(),z.value.idCliente&&"RECOGER ENCARGO"!==z.value.modo)try{const{nombreCliente:e,lista:a,_id:o,idCliente:t}=z.value,l=U(a);if("Too Good To Go Spain S.L.U. "===e){if(l<12)return void x().fire({title:"Promoción Requerida",text:"Para proceder con el cobro, debe aplicar la promoción 3.99€ del Too Good To Go. El importe mínimo es de 12€",icon:"warning"});3.99!==l&&await k.Z.post("/cestas/recalcularIvas",{idCesta:o})}q()}catch(e){q()}else q()}async function q(){if((j(z.value)-H.value).toFixed(2)>=3e3&&!z.value?.idCliente)return x().fire({title:"Cliente Requerido",text:"Para cobrar mas de 3000€, debe seleccionar un cliente de facturación.",icon:"info"});const e=JSON.parse(JSON.stringify(z.value.lista));try{if(z.value){const a=j(z.value);if("VENTA"===z.value.modo||"RECOGER ENCARGO"==z.value.modo)if(z.value.idCliente&&""!=z.value.idCliente){const e=(await k.Z.post("clientes/getClienteById",{idCliente:z.value.idCliente})).data;e?.albaran&&e?.noPagaEnTienda?k.Z.post("albaranes/crearAlbaran",{total:a,cestaFrontEnd:z.value,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");x().fire({icon:"success",title:"Albaran registrada correctamente",showConfirmButton:!1,timer:1500}),await k.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{x().fire("Oops...",e.message,"error")}))})).catch((e=>{x().fire("Oops...",e.message,"error")})):e?.noPagaEnTienda?k.Z.post("tickets/crearTicket",{total:a,idCesta:z.value._id,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA",tipo:"DEUDA",tkrsData:null}).then((e=>{if(!e.data)throw Error("No se ha podida registrar la venta en modo deuda");x().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:1500})})):(await k.Z.post("impresora/abrirCajon"),i.value.abrirModal())}else e.every((e=>e.pagado))?k.Z.post("tickets/crearTicket",{total:a,idCesta:z.value._id,idTrabajador:A.value._id,tipo:"HONEI",tkrsData:null}):(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal());else"DEVOLUCION"===z.value.modo?k.Z.post("devoluciones/nuevaDevolucion",{total:a,idCesta:z.value._id,idTrabajador:A.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await x().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),u()})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===z.value.modo&&0==a?k.Z.post("tickets/crearTicket",{total:a,idCesta:z.value._id,idTrabajador:A.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");x().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"==z.value.modo&&a>0&&(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal())}else x().fire("Oops...","El modo de la cesta es incorrecto","error")}catch(a){}finally{setTimeout((()=>{L()}),500)}}function L(){P.value=!1}function Y(){P.value=!0}function K(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),l=e.getHours();o.value=("0"+l).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(K,1e3),(0,t.bv)((async()=>{W(),V(),k.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{x().fire("Error en getVersion CATCH")})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.tipoDatafono?"3G"==e.data?.tipoDatafono&&(n.value=!0):n.value=!1}))})),{trabajadorActivo:A,DescuentoCliente:d,estadoDatafono:B,DescuentoCliente:d,cesta:z,arrayMesas:s,getTotal:j,goTo:R,abrirCajon:O,tarjetaUltimoTicket:$,modoActual:E,handleCobro:q,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:N,datafonoDisponible:V,procesoDatafono:T,use3g:n,selectDependienta:F,modalCobroViewVueRef:i,arrayTrabajadores:h,conexionInternet:c,modalUltimosImportesRef:m,handleCobroCondicional:Z,abrirModalCobroView:C,indiceTrabajadorActivo:p,disabledBtns:P,enableBtns:L,disableBtns:Y,CashlogyMiniMenuRef:f,showMiniMenuCashlogy:g,Cashlogy_activado:b,dejaCuenta:H}}};const Ws=(0,A.Z)(js,[["render",Yr],["__scopeId","data-v-4365756e"]]);var Vs=Ws,Rs=o(32066),Os=o(48466);const Ns={class:"container"},$s={class:"h3 text-center"},Zs={key:0,class:"row mt-2 container"},qs=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),Ls={class:"h5",style:{"text-align":"center"}},Ys={key:1,class:"row mt-2 container"},Ks={class:"h3"},Gs={key:0,class:"d-inline text-center grupoContento pt-1"},Js=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),Qs=[Js],Xs={key:1,class:"h5",style:{"text-align":"center",color:"red"}},ed={class:"again py-5"},ad={class:"again py-5"};function od(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal"),c=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:l.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ns,[(0,t._)("p",$s,(0,d.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),l.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",Zs,[qs,(0,t._)("span",Ls,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,d.zw)(l.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),l.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Ys,[(0,t._)("p",Ks,(0,d.zw)(e.$t("seleccione","seleccione"))+":",1),l.tryCount>0?((0,t.wg)(),(0,t.iD)("div",Gs,Qs)):(0,t.kq)("",!0),l.tryCount>3?((0,t.wg)(),(0,t.iD)("span",Xs,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),l.tryCount<=0?((0,t.wg)(),(0,t.j4)(r,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>l.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",ed,(0,d.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(r,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>l.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",ad,(0,d.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var td={name:"modalDatafonoConexion",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalErrorDatafonoQueHacerComponent:Os.Z},setup(e,{expose:a}){const o=(0,D.iH)(0),l=(0,D.iH)(!0),n=(0,D.iH)(0),i=(0,D.iH)(null),r=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,v.oR)(),d=(0,D.iH)(0),u=(0,D.iH)(!1),c=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>c.value&&void 0!=m.value&&null!=m.value&&c.value[m.value]?c.value[m.value]:null));function p(e){d.value=e,u.value=!0,g(),s.dispatch("Datafono/setEstado","OFFLINE")}async function f(){try{x().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){await k.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});x().fire("OK","¡El datáfono se ha apagado correctamente!","success"),u.value=!1}}))}catch(e){x().fire("Oops...",e.message,"error")}}async function g(){l.value=!0,n.value=60;let e=!1,a=!1,o=setInterval((async()=>{e||(n.value-=1,await k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async t=>{e||"ONLINE"===t.data&&(s.dispatch("Datafono/setEstado","ONLINE"),a||(a=!0,await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((a=>{e||(clearInterval(o),e=!0,i.value.abrirModal(d.value,a.data),u.value=!1)})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),a=!1))})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),e||n.value<=0&&(clearInterval(o),e=!0,x().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),l.value=!1))}),1e3)}async function b(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async e=>"OFFLINE"===e.data&&o.value<10?b():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((e=>{i.value.abrirModal(d.value,e.data),u.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:u,apagarDatafono:f,reconectarDatafon:b,estadoDatafono:r,tryCount:o,ModalErrorQueHacerRef:i,conexionAutomatica:l,counterAutomatico:n}}};const ld=(0,A.Z)(td,[["render",od]]);var nd=ld,id=(o(25994),{name:"MainView",components:{MenusComponent:P,SubmenusComponent:N,TeclasComponent:za,CestaComponent:yo,MenuIzquierdaComponent:hr,MenuDerechaComponent:Vs,modalDatafonoConexion:nd,ModalErrorDatafonoVentaComponent:Os.Z},setup(){const e=(0,Ta.tv)(),a=(0,D.iH)(null),o=(0,D.iH)(null),l=(0,D.iH)(null),n=(0,D.iH)(null),i=(0,D.iH)(null);function r(e){a.value.clickTecla(e)}const s=(0,v.oR)(),d=(0,Rs.io)("http://"+s.state.TocGameURL+":5051"),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>u.value&&void 0!=c.value&&null!=c.value&&u.value[c.value]?u.value[c.value]:null));function p(){o.value.resetGeneral()}function f(){l.value.actualizarPuntos()}function g(e){a.value.postDisabledTecla(e)}return(0,t.JJ)("clickTecla",r),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",f),(0,t.JJ)("postDisabledTecla",g),d.on("consultaPaytefRefund",(e=>{try{e.ok}catch(a){}})),d.on("consultaPaytef",(e=>{e.valid})),(0,t.bv)((async()=>{k.Z.get("caja/estadoCaja").then((a=>{1==a.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id&&e.push("/menu/fichajes"):e.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:u,indexTrabajadorActivo:c,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:l,modalErrorConexionDatafonoRef:n,modalErrorVentaDatafonoRef:i}}});const rd=(0,A.Z)(id,[["render",s]]);var sd=rd}}]);
//# sourceMappingURL=571.9535ebb5.js.map