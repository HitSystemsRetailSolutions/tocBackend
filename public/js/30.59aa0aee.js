"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[30],{48466:function(e,a,o){o.d(a,{Z:function(){return D}});var t=o(73396),n=o(87139);const l={class:"container"},i={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},d={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},c={class:"again py-5"},m={class:"again py-5"},p={class:"again py-5"};function f(e,a,o,f,v,g){const b=(0,t.up)("MDBBtn"),w=(0,t.up)("MDBModalBody"),h=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(h,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:f.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[4]||(a[4]=e=>f.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[(0,t._)("div",l,[1==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago fallido ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",d,[1==f.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>f.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,n.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),f.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:f.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{f.tarjetaUltimoTicket(),f.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",c,(0,n.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),f.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>f.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,n.zw)(e.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,t.kq)("",!0),f.ticketExist>2?((0,t.wg)(),(0,t.j4)(b,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:a[3]||(a[3]=e=>f.esborrarTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",p,(0,n.zw)(e.$t("anular","Anular ticket")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}o(57658);var v=o(20065),g=o(91076),b=o(74313),w=o(42492),h=o.n(w),C=o(44870),y={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,C.iH)(null),n=(0,C.iH)(0),l=(0,C.iH)(!1),i=(0,v.oR)(),r=(0,C.iH)(!1),s=(0,t.Fl)((()=>i.state.Trabajadores.arrayTrabajadores));let d=(0,C.iH)(!1);const u=(0,t.Fl)((()=>i.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>s.value&&void 0!=u.value&&null!=u.value&&s.value[u.value]?s.value[u.value]:null));function m(e,a){if(4==a)return h().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,n.value=a,r.value=!0}async function p(){await g.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,i.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{r.value=!0,h().fire("Oops...",e.message,"error")})),h().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function f(){null!=o.value&&(await w()?g.Z.post("tickets/anularTicket",{ticketId:o.value}).then((e=>{r.value=!1,e.data.res&&["EFECTIVO","DATAFONO_3G"].includes(e.data.tipo)?(l.value&&b(),h().fire({icon:"success",title:"Ticket anulado"+(l.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):e.data.res?router.push("/main"):h().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((e=>{h().fire(e.message)})):h().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function b(){g.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((e=>{h().fire("Oops...",e.message,"error")}))}async function w(){return await h().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async e=>!!e.isConfirmed))}function y(){d.value=!0,g.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,d.value=!1,i.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{d.value=!1,r.value=!0,h().fire("Oops...",e.message,"error")})),d.value=!1,h().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function _(){h().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return a({abrirModal:m}),(0,t.bv)((async()=>{const{data:e}=await g.Z.post("parametros/getParametros");l.value="Si"==e.params?.TicketAlAnular})),{store:i,darComoValido:p,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:y,esperandoConexion:d,TicketAlAnular:l,arrayTrabajadores:s,indexTrabajadorActivo:u,esborrarTicket:f,idSeleccionado:o,pagoDependienta:_,ticketExist:n}}},_=o(40089);const M=(0,_.Z)(y,[["render",f],["__scopeId","data-v-266e01f8"]]);var D=M},34004:function(e,a,o){o.r(a),o.d(a,{default:function(){return zu}});var t=o(73396);const n={class:"row mt-1"},l={class:"col-md-3"},i={class:"col-md-6"},r={class:"col-md-3"};function s(e,a,o,s,d,u){const c=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),f=(0,t.up)("MenuIzquierdaComponent"),v=(0,t.up)("CestaComponent"),g=(0,t.up)("MenuDerechaComponent"),b=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",n,[(0,t._)("div",l,[(0,t.Wm)(f,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(v,{ref:"cestaRef"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(g)])]),(0,t.Wm)(b,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(57658);var d=o(87139);const u={class:"row",id:"menu",style:{"margin-top":"1px"}},c={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,n,l,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",u,[(0,t._)("div",c,["MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[0]||(a[0]=e=>n.ModalCrearMenusRef.abrirModal(null)),class:"newMenu btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"}," + Nuevo ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,style:(0,d.j5)(a==n.activo?"  background-color: #d45600 !important;color: #fffaee !important;border-color: #d45600 !important;":""),class:"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan",onClick:e=>n.setActivo(a)},(0,d.zw)(e.nombre),13,m)))),128))])]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var f=o(20065),v=o(49242);const g=e=>((0,t.dD)("data-v-5474bf1b"),e=e(),(0,t.Cn)(),e),b={class:"row"},w={key:0},h=g((()=>(0,t._)("br",null,null,-1))),C={class:"row"};function y(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),f=(0,t.up)("MenusComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalCrearMenus",tabindex:"-1",labelledby:"modalCrearMenus",modelValue:n.modalCrearMenus,"onUpdate:modelValue":a[4]||(a[4]=e=>n.modalCrearMenus=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",b,[n.isSubmenu?((0,t.wg)(),(0,t.iD)("label",w,[(0,t.Uk)("Nombre del menu "),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(n.createProductCheckFields&&""==n.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombreMenu=e)},null,4),[[v.nr,n.nombreMenu]])])):(0,t.kq)("",!0),h,(0,t._)("label",null,[(0,t.Uk)("Nombre del Submenú "+(0,d.zw)(""!==n.nombreMenu?"para ":"")+" ",1),(0,t._)("b",null,(0,d.zw)(""!==n.nombreMenu?n.nombreMenu:""),1),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(n.createProductCheckFields&&""==n.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>n.nombreSubMenu=e)},null,4),[[v.nr,n.nombreSubMenu]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>n.crearMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear menu")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[3]||(a[3]=e=>n.modalCrearMenus=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(p,{id:"modalEditarMenu",tabindex:"-1",labelledby:"modalEditarMenu",modelValue:n.modalEditarMenu,"onUpdate:modelValue":a[9]||(a[9]=e=>n.modalEditarMenu=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",C,[(0,t._)("label",null,[(0,t.Uk)("Elija un nuevo nombre "+(0,d.zw)(n.editarEsMenu)+" ",1),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[5]||(a[5]=e=>n.editarNombreTxt=e)},null,512),[[v.nr,n.editarNombreTxt]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[6]||(a[6]=e=>n.editarEsMenu?n.editMenuName():n.editSubMenuName())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[7]||(a[7]=e=>n.editarEsMenu?n.deleteAllProductsMenu():n.deleteAllProductsSubMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Eliminar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[8]||(a[8]=e=>n.modalEditarMenu=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"MenusComponentRef"},null,512)],64)}var _=o(74834),M=o(74313),D=o(44870),k=o(91076),B=o(42492),x=o.n(B),T={name:"ModalCrearProductoMenus",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MenusComponent:H},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(!1),s=(0,D.iH)(!1),d=(0,D.iH)(!1),u=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),c=(0,D.iH)(!1),m=(0,D.iH)(""),p=(0,D.iH)(!1),v=(0,D.iH)(null),g=(0,D.iH)(0),b=(0,D.iH)(null);async function w(e){s.value=null==e,l.value=null==e?"":e,n.value=!0}async function h(){if(""==l.value||""==i.value&&d.value)return r.value=!0,void x().fire("Oops...","Algún campo está vacío o es incorrecto.","error");let e=l.value,a=Number(u.value.length);s.value&&(a+=1);let o=1==a.toString().length?"0"+a:a;d.value&&(e=`[${l.value}]${o} ${i.value}`),k.Z.post("articulos/anadirProducto",{nombreArticulo:"Producto por defecto",precioConIva:0,esSumable:!1,precioBase:0,tipoIva:0,menus:e,posicion:0,articuloExistente:!1}).then((e=>{x().fire("Menú creado","Se ha creado el menú correctamente","success"),_.W.cargarTeclado(),n.value=!1}))}async function C(e,a,o){1==o&&(m.value=e.nombre.substring(3)),0==o&&(m.value=e.nombre),p.value=0==o,g.value=a,v.value=e,c.value=!0}async function y(){let e=v.value,a=m.value;for(let o=0;o<u.value.length;o++)if(u.value[o].nombre.toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let o=0;o<e.arraySubmenus.length;o++)for(let t=0;t<e.arraySubmenus[o].arrayTeclas.length;t++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arraySubmenus[o].arrayTeclas[t].idArticle,nuevaPos:e.arraySubmenus[o].arrayTeclas[t].pos,nombreMenu:`[${a}]${e.arraySubmenus[o].nombre}`});x().fire("Menú editado","Se ha editado el menú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function M(){let e=v.value,a=m.value,o=g.value.value+1,t=1==o.toString().length?"0"+o:o,n=u.value[o-1].nombre;if(e.nombre.split(" ")[1].toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let l=0;l<e.arrayTeclas.length;l++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arrayTeclas[l].idArticle,nuevaPos:e.arrayTeclas[l].pos,nombreMenu:`[${n}]${t} ${a}`});x().fire("Submenú editado","Se ha editado el submenú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function B(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((e=>{if(e.isDismissed)return;let a=v.value;for(let o=0;o<4;o++)for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e].idArticle});o.dispatch("Teclado/setIndexMenuActivo",0),c.value=!1,_.W.cargarTeclado(),x().fire("Submenú eliminado","Se ha eliminado el Submenú correctamente","success")}))}async function T(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((async e=>{let a=v.value;if(!e.isDismissed){if(a.arraySubmenus?.length&&a.arraySubmenus?.length>0)for(let e=0;e<4;e++)for(let o=0;o<a.arraySubmenus?.length;o++)for(let e=0;e<a.arraySubmenus[o]?.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arraySubmenus[o]?.arrayTeclas[e]?.idArticle});else for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e]?.idArticle});await o.dispatch("Teclado/setIndexMenuActivo",0),_.W.cargarTeclado(),c.value=!1,x().fire("Menú eliminado","Se ha eliminado el menú correctamente","success")}}))}return a({openEditModal:C,abrirModal:w}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.DosNivells?"Si"==e.data?.DosNivells&&(d.value=!0):d.value=!1}))})),{modalCrearMenus:n,nombreMenu:l,nombreSubMenu:i,abrirModal:w,editMenuName:y,deleteAllProductsMenu:T,deleteAllProductsSubMenu:B,createProductCheckFields:r,crearMenu:h,MenusComponentRef:b,isSubmenu:s,editarMenuTeclado:v,editarEsMenu:p,haveSubmenu:d,modalEditarMenu:c,editSubMenuName:M,editarNombreTxt:m,editarTagCount:g}}},E=o(40089);const A=(0,E.Z)(T,[["render",y],["__scopeId","data-v-5474bf1b"]]);var I=A,z={name:"MenusComponent",components:{ModalCrearProductoMenus:I},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),l=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.modoActual)),r=(0,D.iH)(null),s=(0,D.iH)(-1);function d(e){e==s.value&&"MODIFICAR_ARTICULO"==i.value&&r.value.openEditModal(n.value[e],e,0),s.value=e,o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{d(0)})),a({setActivo:d,indexMenuActivo:l}),{teclado:n,indexMenuActivo:l,setActivo:d,activo:s,modoActual:i,ModalCrearMenusRef:r}}};const S=(0,E.Z)(z,[["render",p],["__scopeId","data-v-2687fc6f"]]);var H=S;const F={class:"row",id:"submenu",style:{"margin-top":"1px","margin-right":"0px"}},P={key:0,class:"btn-group shadow-none",role:"group"},N={key:0},U=["onClick"];function j(e,a,o,n,l,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",F,[n.teclado&&n.teclado[n.indexMenuActivo]&&n.teclado[n.indexMenuActivo].arraySubmenus&&n.teclado[n.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",P,["MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.iD)("div",N,[(0,t._)("button",{onClick:a[0]||(a[0]=e=>n.ModalCrearMenusRef.abrirModal(n.teclado[n.indexMenuActivo].nombre)),class:"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100 newSubMenu"}," + Nuevo ")])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.teclado[n.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t._)("button",{class:(0,d.C_)([{activo:a==n.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>n.setIndexSubmenu(a)},(0,d.zw)(e.nombre),11,U)])))),128))])):(0,t.kq)("",!0)]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var O={name:"SubmenusComponent",components:{ModalCrearProductoMenus:I},setup(){const e=(0,f.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),n=(0,D.iH)(null),l=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo)),i=(0,t.Fl)((()=>e.state.modoActual)),r=(0,D.iH)(0);function s(t){t==r.value&&"MODIFICAR_ARTICULO"==i.value&&n.value.openEditModal(a.value[o.value].arraySubmenus[t],o,1),r.value=t,e.dispatch("Teclado/setIndexSubmenuActivo",t)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:l,setIndexSubmenu:s,modoActual:i,ModalCrearMenusRef:n}}};const W=(0,E.Z)(O,[["render",j],["__scopeId","data-v-4386dc8f"]]);var R=W;const V={key:0},$={key:1},Z=["onClick"];function q(e,a,o,n,l,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBtn"),u=(0,t.up)("PesoComponent"),c=(0,t.up)("SuplementosComponent"),m=(0,t.up)("ModalEditarProducto"),p=(0,t.up)("ModalCrearProducto"),f=(0,t.up)("ModalAlergenosVue"),v=(0,t.up)("ModalVaris");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[n.arrayTeclas&&n.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,l)=>(0,t._)("div",{class:(0,d.C_)(["col",[n.teclado[n.indexMenuActivo]?.arraySubmenus&&n.teclado[n.indexMenuActivo]?.arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:l},[n.arrayTeclas[l+6*o].idArticle?((0,t.wg)(),(0,t.j4)(s,{key:0,disabled:n.disabledTeclas,onMousedown:e=>n.startPress(n.arrayTeclas[l+6*o],e),onMouseup:e=>n.endPress(n.arrayTeclas[l+6*o],e),onTouchstartPassive:e=>n.startPress(n.arrayTeclas[l+6*o],e),onTouchendPassive:e=>n.endPress(n.arrayTeclas[l+6*o],e),class:(0,d.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[n.teclado[n.indexMenuActivo]?.arraySubmenus&&n.teclado[n.indexMenuActivo]?.arraySubmenus.length>0?"teclasConSubmenu":"teclas"]]),style:(0,d.j5)({"background-color":"#"+n.arrayTeclas[l+6*o].color.toString(16),color:n.getTextColor("#"+n.arrayTeclas[l+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{icon:n.arrayTeclas[l+6*o].esSumable?"":"balance-scale"},null,8,["icon"]),(0,t.Uk)("  "+(0,d.zw)(n.arrayTeclas[l+6*o].nombreArticulo)+" ",1),n.precioTecla&&0==n.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",V,(0,d.zw)(n.arrayTeclas[l+6*o]?.precioConIva?.toFixed(2))+"€ ",1)):n.precioTecla&&1==n.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",$,(0,d.zw)((Math.round(100*n.arrayTeclas[l+6*o]?.precioBase)/100).toFixed(2))+"€ ",1)):(0,t.kq)("",!0),n.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:2,class:"stock",style:(0,d.j5)({fontSize:(n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.fontSize||3.5)+"px",color:n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.fontColor})},(0,d.zw)(void 0!==n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.stock?n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:2},1032,["disabled","onMousedown","onMouseup","onTouchstartPassive","onTouchendPassive","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,d.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==n.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==n.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==n.isEditarArticulos(!1)},null==n.teclado[n.indexMenuActivo]?.arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>n.editarArticulo(n.arrayTeclas[l+6*o].pos)},(0,d.zw)(e.$t("vacio","Vacío"))+" "+(0,d.zw)(n.isEditarArticulos(!0)),11,Z))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(u,{ref:"modalPesoRef"},null,512),(0,t.Wm)(c,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(m,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(p,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(f,{ref:"modalAlergenosRef"},null,512),(0,t.Wm)(v,{ref:"modalVarisRef"},null,512)],64)}const L=e=>((0,t.dD)("data-v-7d1b1c95"),e=e(),(0,t.Cn)(),e),Y=L((()=>(0,t._)("div",{"data-v-95b64bf4":"",class:"modal-header"},[(0,t._)("h5",{"data-v-95b64bf4":"",class:"modal-title",id:"staticBackdropLabel"}," Introduce los gramos ")],-1))),G={class:"row"},K={class:"row"};function J(e,a,o,n,l,i){const r=(0,t.up)("MDBInput"),s=(0,t.up)("NumpadComponent"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:n.modalPeso,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalPeso=e),staticBackdrop:"",onShow:n.onModalShow,onShown:n.onModalShown,onHide:n.onModalHide,onHidden:n.onModalHidden},{default:(0,t.w5)((()=>[Y,(0,t.Wm)(u,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",G,[n.numpadRef&&n.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(r,{key:0,modelValue:n.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>n.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",K,[((0,t.wg)(),(0,t.j4)(s,{disabled:n.isTransitioning,ref:"numpadRef",key:n.modalPeso},null,8,["disabled"]))])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[1]||(a[1]=e=>n.closeModal()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>n.insertarArticulo(n.numpadRef.cantidad))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onShow","onShown","onHide","onHidden"])}var Q=o(33727),X={name:"PesoComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBInput:M.u2,NumpadComponent:Q.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),n=(0,f.oR)(),l=(0,t.Fl)((()=>n.state.Teclado.objTeclado)),i=(0,t.Fl)((()=>n.state.Teclado.indexMenuActivo)),r=(0,D.iH)(null),s=(0,D.iH)({idArticulo:null,idCesta:null,nombre:""}),d=(0,D.iH)(!0),u=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo));function m(e,a,t){s.value.idArticulo=e,s.value.idCesta=a,s.value.nombre=t,setTimeout((()=>{o.value=!0}),1)}function p(){o.value=!1}function v(e){k.Z.post("teclado/clickTeclaArticulo",{idArticulo:s.value.idArticulo,gramos:e,idCesta:s.value.idCesta,unidades:1,arraySuplementos:null,nombre:s.value.nombre,menu:l.value[i.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(s.value.nombre),worker:encodeURIComponent(u.value[c.value].nombre)}}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");s.value.idArticulo=null,s.value.idCesta=null,o.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function g(){d.value=!0}function b(){d.value=!1}function w(){d.value=!0}function h(){d.value=!1}function C(){}return a({abrirModal:m}),(0,t.JJ)("okValue",v),{modalPeso:o,numpadRef:r,closeModal:p,infoArticulo:s,test:C,insertarArticulo:v,isTransitioning:d,onModalShow:g,onModalShown:b,onModalHide:w,onModalHidden:h}}};const ee=(0,E.Z)(X,[["render",J],["__scopeId","data-v-7d1b1c95"]]);var ae=ee;const oe=e=>((0,t.dD)("data-v-4c3afa16"),e=e(),(0,t.Cn)(),e),te={class:"row"},ne=["onClick"],le=oe((()=>(0,t._)("br",null,null,-1))),ie={key:0},re={key:1},se={class:"row"},de={key:0,class:"table-responsive divCesta reverso"},ue={class:"table colorFuente"},ce={class:"tableBody"},me=["onClick"],pe={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}},fe={key:0},ve={key:1};function ge(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:n.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,d.zw)(n.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(u,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",te,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,d.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:n.checkSuplementoActivo(e._id)}]]),onClick:a=>n.addSuplemento(e)},[(0,t.Uk)((0,d.zw)(e.nombre)+" ",1),le,n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("span",ie,(0,d.zw)(e.precioBase)+" €",1)):n.precioTecla&&!n.albaran?((0,t.wg)(),(0,t.iD)("span",re,(0,d.zw)(e.precioConIva.toFixed(2)),1)):(0,t.kq)("",!0)],10,ne)])))),128))]),(0,t._)("div",se,[n.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",de,[(0,t._)("table",ue,[(0,t._)("tbody",ce,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{seleccionado:n.itemSeleccionado===a}]),onClick:e=>n.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",pe,(0,d.zw)(e.nombre),1)]),n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("td",fe,(0,d.zw)(e.precioBase)+" €",1)):!n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("td",ve,(0,d.zw)(e.precioConIva.toFixed(2))+" € ",1)):(0,t.kq)("",!0)],10,me)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[0]||(a[0]=e=>n.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(c,{color:"secondary",onClick:a[1]||(a[1]=e=>n.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>n.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var be={name:"SuplementosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d={idArticulo:null,idCesta:null,cliente:null,suplementos:null},u=(0,D.iH)(!1),c=(0,D.iH)([]),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),v=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let g=0;const b=(0,t.Fl)((()=>{if(c.value&&c.value.length>0){let e=0;for(let a=0;a<c.value.length;a++)e+=c.value[a].precioConIva;return e}return 0})),w=(0,D.iH)(!1);async function h(e,a,t,l,i,r){d.idArticulo=e,d.idCesta=a,d.cliente=t,g=i,w.value=r;const s=await k.Z.post("articulos/getSuplementos",{arrayIdSuplementos:l});if(!s)throw Error("No se ha podido obtener la lista de suplementos");m.value=s.data,m.value.sort(((e,a)=>e.nombre.localeCompare(a.nombre))),o.dispatch("Unidades/setUnidades",1),n.value=!0}function C(e){try{c.value.push(e)}catch(a){x().fire("Oops...",a.message,"error")}}function y(e){const a=c.value.findIndex((a=>a.suplemento===e));return-1!==a}function _(e){i.value=e}function M(){c.value.splice(i.value,1)}async function B(){n.value=!1;try{let e;for(let a=0;a<g;a++)e=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.idArticulo,gramos:0,idCesta:d.idCesta,unidades:1,arraySuplementos:c.value,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(d.idArticulo),worker:encodeURIComponent(p.value[v.value].nombre)}});if(d.idArticulo=null,d.idCesta=null,c.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos")}catch(e){x().fire("Oops...",e.message,"error")}}function T(){}return a({abrirModal:h}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(u.value=!0):u.value=!1}))})),(0,t.JJ)("okValue",B),{modalSuplementos:n,addSuplemento:C,checkSuplementoActivo:y,numpadRef:l,arrayCompletoSuplementos:m,suplementosSeleccionados:c,itemSeleccionado:i,insertarArticulo:B,setIndex:_,eliminarActivo:M,totalSuplementos:b,test:T,precioTecla:u,albaran:w}}};const we=(0,E.Z)(be,[["render",ge],["__scopeId","data-v-4c3afa16"]]);var he=we;const Ce=e=>((0,t.dD)("data-v-2ed020f2"),e=e(),(0,t.Cn)(),e),ye={class:"row"},_e={for:"nombre"},Me=Ce((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),De=["value"],ke=Ce((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Be=Ce((()=>(0,t._)("option",{value:"true"},"Si",-1))),xe=Ce((()=>(0,t._)("option",{value:"false"},"No",-1))),Te=[Be,xe],Ee={for:"precioIva"};function Ae(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:n.modalEditarProd,"onUpdate:modelValue":a[8]||(a[8]=e=>n.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",ye,[(0,t._)("label",_e,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e)},null,512),[[v.nr,n.nombre]])]),Me,(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[1]||(a[1]=e=>n.tipoIva=e),class:"form-control"},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.tiposIva,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.iva,value:parseInt(e.tipus)},(0,d.zw)(e.iva)+"% ",9,De)))),128))],512),[[v.bM,n.tipoIva]]),ke,(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[2]||(a[2]=e=>n.esSumable=e),class:"form-control"},Te,512),[[v.bM,n.esSumable]]),(0,t._)("label",Ee,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(n.tiposIva[n.tipoIva-1].iva))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>n.precioConIva=e)},null,512),[[v.nr,n.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>n.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[5]||(a[5]=e=>n.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[6]||(a[6]=e=>n.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(c,{color:"secondary",size:"lg",onClick:a[7]||(a[7]=e=>n.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ie={name:"ModalEditarProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(0),l=(0,D.iH)(!1),i=(0,D.iH)(0),r=(0,D.iH)(0),s=o.getters["TiposIva/getTiposIva"],d=(0,D.iH)(""),u=(0,D.iH)(-1),c=(0,D.iH)(""),m=(0,D.iH)(!0);async function p(){await k.Z.post("articulos/editarArticulo",{idArticulo:u.value,nombre:d.value,precioBase:parseFloat(i.value)/parseFloat(r.value),precioConIva:parseFloat(i.value),tipoIva:r.value,essumable:JSON.parse(m.value)}).then((e=>{l.value=!1,x().fire("Producto guardado","Producto guardado correctamente","success"),_.W.cargarTeclado()}))}function v(){l.value=!1}function g(){l.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function b(e,a){await k.Z.post("articulos/moverArticulo",{id:u.value,posicion:e,menu:a}).then((a=>{x().fire("Producto establecido","Se ha movido el producto "+d.value+" correctamente a la celda "+e,"success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function w(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await k.Z.post("articulos/eliminarArticulo",{id:u.value}).then((e=>{x().fire("Producto eliminado","Se eliminado el producto "+d.value+" correctamente a la celda","success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),l.value=!1)}async function h(e,a,o,t,n,s){d.value=e,i.value=a,u.value=o,r.value=t,m.value=n,l.value=!0}return(0,t.bv)((()=>{})),a({abrirModal:h,botonVacio:b}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:d,precioBase:n,precioConIva:i,id:u,modalEditarProd:l,tipoIva:r,confirmar:p,menus:c,cambiarPosicion:g,esSumable:m,tiposIva:s,salirSinGuardar:v,EliminarTecla:w}}};const ze=(0,E.Z)(Ie,[["render",Ae],["__scopeId","data-v-2ed020f2"]]);var Se=ze;const He=e=>((0,t.dD)("data-v-f5908666"),e=e(),(0,t.Cn)(),e),Fe={class:"row"},Pe={for:"nombre"},Ne=["disabled"],Ue=He((()=>(0,t._)("label",{for:"nombre"},[(0,t.Uk)("Nombre articulo "),(0,t._)("br")],-1))),je={style:{display:"flex"}},Oe=He((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),We=["disabled"],Re=He((()=>(0,t._)("option",{value:"4"},"0%",-1))),Ve=He((()=>(0,t._)("option",{value:"1"},"4%",-1))),$e=He((()=>(0,t._)("option",{value:"5"},"5%",-1))),Ze=He((()=>(0,t._)("option",{value:"2"},"10%",-1))),qe=He((()=>(0,t._)("option",{value:"3"},"21%",-1))),Le=[Re,Ve,$e,Ze,qe],Ye=He((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Ge=["disabled"],Ke=He((()=>(0,t._)("option",{value:"true"},"Si",-1))),Je=He((()=>(0,t._)("option",{value:"false"},"No",-1))),Qe=[Ke,Je],Xe={for:"precioIva"},ea=["disabled"],aa={class:"row"},oa={for:"nombre"},ta={key:0,class:"row"},na={class:"col"},la={class:"table-responsive w-100",style:{height:"400px"}},ia={class:"table table-striped mt-1"},ra={class:"textoNombre d-inline-block text-truncate"};function sa(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:n.modalCrearProd,"onUpdate:modelValue":a[9]||(a[9]=e=>n.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",Fe,[(0,t._)("label",Pe,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{disabled:null!=n.articuloSeleccionado,id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e)},null,8,Ne),[[v.nr,n.nombre]])]),Ue,(0,t._)("div",je,[null==n.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>n.nombre=e)},null,512)),[[v.nr,n.nombre]]):(0,t.kq)("",!0),null!=n.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:1,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>n.articuloSeleccionado.nombre=e)},null,512)),[[v.nr,n.articuloSeleccionado.nombre]]):(0,t.kq)("",!0),(0,t.Wm)(c,{onClick:a[3]||(a[3]=e=>n.articuloModal=!0),color:"secondary",floating:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"search",size:"0.5x"})])),_:1})]),Oe,(0,t.wy)((0,t._)("select",{disabled:null!=n.articuloSeleccionado,name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[4]||(a[4]=e=>n.tipoIva=e),class:"form-control"},Le,8,We),[[v.bM,n.tipoIva]]),Ye,(0,t.wy)((0,t._)("select",{disabled:null!=n.articuloSeleccionado,name:"esSumable",id:"esSumable","onUpdate:modelValue":a[5]||(a[5]=e=>n.esSumable=e),class:"form-control"},Qe,8,Ge),[[v.bM,n.esSumable]]),(0,t._)("label",Xe,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(n.tiposIva[n.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{disabled:null!=n.articuloSeleccionado,id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>n.precioConIva=e)},null,8,ea),[[v.nr,n.precioConIva]])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[7]||(a[7]=e=>n.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[8]||(a[8]=e=>n.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{id:"articuloModal",tabindex:"-1",labelledby:"articuloModal",modelValue:n.articuloModal,"onUpdate:modelValue":a[12]||(a[12]=e=>n.articuloModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",aa,[(0,t._)("label",oa,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>n.inputBusqueda=e)},null,512),[[v.nr,n.inputBusqueda]])]),n.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",ta,[(0,t._)("div",na,[(0,t._)("div",la,[(0,t._)("table",ia,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",ra,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(c,{color:"primary",size:"lg",onClick:e=>n.selectArticulo({articulo:a}),class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{onClick:a[11]||(a[11]=e=>n.deleteArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Borrar selección")])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var da={name:"modalCrearProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(0),l=(0,D.iH)(!1),i=(0,D.iH)(!1),r=(0,D.iH)(0),s=(0,D.iH)(0),d=(0,D.iH)(0),u=[4,10,21,0,5],c=(0,D.iH)(""),m=(0,D.iH)(""),p=(0,D.iH)(-1),v=(0,D.iH)(""),g=(0,D.iH)(!0),b=(0,D.iH)(),w=(0,D.iH)(""),h=(0,D.iH)(null);function C(){k.Z.post("articulos/buscar",{busqueda:w.value,familia:"Todos",limit:20}).then((e=>{b.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function y(e){s.value=1,r.value=0,c.value="Nombre",g.value=!1,h.value=null,i.value=!1}async function M(e){s.value=e.articulo.tipoIva,r.value=e.articulo.precioConIva,c.value=e.articulo.nombre,g.value=e.articulo.esSumable,h.value=e.articulo,i.value=!1}async function B(){k.Z.post("articulos/anadirProducto",{nombreArticulo:c.value,precioConIva:parseFloat(r.value),esSumable:JSON.parse(g.value),precioBase:parseFloat(r.value)/parseFloat(s.value),tipoIva:parseFloat(s.value),menus:v.value,posicion:d.value,articuloExistente:null!=h.value,idArticulo:h.value?._id}).then((e=>{m.value="",n.value=0,r.value=0,s.value=3,g.value=!1,l.value=!1,x().fire("Producto creado","Producto creado correctamente","success"),_.W.cargarTeclado()}))}function T(){l.value=!1}function E(){l.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function A(e,a){d.value=e,c.value="Nombre",r.value="0.0",s.value="3",g.value=!0,l.value=!0,v.value=a}return(0,t.YP)(w,(()=>{C()})),(0,t.bv)((()=>{})),a({abrirModal:A}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:c,precioBase:n,precioConIva:r,id:p,modalCrearProd:l,tipoIva:s,confirmar:B,menus:v,inputBusqueda:w,arrayArticulos:b,cambiarPosicion:E,esSumable:g,tiposIva:u,salirSinGuardar:T,articuloModal:i,selectArticulo:M,articuloSeleccionado:h,deleteArticulo:y}}};const ua=(0,E.Z)(da,[["render",sa],["__scopeId","data-v-f5908666"]]);var ca=ua;const ma=["src"];function pa(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),u=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(u,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:n.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:n.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,ma),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>n.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var fa={name:"ModalAlergenosComponent",components:{MDBModal:M.j3,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,D.iH)(!1),t=(0,D.iH)(""),n=(0,f.oR)(),l=n.getters["Configuracion/parametros"];function i(e){r(e),o.value=!0}function r(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${l?.licencia}`}return a({abrirModal:i}),{modalAlergenos:o,abrirModal:i,url:t}}};const va=(0,E.Z)(fa,[["render",pa]]);var ga=va;function ba(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),v=(0,t.up)("PesoComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalVaris",tabindex:"-1",labelledby:"tituloModalVaris",modelValue:n.modalVarisActivo,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalVarisActivo=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"tituloModalVaris"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("inserta_el_nombre","Inserta el nombre del articulo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:n.nombreArticulo,"onUpdate:modelValue":a[0]||(a[0]=e=>n.nombreArticulo=e),"aria-placeholder":"{{ $t('nombre', 'Nombre') }}",type:"text",ref:"inputRef"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{color:"success",onClick:n.handleSubmit},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"modalPesoRef"},null,512)],64)}var wa={name:"ModalVaris",components:{MDBBtn:M.$v,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalFooter:M.ab,MDBInput:M.u2,PesoComponent:ae},setup(e,{expose:a}){const o=(0,D.iH)(!1),n=new Event("acabado"),l=(0,f.oR)(),i=(0,D.iH)(null),r=(0,t.Fl)((()=>l.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>l.state.Teclado.indexMenuActivo)),d=(0,D.iH)({idArticle:"",gramos:null,idCesta:"",unidades:0,arraySuplementos:null}),u=(0,D.iH)(""),c=(0,D.iH)(null),m=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),v=async e=>{try{o.value=!0,u.value="",d.value=e}catch(a){console.log(a)}};a({abrirModal:v,nombreArticulo:u});const g=async()=>{let e=u.value;0===e.length&&(e=d.value.nom),d.value.idArticle?(d.value.peso?(o.value=!1,await i.value.abrirModal(d.value.idArticle,d.value.idCesta,e),u.value=void 0):async function(){const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.value.idArticle,gramos:d.value.gramos,idCesta:d.value.idCesta,unidades:d.value.unidades,arraySuplementos:null,nombre:e,menu:r.value[s.value].menu},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e),worker:encodeURIComponent(m.value[p.value].nombre)}});if(u.value="",!a.data)throw Error("No se ha podido añadir el artículo a la cesta");l.dispatch("Unidades/setUnidades",1)}(),u.value=void 0,o.value=!1):document.dispatchEvent(n)},b=()=>{c.value.focus()};return{modalVarisActivo:o,nombreArticulo:u,handleSubmit:g,modalPesoRef:i,inputRef:c,getFocus:b}}};const ha=(0,E.Z)(wa,[["render",ba]]);var Ca=ha,ya=o(22483),_a={name:"TeclasComponent",components:{PesoComponent:ae,MDBBtn:M.$v,SuplementosComponent:he,ModalEditarProducto:Se,ModalCrearProducto:ca,ModalAlergenosVue:ga,ModalVaris:Ca,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,ya.tv)(),l=(0,t.Fl)((()=>o.state.modoActual)),i=(0,t.Fl)((()=>o.state.Configuracion.parametros)),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d=(0,D.iH)(!1),u=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),c=(0,D.iH)(null),m=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),v=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),g=(0,D.iH)(null),b=(0,D.iH)(!1),w=(0,D.iH)(null),h=(0,D.iH)(null),C=(0,D.iH)(null),y=(0,D.iH)(null),_=(0,t.Fl)((()=>o.state.Unidades.unidades)),M=(0,D.iH)(!1),B=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(m.value&&m.value[p.value]&&u.value[e]._id==m.value[p.value].idCesta)return u.value[e];return null})),T=(0,D.iH)(null),E=(0,D.iH)(!1),A=(0,D.iH)(!1),I=(0,D.iH)(!1),z=(0,D.iH)(!1),S=(0,D.iH)(null),H=(0,t.Fl)((()=>{if(S.value!==B.value?.idCliente)return S.value=B.value?.idCliente,B.value?.idCliente})),F=(0,t.Fl)((()=>o.state.Stock.arrayStock));function P(e){y.value.abrirModal(e)}function N(e){I.value=e}function U(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}function j(){k.Z.get("caja/estadoCaja").then((e=>{1==e.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=e.data&&3!=e.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&n.push("/menu/fichajes"):n.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function O(e,a=undefined){j();const t=e.nombreArticulo&&null!=e.nombreArticulo.match(/(Varis|Varios)/i);if(void 0!=a&&-1==a.pointerId)return;let n=e.idArticle,d=u.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===l.value||"MOVER_ARTICULO"===l.value)return"MOVER_ARTICULO"===l.value?void x().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void k.Z.post("articulos/getArticulo",{idArticulo:n,idCliente:d}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");h.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!B.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=i?.value?.prohibirSuplementos&&e.suplementos?.length>0)w.value.abrirModal(e.idArticle,B.value._id,B.value.idCliente,e.suplementos,_.value>0?_.value:1,z.value);else if(t)c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,peso:!1,nom:e.nombreArticulo});else try{o.dispatch("Procesando/procesandoClickTecla",!0);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombreArticulo),worker:encodeURIComponent(m.value[p.value].nombre)}});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}finally{o.dispatch("Procesando/procesandoClickTecla",!1)}else t?await c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value,arraySuplementos:null,peso:!0,nom:e.nombreArticulo}):g.value.abrirModal(e.idArticle,B.value._id,e.nombreArticulo)}catch(f){x().fire("Oops...",f.message,"error")}}const W=(0,t.Fl)((()=>{let e=U();if(r.value&&r.value[s.value]&&r.value[s.value].arraySubmenus&&r.value[s.value].arraySubmenus[v.value])for(let a=0;a<r.value[s.value].arraySubmenus[v.value].arrayTeclas.length;a++)e[r.value[s.value].arraySubmenus[v.value].arrayTeclas[a].pos]=r.value[s.value].arraySubmenus[v.value].arrayTeclas[a];else if(r.value&&r.value[s.value]&&r.value[s.value].arrayTeclas)for(let a=0;a<r.value[s.value].arrayTeclas.length;a++)e[r.value[s.value].arrayTeclas[a].pos]=r.value[s.value].arrayTeclas[a];return e}));function R(e){return parseInt(e,16)||e}function V(e){return R(e)/255<=.03928?R(e)/255/12.92:Math.pow((R(e)/255+.055)/1.055,2.4)}function $(e){return.2126*V(e.substr(1,2))+.7152*V(e.substr(3,2))+.0722*V(e.substr(-2))}function Z(e,a){const o=$(e),t=$(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function q(e){const a=Z(e,"#ffffff"),o=Z(e,"#000000");return a>o?"#ffffff":"#000000"}function L(e){}function Y(e){return e?"MOVER_ARTICULO"==l.value?"Mover aqui":"Vacío":l.value}function G(e){let a=r.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[v.value].nombre,t=`[${a.nombre}]${o}`),"MOVER_ARTICULO"==l.value)return h.value.botonVacio(e,t);C.value.abrirModal(e,t)}async function K(e){return k.Z.post("clientes/getClienteById",{idCliente:e}).then((e=>!!e.data&&!(!e.data?.albaran&&!e.data?.vip))).catch((e=>(console.log("error comprobaralbaranNPT_o_vipPT",e),!1)))}function J(e,a=undefined){T.value=setTimeout((()=>{P(e.idArticle),T.value=null}),500)}function Q(e,a=undefined){T.value&&!E.value&&(clearTimeout(T.value),O(e,a),X()),clearTimeout(T.value)}function X(){E.value=!0,setTimeout((()=>{E.value=!1}),70)}function ee(e){if(!e)return 0;const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Math.round(100*o)/100}return(0,t.JJ)("addItem",L),(0,t.YP)((()=>H.value),(async()=>{try{if(B.value?.idCliente){const e=await K(B.value.idCliente);z.value=!0===e}else z.value=!1}catch(e){console.error("Error en watch:",e),z.value=!1}})),(0,t.bv)((async()=>{m.value&&0!==m.value?.length||n.push("menu/fichajes"),k.Z.post("parametros/getParametros").then((e=>{"Si"==e.data?.params?.textoStock&&(d.value=!0),void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(M.value=!0):M.value=!1,void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(b.value=!0):b.value=!1,void 0!=e.data?.nombreEmpresa&&void 0!=e.data?.params?.AlertaJoanets?"tena"==e.data?.nombreEmpresa?.toLowerCase()&&"Si"==e.data?.params?.AlertaJoanets&&(A.value=!0):A.value=!1})),H.value&&(z.value=await K(H.value))})),a({clickTecla:O,postDisabledTecla:N}),{teclado:r,precioTecla:b,indexMenuActivo:s,arrayTeclas:W,getTextColor:q,modalPesoRef:g,modalSuplementosRef:w,modalAlergenosRef:y,modalEditarProdRef:h,modalCrearProdRef:C,abrirFicha:P,clickTecla:O,NoSuplementos:M,isEditarArticulos:Y,editarArticulo:G,modalVarisRef:c,startPress:J,endPress:Q,pressTimeout:T,opBloquado:E,getAnimation:ee,AlertaJoanets:A,cesta:B,postDisabledTecla:N,disabledTeclas:I,albaranNPT_o_vipPT:z,textoStock:d,arrayStock:F}}};const Ma=(0,E.Z)(_a,[["render",q],["__scopeId","data-v-61ffee65"]]);var Da=Ma;const ka=e=>((0,t.dD)("data-v-3e1b79ce"),e=e(),(0,t.Cn)(),e),Ba={key:0,class:"table-responsive divCesta reverso"},xa={class:"colorFuente"},Ta={class:"tableBody"},Ea=["onClick"],Aa={class:"cantidad"},Ia={class:"d-inline-block text-truncate xUnidades"},za={key:1,id:"suplementos"},Sa={id:"promocionDetalles"},Ha={key:0,class:"d-flex row col-12"},Fa={class:"col-12"},Pa={"d-flex":"","justify-content-around":""},Na={style:{"max-width":"6.5rem","min-width":"6.5rem"},class:"nombreArtPromocion"},Ua={class:"pe-1"},ja={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},Oa={class:"xUnidades d-inline",style:{width:"fit-content",margin:"0 0.07rem"}},Wa={key:0,style:{"max-width":"15rem","min-width":"15rem","vertical-align":"middle",padding:"0.5rem 1.4rem","font-weight":"bold","text-align":"center"}},Ra={key:0},Va={key:1},$a=ka((()=>(0,t._)("br",null,null,-1))),Za={key:2,class:"detallesAlbIva"},qa={key:3,class:"detallesAlbIva"},La={key:4,class:"detallesAlbIva"},Ya={key:1},Ga={key:2},Ka={key:1},Ja={key:0,class:"fw-bold"};function Qa(e,a,o,n,l,i){const r=(0,t.up)("MDBPopover"),s=(0,t.up)("MDBBtn"),u=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBCardTitle"),m=(0,t.up)("MDBCardText"),p=(0,t.up)("MDBCardBody"),f=(0,t.up)("MDBCard"),v=(0,t.up)("ModalDescuentosTiendaComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(r,{style:{position:"absolute"},modelValue:n.popOverTarifaEsp,"onUpdate:modelValue":a[0]||(a[0]=e=>n.popOverTarifaEsp=e),direction:"right"},{header:(0,t.w5)((()=>[(0,t.Uk)("Tarifa especial")])),body:(0,t.w5)((()=>[(0,t.Uk)(" Precio preferencial para clientes específicos. ")])),_:1},8,["modelValue"]),n.cesta&&n.cesta.lista?((0,t.wg)(),(0,t.iD)("div",Ba,[(0,t._)("table",xa,[(0,t._)("tbody",Ta,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.cesta.lista,((e,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o,class:(0,d.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:n.indexItemCestaActivo===o,sePuedeRegalar:n.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>n.clickItem(o)},[(0,t._)("td",Aa,[(0,t._)("span",Ia,[e?.tarifaEsp?((0,t.wg)(),(0,t.iD)("span",{key:0,onMouseover:a[1]||(a[1]=(...e)=>n.showPopOver&&n.showPopOver(...e)),onMouseleave:a[2]||(a[2]=(...e)=>n.hidePopOver&&n.hidePopOver(...e)),class:"tarifaEsp"},"TE",32)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,d.zw)(e.nombre)+" ",1),e.arraySuplementos?.length>0?((0,t.wg)(),(0,t.iD)("div",za,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,d.zw)(e.nombre),1)))),128))])):(0,t.kq)("",!0),(0,t._)("div",Sa,[e.promocion?((0,t.wg)(),(0,t.iD)("tr",Ha,[e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.promocion.grupos.flat(),((a,o)=>((0,t.wg)(),(0,t.iD)("li",Fa,[(0,t._)("span",Pa,[(0,t._)("td",Na,(0,d.zw)(a.nombre),1),(0,t._)("td",Ua,(0,d.zw)(a.precioPromoPorUnidad.toFixed(2))+" € ",1),(0,t._)("td",ja," x"+(0,d.zw)(e.unidades*a.unidades),1)])])))),256)):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])]),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:0,onClick:a=>n.restar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.unidades<=1||e.pagado||n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" - ")])),_:2},1032,["onClick","disabled"])),(0,t._)("span",Oa," x"+(0,d.zw)(0!=e.gramos&&e.gramos?(e.gramos/1e3).toFixed(3)+"kg":e.unidades),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:1,onClick:a=>n.sumar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.pagado||n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" + ")])),_:2},1032,["onClick","disabled"]))]),"DEVOLUCION"!==n.cesta.modo?((0,t.wg)(),(0,t.iD)("td",Wa,[e?.precioOrig?((0,t.wg)(),(0,t.iD)("span",Va,(0,d.zw)(n.cOutPrecioOrig(e.precioOrig))+" €",1)):((0,t.wg)(),(0,t.iD)("span",Ra,(0,d.zw)(e.subtotal.toFixed(2))+" €",1)),$a,e.subtotal>0&&e?.iva?((0,t.wg)(),(0,t.iD)("span",Za,"+"+(0,d.zw)(e.iva)+"% IVA",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.descuentoTienda&&0!=e?.descuentoTienda?((0,t.wg)(),(0,t.iD)("span",qa," -"+(0,d.zw)(e.descuentoTienda)+"% DTO",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.dto?((0,t.wg)(),(0,t.iD)("span",La," -"+(0,d.zw)(e.dto)+"% DTO",1)):(0,t.kq)("",!0)])):(0,t.kq)("",!0),n.sePuedeRegalar(e)?((0,t.wg)(),(0,t.iD)("td",Ya,[(0,t.Wm)(s,{color:"secondary",onClick:a=>n.clickRegalo(o,e),size:"sm",disabled:n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"gift",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0),"CONSUMO_PERSONAL"==n.cesta.modo?((0,t.wg)(),(0,t.iD)("td",Ga,[(0,t.Wm)(s,{color:"secondary",onClick:a=>n.clickDiscountShop(o,e),size:"sm",disabled:n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{icon:"percent",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0)],10,Ea)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",Ka,[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),n.arrayTrabajadores&&n.arrayTrabajadores[n.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",Ja,(0,d.zw)(n.arrayTrabajadores[n.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(s,{color:"primary",onClick:a[3]||(a[3]=e=>n.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,d.zw)(n.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})])),(0,t.Wm)(v,{ref:"modalDescuentosTienda"},null,512)],64)}const Xa={class:"custom-select"},eo=(0,t._)("option",{value:"0"},"0%",-1),ao=(0,t._)("option",{value:"100"},"100%",-1),oo=["value"];function to(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBPopover"),m=(0,t.up)("MDBIcon"),p=(0,t.up)("MDBBtn"),f=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(g,{id:"modalDescuentosTienda",title:"Selecciona un Descuento","static-backdrop":"",centered:"",modelValue:n.isModalOpen,"onUpdate:modelValue":a[4]||(a[4]=e=>n.isModalOpen=e),"data-mdb-autofocus":"false",enforceFocus:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_un_descuento","Selecciona un descuento")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",Xa,[(0,t.wy)((0,t._)("select",{name:"descuentoTienda",id:"descuentoTienda","onUpdate:modelValue":a[0]||(a[0]=e=>n.selectedDiscount=e),class:"form-control",onChange:a[1]||(a[1]=(...e)=>n.removeFocus&&n.removeFocus(...e))},[eo,ao,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.discountValues,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.discount,value:parseInt(e.value)},(0,d.zw)(e.value)+"% ",9,oo)))),128))],544),[[v.bM,n.selectedDiscount]])])])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:n.popOverHelp,"onUpdate:modelValue":a[2]||(a[2]=e=>n.popOverHelp=e),direction:"bottom"},{header:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ayuda","Ayuda")),1)])),body:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ayuda_descuentos_tienda","Si los descuentos del GDT no se muestran, dirígese a 'actualizar parámetros tienda'.")),1)])),_:1},8,["modelValue"]),(0,t.Wm)(p,{"aria-label":"Help",onClick:a[3]||(a[3]=e=>n.popOverHelp=!n.popOverHelp),color:"info"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{icon:"question-circle",size:"lg"})])),_:1}),(0,t.Wm)(p,{onClick:n.closeModal},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1},8,["onClick"]),(0,t.Wm)(p,{onClick:n.applyDiscount,disabled:!n.selectedDiscount},{default:(0,t.w5)((()=>[(0,t.Uk)("Aplicar")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["modelValue"])}var no={name:"ModalDescuentosTiendaComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE,MDBSelect:M.R3,MDBPopover:M.SW},setup(e,{expose:a,emit:o}){const n=(0,f.oR)(),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>n.state.Discounts.discounts)),s=(0,t.Fl)((()=>{if(!r.value)return[];const e=new Set;return r.value.filter((e=>null!==e.value&&0!=e.value&&100!=e.value)).filter((a=>{const o=parseInt(a.value);return!e.has(o)&&(e.add(o),!0)}))||[]})),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(!1);function m(e=0,a,o=0){d.value=a,u.value=o,i.value=e,l.value=!0}const p=()=>{l.value=!1},v=async()=>{const e=await k.Z.post("/cestas/setDiscountShop",{cesta:d.value,index:u.value,discount:i.value});e.data.error?alert(e.data.error):(o("discountSelected",i.value),p())},g=()=>{document.getElementById("descuentoTienda").blur()};return a({showModal:m}),{isModalOpen:l,selectedDiscount:i,discountValues:s,discountsShop:r,closeModal:p,applyDiscount:v,popOverHelp:c,removeFocus:g}}};const lo=(0,E.Z)(no,[["render",to]]);var io,ro,so=lo,uo=(o(30541),o(23767),o(8585),o(68696),9e15),co=1e9,mo="0123456789abcdef",po="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",fo="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",vo={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-uo,maxE:uo,crypto:!1},go=!0,bo="[DecimalError] ",wo=bo+"Invalid argument: ",ho=bo+"Precision limit exceeded",Co=bo+"crypto unavailable",yo="[object Decimal]",_o=Math.floor,Mo=Math.pow,Do=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ko=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Bo=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,xo=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,To=1e7,Eo=7,Ao=9007199254740991,Io=po.length-1,zo=fo.length-1,So={toStringTag:yo};function Ho(e){var a,o,t,n=e.length-1,l="",i=e[0];if(n>0){for(l+=i,a=1;a<n;a++)t=e[a]+"",o=Eo-t.length,o&&(l+=qo(o)),l+=t;i=e[a],t=i+"",o=Eo-t.length,o&&(l+=qo(o))}else if(0===i)return"0";for(;i%10===0;)i/=10;return l+i}function Fo(e,a,o){if(e!==~~e||e<a||e>o)throw Error(wo+e)}function Po(e,a,o,t){var n,l,i,r;for(l=e[0];l>=10;l/=10)--a;return--a<0?(a+=Eo,n=0):(n=Math.ceil((a+1)/Eo),a%=Eo),l=Mo(10,Eo-a),r=e[n]%l|0,null==t?a<3?(0==a?r=r/100|0:1==a&&(r=r/10|0),i=o<4&&99999==r||o>3&&49999==r||5e4==r||0==r):i=(o<4&&r+1==l||o>3&&r+1==l/2)&&(e[n+1]/l/100|0)==Mo(10,a-2)-1||(r==l/2||0==r)&&0==(e[n+1]/l/100|0):a<4?(0==a?r=r/1e3|0:1==a?r=r/100|0:2==a&&(r=r/10|0),i=(t||o<4)&&9999==r||!t&&o>3&&4999==r):i=((t||o<4)&&r+1==l||!t&&o>3&&r+1==l/2)&&(e[n+1]/l/1e3|0)==Mo(10,a-3)-1,i}function No(e,a,o){for(var t,n,l=[0],i=0,r=e.length;i<r;){for(n=l.length;n--;)l[n]*=a;for(l[0]+=mo.indexOf(e.charAt(i++)),t=0;t<l.length;t++)l[t]>o-1&&(void 0===l[t+1]&&(l[t+1]=0),l[t+1]+=l[t]/o|0,l[t]%=o)}return l.reverse()}function Uo(e,a){var o,t,n;if(a.isZero())return a;t=a.d.length,t<32?(o=Math.ceil(t/3),n=(1/tt(4,o)).toString()):(o=16,n="2.3283064365386962890625e-10"),e.precision+=o,a=ot(e,1,a.times(n),new e(1));for(var l=o;l--;){var i=a.times(a);a=i.times(i).minus(i).times(8).plus(1)}return e.precision-=o,a}So.absoluteValue=So.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),Oo(e)},So.ceil=function(){return Oo(new this.constructor(this),this.e+1,2)},So.clampedTo=So.clamp=function(e,a){var o,t=this,n=t.constructor;if(e=new n(e),a=new n(a),!e.s||!a.s)return new n(NaN);if(e.gt(a))throw Error(wo+a);return o=t.cmp(e),o<0?e:t.cmp(a)>0?a:new n(t)},So.comparedTo=So.cmp=function(e){var a,o,t,n,l=this,i=l.d,r=(e=new l.constructor(e)).d,s=l.s,d=e.s;if(!i||!r)return s&&d?s!==d?s:i===r?0:!i^s<0?1:-1:NaN;if(!i[0]||!r[0])return i[0]?s:r[0]?-d:0;if(s!==d)return s;if(l.e!==e.e)return l.e>e.e^s<0?1:-1;for(t=i.length,n=r.length,a=0,o=t<n?t:n;a<o;++a)if(i[a]!==r[a])return i[a]>r[a]^s<0?1:-1;return t===n?0:t>n^s<0?1:-1},So.cosine=So.cos=function(){var e,a,o=this,t=o.constructor;return o.d?o.d[0]?(e=t.precision,a=t.rounding,t.precision=e+Math.max(o.e,o.sd())+Eo,t.rounding=1,o=Uo(t,nt(t,o)),t.precision=e,t.rounding=a,Oo(2==ro||3==ro?o.neg():o,e,a,!0)):new t(1):new t(NaN)},So.cubeRoot=So.cbrt=function(){var e,a,o,t,n,l,i,r,s,d,u=this,c=u.constructor;if(!u.isFinite()||u.isZero())return new c(u);for(go=!1,l=u.s*Mo(u.s*u,1/3),l&&Math.abs(l)!=1/0?t=new c(l.toString()):(o=Ho(u.d),e=u.e,(l=(e-o.length+1)%3)&&(o+=1==l||-2==l?"0":"00"),l=Mo(o,1/3),e=_o((e+1)/3)-(e%3==(e<0?-1:2)),l==1/0?o="5e"+e:(o=l.toExponential(),o=o.slice(0,o.indexOf("e")+1)+e),t=new c(o),t.s=u.s),i=(e=c.precision)+3;;)if(r=t,s=r.times(r).times(r),d=s.plus(u),t=jo(d.plus(u).times(r),d.plus(s),i+2,1),Ho(r.d).slice(0,i)===(o=Ho(t.d)).slice(0,i)){if(o=o.slice(i-3,i+1),"9999"!=o&&(n||"4999"!=o)){+o&&(+o.slice(1)||"5"!=o.charAt(0))||(Oo(t,e+1,1),a=!t.times(t).times(t).eq(u));break}if(!n&&(Oo(r,e+1,0),r.times(r).times(r).eq(u))){t=r;break}i+=4,n=1}return go=!0,Oo(t,e,c.rounding,a)},So.decimalPlaces=So.dp=function(){var e,a=this.d,o=NaN;if(a){if(e=a.length-1,o=(e-_o(this.e/Eo))*Eo,e=a[e],e)for(;e%10==0;e/=10)o--;o<0&&(o=0)}return o},So.dividedBy=So.div=function(e){return jo(this,new this.constructor(e))},So.dividedToIntegerBy=So.divToInt=function(e){var a=this,o=a.constructor;return Oo(jo(a,new o(e),0,1,1),o.precision,o.rounding)},So.equals=So.eq=function(e){return 0===this.cmp(e)},So.floor=function(){return Oo(new this.constructor(this),this.e+1,3)},So.greaterThan=So.gt=function(e){return this.cmp(e)>0},So.greaterThanOrEqualTo=So.gte=function(e){var a=this.cmp(e);return 1==a||0===a},So.hyperbolicCosine=So.cosh=function(){var e,a,o,t,n,l=this,i=l.constructor,r=new i(1);if(!l.isFinite())return new i(l.s?1/0:NaN);if(l.isZero())return r;o=i.precision,t=i.rounding,i.precision=o+Math.max(l.e,l.sd())+4,i.rounding=1,n=l.d.length,n<32?(e=Math.ceil(n/3),a=(1/tt(4,e)).toString()):(e=16,a="2.3283064365386962890625e-10"),l=ot(i,1,l.times(a),new i(1),!0);for(var s,d=e,u=new i(8);d--;)s=l.times(l),l=r.minus(s.times(u.minus(s.times(u))));return Oo(l,i.precision=o,i.rounding=t,!0)},So.hyperbolicSine=So.sinh=function(){var e,a,o,t,n=this,l=n.constructor;if(!n.isFinite()||n.isZero())return new l(n);if(a=l.precision,o=l.rounding,l.precision=a+Math.max(n.e,n.sd())+4,l.rounding=1,t=n.d.length,t<3)n=ot(l,2,n,n,!0);else{e=1.4*Math.sqrt(t),e=e>16?16:0|e,n=n.times(1/tt(5,e)),n=ot(l,2,n,n,!0);for(var i,r=new l(5),s=new l(16),d=new l(20);e--;)i=n.times(n),n=n.times(r.plus(i.times(s.times(i).plus(d))))}return l.precision=a,l.rounding=o,Oo(n,a,o,!0)},So.hyperbolicTangent=So.tanh=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+7,t.rounding=1,jo(o.sinh(),o.cosh(),t.precision=e,t.rounding=a)):new t(o.s)},So.inverseCosine=So.acos=function(){var e=this,a=e.constructor,o=e.abs().cmp(1),t=a.precision,n=a.rounding;return-1!==o?0===o?e.isNeg()?$o(a,t,n):new a(0):new a(NaN):e.isZero()?$o(a,t+4,n).times(.5):(a.precision=t+6,a.rounding=1,e=new a(1).minus(e).div(e.plus(1)).sqrt().atan(),a.precision=t,a.rounding=n,e.times(2))},So.inverseHyperbolicCosine=So.acosh=function(){var e,a,o=this,t=o.constructor;return o.lte(1)?new t(o.eq(1)?0:NaN):o.isFinite()?(e=t.precision,a=t.rounding,t.precision=e+Math.max(Math.abs(o.e),o.sd())+4,t.rounding=1,go=!1,o=o.times(o).minus(1).sqrt().plus(o),go=!0,t.precision=e,t.rounding=a,o.ln()):new t(o)},So.inverseHyperbolicSine=So.asinh=function(){var e,a,o=this,t=o.constructor;return!o.isFinite()||o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+2*Math.max(Math.abs(o.e),o.sd())+6,t.rounding=1,go=!1,o=o.times(o).plus(1).sqrt().plus(o),go=!0,t.precision=e,t.rounding=a,o.ln())},So.inverseHyperbolicTangent=So.atanh=function(){var e,a,o,t,n=this,l=n.constructor;return n.isFinite()?n.e>=0?new l(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(e=l.precision,a=l.rounding,t=n.sd(),Math.max(t,e)<2*-n.e-1?Oo(new l(n),e,a,!0):(l.precision=o=t-n.e,n=jo(n.plus(1),new l(1).minus(n),o+e,1),l.precision=e+4,l.rounding=1,n=n.ln(),l.precision=e,l.rounding=a,n.times(.5))):new l(NaN)},So.inverseSine=So.asin=function(){var e,a,o,t,n=this,l=n.constructor;return n.isZero()?new l(n):(a=n.abs().cmp(1),o=l.precision,t=l.rounding,-1!==a?0===a?(e=$o(l,o+4,t).times(.5),e.s=n.s,e):new l(NaN):(l.precision=o+6,l.rounding=1,n=n.div(new l(1).minus(n.times(n)).sqrt().plus(1)).atan(),l.precision=o,l.rounding=t,n.times(2)))},So.inverseTangent=So.atan=function(){var e,a,o,t,n,l,i,r,s,d=this,u=d.constructor,c=u.precision,m=u.rounding;if(d.isFinite()){if(d.isZero())return new u(d);if(d.abs().eq(1)&&c+4<=zo)return i=$o(u,c+4,m).times(.25),i.s=d.s,i}else{if(!d.s)return new u(NaN);if(c+4<=zo)return i=$o(u,c+4,m).times(.5),i.s=d.s,i}for(u.precision=r=c+10,u.rounding=1,o=Math.min(28,r/Eo+2|0),e=o;e;--e)d=d.div(d.times(d).plus(1).sqrt().plus(1));for(go=!1,a=Math.ceil(r/Eo),t=1,s=d.times(d),i=new u(d),n=d;-1!==e;)if(n=n.times(s),l=i.minus(n.div(t+=2)),n=n.times(s),i=l.plus(n.div(t+=2)),void 0!==i.d[a])for(e=a;i.d[e]===l.d[e]&&e--;);return o&&(i=i.times(2<<o-1)),go=!0,Oo(i,u.precision=c,u.rounding=m,!0)},So.isFinite=function(){return!!this.d},So.isInteger=So.isInt=function(){return!!this.d&&_o(this.e/Eo)>this.d.length-2},So.isNaN=function(){return!this.s},So.isNegative=So.isNeg=function(){return this.s<0},So.isPositive=So.isPos=function(){return this.s>0},So.isZero=function(){return!!this.d&&0===this.d[0]},So.lessThan=So.lt=function(e){return this.cmp(e)<0},So.lessThanOrEqualTo=So.lte=function(e){return this.cmp(e)<1},So.logarithm=So.log=function(e){var a,o,t,n,l,i,r,s,d=this,u=d.constructor,c=u.precision,m=u.rounding,p=5;if(null==e)e=new u(10),a=!0;else{if(e=new u(e),o=e.d,e.s<0||!o||!o[0]||e.eq(1))return new u(NaN);a=e.eq(10)}if(o=d.d,d.s<0||!o||!o[0]||d.eq(1))return new u(o&&!o[0]?-1/0:1!=d.s?NaN:o?0:1/0);if(a)if(o.length>1)l=!0;else{for(n=o[0];n%10===0;)n/=10;l=1!==n}if(go=!1,r=c+p,i=Jo(d,r),t=a?Vo(u,r+10):Jo(e,r),s=jo(i,t,r,1),Po(s.d,n=c,m))do{if(r+=10,i=Jo(d,r),t=a?Vo(u,r+10):Jo(e,r),s=jo(i,t,r,1),!l){+Ho(s.d).slice(n+1,n+15)+1==1e14&&(s=Oo(s,c+1,0));break}}while(Po(s.d,n+=10,m));return go=!0,Oo(s,c,m)},So.minus=So.sub=function(e){var a,o,t,n,l,i,r,s,d,u,c,m,p=this,f=p.constructor;if(e=new f(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new f(e.d||p.s!==e.s?p:NaN):e=new f(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(d=p.d,m=e.d,r=f.precision,s=f.rounding,!d[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!d[0])return new f(3===s?-0:0);e=new f(p)}return go?Oo(e,r,s):e}if(o=_o(e.e/Eo),u=_o(p.e/Eo),d=d.slice(),l=u-o,l){for(c=l<0,c?(a=d,l=-l,i=m.length):(a=m,o=u,i=d.length),t=Math.max(Math.ceil(r/Eo),i)+2,l>t&&(l=t,a.length=1),a.reverse(),t=l;t--;)a.push(0);a.reverse()}else{for(t=d.length,i=m.length,c=t<i,c&&(i=t),t=0;t<i;t++)if(d[t]!=m[t]){c=d[t]<m[t];break}l=0}for(c&&(a=d,d=m,m=a,e.s=-e.s),i=d.length,t=m.length-i;t>0;--t)d[i++]=0;for(t=m.length;t>l;){if(d[--t]<m[t]){for(n=t;n&&0===d[--n];)d[n]=To-1;--d[n],d[t]+=To}d[t]-=m[t]}for(;0===d[--i];)d.pop();for(;0===d[0];d.shift())--o;return d[0]?(e.d=d,e.e=Ro(d,o),go?Oo(e,r,s):e):new f(3===s?-0:0)},So.modulo=So.mod=function(e){var a,o=this,t=o.constructor;return e=new t(e),!o.d||!e.s||e.d&&!e.d[0]?new t(NaN):!e.d||o.d&&!o.d[0]?Oo(new t(o),t.precision,t.rounding):(go=!1,9==t.modulo?(a=jo(o,e.abs(),0,3,1),a.s*=e.s):a=jo(o,e,0,t.modulo,1),a=a.times(e),go=!0,o.minus(a))},So.naturalExponential=So.exp=function(){return Ko(this)},So.naturalLogarithm=So.ln=function(){return Jo(this)},So.negated=So.neg=function(){var e=new this.constructor(this);return e.s=-e.s,Oo(e)},So.plus=So.add=function(e){var a,o,t,n,l,i,r,s,d,u,c=this,m=c.constructor;if(e=new m(e),!c.d||!e.d)return c.s&&e.s?c.d||(e=new m(e.d||c.s===e.s?c:NaN)):e=new m(NaN),e;if(c.s!=e.s)return e.s=-e.s,c.minus(e);if(d=c.d,u=e.d,r=m.precision,s=m.rounding,!d[0]||!u[0])return u[0]||(e=new m(c)),go?Oo(e,r,s):e;if(l=_o(c.e/Eo),t=_o(e.e/Eo),d=d.slice(),n=l-t,n){for(n<0?(o=d,n=-n,i=u.length):(o=u,t=l,i=d.length),l=Math.ceil(r/Eo),i=l>i?l+1:i+1,n>i&&(n=i,o.length=1),o.reverse();n--;)o.push(0);o.reverse()}for(i=d.length,n=u.length,i-n<0&&(n=i,o=u,u=d,d=o),a=0;n;)a=(d[--n]=d[n]+u[n]+a)/To|0,d[n]%=To;for(a&&(d.unshift(a),++t),i=d.length;0==d[--i];)d.pop();return e.d=d,e.e=Ro(d,t),go?Oo(e,r,s):e},So.precision=So.sd=function(e){var a,o=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(wo+e);return o.d?(a=Zo(o.d),e&&o.e+1>a&&(a=o.e+1)):a=NaN,a},So.round=function(){var e=this,a=e.constructor;return Oo(new a(e),e.e+1,a.rounding)},So.sine=So.sin=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+Math.max(o.e,o.sd())+Eo,t.rounding=1,o=at(t,nt(t,o)),t.precision=e,t.rounding=a,Oo(ro>2?o.neg():o,e,a,!0)):new t(NaN)},So.squareRoot=So.sqrt=function(){var e,a,o,t,n,l,i=this,r=i.d,s=i.e,d=i.s,u=i.constructor;if(1!==d||!r||!r[0])return new u(!d||d<0&&(!r||r[0])?NaN:r?i:1/0);for(go=!1,d=Math.sqrt(+i),0==d||d==1/0?(a=Ho(r),(a.length+s)%2==0&&(a+="0"),d=Math.sqrt(a),s=_o((s+1)/2)-(s<0||s%2),d==1/0?a="5e"+s:(a=d.toExponential(),a=a.slice(0,a.indexOf("e")+1)+s),t=new u(a)):t=new u(d.toString()),o=(s=u.precision)+3;;)if(l=t,t=l.plus(jo(i,l,o+2,1)).times(.5),Ho(l.d).slice(0,o)===(a=Ho(t.d)).slice(0,o)){if(a=a.slice(o-3,o+1),"9999"!=a&&(n||"4999"!=a)){+a&&(+a.slice(1)||"5"!=a.charAt(0))||(Oo(t,s+1,1),e=!t.times(t).eq(i));break}if(!n&&(Oo(l,s+1,0),l.times(l).eq(i))){t=l;break}o+=4,n=1}return go=!0,Oo(t,s,u.rounding,e)},So.tangent=So.tan=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+10,t.rounding=1,o=o.sin(),o.s=1,o=jo(o,new t(1).minus(o.times(o)).sqrt(),e+10,0),t.precision=e,t.rounding=a,Oo(2==ro||4==ro?o.neg():o,e,a,!0)):new t(NaN)},So.times=So.mul=function(e){var a,o,t,n,l,i,r,s,d,u=this,c=u.constructor,m=u.d,p=(e=new c(e)).d;if(e.s*=u.s,!m||!m[0]||!p||!p[0])return new c(!e.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:m&&p?0*e.s:e.s/0);for(o=_o(u.e/Eo)+_o(e.e/Eo),s=m.length,d=p.length,s<d&&(l=m,m=p,p=l,i=s,s=d,d=i),l=[],i=s+d,t=i;t--;)l.push(0);for(t=d;--t>=0;){for(a=0,n=s+t;n>t;)r=l[n]+p[t]*m[n-t-1]+a,l[n--]=r%To|0,a=r/To|0;l[n]=(l[n]+a)%To|0}for(;!l[--i];)l.pop();return a?++o:l.shift(),e.d=l,e.e=Ro(l,o),go?Oo(e,c.precision,c.rounding):e},So.toBinary=function(e,a){return lt(this,2,e,a)},So.toDecimalPlaces=So.toDP=function(e,a){var o=this,t=o.constructor;return o=new t(o),void 0===e?o:(Fo(e,0,co),void 0===a?a=t.rounding:Fo(a,0,8),Oo(o,e+o.e+1,a))},So.toExponential=function(e,a){var o,t=this,n=t.constructor;return void 0===e?o=Wo(t,!0):(Fo(e,0,co),void 0===a?a=n.rounding:Fo(a,0,8),t=Oo(new n(t),e+1,a),o=Wo(t,!0,e+1)),t.isNeg()&&!t.isZero()?"-"+o:o},So.toFixed=function(e,a){var o,t,n=this,l=n.constructor;return void 0===e?o=Wo(n):(Fo(e,0,co),void 0===a?a=l.rounding:Fo(a,0,8),t=Oo(new l(n),e+n.e+1,a),o=Wo(t,!1,e+t.e+1)),n.isNeg()&&!n.isZero()?"-"+o:o},So.toFraction=function(e){var a,o,t,n,l,i,r,s,d,u,c,m,p=this,f=p.d,v=p.constructor;if(!f)return new v(p);if(d=o=new v(1),t=s=new v(0),a=new v(t),l=a.e=Zo(f)-p.e-1,i=l%Eo,a.d[0]=Mo(10,i<0?Eo+i:i),null==e)e=l>0?a:d;else{if(r=new v(e),!r.isInt()||r.lt(d))throw Error(wo+r);e=r.gt(a)?l>0?a:d:r}for(go=!1,r=new v(Ho(f)),u=v.precision,v.precision=l=f.length*Eo*2;;){if(c=jo(r,a,0,1,1),n=o.plus(c.times(t)),1==n.cmp(e))break;o=t,t=n,n=d,d=s.plus(c.times(n)),s=n,n=a,a=r.minus(c.times(n)),r=n}return n=jo(e.minus(o),t,0,1,1),s=s.plus(n.times(d)),o=o.plus(n.times(t)),s.s=d.s=p.s,m=jo(d,t,l,1).minus(p).abs().cmp(jo(s,o,l,1).minus(p).abs())<1?[d,t]:[s,o],v.precision=u,go=!0,m},So.toHexadecimal=So.toHex=function(e,a){return lt(this,16,e,a)},So.toNearest=function(e,a){var o=this,t=o.constructor;if(o=new t(o),null==e){if(!o.d)return o;e=new t(1),a=t.rounding}else{if(e=new t(e),void 0===a?a=t.rounding:Fo(a,0,8),!o.d)return e.s?o:e;if(!e.d)return e.s&&(e.s=o.s),e}return e.d[0]?(go=!1,o=jo(o,e,0,a,1).times(e),go=!0,Oo(o)):(e.s=o.s,o=e),o},So.toNumber=function(){return+this},So.toOctal=function(e,a){return lt(this,8,e,a)},So.toPower=So.pow=function(e){var a,o,t,n,l,i,r=this,s=r.constructor,d=+(e=new s(e));if(!r.d||!e.d||!r.d[0]||!e.d[0])return new s(Mo(+r,d));if(r=new s(r),r.eq(1))return r;if(t=s.precision,l=s.rounding,e.eq(1))return Oo(r,t,l);if(a=_o(e.e/Eo),a>=e.d.length-1&&(o=d<0?-d:d)<=Ao)return n=Lo(s,r,o,t),e.s<0?new s(1).div(n):Oo(n,t,l);if(i=r.s,i<0){if(a<e.d.length-1)return new s(NaN);if(0==(1&e.d[a])&&(i=1),0==r.e&&1==r.d[0]&&1==r.d.length)return r.s=i,r}return o=Mo(+r,d),a=0!=o&&isFinite(o)?new s(o+"").e:_o(d*(Math.log("0."+Ho(r.d))/Math.LN10+r.e+1)),a>s.maxE+1||a<s.minE-1?new s(a>0?i/0:0):(go=!1,s.rounding=r.s=1,o=Math.min(12,(a+"").length),n=Ko(e.times(Jo(r,t+o)),t),n.d&&(n=Oo(n,t+5,1),Po(n.d,t,l)&&(a=t+10,n=Oo(Ko(e.times(Jo(r,a+o)),a),a+5,1),+Ho(n.d).slice(t+1,t+15)+1==1e14&&(n=Oo(n,t+1,0)))),n.s=i,go=!0,s.rounding=l,Oo(n,t,l))},So.toPrecision=function(e,a){var o,t=this,n=t.constructor;return void 0===e?o=Wo(t,t.e<=n.toExpNeg||t.e>=n.toExpPos):(Fo(e,1,co),void 0===a?a=n.rounding:Fo(a,0,8),t=Oo(new n(t),e,a),o=Wo(t,e<=t.e||t.e<=n.toExpNeg,e)),t.isNeg()&&!t.isZero()?"-"+o:o},So.toSignificantDigits=So.toSD=function(e,a){var o=this,t=o.constructor;return void 0===e?(e=t.precision,a=t.rounding):(Fo(e,1,co),void 0===a?a=t.rounding:Fo(a,0,8)),Oo(new t(o),e,a)},So.toString=function(){var e=this,a=e.constructor,o=Wo(e,e.e<=a.toExpNeg||e.e>=a.toExpPos);return e.isNeg()&&!e.isZero()?"-"+o:o},So.truncated=So.trunc=function(){return Oo(new this.constructor(this),this.e+1,1)},So.valueOf=So.toJSON=function(){var e=this,a=e.constructor,o=Wo(e,e.e<=a.toExpNeg||e.e>=a.toExpPos);return e.isNeg()?"-"+o:o};var jo=function(){function e(e,a,o){var t,n=0,l=e.length;for(e=e.slice();l--;)t=e[l]*a+n,e[l]=t%o|0,n=t/o|0;return n&&e.unshift(n),e}function a(e,a,o,t){var n,l;if(o!=t)l=o>t?1:-1;else for(n=l=0;n<o;n++)if(e[n]!=a[n]){l=e[n]>a[n]?1:-1;break}return l}function o(e,a,o,t){for(var n=0;o--;)e[o]-=n,n=e[o]<a[o]?1:0,e[o]=n*t+e[o]-a[o];for(;!e[0]&&e.length>1;)e.shift()}return function(t,n,l,i,r,s){var d,u,c,m,p,f,v,g,b,w,h,C,y,_,M,D,k,B,x,T,E=t.constructor,A=t.s==n.s?1:-1,I=t.d,z=n.d;if(!I||!I[0]||!z||!z[0])return new E(t.s&&n.s&&(I?!z||I[0]!=z[0]:z)?I&&0==I[0]||!z?0*A:A/0:NaN);for(s?(p=1,u=t.e-n.e):(s=To,p=Eo,u=_o(t.e/p)-_o(n.e/p)),x=z.length,k=I.length,b=new E(A),w=b.d=[],c=0;z[c]==(I[c]||0);c++);if(z[c]>(I[c]||0)&&u--,null==l?(_=l=E.precision,i=E.rounding):_=r?l+(t.e-n.e)+1:l,_<0)w.push(1),f=!0;else{if(_=_/p+2|0,c=0,1==x){for(m=0,z=z[0],_++;(c<k||m)&&_--;c++)M=m*s+(I[c]||0),w[c]=M/z|0,m=M%z|0;f=m||c<k}else{for(m=s/(z[0]+1)|0,m>1&&(z=e(z,m,s),I=e(I,m,s),x=z.length,k=I.length),D=x,h=I.slice(0,x),C=h.length;C<x;)h[C++]=0;T=z.slice(),T.unshift(0),B=z[0],z[1]>=s/2&&++B;do{m=0,d=a(z,h,x,C),d<0?(y=h[0],x!=C&&(y=y*s+(h[1]||0)),m=y/B|0,m>1?(m>=s&&(m=s-1),v=e(z,m,s),g=v.length,C=h.length,d=a(v,h,g,C),1==d&&(m--,o(v,x<g?T:z,g,s))):(0==m&&(d=m=1),v=z.slice()),g=v.length,g<C&&v.unshift(0),o(h,v,C,s),-1==d&&(C=h.length,d=a(z,h,x,C),d<1&&(m++,o(h,x<C?T:z,C,s))),C=h.length):0===d&&(m++,h=[0]),w[c++]=m,d&&h[0]?h[C++]=I[D]||0:(h=[I[D]],C=1)}while((D++<k||void 0!==h[0])&&_--);f=void 0!==h[0]}w[0]||w.shift()}if(1==p)b.e=u,io=f;else{for(c=1,m=w[0];m>=10;m/=10)c++;b.e=c+u*p-1,Oo(b,r?l+b.e+1:l,i,f)}return b}}();function Oo(e,a,o,t){var n,l,i,r,s,d,u,c,m,p=e.constructor;e:if(null!=a){if(c=e.d,!c)return e;for(n=1,r=c[0];r>=10;r/=10)n++;if(l=a-n,l<0)l+=Eo,i=a,u=c[m=0],s=u/Mo(10,n-i-1)%10|0;else if(m=Math.ceil((l+1)/Eo),r=c.length,m>=r){if(!t)break e;for(;r++<=m;)c.push(0);u=s=0,n=1,l%=Eo,i=l-Eo+1}else{for(u=r=c[m],n=1;r>=10;r/=10)n++;l%=Eo,i=l-Eo+n,s=i<0?0:u/Mo(10,n-i-1)%10|0}if(t=t||a<0||void 0!==c[m+1]||(i<0?u:u%Mo(10,n-i-1)),d=o<4?(s||t)&&(0==o||o==(e.s<0?3:2)):s>5||5==s&&(4==o||t||6==o&&(l>0?i>0?u/Mo(10,n-i):0:c[m-1])%10&1||o==(e.s<0?8:7)),a<1||!c[0])return c.length=0,d?(a-=e.e+1,c[0]=Mo(10,(Eo-a%Eo)%Eo),e.e=-a||0):c[0]=e.e=0,e;if(0==l?(c.length=m,r=1,m--):(c.length=m+1,r=Mo(10,Eo-l),c[m]=i>0?(u/Mo(10,n-i)%Mo(10,i)|0)*r:0),d)for(;;){if(0==m){for(l=1,i=c[0];i>=10;i/=10)l++;for(i=c[0]+=r,r=1;i>=10;i/=10)r++;l!=r&&(e.e++,c[0]==To&&(c[0]=1));break}if(c[m]+=r,c[m]!=To)break;c[m--]=0,r=1}for(l=c.length;0===c[--l];)c.pop()}return go&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function Wo(e,a,o){if(!e.isFinite())return Qo(e);var t,n=e.e,l=Ho(e.d),i=l.length;return a?(o&&(t=o-i)>0?l=l.charAt(0)+"."+l.slice(1)+qo(t):i>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(e.e<0?"e":"e+")+e.e):n<0?(l="0."+qo(-n-1)+l,o&&(t=o-i)>0&&(l+=qo(t))):n>=i?(l+=qo(n+1-i),o&&(t=o-n-1)>0&&(l=l+"."+qo(t))):((t=n+1)<i&&(l=l.slice(0,t)+"."+l.slice(t)),o&&(t=o-i)>0&&(n+1===i&&(l+="."),l+=qo(t))),l}function Ro(e,a){var o=e[0];for(a*=Eo;o>=10;o/=10)a++;return a}function Vo(e,a,o){if(a>Io)throw go=!0,o&&(e.precision=o),Error(ho);return Oo(new e(po),a,1,!0)}function $o(e,a,o){if(a>zo)throw Error(ho);return Oo(new e(fo),a,o,!0)}function Zo(e){var a=e.length-1,o=a*Eo+1;if(a=e[a],a){for(;a%10==0;a/=10)o--;for(a=e[0];a>=10;a/=10)o++}return o}function qo(e){for(var a="";e--;)a+="0";return a}function Lo(e,a,o,t){var n,l=new e(1),i=Math.ceil(t/Eo+4);for(go=!1;;){if(o%2&&(l=l.times(a),it(l.d,i)&&(n=!0)),o=_o(o/2),0===o){o=l.d.length-1,n&&0===l.d[o]&&++l.d[o];break}a=a.times(a),it(a.d,i)}return go=!0,l}function Yo(e){return 1&e.d[e.d.length-1]}function Go(e,a,o){for(var t,n,l=new e(a[0]),i=0;++i<a.length;){if(n=new e(a[i]),!n.s){l=n;break}t=l.cmp(n),(t===o||0===t&&l.s===o)&&(l=n)}return l}function Ko(e,a){var o,t,n,l,i,r,s,d=0,u=0,c=0,m=e.constructor,p=m.rounding,f=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);null==a?(go=!1,s=f):s=a,r=new m(.03125);while(e.e>-2)e=e.times(r),c+=5;for(t=Math.log(Mo(2,c))/Math.LN10*2+5|0,s+=t,o=l=i=new m(1),m.precision=s;;){if(l=Oo(l.times(e),s,1),o=o.times(++u),r=i.plus(jo(l,o,s,1)),Ho(r.d).slice(0,s)===Ho(i.d).slice(0,s)){n=c;while(n--)i=Oo(i.times(i),s,1);if(null!=a)return m.precision=f,i;if(!(d<3&&Po(i.d,s-t,p,d)))return Oo(i,m.precision=f,p,go=!0);m.precision=s+=10,o=l=r=new m(1),u=0,d++}i=r}}function Jo(e,a){var o,t,n,l,i,r,s,d,u,c,m,p=1,f=10,v=e,g=v.d,b=v.constructor,w=b.rounding,h=b.precision;if(v.s<0||!g||!g[0]||!v.e&&1==g[0]&&1==g.length)return new b(g&&!g[0]?-1/0:1!=v.s?NaN:g?0:v);if(null==a?(go=!1,u=h):u=a,b.precision=u+=f,o=Ho(g),t=o.charAt(0),!(Math.abs(l=v.e)<15e14))return d=Vo(b,u+2,h).times(l+""),v=Jo(new b(t+"."+o.slice(1)),u-f).plus(d),b.precision=h,null==a?Oo(v,h,w,go=!0):v;while(t<7&&1!=t||1==t&&o.charAt(1)>3)v=v.times(e),o=Ho(v.d),t=o.charAt(0),p++;for(l=v.e,t>1?(v=new b("0."+o),l++):v=new b(t+"."+o.slice(1)),c=v,s=i=v=jo(v.minus(1),v.plus(1),u,1),m=Oo(v.times(v),u,1),n=3;;){if(i=Oo(i.times(m),u,1),d=s.plus(jo(i,new b(n),u,1)),Ho(d.d).slice(0,u)===Ho(s.d).slice(0,u)){if(s=s.times(2),0!==l&&(s=s.plus(Vo(b,u+2,h).times(l+""))),s=jo(s,new b(p),u,1),null!=a)return b.precision=h,s;if(!Po(s.d,u-f,w,r))return Oo(s,b.precision=h,w,go=!0);b.precision=u+=f,d=i=v=jo(c.minus(1),c.plus(1),u,1),m=Oo(v.times(v),u,1),n=r=1}s=d,n+=2}}function Qo(e){return String(e.s*e.s/0)}function Xo(e,a){var o,t,n;for((o=a.indexOf("."))>-1&&(a=a.replace(".","")),(t=a.search(/e/i))>0?(o<0&&(o=t),o+=+a.slice(t+1),a=a.substring(0,t)):o<0&&(o=a.length),t=0;48===a.charCodeAt(t);t++);for(n=a.length;48===a.charCodeAt(n-1);--n);if(a=a.slice(t,n),a){if(n-=t,e.e=o=o-t-1,e.d=[],t=(o+1)%Eo,o<0&&(t+=Eo),t<n){for(t&&e.d.push(+a.slice(0,t)),n-=Eo;t<n;)e.d.push(+a.slice(t,t+=Eo));a=a.slice(t),t=Eo-a.length}else t-=n;for(;t--;)a+="0";e.d.push(+a),go&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function et(e,a){var o,t,n,l,i,r,s,d,u;if(a.indexOf("_")>-1){if(a=a.replace(/(\d)_(?=\d)/g,"$1"),xo.test(a))return Xo(e,a)}else if("Infinity"===a||"NaN"===a)return+a||(e.s=NaN),e.e=NaN,e.d=null,e;if(ko.test(a))o=16,a=a.toLowerCase();else if(Do.test(a))o=2;else{if(!Bo.test(a))throw Error(wo+a);o=8}for(l=a.search(/p/i),l>0?(s=+a.slice(l+1),a=a.substring(2,l)):a=a.slice(2),l=a.indexOf("."),i=l>=0,t=e.constructor,i&&(a=a.replace(".",""),r=a.length,l=r-l,n=Lo(t,new t(o),l,2*l)),d=No(a,o,To),u=d.length-1,l=u;0===d[l];--l)d.pop();return l<0?new t(0*e.s):(e.e=Ro(d,u),e.d=d,go=!1,i&&(e=jo(e,n,4*r)),s&&(e=e.times(Math.abs(s)<54?Mo(2,s):Yt.pow(2,s))),go=!0,e)}function at(e,a){var o,t=a.d.length;if(t<3)return a.isZero()?a:ot(e,2,a,a);o=1.4*Math.sqrt(t),o=o>16?16:0|o,a=a.times(1/tt(5,o)),a=ot(e,2,a,a);for(var n,l=new e(5),i=new e(16),r=new e(20);o--;)n=a.times(a),a=a.times(l.plus(n.times(i.times(n).minus(r))));return a}function ot(e,a,o,t,n){var l,i,r,s,d=e.precision,u=Math.ceil(d/Eo);for(go=!1,s=o.times(o),r=new e(t);;){if(i=jo(r.times(s),new e(a++*a++),d,1),r=n?t.plus(i):t.minus(i),t=jo(i.times(s),new e(a++*a++),d,1),i=r.plus(t),void 0!==i.d[u]){for(l=u;i.d[l]===r.d[l]&&l--;);if(-1==l)break}l=r,r=t,t=i,i=l}return go=!0,i.d.length=u+1,i}function tt(e,a){var o=e;while(--a)o*=e;return o}function nt(e,a){var o,t=a.s<0,n=$o(e,e.precision,1),l=n.times(.5);if(a=a.abs(),a.lte(l))return ro=t?4:1,a;if(o=a.divToInt(n),o.isZero())ro=t?3:2;else{if(a=a.minus(o.times(n)),a.lte(l))return ro=Yo(o)?t?2:3:t?4:1,a;ro=Yo(o)?t?1:4:t?3:2}return a.minus(n).abs()}function lt(e,a,o,t){var n,l,i,r,s,d,u,c,m,p=e.constructor,f=void 0!==o;if(f?(Fo(o,1,co),void 0===t?t=p.rounding:Fo(t,0,8)):(o=p.precision,t=p.rounding),e.isFinite()){for(u=Wo(e),i=u.indexOf("."),f?(n=2,16==a?o=4*o-3:8==a&&(o=3*o-2)):n=a,i>=0&&(u=u.replace(".",""),m=new p(1),m.e=u.length-i,m.d=No(Wo(m),10,n),m.e=m.d.length),c=No(u,10,n),l=s=c.length;0==c[--s];)c.pop();if(c[0]){if(i<0?l--:(e=new p(e),e.d=c,e.e=l,e=jo(e,m,o,t,0,n),c=e.d,l=e.e,d=io),i=c[o],r=n/2,d=d||void 0!==c[o+1],d=t<4?(void 0!==i||d)&&(0===t||t===(e.s<0?3:2)):i>r||i===r&&(4===t||d||6===t&&1&c[o-1]||t===(e.s<0?8:7)),c.length=o,d)for(;++c[--o]>n-1;)c[o]=0,o||(++l,c.unshift(1));for(s=c.length;!c[s-1];--s);for(i=0,u="";i<s;i++)u+=mo.charAt(c[i]);if(f){if(s>1)if(16==a||8==a){for(i=16==a?4:3,--s;s%i;s++)u+="0";for(c=No(u,n,a),s=c.length;!c[s-1];--s);for(i=1,u="1.";i<s;i++)u+=mo.charAt(c[i])}else u=u.charAt(0)+"."+u.slice(1);u=u+(l<0?"p":"p+")+l}else if(l<0){for(;++l;)u="0"+u;u="0."+u}else if(++l>s)for(l-=s;l--;)u+="0";else l<s&&(u=u.slice(0,l)+"."+u.slice(l))}else u=f?"0p+0":"0";u=(16==a?"0x":2==a?"0b":8==a?"0o":"")+u}else u=Qo(e);return e.s<0?"-"+u:u}function it(e,a){if(e.length>a)return e.length=a,!0}function rt(e){return new this(e).abs()}function st(e){return new this(e).acos()}function dt(e){return new this(e).acosh()}function ut(e,a){return new this(e).plus(a)}function ct(e){return new this(e).asin()}function mt(e){return new this(e).asinh()}function pt(e){return new this(e).atan()}function ft(e){return new this(e).atanh()}function vt(e,a){e=new this(e),a=new this(a);var o,t=this.precision,n=this.rounding,l=t+4;return e.s&&a.s?e.d||a.d?!a.d||e.isZero()?(o=a.s<0?$o(this,t,n):new this(0),o.s=e.s):!e.d||a.isZero()?(o=$o(this,l,1).times(.5),o.s=e.s):a.s<0?(this.precision=l,this.rounding=1,o=this.atan(jo(e,a,l,1)),a=$o(this,l,1),this.precision=t,this.rounding=n,o=e.s<0?o.minus(a):o.plus(a)):o=this.atan(jo(e,a,l,1)):(o=$o(this,l,1).times(a.s>0?.25:.75),o.s=e.s):o=new this(NaN),o}function gt(e){return new this(e).cbrt()}function bt(e){return Oo(e=new this(e),e.e+1,2)}function wt(e,a,o){return new this(e).clamp(a,o)}function ht(e){if(!e||"object"!==typeof e)throw Error(bo+"Object expected");var a,o,t,n=!0===e.defaults,l=["precision",1,co,"rounding",0,8,"toExpNeg",-uo,0,"toExpPos",0,uo,"maxE",0,uo,"minE",-uo,0,"modulo",0,9];for(a=0;a<l.length;a+=3)if(o=l[a],n&&(this[o]=vo[o]),void 0!==(t=e[o])){if(!(_o(t)===t&&t>=l[a+1]&&t<=l[a+2]))throw Error(wo+o+": "+t);this[o]=t}if(o="crypto",n&&(this[o]=vo[o]),void 0!==(t=e[o])){if(!0!==t&&!1!==t&&0!==t&&1!==t)throw Error(wo+o+": "+t);if(t){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(Co);this[o]=!0}else this[o]=!1}return this}function Ct(e){return new this(e).cos()}function yt(e){return new this(e).cosh()}function _t(e){var a,o,t;function n(e){var a,o,t,l=this;if(!(l instanceof n))return new n(e);if(l.constructor=n,xt(e))return l.s=e.s,void(go?!e.d||e.e>n.maxE?(l.e=NaN,l.d=null):e.e<n.minE?(l.e=0,l.d=[0]):(l.e=e.e,l.d=e.d.slice()):(l.e=e.e,l.d=e.d?e.d.slice():e.d));if(t=typeof e,"number"===t){if(0===e)return l.s=1/e<0?-1:1,l.e=0,void(l.d=[0]);if(e<0?(e=-e,l.s=-1):l.s=1,e===~~e&&e<1e7){for(a=0,o=e;o>=10;o/=10)a++;return void(go?a>n.maxE?(l.e=NaN,l.d=null):a<n.minE?(l.e=0,l.d=[0]):(l.e=a,l.d=[e]):(l.e=a,l.d=[e]))}return 0*e!==0?(e||(l.s=NaN),l.e=NaN,void(l.d=null)):Xo(l,e.toString())}if("string"===t)return 45===(o=e.charCodeAt(0))?(e=e.slice(1),l.s=-1):(43===o&&(e=e.slice(1)),l.s=1),xo.test(e)?Xo(l,e):et(l,e);if("bigint"===t)return e<0?(e=-e,l.s=-1):l.s=1,Xo(l,e.toString());throw Error(wo+e)}if(n.prototype=So,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=ht,n.clone=_t,n.isDecimal=xt,n.abs=rt,n.acos=st,n.acosh=dt,n.add=ut,n.asin=ct,n.asinh=mt,n.atan=pt,n.atanh=ft,n.atan2=vt,n.cbrt=gt,n.ceil=bt,n.clamp=wt,n.cos=Ct,n.cosh=yt,n.div=Mt,n.exp=Dt,n.floor=kt,n.hypot=Bt,n.ln=Tt,n.log=Et,n.log10=It,n.log2=At,n.max=zt,n.min=St,n.mod=Ht,n.mul=Ft,n.pow=Pt,n.random=Nt,n.round=Ut,n.sign=jt,n.sin=Ot,n.sinh=Wt,n.sqrt=Rt,n.sub=Vt,n.sum=$t,n.tan=Zt,n.tanh=qt,n.trunc=Lt,void 0===e&&(e={}),e&&!0!==e.defaults)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],a=0;a<t.length;)e.hasOwnProperty(o=t[a++])||(e[o]=this[o]);return n.config(e),n}function Mt(e,a){return new this(e).div(a)}function Dt(e){return new this(e).exp()}function kt(e){return Oo(e=new this(e),e.e+1,3)}function Bt(){var e,a,o=new this(0);for(go=!1,e=0;e<arguments.length;)if(a=new this(arguments[e++]),a.d)o.d&&(o=o.plus(a.times(a)));else{if(a.s)return go=!0,new this(1/0);o=a}return go=!0,o.sqrt()}function xt(e){return e instanceof Yt||e&&e.toStringTag===yo||!1}function Tt(e){return new this(e).ln()}function Et(e,a){return new this(e).log(a)}function At(e){return new this(e).log(2)}function It(e){return new this(e).log(10)}function zt(){return Go(this,arguments,-1)}function St(){return Go(this,arguments,1)}function Ht(e,a){return new this(e).mod(a)}function Ft(e,a){return new this(e).mul(a)}function Pt(e,a){return new this(e).pow(a)}function Nt(e){var a,o,t,n,l=0,i=new this(1),r=[];if(void 0===e?e=this.precision:Fo(e,1,co),t=Math.ceil(e/Eo),this.crypto)if(crypto.getRandomValues)for(a=crypto.getRandomValues(new Uint32Array(t));l<t;)n=a[l],n>=429e7?a[l]=crypto.getRandomValues(new Uint32Array(1))[0]:r[l++]=n%1e7;else{if(!crypto.randomBytes)throw Error(Co);for(a=crypto.randomBytes(t*=4);l<t;)n=a[l]+(a[l+1]<<8)+(a[l+2]<<16)+((127&a[l+3])<<24),n>=214e7?crypto.randomBytes(4).copy(a,l):(r.push(n%1e7),l+=4);l=t/4}else for(;l<t;)r[l++]=1e7*Math.random()|0;for(t=r[--l],e%=Eo,t&&e&&(n=Mo(10,Eo-e),r[l]=(t/n|0)*n);0===r[l];l--)r.pop();if(l<0)o=0,r=[0];else{for(o=-1;0===r[0];o-=Eo)r.shift();for(t=1,n=r[0];n>=10;n/=10)t++;t<Eo&&(o-=Eo-t)}return i.e=o,i.d=r,i}function Ut(e){return Oo(e=new this(e),e.e+1,this.rounding)}function jt(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Ot(e){return new this(e).sin()}function Wt(e){return new this(e).sinh()}function Rt(e){return new this(e).sqrt()}function Vt(e,a){return new this(e).sub(a)}function $t(){var e=0,a=arguments,o=new this(a[e]);for(go=!1;o.s&&++e<a.length;)o=o.plus(a[e]);return go=!0,Oo(o,this.precision,this.rounding)}function Zt(e){return new this(e).tan()}function qt(e){return new this(e).tanh()}function Lt(e){return Oo(e=new this(e),e.e+1,1)}So[Symbol.for("nodejs.util.inspect.custom")]=So.toString,So[Symbol.toStringTag]="Decimal";var Yt=So.constructor=_t(vo);po=new Yt(po),fo=new Yt(fo);var Gt=Yt,Kt={name:"CestaComponent",components:{MDBCard:M.Yl,MDBCardBody:M.H7,MDBCardTitle:M.QM,MDBCardText:M.Pp,MDBBtn:M.$v,MDBIcon:M.vm,MDBPopover:M.SW,ModalDescuentosTiendaComponent:so},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),l=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),r=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),s=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),u=(0,t.Fl)((()=>{let e=0;return c&&c.value?.lista&&c.value.lista.forEach((a=>{a.regalo&&(e+=a.puntos)})),e})),c=(0,t.Fl)((()=>{if(n.value)for(let e=0;e<n.value.length;e++)if(s.value&&s.value[d.value]&&n.value[e]._id==s.value[d.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",n.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),n.value[e];return null})),m=(0,D.iH)([]),p=(0,D.iH)(0),v=(0,D.iH)("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"),g=(0,D.iH)(!1),b=(0,D.iH)(!1),w=(0,t.f3)("postDisabledTecla"),h=(0,D.iH)(!1),C=(0,D.iH)(null),y=(0,D.iH)(null);(0,t.Fl)((()=>o.state.Discounts.discounts));function _(){c.value?.idCliente?k.Z.post("clientes/consultarPuntos",{idCliente:c.value?.idCliente}).then((e=>{"number"===typeof e.data?p.value=e.data:p.value=0})).catch((e=>{x().fire("Oops...",e.message,"error"),p.value=0})):p.value=0}const M=async e=>{if(e.regalo)return;await o.dispatch("Unidades/setUnidades",1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:c.value._id,unidades:1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[l.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[d.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",-1)},B=(0,D.iH)(!1),T=async e=>{if(e.unidades<=1||e.regalo||B.value)return;B.value=!0,await o.dispatch("Unidades/setUnidades",-1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:c.value._id,unidades:-1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[l.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[d.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",1),B.value=!1};function E(){if(s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]){let e=!0;if(void 0!=c.value&&"DEVOLUCION"==c?.value?.modo)return;for(let a=0;a<n.value.length;a++)if(n.value[a].trabajador==s.value[d.value].idTrabajador){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:n.value[a]._id,idTrabajador:s.value[d.value]._id}),e=!1;break}if(!e)return;A(),e=!1}else s.value&&void 0!=d.value&&null!=d.value?x().fire("Oops...","Error desconocido #123","error"):x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function A(){s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?await k.Z.post("cestas/crearCesta",{idTrabajador:s.value[d.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{x().fire("Oops...",e.message,"error")})):s.value&&void 0!=d.value&&null!=d.value||x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function I(e){return!(1==c.value?.albaran||1==c.value?.vip||null==c.value.idCliente||void 0==c.value.idCliente||""==c.value.idCliente||null==e.puntos||e.puntos<=0||e.subtotal<=0||"CONSUMO_PERSONAL"==c.value.modo)&&(p.value>u.value+e.puntos&&!e.regalo&&!m.value.includes(c.value.idCliente))}function z(e,a=null){k.Z.post("cestas/regalarProducto",{idCesta:c.value._id,indexLista:e,idPromoArtSel:a}).then((e=>{e.data?x().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):x().fire("Oops...","No se ha podido regalar el producto","error")}))}async function S(e,a){y.value=e,C.value?C.value.showModal(parseInt(a.descuentoTienda),c.value,e):console.error("modalDescuentosTienda no está definido.")}async function H(e,a){let t=a.promocion?a.promocion.grupos.flat():null;if(a.promocion&&t.length>1){let n='\n                <style>\n                input[type="radio"] {\n          appearance: none;\n          -webkit-appearance: none;\n          width: 20px;\n          height: 20px;\n          border: 2px solid black;\n          border-radius: 50%;\n\n          background-color: transparent;\n          position: relative;\n        }\n        .inputRegalo{\n          margin-left: 3rem ; /* Margen izquierdo de 2 columnas */\n          display: flex ; /* Display flex */\n          margin-top: 0.5rem ; /* Margen superior de 2 espacios */\n          margin-bottom: 0.5rem ;\n        }\n\n        label {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-left:5px;\n        }\n        .bloqueado {\n          pointer-events: none; /* Hace que el div no sea cliclable */\n          opacity: 0.6; /* Establece una opacidad inferior al normal (puedes ajustar el valor según tus preferencias) */\n        }\n        input[type="radio"]:checked::before {\n          content: "";\n          display: block;\n          width: 12px;\n          height: 12px;\n          background-color: #ca8489;\n          border-radius: 50%;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          animation: appear 0.8s;\n        }\n        @keyframes appear {\n          0% {\n            transform: translate(-50%, -50%) scale(0);\n            background-color: #fff;\n          }\n          45% {\n            transform: translate(-50%, -50%) scale(1.6);\n            background-color: #64aedf;\n          }\n          50% {\n            transform: translate(-50%, -50%) scale(1.7);\n            background-color: #ad97b3;\n          }\n          55% {\n            transform: translate(-50%, -50%) scale(1.6);\n          }\n          100% {\n            transform: translate(-50%, -50%) scale(1);\n            background-color: #ca8489;\n          }\n        }\n        </style>\n        <div class="col-12 mx-auto" >';for(let e of t){const o=(await k.Z.post("articulos/getArticuloById",{idArticulo:e.idArticulo})).data;n+=`<div class="inputRegalo ${null==o.puntos?"bloqueado":""}">\n              <input type="radio"  name="opcion" id="opcion1" value="${e.idArticulo}">\n              <label for="opcion1" class="col-9 d-flex">${e.nombre} \n                ${null==o.puntos?"":o.puntos*e.unidades*a.unidades+" p"}</label>\n            </div>`}n+="</div>",x().fire({title:"¿Cual articulo para regalar?",html:n,icon:"question",showDenyButton:!0,showConfirmButton:!0,confirmButtonText:"Si, regalar",denyButtonText:"No",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"},showClass:{popup:""},didOpen:()=>{const e=document.querySelector(".bloqueado");if(e){const a=e.querySelector("label").textContent;x().showValidationMessage(`${a} no se puede regalar`)}},preConfirm:()=>{const e=document.getElementsByName("opcion"),a=Array.from(e).find((e=>e.checked));return a?a.value:(x().showValidationMessage("Debes seleccionar una opción"),!1)}}).then((a=>{a.isConfirmed?(z(e,a.value),o.state.indexItemActivo=null):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}else x().fire({title:"¿Regalar este artículo?",text:`Se descontarán ${null!=a.puntos?a.puntos:0} puntos al cliente ${c.value.nombreCliente}`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?z(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}function F(e){o.dispatch("Cestas/setActivoAction",e)}function P(){const e=c.value.detalleIva,a=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((a,o)=>a+e[o]),0);return Number(a.toFixed(2))}function N(){if(!c.value)return;P();const e=c.value?.lista?c.value.lista.length:0;let a=0;for(let o=0;o<e;o++)a+=c.value.lista[o].subtotal;a>=12&&c.value?.idCliente==v.value&&!g.value?(b.value=!0,w(!0),g.value=!0):(c.value?.idCliente!=v.value||a<12||0==c.value.lista.length)&&g.value&&(b.value=!1,w(!1),g.value=!1,k.Z.post("/cestas/recalcularIvas",{idCesta:c.value._id}))}function U(){h.value=!0}function j(){h.value=!1}function O(e){const a=new Gt(e).toDecimalPlaces(2).toFixed(2);return a}return(0,t.YP)((()=>c.value?.lista),(()=>{N()})),a({actualizarPuntos:_,BuscarCestas:E}),(0,t.bv)((()=>{_(),N(),k.Z.get("clientes/getEsClienteFacturacion").then((e=>{e.data&&(m.value=e.data)}))})),{cesta:c,arrayTrabajadores:s,indexTrabajadorActivo:d,indexItemCestaActivo:r,clickItem:F,inicializarCesta:A,BuscarCestas:E,sePuedeRegalar:I,puntos:p,sumar:M,restar:T,clickRegalo:H,disabledCambiarUnidades:b,popOverTarifaEsp:h,showPopOver:U,hidePopOver:j,clickDiscountShop:S,modalDescuentosTienda:C,cOutPrecioOrig:O}}};const Jt=(0,E.Z)(Kt,[["render",Qa],["__scopeId","data-v-3e1b79ce"]]);var Qt=Jt;const Xt={class:"modoVenta d-block text-center"},en={key:0,class:"d-block textoNombreCliente text-center"},an={class:"text-truncate",style:{"max-width":"10rem"}},on={key:0,class:"d-flex justify-content-around mb-1"},tn={key:1,class:"d-block text-center textoNombreCliente"};function nn(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBtnGroup"),c=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),f=(0,t.up)("ModalUnidadesComponent"),v=(0,t.up)("tarjetaClienteNumero"),g=(0,t.up)("ModalEncargosComponent"),b=(0,t.up)("ModalNuevoCliente"),w=(0,t.up)("ModalExtendidoClienteComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[n.vistaEspecial&&n.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==n.cesta.modo,fondoEncargo:"RECOGER ENCARGO"==n.cesta.modo,fondoCliente:n.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",Xt,(0,d.zw)(n.cesta.modo),1),n.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",en,[(0,t._)("span",an,(0,d.zw)(n.cesta.nombreCliente),1),n.clienteSeleccionado?((0,t.wg)(),(0,t.iD)("div",on,[(0,t._)("span",null,"Encargos: "+(0,d.zw)(n.quantEncargo),1),(0,t._)("span",null,"Deudas: "+(0,d.zw)(n.quantDeuda),1)])):(0,t.kq)("",!0),(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>n.consultarPuntos(n.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",tn,(0,d.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),n.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(u,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>n.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[2]||(a[2]=e=>n.refModalArticulos.abrirModal()),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:n.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),n.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>n.refModalClientesSeleccionado.abrirModal(n.cesta.idCliente))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones ms-1",onMousedown:a[4]||(a[4]=e=>n.startPress()),onMouseup:a[5]||(a[5]=e=>n.endPress()),onTouchstartPassive:a[6]||(a[6]=e=>n.startPress()),onTouchendPassive:a[7]||(a[7]=e=>n.endPress()),disabled:"CONSUMO_PERSONAL"==n.cesta?.modo},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1},8,["disabled"]))])),_:1})),n.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(u,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{onClick:a[8]||(a[8]=e=>n.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[9]||(a[9]=e=>n.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[10]||(a[10]=e=>n.goTo("/cestas")),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:!n.siMesas}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1},8,["class"])])),_:1})),(0,t.Wm)(u,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==n.indexActivoCesta||null==n.indexActivoCesta?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones",onClick:a[11]||(a[11]=e=>n.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones",onClick:a[12]||(a[12]=e=>n.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(r,{onClick:a[13]||(a[13]=e=>n.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(r,{outline:"secondary",onClick:a[14]||(a[14]=e=>n.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",style:(0,d.j5)({fontSize:n.textoStock?"3em":"4em"})},null,8,["style"]),n.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:0,class:"stock",style:(0,d.j5)({fontSize:"16px",color:n.arrayStock["stock-IndicadorPos1"]?.fontColor})},(0,d.zw)(void 0!==n.arrayStock["stock-IndicadorPos1"]?.stock?n.arrayStock["stock-IndicadorPos1"]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(c,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(f,{ref:"refModalUnidades"},null,512),(0,t.Wm)(v,{ref:"tarjetaNum"},null,512),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512),(0,t.Wm)(b,{ref:"refModalNuevoCliente"},null,512),(0,t.Wm)(w,{ref:"refModalExtendidoCliente"},null,512)],64)}var ln=o(6411),rn=o(46626);const sn=e=>((0,t.dD)("data-v-87b8dff6"),e=e(),(0,t.Cn)(),e),dn={class:"header"},un={class:"col-md-8"},cn=["value"],mn=sn((()=>(0,t._)("div",{class:"col-md-12"},[(0,t._)("hr")],-1))),pn={class:"textoNombre d-inline-block text-truncate"},fn={key:0,class:"spinner-border",role:"status",style:{margin:"2%"}},vn=sn((()=>(0,t._)("span",{class:"visually-hidden"},"Loading...",-1))),gn=[vn],bn={key:1,style:{margin:"2%"}},wn={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function hn(e,a,o,n,l,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBadge"),u=(0,t.up)("MDBListGroupItem"),c=(0,t.up)("MDBListGroup"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModal"),f=(0,t.up)("KeyBoardComponent"),g=(0,t.Q2)("mdb-infinite-scroll");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:n.modalArticulos,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",dn,[(0,t._)("div",un,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",style:{"background-color":"#00ffff00"},placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example",readonly:"",onClick:a[0]||(a[0]=e=>n.openKeyboard()),"onUpdate:modelValue":a[1]||(a[1]=e=>n.inputBusqueda=e)},null,512),[[v.nr,n.inputBusqueda]])]),(0,t._)("select",{class:"Familia",onChange:a[2]||(a[2]=e=>n.selectFamilia(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.familias,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",value:n.familias[a].text},(0,d.zw)(n.familias[a].text),9,cn)))),256))],32)]),mn,n.arrayArticulos?.length>0?(0,t.wy)(((0,t.wg)(),(0,t.j4)(c,{key:0,class:"container",style:{"max-height":"461px","overflow-y":"scroll"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.j4)(u,{key:e.i,style:{"justify-content":"space-between"},class:"d-flex align-items-center",onClick:e=>n.selectArticulo({nombreArticulo:a.nombre,idArticle:a._id,esSumable:a.esSumable})},{default:(0,t.w5)((()=>[(0,t._)("td",null,[(0,t.Wm)(r,{icon:"tag",size:"2x",class:"me-4"}),(0,t._)("span",pn,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(s,{class:"textoFamilia d-inline-block text-truncate text-dark",badge:"info",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(a.familia),1)])),_:2},1024)])])),_:2},1032,["onClick"])))),128)),((0,t.wg)(),(0,t.j4)(u,{key:e.i,style:{"justify-content":"center"},class:"d-flex align-items-center"},{default:(0,t.w5)((()=>[n.maxLimit?((0,t.wg)(),(0,t.iD)("div",bn,[(0,t._)("span",wn,(0,d.zw)(e.$t("sin_resultados","No hay mas resultados")),1)])):((0,t.wg)(),(0,t.iD)("div",fn,gn))])),_:1}))])),_:1})),[[g,n.infiniteScroll]]):(0,t.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"keyboardRef"},null,512)],64)}var Cn=o(61562),yn={name:"ModalArticulosComponent",directives:{mdbInfiniteScroll:M.z9},components:{MDBModal:M.j3,MDBIcon:M.vm,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_,MDBSelect:M.R3,KeyBoardComponent:Cn.Z,MDBModalFooter:M.ab},setup(e,a){const o=(0,D.iH)(!1),n=(0,D.iH)(0),l=(0,D.iH)(null),i=(0,D.iH)(""),r=(0,D.iH)(),s=(0,D.iH)([{text:"Todos",value:"Todos"}]),d=(0,D.iH)("Todos"),u=(0,D.iH)(20),c=(0,D.iH)(!1),m=(0,t.f3)("clickTecla"),p=async()=>{u.value=u.value+20,await h()};function f(e){m(e),o.value=!1}async function v(){o.value=!0,u.value=20,c.value=!1,r.value=[],await b(),h()}function g(){n.value++}function b(){k.Z.post("articulos/familias").then((e=>{s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function w(e){d.value=e.target.value,u.value=20,c.value=!1,r.value=[],await h()}function h(){""!=i.value&&0==r.value.length&&(u.value=u.value+20*i.value.length),c.value=!1,k.Z.post("articulos/buscar",{busqueda:i.value,familia:d.value,limit:u.value}).then((e=>{r.value=e.data,u.value>r.value.length&&(c.value=!0)})).catch((e=>{x().fire("Oops...",e.message,"error")}))}let C;async function y(){try{l.value.abrirModal(i.value),C=setInterval((()=>{i.value=l.value.getValue()[0],l.value.getValue()[1]||clearInterval(C)}),100)}catch(e){console.log(e),C=void 0}}return(0,t.YP)(i,(()=>{h()})),a.expose({abrirModal:v,datoBorrar:n}),(0,t.bv)((async()=>{await b()})),{test:g,openKeyboard:y,maxLimit:c,datoBorrar:n,infiniteScroll:p,familias:s,keyboardRef:l,modalArticulos:o,selectFamilia:w,inputBusqueda:i,arrayArticulos:r,buscar:h,selectArticulo:f}}};const _n=(0,E.Z)(yn,[["render",hn],["__scopeId","data-v-87b8dff6"]]);var Mn=_n;const Dn={class:"row"},kn={class:"row"},Bn={class:"text-center"};function xn(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("NumpadComponent"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:n.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("introduce","Introduce"))+" "+(0,d.zw)(e.$t("las_unidades","las unidades"))+" "+(0,d.zw)(e.$t("y_marca","y marca"))+" "+(0,d.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",Dn,[n.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>n.refUnidadesComponent.cantidad=e)},null,512)),[[v.nr,n.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",kn,[(0,t._)("div",Bn,[(0,t.Wm)(u,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Tn={name:"UnidadesComponent",components:{NumpadComponent:Q.Z,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalTitle:M.wo},setup(){const e=(0,D.iH)(null),a=(0,D.iH)(null),o=(0,f.oR)();function n(){a.value=!0}function l(e){if(e>100)return x().fire({title:"Has añadido muchos productos.",html:`Vas a añadir <b>${e}<b/> productos,<br/><i> ¿estás segur@ de esta acción?</i>`,showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",confirmButtonColor:"info",cancelButtonColor:"green",iconColor:"info",icon:"info"}).then((t=>{t.isConfirmed&&(a.value=!1,o.dispatch("Unidades/setUnidades",e))}));a.value=!1,o.dispatch("Unidades/setUnidades",e)}return(0,t.JJ)("okValue",l),{refUnidadesComponent:e,modalUnidades:a,abrirModal:n}}};const En=(0,E.Z)(Tn,[["render",xn],["__scopeId","data-v-7e0f404e"]]);var An=En;const In={class:"text-center col-12 p3"},zn={class:"text-center h2"},Sn={class:"row"},Hn={class:"d-inline-block text-center"},Fn={class:"d-inline-block text-center"},Pn={id:"salir",class:"text-center"};function Nn(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal"),c=(0,t.up)("ModalEncargosComponent"),m=(0,t.up)("ModalDeudasComponent"),p=(0,t.up)("ModalFichaCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalClientesSeleccionado,"onUpdate:modelValue":a[5]||(a[5]=e=>n.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",In,[(0,t._)("span",zn,(0,d.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,d.zw)(n.cesta?.nombreCliente),1)]),(0,t._)("div",Sn,[(0,t._)("div",Hn,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),void 0==n.cliente?.noPagaEnTienda||!1===n.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:0,color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>n.abrirModalEncargos())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1})):(0,t.kq)("",!0),void 0==n.cliente?.noPagaEnTienda||!1===n.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:1,disabled:n.recogiendoEncargos,color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>n.abrirModalDeuda())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("Deudas","deudas")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0)]),(0,t._)("div",Fn,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.nuevoPedido},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_pedido","Nuevo pedido")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>n.ficha())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ficha","Ficha")),1)])),_:1})]),(0,t._)("div",Pn,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>n.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"refModalEncargos"},null,512),(0,t.Wm)(m,{ref:"refModalDeudas"},null,512),(0,t.Wm)(p,{ref:"refModalFichaCliente",callback:n.cambiosCliente},null,8,["callback"])],64)}const Un=e=>((0,t.dD)("data-v-0073e22a"),e=e(),(0,t.Cn)(),e),jn={class:"row"},On={class:"d-inline-block text-center"},Wn={class:"p-0"},Rn={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},Vn={class:"d-flex align-content-center ps-5"},$n={class:"content-date"},Zn=["min","max"],qn=Un((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),Ln={class:"content-date"},Yn=["min","max"],Gn={class:"d-flex pe-5 my-1"},Kn={class:"m-auto px-2"},Jn=["onClick"],Qn={class:"d-flex flex-row-reverse"},Xn={class:"d-flex m-0 p-0 justify-content-between"},el={key:0,class:"p-0"},al={key:0},ol={key:1},tl={key:1,class:"p-0",type:"button"},nl={key:2,class:"p-0",type:"button"},ll={class:"d-flex justify-content-between px-0 py-2 m-0"},il={class:"d-flex m-0 p-0 justify-content-between"},rl={class:"productos"},sl={class:"col-12"},dl={class:"col-3"},ul={class:"col-1"},cl={class:"col-1"},ml={class:"col-2"},pl={class:"col-2"},fl={class:"col-3"},vl={class:"d-flex flex-column justify-content-center"},gl={key:0},bl={key:1},wl={key:1},hl={class:"sinResultados position-relative"},Cl={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},yl={id:"salir"},_l={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},Ml=Un((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),Dl={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},kl=Un((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1))),Bl={class:"h4 mx-2 pb-2 border-bottom"},xl={class:"d-flex justify-content-around"},Tl={class:"my-3 d-flex flex-column content-date"},El={for:"dateStart",class:"h5"},Al=["min","max"],Il={class:"my-3 d-flex flex-column content-date"},zl={for:"dateFinal",class:"h5"},Sl=["min","max"],Hl={class:"h4 mx-2 pb-2 border-bottom"},Fl={class:"d-flex justify-content-around my-3"},Pl=Un((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),Nl={for:"orden1",class:"h6"},Ul=Un((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),jl={for:"orden2",class:"h6"},Ol=Un((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),Wl={for:"orden3",class:"h6"},Rl={class:"h6"},Vl=Un((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function $l(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),m=(0,t.up)("MDBModalTitle"),p=(0,t.up)("MDBModalHeader"),f=(0,t.up)("MDBModalFooter");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",labelledby:"tituloModalClientes",modelValue:n.modalEncargos,"onUpdate:modelValue":a[6]||(a[6]=e=>n.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",jn,[(0,t._)("div",On,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.goTo("/menu/encargos")),disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1},8,["disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.recoger,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.anular,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.abrirModalImprimir,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick","disabled"])]),(0,t._)("div",Wn,[(0,t._)("div",Rn,[(0,t._)("div",Vn,[(0,t._)("div",$n,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>n.startSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[2]||(a[2]=e=>(n.mostrar(),n.currentPage=1))},null,40,Zn),[[v.nr,n.startSelectedDate]])]),qn,(0,t._)("div",Ln,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>n.finalSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[4]||(a[4]=e=>(n.mostrar(),n.currentPage=1))},null,40,Yn),[[v.nr,n.finalSelectedDate]])])]),(0,t._)("div",Gn,[(0,t._)("span",Kn,(0,d.zw)(n.startRange)+" - "+(0,d.zw)(n.endRange)+" de "+(0,d.zw)(n.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])])]),(0,t.Wm)(v.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[n.encargos&&n.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>n.onClickEncargo(o),class:(0,d.C_)({active:n.seleccionado===o,horaTarde:1==n.horaTarde(a),diaTarde:1==n.diaTarde(a)})},[(0,t._)("div",Qn,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>n.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",Xn,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",el,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",al,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",ol,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",tl,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",nl,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a?.dias[0]?.dia)+" - "+(0,d.zw)(a?.dias[0]?.dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",ll,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",il,[(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,d.zw)(e.$t("dependienta","Dependienta"))+": "+(0,d.zw)(a?.nombreDependienta),1)]),(0,t._)("div",rl,[(0,t._)("table",sl,[(0,t._)("tr",null,[(0,t._)("th",dl,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",ul,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",cl,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",ml,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",pl,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",fl,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",vl,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",gl,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",bl,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,Jn)])))),128)):((0,t.wg)(),(0,t.iD)("div",wl,[(0,t._)("div",hl,[(0,t._)("span",Cl,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",yl,[(0,t._)("div",_l,[Ml,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[5]||(a[5]=e=>n.cerrarModal()),disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1},8,["disabled"]),(0,t._)("div",Dl,[kl,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:n.modalImprimirEncargos,"onUpdate:modelValue":a[14]||(a[14]=e=>n.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:n.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("h2",Bl,(0,d.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",xl,[(0,t._)("div",Tl,[(0,t._)("label",El,(0,d.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[7]||(a[7]=e=>n.dateStart=e),min:n.startInputDate,max:n.finalInputDate},null,8,Al),[[v.nr,n.dateStart]])]),(0,t._)("div",Il,[(0,t._)("label",zl,(0,d.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[8]||(a[8]=e=>n.dateFinal=e),min:n.startInputDate,max:n.finalInputDate},null,8,Sl),[[v.nr,n.dateFinal]])])]),(0,t._)("h2",Hl,(0,d.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",Fl,[(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>n.orden="producto")},[Pl,(0,t._)("label",Nl,(0,d.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[10]||(a[10]=e=>n.orden="Cliente")},[Ul,(0,t._)("label",jl,(0,d.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[11]||(a[11]=e=>n.orden="producto_resumido")},[Ol,(0,t._)("label",Wl,(0,d.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!n.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",Rl,[Vl,(0,t.Uk)(" "+(0,d.zw)(n.commentError),1)])],2)])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[12]||(a[12]=e=>n.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[13]||(a[13]=e=>n.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"])],64)}var Zl={name:"modalEncargosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm},setup(e,a){const o=(0,D.iH)(!1),n=(0,f.oR)(),l=(0,ya.tv)(),i=(0,D.iH)(null),r=((0,D.iH)(0),(0,D.iH)()),s=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),u=(0,t.Fl)((()=>s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?s.value[d.value]:null)),c=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(s.value&&s.value[d.value]&&c.value[e]._id==s.value[d.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(!1),v=new Date,g=(0,D.iH)(-1),b=new Date(v.getFullYear(),v.getMonth(),v.getDate(),0,0,0),w=(0,D.iH)(null),h=(0,D.iH)(null),C=(0,D.iH)(null),y=(0,D.iH)(null);b.setDate(b.getDate()+1);let _="1";const M=(0,D.iH)([]),B=(0,D.iH)(null),T=(0,D.iH)(!1),E=(0,D.iH)(null),A=(0,D.iH)(null),I=(0,D.iH)(null),z=(0,D.iH)(null),S=(0,D.iH)(!1),H=(0,D.iH)(null),F=(0,D.iH)(null),P=(0,t.Fl)((()=>n.state.Encargos.encargoToModalEnc));function N(e,a){F.value=e,H.value=a,i.value=!0,Z()}const U=(0,D.iH)(1),j=(0,D.iH)(20),O=(0,t.Fl)((()=>B.value?Math.ceil(B.value.length/j.value):0)),W=(0,t.Fl)((()=>(U.value-1)*j.value+1)),R=(0,t.Fl)((()=>Math.min(U.value*j.value,B.value?.length||0))),V=(0,t.f3)("cerrarModalClientesSeleccionado"),$=(0,t.f3)("eliminarCestaActual");async function Z(){await k.Z.post("/encargos/getEncargosByIdCliente",{idCliente:H.value}).then((e=>{M.value=e.data,M.value&&0!==M.value.length&&(q(M.value),G())}))}function q(e){let a=null,o=null;for(const t of e){1==t.opcionRecogida&&"am"==t.amPm&&(t.hora="14:59"),1==t.opcionRecogida&&"pm"==t.amPm&&(t.hora="23:59");const e=new Date(t.fecha);(null===a||e<a)&&(a=e),(null===o||e>o)&&(o=e)}C.value=a?.toISOString().slice(0,10),w.value=a?.toISOString().slice(0,10),h.value=o?.toISOString().slice(0,10),y.value=o?.toISOString().slice(0,10)}function L(e,a=!1){i.value=!0,p.value=!0,k.Z.post("/encargos/getEncargoById",{idEncargo:e}).then((async e=>{if(B.value=[e.data],"SIN_RECOGER"!=B.value[0].estado)return i.value=!1,void x().fire({icon:"info",title:"Este encargo ya se ha pagado/anulado",showConfirmButton:!0});if(1==B.value.length&&a&&(g.value=0),q(B.value),!a){Q(0);const e=ee();oe(e)}}))}function Y(e){l.push(e)}function G(){if(B.value=[],M.value=M.value||[],Array.isArray(M.value)){for(const e of M.value){const a=e.fecha;a>=w.value&&a<=h.value&&B.value.push(e)}B.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}}function K(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),n=a.getMinutes(),l=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(l<t||l==t&&i<n)}function J(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function Q(e){g.value=e}function X(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function ee(){return g.value+(U.value-1)*j.value}async function ae(){o.value=!0;const e=ee();if(-1!=g.value){let a=X(B.value[e].total-B.value[e].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+a+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cesta",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async a=>{a.isConfirmed?oe(e):o.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),o.value=!1}function oe(e){try{let a=X(B.value[e].total-B.value[e].dejaCuenta,2);n.dispatch("Cestas/setCestaBaseAction",F.value);const o=B.value[e].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:o}).then((async o=>{if(!o.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.data,idTrabajador:u.value._id}).then((async l=>{let i=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let e=0;e<i.value.length;e++)if(i.value[e]._id==o.data)return i.value[e]}));(r.value.modo="RECOGER ENCARGO")&&(n.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:a}),p.value||V(),me(),n.dispatch("Encargos/setEncargoSeleccionado",B.value[e]))}))}))}catch(a){}finally{o.value=!1}}function te(){const e=ee();-1!=g.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((a=>{a.isConfirmed&&(B.value[e].dejaCuenta>0?x().fire({title:"Devolver anticipo de "+B.value[e].dejaCuenta+"€ al cliente?",icon:"warning",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",denyButtonText:"No",confirmButtonText:"Si",cancelButtonText:"Cancelar",confirmButtonColor:"green",denyButtonColor:"red",cancelButtonColor:"gray"}).then((a=>{a.isConfirmed?k.Z.post("movimientos/nuevoMovimiento",{cantidad:B.value[e].dejaCuenta,concepto:"dejaACuenta",idTrabajador:u.value._id,tipo:"SALIDA",nombreCliente:B.value[e].nombreCliente}).then((a=>{if(a.data)return k.Z.post("impresora/abrirCajon"),void ne(e);throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})):a.isDenied?ne(e):o.value=!1})):ne(e))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function ne(e){k.Z.post("/encargos/anularEncargo",{id:B.value[e]._id}).then((async a=>{if(a?.data){const a=await n.dispatch("Encargos/cancelarEncargoEnUso",{id:B.value[e]._id});a&&$(),B.value.splice(g.value,1),g.value=-1,Z(),p.value&&me(),x().fire("Perfecto","Encargo anulado correctamente","success")}else x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function le(){T.value=!0}function ie(){S.value=!1,z.value="",T.value=!1,I.value=null}function re(){if(!E.value||!A.value)return z.value="Por favor, ingresa ambas fechas",void(S.value=!0);if(A.value<E.value)return z.value="La fecha final no puede ser anterior a la fecha inicial",void(S.value=!0);if(null==I.value)return z.value="Elige una opción de orden",void(S.value=!0);{const e=[];for(const a of M.value){const o=a.fecha;o>=E.value&&o<=A.value&&e.push(a)}if(0==e.length)return z.value="El intervalo de fechas seleccionado no contiene encargos.",void(S.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:I.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),ie()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function se(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function de(){const e=(U.value-1)*j.value,a=e+j.value;return B.value.slice(e,a)}function ue(){U.value<O.value&&U.value++}function ce(){U.value>1&&U.value--}function me(){p.value=!1,g.value=-1,i.value=!1}return(0,t.YP)(U,(()=>{g.value=-1})),(0,t.YP)(B,(()=>{B.value.length<W.value&&(U.value=1)})),(0,t.YP)(P,((e,a)=>{if(e&&e._id&&e!==a){const a=e._id;H.value=e.idCliente,n.dispatch("Encargos/deleteEncargoToModalEnc"),L(a,!0)}}),{deep:!0}),a.expose({abrirModal:N,getEncargo:L}),{modalEncargos:i,arrayClientes:r,cesta:m,goTo:Y,encargos:B,mostrar:G,listado:_,seleccionado:g,onClickEncargo:Q,recoger:ae,anular:te,redondearDecimales:X,diaTarde:J,horaTarde:K,cargarEncargos:Z,imprimir:re,botonBloqueado:o,getEncargo:L,startSelectedDate:w,finalSelectedDate:h,startInputDate:C,finalInputDate:y,abrirModalImprimir:le,modalImprimirEncargos:T,errorValidacionImp:S,dateStart:E,dateFinal:A,orden:I,commentError:z,cerrarModalImprimir:ie,currentPage:U,itemsPerPage:j,totalPages:O,paginatedItems:de,nextPage:ue,prevPage:ce,startRange:W,endRange:R,cerrarModal:me,printCharge:se}}};const ql=(0,E.Z)(Zl,[["render",$l],["__scopeId","data-v-0073e22a"]]);var Ll=ql;const Yl=e=>((0,t.dD)("data-v-7e8d2dd9"),e=e(),(0,t.Cn)(),e),Gl={class:"row"},Kl={class:"d-inline-block text-center"},Jl={class:"p-0"},Ql={class:"d-flex justify-content-between px-5"},Xl={class:"d-flex pe-5 my-1"},ei={class:"m-auto px-2"},ai={class:"d-flex"},oi={class:"text-center d-flex justify-content-center align-items-center"},ti=Yl((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),ni={class:"size ps-2"},li={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},ii=Yl((()=>(0,t._)("div",{class:"spinner"},null,-1))),ri=[ii],si=["onClick"],di={class:"d-flex m-0 p-0 justify-content-between"},ui={class:"d-flex justify-content-between px-0 py-2 m-0"},ci={class:"productos"},mi={class:"col-12"},pi=Yl((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),fi={class:"d-flex flex-column justify-content-center"},vi={key:0},gi={key:1},bi={key:2},wi={class:"sinResultados position-relative"},hi={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Ci={id:"salir"},yi={key:0},_i=Yl((()=>(0,t._)("h1",{class:"h5"},"Selecciona el tipo de pago:",-1))),Mi={class:"d-flex flex-column"},Di={class:"form-check"},ki={class:"form-check-label",for:"pagoTotal"},Bi={class:"form-check mt-2"},xi=Yl((()=>(0,t._)("label",{class:"form-check-label",for:"pagoParcial"}," Pago parcial: ",-1))),Ti={class:"row"},Ei={class:"col"},Ai={class:"input-group input-group-lg"},Ii={class:"row"},zi={class:"col text-center"};function Si(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBadge"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal"),p=(0,t.up)("MDBInput"),f=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModalHeader"),b=(0,t.up)("NumpadComponent"),w=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(m,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalDeudas,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalDeudas=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",Gl,[(0,t._)("div",Kl,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.goTo("/menu/deudas"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nueva_deuda","Nueva deuda")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.findOutPagar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.eliminar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",Jl,[(0,t._)("div",Ql,[(0,t._)("div",Xl,[(0,t._)("span",ei,(0,d.zw)(n.startRange)+" - "+(0,d.zw)(n.endRange)+" de "+(0,d.zw)(n.arrayDeudas?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])]),(0,t._)("div",ai,[(0,t.Wm)(r,{onClick:a[1]||(a[1]=e=>n.selectAllDebtsClient()),class:"bg-info text-white my-1 me-2"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1}),(0,t._)("div",oi,[ti,(0,t._)("span",ni,(0,d.zw)(n.seleccionados.length),1)])])]),(0,t.Wm)(v.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("div",li,ri)):n.arrayDeudas&&n.arrayDeudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:o},[(0,t._)("div",{type:"button",onClick:e=>n.onClickDeuda(a._id),class:(0,d.C_)({active:n.seleccionados.includes(a._id)})},[(0,t._)("div",di,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(n.getFecha(a?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,d.zw)(a?.nombreCliente),1),a?.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",ui,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(a?.cesta?.lista?.length),1),(0,t._)("div",ci,[(0,t._)("table",mi,[pi,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",fi,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",vi,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",gi,"Ninguno"))])])))),128))])])],10,si)])))),128)):((0,t.wg)(),(0,t.iD)("div",bi,[(0,t._)("div",wi,[(0,t._)("span",hi,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",Ci,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[2]||(a[2]=e=>n.cerrarModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalPagoDeudasRef",tabindex:"-1",labelledby:"ModalPagoDeudas",modelValue:n.modalPagoDeudasRef,"onUpdate:modelValue":a[11]||(a[11]=e=>n.modalPagoDeudasRef=e),centered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[n.modalPagoDeudasRef?((0,t.wg)(),(0,t.iD)("div",yi,[_i,(0,t._)("div",Mi,[(0,t._)("div",Di,[(0,t.wy)((0,t._)("input",{class:"form-check-input",type:"radio",name:"tipoPago",id:"pagoTotal",value:"total","onUpdate:modelValue":a[4]||(a[4]=e=>n.tipoPago=e),onChange:a[5]||(a[5]=e=>n.pagoParcial=n.totalAPagar)},null,544),[[v.G2,n.tipoPago]]),(0,t._)("label",ki," Pago total ("+(0,d.zw)(n.totalAPagar)+"€) ",1)]),(0,t._)("div",Bi,[(0,t.wy)((0,t._)("input",{class:"form-check-input",type:"radio",name:"tipoPago",id:"pagoParcial",value:"parcial","onUpdate:modelValue":a[6]||(a[6]=e=>n.tipoPago=e),onChange:a[7]||(a[7]=e=>n.pagoParcial=0)},null,544),[[v.G2,n.tipoPago]]),xi,"parcial"===n.tipoPago?((0,t.wg)(),(0,t.j4)(p,{key:0,type:"number",name:"PagoDeuda",id:"pagoDeudaInput",min:0,max:n.totalAPagar,step:"0.01",modelValue:n.pagoParcial,"onUpdate:modelValue":a[8]||(a[8]=e=>n.pagoParcial=e),onClick:a[9]||(a[9]=e=>n.openTecladoNum()),readonly:"",class:"mt-2 col-3 form-control",placeholder:"Ingresa el monto parcial"},null,8,["max","modelValue"])):(0,t.kq)("",!0)])])])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"primary",onClick:n.pagar},{default:(0,t.w5)((()=>[(0,t.Uk)(" Ir a Cobrar ")])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"danger",onClick:a[10]||(a[10]=e=>n.cerrarModalPagoDeudas())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:n.modalTecladoNum,"onUpdate:modelValue":a[15]||(a[15]=e=>n.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,t.w5)((()=>[(0,t.Wm)(g),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ti,[(0,t._)("div",Ei,[(0,t._)("div",Ai,[n.numpadRef?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[12]||(a[12]=e=>n.numpadRef.cantidad=e)},null,512)),[[v.nr,n.numpadRef.cantidad]]):(0,t.kq)("",!0)])])]),(0,t._)("div",Ii,[(0,t._)("div",zi,[(0,t.Wm)(b,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",onClick:a[13]||(a[13]=e=>n.closeTecladoNum()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[14]||(a[14]=e=>n.finishTecladoNum())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(w,{ref:"keyboardRef"},null,512)],64)}var Hi={name:"modaldeudasComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,KeyBoardComponentVue:Cn.Z,MDBBadge:M.m_,MDBIcon:M.vm,MDBModalFooter:M.ab,MDBInput:M.u2,NumpadComponent:Q.Z},setup(e,a){const o=(0,D.iH)(null),n=(0,ya.tv)(),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)([]),s=(0,D.iH)(-1),d=(0,D.iH)(null),u=(0,D.iH)(""),c=(0,D.iH)("1"),m=(0,f.oR)(),p=(0,D.iH)(null),v=(0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),g=(0,t.Fl)((()=>m.state.Trabajadores.arrayTrabajadores)),b=((0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),(0,t.Fl)((()=>g.value&&void 0!=v.value&&null!=v.value&&g.value[v.value]?g.value[v.value]:null))),w=(0,D.iH)(null),h=(0,t.Fl)((()=>m.state.ModalCobroView.modalCobroViewAbierto)),C=(0,D.iH)(null),y=(0,D.iH)(!1),_=(0,D.iH)(0),M=(0,t.Fl)((()=>R(L(),2))),B=(0,D.iH)("total"),T=()=>{_.value=0,y.value=!1},E=(0,D.iH)(null),A=(0,D.iH)(null);function I(e,a){p.value=e,C.value=a,o.value=!0,O()}const z=(0,D.iH)(!1),S=(0,t.f3)("cerrarModalClientesSeleccionado"),H=(0,t.Fl)((()=>m.state.Deudas.deudasToModal)),F=(0,D.iH)(1),P=(0,D.iH)(5),N=(0,t.Fl)((()=>i.value?Math.ceil(i.value.length/P.value):0)),U=(0,t.Fl)((()=>(F.value-1)*P.value+1)),j=(0,t.Fl)((()=>Math.min(F.value*P.value,i.value?.length||0)));function O(){z.value=!0,k.Z.post("/deudas/getDeudasByIdCliente",{idCliente:C.value}).then((async e=>{l.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),l.value.sort(((e,a)=>e.timestamp-a.timestamp));for(const a of l.value){const e=(await k.Z.post("clientes/getClienteById",{idCliente:a.idCliente})).data;a.albaran=e?.albaran,a.dejaCuenta||(a.dejaCuenta=0)}i.value=l.value,z.value=!1,W()})).catch((e=>{z.value=!1}))}function W(){switch(c.value){case"1":i.value.sort(((e,a)=>e.timestamp-a.timestamp));break;case"2":i.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":i.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function R(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function V(){r.value=i.value.map((e=>e._id))}function $(e){const a=i.value.find((a=>a._id===e)).idCliente,o=i.value.find((a=>a._id===e))._id;r.value.includes(o)?r.value.splice(r.value.indexOf(o),1):w.value&&a!=w.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):r.value.push(o),Z()}function Z(){r.value.length>=1&&null==w.value&&(w.value=i.value.find((e=>e._id===r.value[0])).idCliente),0==r.value.length&&(w.value=null)}function q(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),n=("0"+a.getDate()).slice(-2),l=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+n+" "+l+":"+i+":"+r);return s}function L(){let e=0,a=i.value.filter((e=>r.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}function Y(){y.value=!0}async function G(){0!=r.value.length?Y():x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function K(){if("total"===B.value&&(_.value=M.value),_.value<0)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser negativo"});if(_.value>M.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser mayor al total a pagar"});if(0==_.value&&0!=M.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser 0"});const e=i.value.filter((e=>r.value.includes(e._id))),a=R(e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),2),o=Math.max(...e.map((e=>e.total-e.dejaCuenta))),n=R(a-o,2);if(_.value<n)return void x().fire({icon:"info",title:"Oops...",text:"El pago debe superar el monto minimo de "+n});const l=r.value,s=[];try{m.dispatch("Cestas/setCestaBaseAction",p.value);const e=[];for(const a of l)e.push(i.value.find((e=>e._id===a)).cesta),s.push(i.value.find((e=>e._id===a)));k.Z.post("cestas/cestaDeudas",{cestas:e}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:b.value._id}).then((async a=>{let o=(0,t.Fl)((()=>m.state.Cestas.arrayCestas)),n=await(0,t.Fl)((()=>{if(o.value)for(let a=0;a<o.value.length;a++)if(o.value[a]._id==e.data)return o.value[a]}));(n.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:L()}),m.dispatch("Deudas/setDeudasSeleccionadas",s),_.value!=M.value&&m.dispatch("Deudas/setTotalAPagar",_.value),m.dispatch("ModalCobroView/abrirModalCobroView"),T())}))}))}catch(d){console.log("Error",d),x().fire("Oops...",d.message,"error")}}function J(){O(),u.value="",n.push("/main")}function Q(){0!=r.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+r.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=r.value;try{const a=[];for(const o of e)a.push(await X(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success"),ie.value&&te()}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}J()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function X(e){const a=i.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function ee(){const e=(F.value-1)*P.value,a=e+P.value;return i.value.slice(e,a)}function ae(){F.value<N.value&&F.value++}function oe(){F.value>1&&F.value--}function te(){o.value=!1,F.value=1,s.value=-1,r.value=[],ie.value=!1}function ne(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input">\n          </div>\n          <div id="fechas my-input-class"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function le(){const e=u?.value,a=[];if(e&&e.length>0){for(let o=0;o<l.value.length;o++)l.value[o].nombreCliente.toLowerCase().includes(e.toLocaleLowerCase())&&a.push(l.value[o]);i.value=a}else i.value=l.value}const ie=(0,D.iH)(!1);function re(e){o.value=!0,r.value=e.map((e=>e._id)),ie.value=!0,i.value=e}const se=()=>{E.value=!0},de=()=>{E.value=!1},ue=()=>{let e=Number(A.value.cantidad);_.value=Number(e.toFixed(2)),de()};function ce(e){n.push(e)}let me;async function pe(){try{d.value.abrirModal(u.value),me=setInterval((()=>{u.value=d.value.getValue()[0],d.value.getValue()[1]||clearInterval(me)}),100)}catch(e){console.log(e),me=void 0}}return(0,t.JJ)("okValue",(()=>E.value?ue():se())),(0,t.YP)(i,(()=>{i.value.length<U.value&&(F.value=1)})),(0,t.YP)(u,(()=>{le()})),(0,t.YP)(h,(()=>{!h.value&&o.value&&(ie.value||(S(),k.Z.post("impresora/despedida",{precioTotal:L()})),te())})),(0,t.YP)(H,((e,a)=>{if(e&&JSON.stringify(e)!==JSON.stringify(a)&&e.length>0){const a=e;C.value=a[0].idCliente,re(a),m.dispatch("Deudas/deleteDeudasToModal")}})),a.expose({abrirModal:I,getDeuda:re}),{modalDeudas:o,goTo:ce,cargarDeudas:O,redondearDecimales:R,deudasFiltradas:l,arrayDeudas:i,onClickDeuda:$,seleccionado:s,seleccionados:r,pagar:K,getFecha:q,eliminar:Q,imprimir:ne,buscar:le,openKeyboard:pe,keyboardRef:d,inputBusqueda:u,loading:z,filtrarLista:W,selectFiltro:c,cerrarModal:te,currentPage:F,itemsPerPage:P,totalPages:N,paginatedItems:ee,nextPage:ae,prevPage:oe,startRange:U,endRange:j,getTotalSeleccionados:L,findOutPagar:G,modalPagoDeudasRef:y,pagoParcial:_,totalAPagar:M,cerrarModalPagoDeudas:T,tipoPago:B,modalTecladoNum:E,numpadRef:A,openTecladoNum:se,closeTecladoNum:de,finishTecladoNum:ue,selectAllDebtsClient:V}}};const Fi=(0,E.Z)(Hi,[["render",Si],["__scopeId","data-v-7e8d2dd9"]]);var Pi=Fi;const Ni={class:"row"},Ui={class:"col w-50"},ji={class:"col w-50 datos"},Oi={key:0,class:"spinner"},Wi={key:1};function Ri(e,a,o,n,l,i){const r=(0,t.up)("MDBModalHeader"),s=(0,t.up)("MDBInput"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:n.modalFichaCliente,"onUpdate:modelValue":a[9]||(a[9]=e=>n.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,d.zw)(n.nombre),1)])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ni,[(0,t._)("div",Ui,[(0,t.Wm)(s,{label:"Nombre",modelValue:n.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e),style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Teléfono",modelValue:n.telefono,"onUpdate:modelValue":a[1]||(a[1]=e=>n.telefono=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Correo electrónico",modelValue:n.email,"onUpdate:modelValue":a[2]||(a[2]=e=>n.email=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Dirección",modelValue:n.direccion,"onUpdate:modelValue":a[3]||(a[3]=e=>n.direccion=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])]),(0,t._)("div",ji,[(0,t.Wm)(s,{label:"Tarjeta cliente",modelValue:n.tarjeta,"onUpdate:modelValue":a[4]||(a[4]=e=>n.tarjeta=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Documento de identidad",modelValue:n.nif,"onUpdate:modelValue":a[5]||(a[5]=e=>n.nif=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),!n.clienteToc||n.clienteToc?.albaran||n.clienteToc?.vip?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:0,label:"Descuento aplicado",min:"0",max:"100",type:"number",modelValue:n.descuento,"onUpdate:modelValue":a[6]||(a[6]=e=>n.descuento=e),class:"datos",style:{"margin-top":"10px"},onChange:n.validateDescuento},null,8,["modelValue","onChange"]))])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"primary",onClick:a[7]||(a[7]=e=>n.guardarCliente()),disabled:n.loading,class:"btnSpinner d-flex align-items-center justify-content-center"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("span",Oi)):((0,t.wg)(),(0,t.iD)("span",Wi,"Guardar"))])),_:1},8,["disabled"]),(0,t.Wm)(c,{color:"danger",onClick:a[8]||(a[8]=e=>n.modalFichaCliente=!1),ref:"salirBoton",disabled:n.loading},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])}var Vi={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:M.$v,MDBInput:M.u2,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBModalHeader:M.ol},setup(e,a){const o=(0,D.iH)(!1),n=e=>{o.value=!0,w(e)};a.expose({abrirModal:n});const l=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(""),s=(0,D.iH)(""),d=(0,D.iH)(""),u=(0,D.iH)(""),c=(0,D.iH)("0"),m=(0,D.iH)(null),p=(0,D.iH)(null),f=(0,D.iH)(null),v=(0,t.f3)("cambiosCliente"),g=(0,D.iH)(!1),b=()=>{""!=l.value?isNaN(Number(c.value))?x().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):(g.value=!0,k.Z.post("clientes/actualizarCliente",{idCliente:m.value,nombre:l.value,telefono:i.value,email:r.value,direccion:s.value,tarjetaCliente:d.value,nif:u.value,descuento:c.value}).then((()=>{x().fire({title:"Cliente actualizado",icon:"success",confirmButtonText:"Aceptar"}),e.callback({nombre:l.value,descuento:c.value}),o.value=!1})).catch((e=>{x().fire({title:"Vaya...",text:"No se ha podido actualizar el cliente",icon:"error",confirmButtonText:"Aceptar"})})).finally((()=>{g.value=!1}))):x().fire({title:"Vaya...",text:"No se puede dejar el nombre vacio",icon:"error",confirmButtonText:"Aceptar"})},w=async e=>{const{data:a}=await k.Z.post("/clientes/getClienteById",{idCliente:e});if(!a)throw new Error("No se ha podido cargar el cliente");p.value=a,l.value="null"==a.nombre?"":a.nombre,i.value="null"==a.telefono?"":a.telefono,r.value="null"==a.email?"":a.email,s.value="null"==a.direccion?"":a.direccion,d.value="null"==a.tarjetaCliente?"":a.tarjetaCliente,u.value="null"==a.nif?"":a.nif,c.value="null"==a.descuento?"":a.descuento,m.value="null"==a.id?"":a.id};function h(e){const a=e.target.value,o=a.replace(/[^0-9.]/g,""),[t,n]=o.split("."),l=n&&n.length>2?n.slice(0,2):n,i=t+(l?`.${l}`:""),r=parseFloat(i);isNaN(r)?c.value="":c.value=r<0?"0":r>100?"100":i}return{modalFichaCliente:o,guardarCliente:b,nombre:l,telefono:i,email:r,direccion:s,tarjeta:d,nif:u,descuento:c,salirBoton:f,cambiosCliente:v,loading:g,clienteToc:p,validateDescuento:h}}};const $i=(0,E.Z)(Vi,[["render",Ri],["__scopeId","data-v-3e9997ce"]]);var Zi=$i,qi={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalEncargosComponent:Ll,ModalDeudasComponent:Pi,ModalFichaCliente:Zi},setup(e,a){const o=(0,f.oR)(),n=(0,D.iH)(null),l=((0,D.iH)(0),(0,D.iH)()),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=((0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(d.value&&d.value[u.value]&&c.value[e]._id==d.value[u.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(null),v=(0,D.iH)(null),g=(0,t.Fl)((()=>!!m.value&&"RECOGER ENCARGO"==m.value.modo));function b(e){w(e),n.value=!0}async function w(e){try{const a=await k.Z.post("clientes/getClienteById",{idCliente:e});a.data&&(v.value=a.data)}catch(a){}}async function h(){if(c.value&&m.value)for(let e=0;e<c.value.length;e++)if(c.value[e]._id===m.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),await o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset"),k.Z.post("cestas/recalcularIvas",{idCesta:m.value._id});break}y()}a.expose({abrirModal:b});const C=()=>{s.value.abrirModal(m.value.idCliente)};function y(){n.value=!1}function _({nombre:e,descuento:a}){m.value.nombreCliente=e,o.dispatch("Cestas/setDescuentoAction",Number(a/100))}function M(){k.Z.get("deudas/getUpdateDeudas").then((e=>{e.data?r.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando deudas",html:"Descargando deudas debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("deudas/descargarDeudas").then((e=>{e.data?(r.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar las deudas. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&r.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}function B(){k.Z.get("encargos/getUpdateEncargos").then((e=>{e.data?i.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando encargos",html:"Descargando encargos debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("encargos/descargarEncargos").then((e=>{e.data?(i.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar los encargos. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&i.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}async function T(){p.value?(await h(),setTimeout((()=>{E("/menu/nuevos-pedidos")}),200)):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function E(e){ln.Z.push(e)}return(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{p.value=e.data})).catch((e=>{p.value=!1}))})),(0,t.JJ)("cambiosClientes",_),(0,t.JJ)("cerrarModalClientesSeleccionado",y),{modalClientesSeleccionado:n,arrayClientes:l,cesta:m,resetGeneral:h,refModalEncargos:i,refModalDeudas:r,ficha:C,refModalFichaCliente:s,cambiosCliente:_,abrirModalDeuda:M,abrirModalEncargos:B,cliente:v,nuevoPedido:T,clientePedidosTienda:p,recogiendoEncargos:g}}};const Li=(0,E.Z)(qi,[["render",Nn],["__scopeId","data-v-5065ebca"]]);var Yi=Li,Gi=o(62492);const Ki={class:"d-flex justify-content-between"},Ji={class:"d-flex"};function Qi(e,a,o,n,l,i){const r=(0,t.up)("MDBTabItem"),s=(0,t.up)("MDBTabNav"),u=(0,t.up)("MDBBtn"),c=(0,t.up)("ListadoEncargosComponent"),m=(0,t.up)("MDBTabPane"),p=(0,t.up)("ListadoDeudasComponent"),f=(0,t.up)("MDBTabContent"),v=(0,t.up)("MDBTabs"),g=(0,t.up)("MDBModalBody"),b=(0,t.up)("MDBModalFooter"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"modalExtendidoClient",title:"Datos extendidos del cliente",modelValue:n.modalExtendidoCliente,"onUpdate:modelValue":a[4]||(a[4]=e=>n.modalExtendidoCliente=e),size:"xl","static-backdrop":""},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{class:"pb-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{modelValue:n.activeTabId,"onUpdate:modelValue":a[2]||(a[2]=e=>n.activeTabId=e)},{default:(0,t.w5)((()=>[(0,t._)("div",Ki,[(0,t.Wm)(s,{tabsClasses:" text-center border-bottom d-flex tabMenuCliente"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:(0,d.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab1"===n.activeTabId}]),tag:"button",wrap:!1,tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1},8,["class"]),(0,t.Wm)(r,{tag:"button",class:(0,d.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab2"===n.activeTabId}]),wrap:!1,tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deudas","Deudas")),1)])),_:1},8,["class"])])),_:1}),(0,t._)("div",Ji,["tab1"==n.activeTabId?((0,t.wg)(),(0,t.j4)(u,{key:0,onClick:a[0]||(a[0]=e=>n.sendToModalEncargos()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0),"tab2"==n.activeTabId?((0,t.wg)(),(0,t.j4)(u,{key:1,onClick:a[1]||(a[1]=e=>n.sendToModalDeudas()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0)])]),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref:"refListadoEncargos"},null,512)])),_:1}),(0,t.Wm)(m,{tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref:"refListadoDeudas"},null,512)])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{class:"d-flex justify-content-center"},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(u,{id:"salir",color:"danger",class:"ms-2 col-4",onClick:a[3]||(a[3]=a=>{e.seleccionado=-1,n.modalExtendidoCliente=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])),_:1})])),_:1},8,["modelValue"])}const Xi=e=>((0,t.dD)("data-v-2cdf9ebb"),e=e(),(0,t.Cn)(),e),er={class:"p-0"},ar={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},or={class:"d-flex align-content-center px-3"},tr={class:"content-date"},nr=["min","max"],lr=Xi((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),ir={class:"content-date"},rr=["min","max"],sr={class:"d-flex my-1"},dr={class:"m-auto px-2 range"},ur=["onClick"],cr={class:"d-flex flex-row-reverse"},mr={class:"d-flex m-0 p-0 justify-content-between"},pr={key:0,class:"p-0"},fr={key:0},vr={key:1},gr={key:1,class:"p-0",type:"button"},br={key:2,class:"p-0",type:"button"},wr={class:"d-flex justify-content-between px-0 py-2 m-0"},hr={class:"d-flex m-0 p-0 justify-content-between"},Cr={class:"productos"},yr={class:"col-12"},_r={class:"col-3"},Mr={class:"col-1"},Dr={class:"col-1"},kr={class:"col-2"},Br={class:"col-2"},xr={class:"col-3"},Tr={class:"d-flex flex-column justify-content-center"},Er={key:0},Ar={key:1},Ir={key:1},zr={class:"sinResultados position-relative"},Sr={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Hr={class:"h4 mx-2 pb-2 border-bottom"},Fr={class:"d-flex justify-content-around"},Pr={class:"my-3 d-flex flex-column content-date"},Nr={for:"dateStart",class:"h5"},Ur=["min","max"],jr={class:"my-3 d-flex flex-column content-date"},Or={for:"dateFinal",class:"h5"},Wr=["min","max"],Rr={class:"h4 mx-2 pb-2 border-bottom"},Vr={class:"d-flex justify-content-around my-3"},$r=Xi((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),Zr={for:"orden1",class:"h6"},qr=Xi((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),Lr={for:"orden2",class:"h6"},Yr=Xi((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),Gr={for:"orden3",class:"h6"},Kr={class:"h6"},Jr=Xi((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function Qr(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBModalTitle"),c=(0,t.up)("MDBModalHeader"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),g=(0,t.up)("ModalEncargos");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",er,[(0,t._)("div",ar,[(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>n.nuevoPedido()),class:"sizeBotones my-auto",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Nuevo pedido ")])),_:1}),(0,t._)("div",or,[(0,t._)("div",tr,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>n.startSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[2]||(a[2]=e=>(n.mostrar(),n.currentPage=1))},null,40,nr),[[v.nr,n.startSelectedDate]])]),lr,(0,t._)("div",ir,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>n.finalSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[4]||(a[4]=e=>(n.mostrar(),n.currentPage=1))},null,40,rr),[[v.nr,n.finalSelectedDate]])])]),(0,t._)("div",sr,[(0,t._)("span",dr,(0,d.zw)(n.startRange)+" - "+(0,d.zw)(n.endRange)+" de "+(0,d.zw)(n.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right",size:"1x"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{class:"ms-5",onClick:n.abrirModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])]),(0,t.Wm)(v.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[n.encargos&&n.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{onClick:e=>n.onClickEncargo(o),class:(0,d.C_)({active:n.seleccionado===o,horaTarde:1==n.horaTarde(a),diaTarde:1==n.diaTarde(a)})},[(0,t._)("div",cr,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>n.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",mr,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",pr,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",fr,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",vr,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",gr,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",br,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a?.dias[0]?.dia)+" - "+(0,d.zw)(a?.dias[0]?.dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",wr,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",hr,[(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,d.zw)(e.$t("dependienta","Dependienta"))+": "+(0,d.zw)(a?.nombreDependienta),1)]),(0,t._)("div",Cr,[(0,t._)("table",yr,[(0,t._)("tr",null,[(0,t._)("th",_r,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",Mr,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",Dr,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",kr,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",Br,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",xr,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",Tr,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Er,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Ar,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,ur)])))),128)):((0,t.wg)(),(0,t.iD)("div",Ir,[(0,t._)("div",zr,[(0,t._)("span",Sr,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(f,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:n.modalImprimirEncargos,"onUpdate:modelValue":a[12]||(a[12]=e=>n.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:n.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("h2",Hr,(0,d.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",Fr,[(0,t._)("div",Pr,[(0,t._)("label",Nr,(0,d.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[5]||(a[5]=e=>n.dateStart=e),min:n.startInputDate,max:n.finalInputDate},null,8,Ur),[[v.nr,n.dateStart]])]),(0,t._)("div",jr,[(0,t._)("label",Or,(0,d.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[6]||(a[6]=e=>n.dateFinal=e),min:n.startInputDate,max:n.finalInputDate},null,8,Wr),[[v.nr,n.dateFinal]])])]),(0,t._)("h2",Rr,(0,d.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",Vr,[(0,t._)("div",{class:"inputOrden",onClick:a[7]||(a[7]=e=>n.orden="producto")},[$r,(0,t._)("label",Zr,(0,d.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[8]||(a[8]=e=>n.orden="Cliente")},[qr,(0,t._)("label",Lr,(0,d.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>n.orden="producto_resumido")},[Yr,(0,t._)("label",Gr,(0,d.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!n.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",Kr,[Jr,(0,t.Uk)(" "+(0,d.zw)(n.commentError),1)])],2)])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[10]||(a[10]=e=>n.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>n.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"]),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512)],64)}var Xr={name:"ListadoEncargosComponent",components:{TransitionGroup:v.W3,MDBBtn:M.$v,MDBIcon:M.vm,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalBody:M.Yz,MDBModalFooter:M.ab,ModalEncargos:Ll},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,ya.tv)(),l=new Date,i=(new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),(0,D.iH)(null)),r=(0,D.iH)(!1),s=(0,D.iH)(null),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),v=(0,D.iH)(null),g=(0,D.iH)(!1),b=(0,D.iH)(null),w=(0,D.iH)([]),h=(0,D.iH)(null),C=(0,D.iH)(!1),y=(0,D.iH)(-1),_=(0,D.iH)(1),M=(0,D.iH)(20),B=(0,t.Fl)((()=>h.value?Math.ceil(h.value.length/M.value):0)),T=(0,t.Fl)((()=>(_.value-1)*M.value+1)),E=(0,t.Fl)((()=>Math.min(_.value*M.value,h.value?.length||0))),A=(0,t.f3)("cerrarModalExtendidoCliente"),I=(0,D.iH)(null),z=(0,t.f3)("resetGeneral");function S(){k.Z.post("/encargos/getEncargos").then((e=>{w.value=e.data;let a=null,o=null;if(0!=w.length){for(const e of w.value){1==e.opcionRecogida&&"am"==e.amPm&&(e.hora="14:59"),1==e.opcionRecogida&&"pm"==e.amPm&&(e.hora="23:59");const t=new Date(e.fecha);(null===a||t<a)&&(a=t),(null===o||t>o)&&(o=t)}u.value=a?.toISOString().slice(0,10),s.value=a?.toISOString().slice(0,10),d.value=o?.toISOString().slice(0,10),c.value=o?.toISOString().slice(0,10),H()}}))}function H(){h.value=[];for(const e of w.value){const a=e.fecha;a>=s.value&&a<=d.value&&h.value.push(e)}h.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function F(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),n=a.getMinutes(),l=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(l<t||l==t&&i<n)}function P(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function N(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function U(e){y.value=e}function j(){return y.value+(_.value-1)*M.value}async function O(e,a){C.value=!0;const n=j();if(-1!=y.value){let l=N(h.value[n].total-h.value[n].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+l+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async i=>{if(i.isConfirmed)try{o.dispatch("Cestas/setCestaBaseAction",e);const i=h.value[n].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:i}).then((async e=>{if(!e.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:a}).then((async a=>{let i=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let a=0;a<i.value.length;a++)if(i.value[a]._id==e.data)return i.value[a]}));(r.value.modo="RECOGER ENCARGO")&&(o.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:l}),A(),o.dispatch("Encargos/setEncargoSeleccionado",h.value[n]),o.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(r){}finally{C.value=!1}else C.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),C.value=!1}function W(e){const a=j();-1!=y.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((o=>{o.isConfirmed&&(h.value[a].dejaCuenta>0&&k.Z.post("movimientos/nuevoMovimiento",{cantidad:h.value[a].dejaCuenta,concepto:"dejaACuenta",idTrabajador:e,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})),k.Z.post("/encargos/anularEncargo",{id:h.value[a]._id}).then((e=>{e?.data?(h.value.splice(y.value,1),y.value=-1,S(),x().fire("Perfecto","Encargo anulado correctamente","success")):x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")})))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function R(){if(-1==y.value)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"});const e=j();o.dispatch("Encargos/setEncargoToModalEnc",h.value[e]),A()}function V(){r.value=!0}function $(){g.value=!1,b.value="",r.value=!1,v.value=null}function Z(){if(!m.value||!p.value)return b.value="Por favor, ingresa ambas fechas",void(g.value=!0);if(p.value<m.value)return b.value="La fecha final no puede ser anterior a la fecha inicial",void(g.value=!0);if(null==v.value)return b.value="Elige una opción de orden",void(g.value=!0);{const e=[];for(const a of w.value){const o=a.fecha;o>=m.value&&o<=p.value&&e.push(a)}if(0==e.length)return b.value="El intervalo de fechas seleccionado no contiene encargos.",void(g.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:v.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),$()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function q(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function L(){const e=(_.value-1)*M.value,a=e+M.value;return h.value.slice(e,a)}function Y(){_.value<B.value&&_.value++}function G(){_.value>1&&_.value--}async function K(){I.value?(await z(),J("/menu/nuevos-pedidos")):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function J(e){n.push(e)}return(0,t.YP)(_,(()=>{y.value=-1})),(0,t.YP)(h,(()=>{h.value.length<T.value&&(_.value=1),y.value=-1})),a({cargarEncargos:S,recoger:O,anular:W,sendToModalEncargos:R}),(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{I.value=e.data})).catch((e=>{I.value=!1})),S()})),{startSelectedDate:s,finalSelectedDate:d,modalImprimirEncargos:r,startInputDate:u,finalInputDate:c,dateStart:m,dateFinal:p,orden:v,encargos:h,currentPage:_,itemsPerPage:M,totalPages:B,startRange:T,endRange:E,cargarEncargos:S,mostrar:H,horaTarde:F,diaTarde:P,redondearDecimales:N,paginatedItems:L,nextPage:Y,prevPage:G,abrirModalImprimir:V,cerrarModalImprimir:$,imprimir:Z,errorValidacionImp:g,commentError:b,nuevoPedido:K,clientePedidosTienda:I,seleccionado:y,onClickEncargo:U,refModalEncargos:i,printCharge:q}}};const es=(0,E.Z)(Xr,[["render",Qr],["__scopeId","data-v-2cdf9ebb"]]);var as=es;const os=e=>((0,t.dD)("data-v-2f1433f4"),e=e(),(0,t.Cn)(),e),ts={class:"p-0"},ns={class:"d-flex justify-content-around"},ls={class:"d-flex justify-content-between py-2 col-12"},is={class:"d-flex col-6 align-items-center"},rs={class:"col-md-2 text-center d-flex justify-content-center align-items-center"},ss=os((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),ds={class:"size ps-2"},us={class:"d-flex col-4 justify-content-between"},cs={class:"d-flex col-7"},ms=os((()=>(0,t._)("div",{class:"d-flex align-items-center col-2 size"},[(0,t._)("i",{class:"fas fa-filter"})],-1))),ps={class:"col-10"},fs={value:"1"},vs={value:"2"},gs={value:"3"},bs={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},ws=os((()=>(0,t._)("div",{class:"spinner"},null,-1))),hs=[ws],Cs=["onClick"],ys={class:"clientStatusToggle"},_s={key:1,class:"fas fa-chevron-up"},Ms={key:2,class:"fas fa-chevron-down"},Ds=["onClick"],ks={class:"d-flex m-0 p-0 justify-content-between"},Bs={class:"d-flex justify-content-between px-0 py-2 m-0"},xs={class:"productos"},Ts={class:"col-12"},Es=os((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),As={class:"d-flex flex-column justify-content-center"},Is={key:0},zs={key:1},Ss={key:2},Hs={class:"sinResultados position-relative"},Fs={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function Ps(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBadge"),c=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",ts,[(0,t._)("div",ns,[(0,t._)("div",ls,[(0,t._)("div",is,[(0,t.wy)((0,t._)("input",{class:"form-control input w-100",type:"text",placeholder:"Buscar por cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>n.inputBusqueda=e),onClick:a[1]||(a[1]=e=>n.openKeyboard()),readonly:"",style:{"background-color":"white"}},null,512),[[v.nr,n.inputBusqueda]]),(0,t._)("div",rs,[ss,(0,t._)("span",ds,(0,d.zw)(n.seleccionados.length),1)]),(0,t.Wm)(r,{style:(0,d.j5)({visibility:n.viewedDebts?"visible":"hidden"}),onClick:a[2]||(a[2]=e=>n.selectAllDebtsClient()),class:"col-3 btn bg-info text-white"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1},8,["style"])]),(0,t._)("div",us,[(0,t._)("div",cs,[ms,(0,t._)("div",ps,[(0,t.wy)((0,t._)("select",{id:"filtro",class:"form-select input",name:"filtro","aria-label":".form-control-lg example","onUpdate:modelValue":a[3]||(a[3]=e=>n.selectFiltro=e),onChange:a[4]||(a[4]=e=>n.filtrarLista())},[(0,t._)("option",fs,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("option",vs,(0,d.zw)(e.$t("albaranes","Albaranes")),1),(0,t._)("option",gs,(0,d.zw)(e.$t("no_albaranes","No Albaranes")),1)],544),[[v.bM,n.selectFiltro]])])]),(0,t.Wm)(r,{class:"col-3 inputIcon",onClick:n.imprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])])]),(0,t.Wm)(v.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("div",bs,hs)):n.arrayByClients&&n.arrayByClients.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(n.computedClientList,((a,o)=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("div",{class:"DebtsClient",onClick:e=>n.displayDebtsClient(a.idCliente)},[(0,t._)("span",null,(0,d.zw)(a.nombreCliente)+": "+(0,d.zw)(a.deudas.length)+" "+(0,d.zw)(1===a.deudas.length?"Deuda":"Deudas")+", total de "+(0,d.zw)(n.sumDebtClient(a.deudas))+"€",1),(0,t._)("div",ys,[a.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark textoAlbaran",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0),n.viewedDebts==a.idCliente?((0,t.wg)(),(0,t.iD)("i",_s)):((0,t.wg)(),(0,t.iD)("i",Ms))])],8,Cs),a.deudas&&a.deudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(a.deudas,((o,l)=>(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:l},[(0,t._)("div",{onClick:e=>n.onClickDeuda(o),class:(0,d.C_)({active:n.seleccionados.includes(o._id)})},[(0,t._)("div",ks,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(n.getFecha(o?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,d.zw)(o?.nombreCliente),1),o?.albaran?((0,t.wg)(),(0,t.j4)(u,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",Bs,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(o?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(o?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(n.redondearDecimales(o?.total-o?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(o?.cesta?.lista?.length),1),(0,t._)("div",xs,[(0,t._)("table",Ts,[Es,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(o?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(n.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",As,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Is,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",zs,"Ninguno"))])])))),128))])])],10,Ds)])),[[v.F8,n.viewedDebts==a.idCliente]]))),128)):(0,t.kq)("",!0)])))),256)):((0,t.wg)(),(0,t.iD)("div",Ss,[(0,t._)("div",Hs,[(0,t._)("span",Fs,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(c,{class:"position-absolute",ref:"keyboardRef"},null,512)],64)}var Ns={name:"ListadoDeudasComponent",components:{MDBBtn:M.$v,MDBBadge:M.m_,TransitionGroup:v.W3,KeyBoardComponentVue:Cn.Z,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,D.iH)([]),n=(0,D.iH)([]),l=(0,D.iH)([]),i=(0,t.Fl)((()=>l.value.filter((e=>!!e.nombreCliente&&e.nombreCliente.toLocaleLowerCase().includes(c.value.toLocaleLowerCase()))))),r=(0,D.iH)(""),s=(0,ya.tv)(),d=(0,D.iH)([]),u=(0,D.iH)(null),c=(0,D.iH)(""),m=(0,D.iH)("1"),p=(0,f.oR)(),v=(0,D.iH)(null),g=(0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),b=(0,t.Fl)((()=>p.state.Trabajadores.arrayTrabajadores)),w=((0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),(0,D.iH)(!1)),h=(0,t.Fl)((()=>b.value&&void 0!=g.value&&null!=g.value&&b.value[g.value]?b.value[g.value]:null)),C=(0,D.iH)(null),y=(0,t.Fl)((()=>p.state.ModalCobroView.modalCobroViewAbierto)),_=(0,t.f3)("cerrarModalExtendidoCliente");function M(){w.value=!0,k.Z.post("/deudas/getDeudas").then((async e=>{o.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),o.value.sort(((e,a)=>e.timestamp-a.timestamp));const a={};for(const t of o.value){const e=t.idCliente;if(!a[e]){const o=(await k.Z.post("clientes/getClienteById",{idCliente:t.idCliente})).data;a[e]={idCliente:e,nombreCliente:t.nombreCliente,albaran:o?.albaran||!1,deudas:[]}}a[e].deudas.push(t)}l.value=Object.values(a),l.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente))),w.value=!1,T()})).catch((e=>{w.value=!1}))}function B(e){e&&(r.value=e==r.value?"":e)}function T(){switch(m.value){case"1":l.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente)));break;case"2":l.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":l.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function E(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function A(){if(r.value){const e=l.value.find((e=>e.idCliente==r.value));e&&(d.value=e.deudas.map((e=>e._id)))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un cliente"})}function I(e){const a=e.idCliente,o=e._id;d.value.includes(o)?d.value.splice(d.value.indexOf(o),1):C.value&&a!=C.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):d.value.push(o),z()}function z(){d.value.length>=1&&null==C.value&&(C.value=l.value.find((e=>e.deudas.some((e=>e._id===d.value[0])))).idCliente),0==d.value.length&&(C.value=null)}function S(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),n=("0"+a.getDate()).slice(-2),l=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+n+" "+l+":"+i+":"+r);return s}function H(){k.Z.post("impresora/abrirCajon")}function F(){let e=0,a=n.value.filter((e=>d.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}async function P(){if(0!=d.value.length){H();const e=F();await x().fire({title:"Dinero total: "+E(e,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=d.value,o=[];try{p.dispatch("Cestas/setCestaBaseAction",v.value);const a=[];for(const t of e)a.push(n.value.find((e=>e._id===t)).cesta),o.push(n.value.find((e=>e._id===t)));k.Z.post("cestas/cestaDeudas",{cestas:a}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:h.value._id}).then((async a=>{let n=(0,t.Fl)((()=>p.state.Cestas.arrayCestas)),l=await(0,t.Fl)((()=>{if(n.value)for(let a=0;a<n.value.length;a++)if(n.value[a]._id==e.data)return n.value[a]}));(l.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:F()}),p.dispatch("Deudas/setDeudasSeleccionadas",o),p.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}}}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function N(){M(),c.value="",s.push("/main")}function U(){0!=d.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+d.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=d.value;try{const a=[];for(const o of e)a.push(await j(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success")}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}N()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function j(e){const a=n.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function O(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input m-0">\n          </div>\n          <div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input m-0">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function W(e){const a=e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0);return Math.round(100*a)/100}function R(){if(0==d.value.length)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"});const e=[];for(const a of d.value)e.push(o.value.find((e=>e._id===a)));p.dispatch("Deudas/setDeudasToModal",e),_()}let V;async function $(){try{u.value.abrirModal(c.value),V=setInterval((()=>{c.value=u.value.getValue()[0],u.value.getValue()[1]||clearInterval(V)}),100)}catch(e){console.log(e),V=void 0}}return(0,t.YP)(i,(()=>{r.value="",d.value=[],C.value=null})),(0,t.YP)(y,(()=>{y.value||N()})),a({cargarDeudas:M,pagar:P,eliminar:U,sendToModalDeudas:R}),(0,t.bv)((()=>{M()})),{arrayDeudas:n,inputBusqueda:c,selectFiltro:m,filtrarLista:T,redondearDecimales:E,getFecha:S,imprimir:O,openKeyboard:$,keyboardRef:u,loading:w,openKeyboard:$,onClickDeuda:I,eliminar:U,seleccionados:d,arrayByClients:l,computedClientList:i,viewedDebts:r,displayDebtsClient:B,sumDebtClient:W,selectAllDebtsClient:A}}};const Us=(0,E.Z)(Ns,[["render",Ps],["__scopeId","data-v-2f1433f4"]]);var js=Us,Os={name:"ModalExtendidoClienteComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,ListadoEncargosComponent:as,ListadoDeudasComponent:js,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE},setup(e,{expose:a}){const o=(0,D.iH)(null),n=(0,D.iH)(null),l=(0,D.iH)(null);function i(){o.value=!0}function r(){o.value=!1}const s=(0,f.oR)(),d=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>d.value&&void 0!=u.value&&null!=u.value&&d.value[u.value]?d.value[u.value]:null)),m=(0,t.Fl)((()=>s.state.Cestas.arrayCestas)),p=(0,t.Fl)((()=>{if(m.value)for(let e=0;e<m.value.length;e++)if(d.value&&d.value[u.value]&&m.value[e]._id==d.value[u.value].idCesta)return m.value[e];return null}));function v(){l.value.pagar()}function g(){l.value.eliminar()}function b(){l.value.sendToModalDeudas()}function w(){n.value.recoger(p.value._id,c.value._id)}function h(){n.value.anular(c.value._id)}function C(){n.value.sendToModalEncargos()}(0,t.JJ)("cerrarModalExtendidoCliente",r);const y=(0,D.iH)("tab1");return a({abrirModal:i}),{modalExtendidoCliente:o,refListadoEncargos:n,refListadoDeudas:l,activeTabId:y,pagarDeuda:v,eliminarDeuda:g,recogerEncargo:w,anularEncargo:h,sendToModalDeudas:b,sendToModalEncargos:C}}};const Ws=(0,E.Z)(Os,[["render",Qi],["__scopeId","data-v-cd69a014"]]);var Rs=Ws,Vs={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:M.Ff,MDBBtn:M.$v,MDBIcon:M.vm,ModalClientesComponent:rn.Z,ModalArticulosComponent:Mn,ModalNuevoCliente:Gi.Z,ModalUnidadesComponent:An,CestaComponentVue:Qt,ModalClientesSeleccionadoComponent:Yi,ModalEncargosComponent:Ll,ModalExtendidoClienteComponent:Rs},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Configuracion.parametros)),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,D.iH)(null),u=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),v=(0,D.iH)(!1),g=(0,D.iH)(null),b=(0,D.iH)(!1),w=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),h=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),C=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),y=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),_=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let M="",B="";const T=(0,D.iH)(!1),E=(0,D.iH)(!0),A=(0,t.Fl)((()=>{if(h.value)for(let e=0;e<h.value.length;e++)if(C.value&&C.value[_.value]&&h.value[e]._id==C.value[_.value].idCesta)return h.value[e];return null})),I=(0,D.iH)(!1),z=(0,t.Fl)((()=>o.state.Stock.arrayStock)),S=(0,t.Fl)((()=>A.value?.idCliente||null)),H=(0,D.iH)(0),F=(0,D.iH)(0);function P(){null!=y.value&&void 0!=y.value&&A.value&&o.dispatch("Cestas/deleteIndex",{index:y.value,idCesta:A.value._id})}async function N(){A.value&&(o.dispatch("Cestas/deleteLista",A.value._id),await k.Z.post("impresora/saludo").catch((e=>{x().fire("Oops...",e.message,"error")})))}function U(){w.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function j(e){ln.Z.push(e)}function O(e){k.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");x().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function W(){if(h.value&&A.value)for(let e=0;e<h.value.length;e++)if(h.value[e]._id===A.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==A.value.modo){for(let e=0;e<h.value.length;e++)if(h.value[e].trabajador==C.value[_.value].idTrabajador&&"DEVOLUCION"!==h.value[e].modo){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:h.value[e]._id,idTrabajador:C.value[_.value]._id});break}}else{if("RECOGER ENCARGO"==A.value.modo)return void await R(A.value._id);if(h.value&&A.value)for(let e=0;e<h.value.length;e++)if(h.value[e]._id===A.value._id){const a=h.value[e].modo;let t=!1;o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),null!=A.value.idCliente&&(t=!0,o.dispatch("Cestas/setDescuentoAction",Number(0))),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),(t||"CONSUMO_PERSONAL"==a)&&k.Z.post("cestas/recalcularIvas",{idCesta:A.value._id}),o.dispatch("EstadoDinamico/reset");break}}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset");break}}async function R(e=null){if(!A.value)return;const a=e||A.value._id;k.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((e=>{x().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:C.value[o.state.Trabajadores.indexActivo]._id}).then((e=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}async function V(e){const a=d.value;a&&k.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((async a=>{a.data?l.value.selectCliente(a.data.id,a.data.nombre,a.data.albaran,a.data.vip):e&&13==e.length?x().fire({title:"Tarjeta sin cliente",text:"¿Desea crear un nuevo cliente?",icon:"warning",showCancelButton:!0,confirmButtonColor:"green",cancelButtonColor:"#d33",confirmButtonText:"Crear",cancelButtonText:"Cancelar"}).then((a=>{a.isConfirmed&&d.value.abrirModal(e)})):x().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}async function $(e){const a=await k.Z.post("encargos/getEncargoByNumber",{idEncargo:e});return!!a.data&&(s.value?.getEncargo(a.data._id),!0)}async function Z(e){if("Shift"==e)return null;if("Enter"==e){const e=await $(B);return e||V(M),M="",void(B="")}B+=e,M+=e}function q(){k.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(g.value=e.data[0]._id,k.Z.post("impresora/imprimirTicket",{idTicket:g.value}).catch((e=>{x().fire("Oops...",e.message,"error")}))):x().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}function L(){p.value=setTimeout((()=>{m.value.abrirModal(),p.value=null}),360)}function Y(){v.value=!0,setTimeout((()=>{v.value=!1}),70)}function G(){p.value&&!v.value&&(clearTimeout(p.value),l.value.abrirModal(),Y()),clearTimeout(p.value)}(0,t.JJ)("eliminarCestaActual",R),a({resetGeneral:W});const K=e=>{if("Shift"==e.key)return null;const a=document.activeElement;"Enter"===e.key&&a&&a.blur(),Z(e.key)};async function J(e){await k.Z.post("clientes/getCantidadEncargosDeudas",{idCliente:e}).then((e=>{e.data?(H.value=e.data.cantidadEncargos,F.value=e.data.cantidadDeudas):(H.value=0,F.value=0)})).catch((e=>{F.value=0,H.value=0}))}return(0,t.bv)((()=>{document.addEventListener("keydown",K),A.value&&(A.value.idCliente||"VENTA"!=A.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),A.value&&A.value.idCliente&&J(A.value.idCliente),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?(E.value="Si"==e.data?.params?.mesas,T.value="Si"==e.data?.params?.prohibirBuscarArticulos):(T.value=!1,E.value=!0),"Si"==e.data?.params?.textoStock&&(I.value=!0)}))})),(0,t.YP)(S,((e,a)=>{e!=a&&null!=e&&J(e)})),{indexActivoCesta:y,borrarItem:P,borrarLista:N,vistaEspecial:w,changeVistaCliente:U,cesta:A,goTo:j,refModalClientes:l,refModalArticulos:i,refModalUnidades:r,CestaComponent:u,resetGeneral:W,consultarPuntos:O,parametros:n,NoBuscarProducte:T,siMesas:E,imprimirUltimoTicket:q,idTicket:g,getCodigo:Z,refModalNuevoCliente:d,tarjetaClienteNumero:M,refModalClientesSeleccionado:c,clickEncargoAtajo:$,refModalEncargos:s,hayPagados:b,textoStock:I,arrayStock:z,startPress:L,endPress:G,opBloqueado:v,refModalExtendidoCliente:m,clienteSeleccionado:S,quantEncargo:H,quantDeuda:F}}};const $s=(0,E.Z)(Vs,[["render",nn],["__scopeId","data-v-09a795ca"]]);var Zs=$s;const qs=e=>((0,t.dD)("data-v-6d3a08db"),e=e(),(0,t.Cn)(),e),Ls={class:"row"},Ys={class:"nombreMesa d-inline-block text-truncate"},Gs={key:0},Ks={key:1},Js=["value"],Qs={class:"row rowEstadoDatafono"},Xs={class:"col colEstadoDatafono"},ed={class:"row"},ad={class:"disponible"},od={class:"nodisponible"},td={class:"again"},nd={class:"esperandoVenta"},ld={key:4,class:"d-inline text-center grupoContento pt-1"},id=qs((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"100",height:"35"},null,-1))),rd=[id],sd={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},dd={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},ud={key:7,class:"d-inline text-center grupoContento pt-1"},cd={class:"col-auto colEstadoCashlogy"},md={class:"w-100 h-100",style:{margin:"0 0.12rem"}},pd={class:"row mt-1"},fd=qs((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),vd={class:"letraTotal ms-3 mt-2"},gd={class:"text-start fst-italic informacion"},bd={class:"nomTienda"};function wd(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),u=(0,t.up)("CashlogyMenuNotificaciones"),c=(0,t.up)("modalCobroViewVue"),m=(0,t.up)("modalUltimosImportes");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Ls,[(0,t._)("div",Ys,[n.cesta&&n.cesta.indexMesa>=0&&n.arrayMesas[n.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",Gs,(0,d.zw)(n.arrayMesas[n.cesta?.indexMesa].nombre),1)):(0,t.kq)("",!0),(n.cesta||n.cesta?.indexMesa||n.arrayMesas)&&n.arrayMesas[n.cesta?.indexMesa]?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",Ks,(0,d.zw)(e.$t("en_tu_cesta","En tu cesta")),1))]),(0,t.wy)((0,t._)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.indiceTrabajadorActivo=e),class:"nombreTrabajador selecTrabajador",onChange:a[1]||(a[1]=e=>n.selectDependienta(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{key:a,dropdownDirection:"up",value:a},(0,d.zw)(n.arrayTrabajadores[a].nombre),9,Js)))),128))],544),[[v.bM,n.indiceTrabajadorActivo]])]),(0,t._)("div",Qs,[(0,t._)("div",Xs,[(0,t._)("div",ed,["ONLINE"!==n.estadoDatafono||n.use3g?"OFFLINE"!==n.estadoDatafono||n.use3g?"AGAIN"!==n.estadoDatafono||n.use3g?"PENDIENTE"!==n.estadoDatafono||n.use3g?"BUSCANDO"!==n.estadoDatafono||n.use3g?"APROBADA"!==n.estadoDatafono||n.use3g?"DENEGADA"!==n.estadoDatafono||n.use3g?n.Cashlogy_activado?((0,t.wg)(),(0,t.iD)("div",ud)):(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",dd,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",sd,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",ld,rd)):((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",nd,(0,d.zw)(n.procesoDatafono),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:2,outline:"warning",class:"botonEstado",onClick:a[4]||(a[4]=e=>n.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",td,(0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,onClick:a[3]||(a[3]=e=>{n.datafonoDisponible(),n.modalUltimosImportesRef.abrirModal(n.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",od,(0,d.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:a[2]||(a[2]=e=>{n.datafonoDisponible(),n.modalUltimosImportesRef.abrirModal(n.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",ad,(0,d.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1}))])]),(0,t.wy)((0,t._)("div",cd,[(0,t._)("div",md,[(0,t.Wm)(u,{miniMenu:"",ref:"CashlogyMiniMenuRef"},null,512)])],512),[[v.F8,n.Cashlogy_activado&&n.showMiniMenuCashlogy]])]),(0,t._)("div",pd,[n.cesta&&n.cesta.lista.length&&"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual&&"DEVOLUCION"===n.cesta.modo?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"primary",class:"botonPagar",disabled:n.disabledBtns,onClick:a[5]||(a[5]=e=>n.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),fd])),_:1},8,["disabled"])):n.cesta&&n.cesta.lista.length&&"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"primary",class:"botonPagar",disabled:n.disabledBtns,onClick:a[6]||(a[6]=e=>n.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",vd,(0,d.zw)((n.getTotal(n.cesta)-n.dejaCuenta).toFixed(2))+" € ",1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:2,onClick:a[7]||(a[7]=e=>n.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual&&n.cesta&&!n.cesta.lista.length?((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonPagar",onClick:a[8]||(a[8]=e=>n.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",gd,[(0,t.Uk)("("+(0,d.zw)(n.conexionInternet)+")(v"+(0,d.zw)(n.tocVersion)+") (",1),(0,t._)("a",bd,(0,d.zw)(n.nombreTienda),1),(0,t.Uk)(") "+(0,d.zw)(n.getClock),1)])]),(0,t.Wm)(c,{ref:"modalCobroViewVueRef"},null,512),(0,t.Wm)(m,{ref:"modalUltimosImportesRef"},null,512)],64)}var hd=o(92853);const Cd=e=>((0,t.dD)("data-v-66e63997"),e=e(),(0,t.Cn)(),e),yd=Cd((()=>(0,t._)("div",{class:"d-inline text-center mx-auto pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"300"})],-1))),_d=Cd((()=>(0,t._)("h2",{class:"text-center mb-3"},"Últimos Importes",-1))),Md={key:0,class:"Resultados d-flex flex-column col-8 mx-auto"},Dd={class:"col-12"},kd=["onClick"],Bd={class:"m-0"},xd={class:"m-0"},Td={class:"m-0"},Ed={class:"m-0"},Ad={class:"tcodPos"},Id={class:"divMain"},zd=Cd((()=>(0,t._)("span",{class:"h3 mb-3"},"Información de PayTef",-1))),Sd=Cd((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Datos de la transacción ",-1))),Hd={class:"info paytef col-10 mx-auto"},Fd=Cd((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Información de transacción:")],-1))),Pd={class:"m-0"},Nd={class:"m-0"},Ud={class:"m-0"},jd={class:"m-0"},Od={class:"m-0"},Wd=Cd((()=>(0,t._)("hr",null,null,-1))),Rd={class:"info paytef col-10 mx-auto"},Vd=Cd((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Datos bancarios:")],-1))),$d={class:"m-0"},Zd={class:"m-0"},qd=Cd((()=>(0,t._)("span",{class:"h3 mb-3"},"Información del ticket",-1))),Ld=Cd((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Productos del ticket ",-1))),Yd={class:"col-12"},Gd={class:"ms-2 me-auto"},Kd={class:"col-12"},Jd={class:"text-truncate"},Qd={class:"ms-2"},Xd={class:"ms-2 me-auto text-truncate"},eu={class:"ms-2 me-auto mb-0"};function au(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBIcon"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),v=(0,t.up)("MDBBadge"),g=(0,t.up)("MDBListGroupItem"),b=(0,t.up)("MDBListGroup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalUltimosImportes,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalUltimosImportes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Datos del datáfono")])),_:1})])),_:1}),n.loading?((0,t.wg)(),(0,t.j4)(u,{key:0,style:{"align-self":"center"}},{default:(0,t.w5)((()=>[yd])),_:1})):((0,t.wg)(),(0,t.j4)(u,{key:1},{default:(0,t.w5)((()=>[_d,(n.importeEncontrado,(0,t.wg)(),(0,t.iD)("div",Md,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.array,((e,a)=>((0,t.wg)(),(0,t.iD)("div",Dd,[(0,t._)("div",{class:"d-flex justify-content-between border border-2 p-2",style:(0,d.j5)([{"margin-bottom":"2%"},e.approved?"background-color:rgb(5 213 5 / 20%)":"background-color: rgb(227 100 100 / 20%)"]),onClick:o=>n.abrirModalDetallesImpote(a,e.reference)},[(0,t._)("p",Bd,"#"+(0,d.zw)(a+1),1),(0,t._)("p",xd,"Fecha: "+(0,d.zw)(e.timestamp),1),(0,t._)("p",Td,"Núm Ticket: "+(0,d.zw)(e.reference),1),(0,t._)("p",Ed,"Precio: "+(0,d.zw)(e.amountWithSign)+" €",1),(0,t._)("div",null,[(0,t.Wm)(c,{icon:e.approved?"check-circle":"times-circle",style:(0,d.j5)(e.approved?"color: #33bf61":"color: red;")},null,8,["icon","style"])])],12,kd)])))),256))]))])),_:1})),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t._)("p",Ad,"TCod: "+(0,d.zw)(n.tcod),1),(0,t.Wm)(m,{color:"secondary",onClick:a[0]||(a[0]=e=>n.modalUltimosImportes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalDetallesImporte,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalDetallesImporte=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" Ref. Paytef #"+(0,d.zw)(n.selectedTicket.reference),1)])),_:1}),n.selectedTicket.approved?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(m,{key:0,class:"ms-auto ms-4 modalHeader",color:"danger",onClick:a[2]||(a[2]=e=>n.tarjetaTicketById(n.selectedTicket.reference))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1}))])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",Id,[(0,t._)("div",null,[zd,Sd,(0,t._)("div",Hd,[Fd,(0,t._)("p",Pd,[(0,t.Wm)(c,{icon:"server"}),(0,t._)("span",{style:(0,d.j5)(1==n.selectedTicket.approved?"color:seagreen;":"color:indianred;")},"   "+(0,d.zw)(1==n.selectedTicket.approved?"Aprobado ✓":"Denegado ✖"),5)]),(0,t._)("p",Nd,[(0,t.Wm)(c,{icon:"calendar-alt"}),(0,t.Uk)("    "+(0,d.zw)(n.fechaImporte),1)]),(0,t._)("p",Ud,[(0,t.Wm)(c,{icon:"question"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.typeName),1)]),(0,t._)("p",jd,[(0,t.Wm)(c,{icon:"clipboard-check"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.reference),1)]),(0,t._)("p",Od,[(0,t.Wm)(c,{icon:"euro-sign"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.amountWithSign)+" € ",1)])]),Wd,(0,t._)("div",Rd,[Vd,(0,t._)("p",$d,[(0,t.Wm)(c,{icon:"university"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.issuerNameAndCountry),1)]),(0,t._)("p",Zd,[(0,t.Wm)(c,{icon:"credit-card"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.hiddenCardNumber),1)]),(0,t._)("p",null,[(0,t.Wm)(c,{icon:"globe-europe"}),(0,t.Uk)("    "+(0,d.zw)(n.selectedTicket.country),1)])])]),(0,t._)("div",null,[qd,Ld,(0,t._)("div",Yd,[(0,t.Wm)(b,{light:"",class:"productos"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.productosArray,((e,a)=>((0,t.wg)(),(0,t.j4)(g,{class:"d-flex justify-content-between align-items-center"},{default:(0,t.w5)((()=>[(0,t._)("div",Gd,[(0,t._)("div",Kd,[(0,t._)("span",Jd,(0,d.zw)(e.nombre),1),(0,t._)("span",Qd,"x"+(0,d.zw)(e.unidades),1)]),null!=e.arraySuplementos?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",Xd," - "+(0,d.zw)(e.nombre.replace("(","")),1)))),256)):(0,t.kq)("",!0),null!=e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(e.promocion.grupos.flat(),(a=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("p",eu,(0,d.zw)(a.nombre)+" x"+(0,d.zw)(e.unidades*a.unidades),1)])))),256)):(0,t.kq)("",!0)]),(0,t.Wm)(v,{class:"badge-primary",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.subtotal)+" €",1)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])])])])),_:1}),(0,t.Wm)(p)])),_:1},8,["modelValue"])],64)}var ou=o(36797),tu=o.n(ou),nu={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_},setup(e,a){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,D.iH)([]),u=(0,D.iH)("cargando..."),c=(0,D.iH)(null),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Caja.arrayVentas)),v=(0,D.iH)(!0),g=(0,D.iH)(null);function b(e){g.value=e,n.value=!0,y()}async function w(){for(const e of m.value){let{year:a,month:o,day:t,hour:n,minute:l,second:i,millisecond:r}=e.timestamp,s=`${a}-${(o<10?"0":"")+o}-${(t<10?"0":"")+t} ${(n<10?"0":"")+n}:${(l<10?"0":"")+l}:${(i<10?"0":"")+i}.${(r<10?"0":"")+r}`;e["timestamp"]=s}}async function h(e,a){try{C.value=m.value[e],tu().locale("es"),s.value=tu()(new Date(C.value.timestamp)).format("LLL"),d.value=await(0,t.Fl)((()=>p.value.find((e=>e._id==a)).cesta.lista)).value,l.value=!0}catch(o){console.log(o)}}const C=(0,D.iH)(null);async function y(){await k.Z.post("paytef/getLastFive").then((async e=>{e.data&&(m.value=e.data.reverse(),await w(),v.value=!1)}))}function _(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function M(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}function B(e){k.Z.post("paytef/cobrarTicketById",{idTrabajador:g.value.idTrabajador,idTicket:e}).then((()=>{o.dispatch("Datafono/setEstado","PENDIENTE"),n.value=!1,l.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:b}),(0,t.bv)((async()=>{u.value=await k.Z.post("parametros/getParametros").then((e=>e.data.payteftcod))})),{modalUltimosImportes:n,importeEncontrado:i,importe:r,tcod:u,fecha:c,array:m,productosArray:d,modalDetallesImporte:l,abrirModalDetallesImpote:h,selectedTicket:C,fechaImporte:s,loading:v,recortarNombreArtPrinc:_,recortarNombreArtSec:M,tarjetaTicketById:B,trabajadorActivo:g}}};const lu=(0,E.Z)(nu,[["render",au],["__scopeId","data-v-66e63997"]]);var iu=lu,ru=o(69523),su={name:"MenuDerechaComponent",components:{MDBIcon:M.vm,MDBBtn:M.$v,MDBSelect:M.R3,modalCobroViewVue:hd.Z,modalUltimosImportes:iu,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,CashlogyMenuNotificaciones:ru.Z},setup(){const e=(0,D.iH)(""),a=(0,D.iH)(""),o=(0,D.iH)(""),n=(0,f.oR)(),l=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,ya.tv)(),s=(0,D.iH)([]),d=(0,t.Fl)((()=>n.state.Cestas.Descuento)),u=(0,t.f3)("resetGeneral"),c=(0,D.iH)(""),m=(0,D.iH)(null),p=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),v=(0,D.iH)(null),g=(0,t.Fl)((()=>!(!v.value?.mini_menu_activo||!(l.value||["ONLINE","OFFLINE","BUSCANDO"].indexOf(B.value)>=0)))),b=(0,D.iH)(!1);(0,t.bv)((async()=>{b.value=await(v.value?.activado())}));const w=(0,t.Fl)((()=>{if(n.state.ModalCobroView.modalCobroViewAbierto)return!0}));(0,t.m0)((()=>{w.value&&i.value.abrirModal()}));let h=!1;async function C(){if(!h){try{let e=(await k.Z.post("checkers/internet_with_pings")).data;c.value=e?"🟢":"🔴"}catch(e){}setTimeout(C,1e4)}}(0,t.Ah)((()=>{h=!0})),C();const y=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),_=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),M=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),B=(0,t.Fl)((()=>n.state.Datafono.estado)),T=(0,t.Fl)((()=>n.state.Datafono.procesoActual)),E=(0,t.Fl)((()=>n.state.modoActual)),A=(0,t.Fl)((()=>y.value&&void 0!=M.value&&null!=M.value&&y.value[M.value]?y.value[M.value]:null)),I=(0,t.Fl)((()=>{if(_.value)for(let e=0;e<_.value.length;e++)if(y.value&&y.value[M.value]&&_.value[e]._id==y.value[M.value].idCesta)return _.value[e];return null})),z=(0,t.Fl)((()=>n.state.Deudas.deudasSeleccionadas)),S=(0,t.Fl)((()=>n.state.Encargos.encargoSeleccionado)),H=(0,t.Fl)((()=>{if(z.value.length>0){let e=0;for(const a of z.value)a.dejaCuenta&&(e+=a.dejaCuenta);return e}return S.value&&"RECOGER ENCARGO"==I?.value?.modo&&S.value.dejaCuenta||0})),F=(0,D.iH)(!1);function P(e){n.dispatch("Trabajadores/setIndexActivo",Number(e.target.value)),W("/main")}function N(e){let a=0;return e.forEach((e=>{a+=e.subtotal})),a=Math.round(100*a)/100,a}function U(e){const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Number(o.toFixed(2))}function j(){k.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function O(){"PENDIENTE"!=B.value&&(n.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((e=>n.dispatch("Datafono/setEstado",e.data))).catch((e=>n.dispatch("Datafono/setEstado","OFFLINE"))))}function W(e){r.push(e)}function R(){let e=!1;I.value&&I.value.lista.length>0&&I.value.lista.forEach((a=>{if(a?.regalo)return e=!0,void Z()})),e||(k.Z.post("impresora/abrirCajon"),x().fire("AVISO","elige un artículo para ir a cobrar","info"))}function V(){k.Z.post("articulos/saveTeclas"),n.dispatch("setModoActual","NORMAL")}function $(){k.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:A.value._id}).then((()=>{n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function Z(){if(!n.state.Procesando.clickTecla)if(Y(),I.value.idCliente&&"RECOGER ENCARGO"!==I.value.modo)try{const{nombreCliente:e,lista:a,_id:o,idCliente:t}=I.value,n=N(a);if("Too Good To Go Spain S.L.U. "===e){if(n<12)return void x().fire({title:"Promoción Requerida",text:"Para proceder con el cobro, debe aplicar la promoción 3.99€ del Too Good To Go. El importe mínimo es de 12€",icon:"warning"});3.99!==n&&await k.Z.post("/cestas/recalcularIvas",{idCesta:o})}q()}catch(e){q()}else q()}async function q(){const e=JSON.parse(JSON.stringify(I.value.lista));try{if(I.value){const a=U(I.value);if("VENTA"===I.value.modo||"RECOGER ENCARGO"==I.value.modo)if(I.value.idCliente&&""!=I.value.idCliente){const e=(await k.Z.post("clientes/getClienteById",{idCliente:I.value.idCliente})).data;e?.albaran&&e?.noPagaEnTienda?k.Z.post("albaranes/crearAlbaran",{total:a,cestaFrontEnd:I.value,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");x().fire({icon:"success",title:"Albaran registrada correctamente",showConfirmButton:!1,timer:1500}),await k.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{x().fire("Oops...",e.message,"error")}))})).catch((e=>{x().fire("Oops...",e.message,"error")})):e?.noPagaEnTienda?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA",tipo:"DEUDA",tkrsData:null}).then((e=>{if(!e.data)throw Error("No se ha podida registrar la venta en modo deuda");x().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:1500})})):(await k.Z.post("impresora/abrirCajon"),i.value.abrirModal())}else e.every((e=>e.pagado))?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,tipo:"HONEI",tkrsData:null}):(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal());else"DEVOLUCION"===I.value.modo?k.Z.post("devoluciones/nuevaDevolucion",{total:a,idCesta:I.value._id,idTrabajador:A.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await x().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),u()})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===I.value.modo&&0==a?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");x().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"==I.value.modo&&a>0&&(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal())}else x().fire("Oops...","El modo de la cesta es incorrecto","error")}catch(a){}finally{setTimeout((()=>{L()}),500)}}function L(){F.value=!1}function Y(){F.value=!0}function G(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),n=e.getHours();o.value=("0"+n).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(G,1e3),(0,t.bv)((async()=>{j(),O(),k.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{x().fire("Error en getVersion CATCH")})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.tipoDatafono?"3G"==e.data?.tipoDatafono&&(l.value=!0):l.value=!1}))})),{trabajadorActivo:A,DescuentoCliente:d,estadoDatafono:B,DescuentoCliente:d,cesta:I,arrayMesas:s,getTotal:U,goTo:W,abrirCajon:R,tarjetaUltimoTicket:$,modoActual:E,handleCobro:q,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:V,datafonoDisponible:O,procesoDatafono:T,use3g:l,selectDependienta:P,modalCobroViewVueRef:i,arrayTrabajadores:y,conexionInternet:c,modalUltimosImportesRef:m,handleCobroCondicional:Z,abrirModalCobroView:w,indiceTrabajadorActivo:p,disabledBtns:F,enableBtns:L,disableBtns:Y,CashlogyMiniMenuRef:v,showMiniMenuCashlogy:g,Cashlogy_activado:b,dejaCuenta:H}}};const du=(0,E.Z)(su,[["render",wd],["__scopeId","data-v-6d3a08db"]]);var uu=du,cu=o(32066),mu=o(48466);const pu={class:"container"},fu={class:"h3 text-center"},vu={key:0,class:"row mt-2 container"},gu=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),bu={class:"h5",style:{"text-align":"center"}},wu={key:1,class:"row mt-2 container"},hu={class:"h3"},Cu={key:0,class:"d-inline text-center grupoContento pt-1"},yu=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),_u=[yu],Mu={key:1,class:"h5",style:{"text-align":"center",color:"red"}},Du={class:"again py-5"},ku={class:"again py-5"};function Bu(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal"),c=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:n.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>n.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",pu,[(0,t._)("p",fu,(0,d.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),n.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",vu,[gu,(0,t._)("span",bu,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,d.zw)(n.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),n.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",wu,[(0,t._)("p",hu,(0,d.zw)(e.$t("seleccione","seleccione"))+":",1),n.tryCount>0?((0,t.wg)(),(0,t.iD)("div",Cu,_u)):(0,t.kq)("",!0),n.tryCount>3?((0,t.wg)(),(0,t.iD)("span",Mu,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),n.tryCount<=0?((0,t.wg)(),(0,t.j4)(r,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>n.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",Du,(0,d.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(r,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>n.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",ku,(0,d.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var xu={name:"modalDatafonoConexion",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalErrorDatafonoQueHacerComponent:mu.Z},setup(e,{expose:a}){const o=(0,D.iH)(0),n=(0,D.iH)(!0),l=(0,D.iH)(0),i=(0,D.iH)(null),r=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,f.oR)(),d=(0,D.iH)(0),u=(0,D.iH)(!1),c=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>c.value&&void 0!=m.value&&null!=m.value&&c.value[m.value]?c.value[m.value]:null));function p(e){d.value=e,u.value=!0,g(),s.dispatch("Datafono/setEstado","OFFLINE")}async function v(){try{x().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){await k.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});x().fire("OK","¡El datáfono se ha apagado correctamente!","success"),u.value=!1}}))}catch(e){x().fire("Oops...",e.message,"error")}}async function g(){n.value=!0,l.value=60;let e=!1,a=!1,o=setInterval((async()=>{e||(l.value-=1,await k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async t=>{e||"ONLINE"===t.data&&(s.dispatch("Datafono/setEstado","ONLINE"),a||(a=!0,await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((a=>{e||(clearInterval(o),e=!0,i.value.abrirModal(d.value,a.data),u.value=!1)})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),a=!1))})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),e||l.value<=0&&(clearInterval(o),e=!0,x().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),n.value=!1))}),1e3)}async function b(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async e=>"OFFLINE"===e.data&&o.value<10?b():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((e=>{i.value.abrirModal(d.value,e.data),u.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:u,apagarDatafono:v,reconectarDatafon:b,estadoDatafono:r,tryCount:o,ModalErrorQueHacerRef:i,conexionAutomatica:n,counterAutomatico:l}}};const Tu=(0,E.Z)(xu,[["render",Bu]]);var Eu=Tu,Au=(o(43666),{name:"MainView",components:{MenusComponent:H,SubmenusComponent:R,TeclasComponent:Da,CestaComponent:Qt,MenuIzquierdaComponent:Zs,MenuDerechaComponent:uu,modalDatafonoConexion:Eu,ModalErrorDatafonoVentaComponent:mu.Z},setup(){const e=(0,ya.tv)(),a=(0,D.iH)(null),o=(0,D.iH)(null),n=(0,D.iH)(null),l=(0,D.iH)(null),i=(0,D.iH)(null);function r(e){a.value.clickTecla(e)}const s=(0,f.oR)(),d=(0,cu.io)("http://"+s.state.TocGameURL+":5051"),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>u.value&&void 0!=c.value&&null!=c.value&&u.value[c.value]?u.value[c.value]:null));function p(){o.value.resetGeneral()}function v(){n.value.actualizarPuntos()}function g(e){a.value.postDisabledTecla(e)}return(0,t.JJ)("clickTecla",r),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",v),(0,t.JJ)("postDisabledTecla",g),d.on("consultaPaytefRefund",(e=>{try{e.ok}catch(a){}})),d.on("consultaPaytef",(e=>{e.valid})),(0,t.bv)((async()=>{k.Z.get("caja/estadoCaja").then((a=>{1==a.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id&&e.push("/menu/fichajes"):e.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:u,indexTrabajadorActivo:c,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:n,modalErrorConexionDatafonoRef:l,modalErrorVentaDatafonoRef:i}}});const Iu=(0,E.Z)(Au,[["render",s]]);var zu=Iu}}]);
//# sourceMappingURL=30.59aa0aee.js.map