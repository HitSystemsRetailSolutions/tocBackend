"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[999],{48466:function(e,a,o){o.d(a,{Z:function(){return D}});var t=o(73396),n=o(87139);const l={class:"container"},i={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},u={class:"row mt-2 container botonesCaja"},d={class:"again py-5"},c={class:"again py-5"},m={class:"again py-5"},p={class:"again py-5"};function f(e,a,o,f,v,g){const b=(0,t.up)("MDBBtn"),w=(0,t.up)("MDBModalBody"),h=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(h,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:f.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[4]||(a[4]=e=>f.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[(0,t._)("div",l,[1==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==f.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago fallido ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",u,[1==f.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>f.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",d,(0,n.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),f.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:f.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{f.tarjetaUltimoTicket(),f.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",c,(0,n.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),f.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>f.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,n.zw)(e.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,t.kq)("",!0),f.ticketExist>2?((0,t.wg)(),(0,t.j4)(b,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:a[3]||(a[3]=e=>f.esborrarTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",p,(0,n.zw)(e.$t("anular","Anular ticket")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}o(57658);var v=o(20065),g=o(91076),b=o(74313),w=o(42492),h=o.n(w),C=o(44870),y={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,C.iH)(null),n=(0,C.iH)(0),l=(0,C.iH)(!1),i=(0,v.oR)(),r=(0,C.iH)(!1),s=(0,t.Fl)((()=>i.state.Trabajadores.arrayTrabajadores));let u=(0,C.iH)(!1);const d=(0,t.Fl)((()=>i.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?s.value[d.value]:null));function m(e,a){if(4==a)return h().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,n.value=a,r.value=!0}async function p(){await g.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,i.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{r.value=!0,h().fire("Oops...",e.message,"error")})),h().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function f(){null!=o.value&&(await w()?g.Z.post("tickets/anularTicket",{ticketId:o.value}).then((e=>{r.value=!1,e.data.res&&["EFECTIVO","DATAFONO_3G"].includes(e.data.tipo)?(l.value&&b(),h().fire({icon:"success",title:"Ticket anulado"+(l.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):e.data.res?router.push("/main"):h().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((e=>{h().fire(e.message)})):h().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function b(){g.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((e=>{h().fire("Oops...",e.message,"error")}))}async function w(){return await h().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async e=>!!e.isConfirmed))}function y(){u.value=!0,g.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,u.value=!1,i.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{u.value=!1,r.value=!0,h().fire("Oops...",e.message,"error")})),u.value=!1,h().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function _(){h().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return a({abrirModal:m}),(0,t.bv)((async()=>{const{data:e}=await g.Z.post("parametros/getParametros");l.value="Si"==e.params?.TicketAlAnular})),{store:i,darComoValido:p,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:y,esperandoConexion:u,TicketAlAnular:l,arrayTrabajadores:s,indexTrabajadorActivo:d,esborrarTicket:f,idSeleccionado:o,pagoDependienta:_,ticketExist:n}}},_=o(40089);const M=(0,_.Z)(y,[["render",f],["__scopeId","data-v-266e01f8"]]);var D=M},75817:function(e,a,o){o.r(a),o.d(a,{default:function(){return Yd}});var t=o(73396);const n={class:"row mt-1"},l={class:"col-md-3"},i={class:"col-md-6"},r={class:"col-md-3"};function s(e,a,o,s,u,d){const c=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),f=(0,t.up)("MenuIzquierdaComponent"),v=(0,t.up)("CestaComponent"),g=(0,t.up)("MenuDerechaComponent"),b=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",n,[(0,t._)("div",l,[(0,t.Wm)(f,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(v,{ref:"cestaRef"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(g)])]),(0,t.Wm)(b,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(57658);var u=o(87139);const d={class:"row",id:"menu",style:{"margin-top":"1px"}},c={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,n,l,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",d,[(0,t._)("div",c,["MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[0]||(a[0]=e=>n.ModalCrearMenusRef.abrirModal(null)),class:"newMenu btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"}," + Nuevo ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,style:(0,u.j5)(a==n.activo?"  background-color: #d45600 !important;color: #fffaee !important;border-color: #d45600 !important;":""),class:"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan",onClick:e=>n.setActivo(a)},(0,u.zw)(e.nombre),13,m)))),128))])]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var f=o(20065),v=o(49242);const g=e=>((0,t.dD)("data-v-00a5a4d2"),e=e(),(0,t.Cn)(),e),b={class:"row"},w={key:0},h=g((()=>(0,t._)("br",null,null,-1))),C={class:"row"};function y(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),f=(0,t.up)("MenusComponent"),g=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalCrearMenus",tabindex:"-1",labelledby:"modalCrearMenus",modelValue:n.modalCrearMenus,"onUpdate:modelValue":a[6]||(a[6]=e=>n.modalCrearMenus=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",b,[n.isSubmenu?((0,t.wg)(),(0,t.iD)("label",w,[(0,t.Uk)("Nombre del menu "),(0,t.wy)((0,t._)("input",{style:(0,u.j5)(n.createProductCheckFields&&""==n.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombreMenu=e),readonly:"",onClick:a[1]||(a[1]=e=>n.openKeyBoardCampos("nombreMenu"))},null,4),[[v.nr,n.nombreMenu]])])):(0,t.kq)("",!0),h,(0,t._)("label",null,[(0,t.Uk)("Nombre del Submenú "+(0,u.zw)(""!==n.nombreMenu?"para ":"")+" ",1),(0,t._)("b",null,(0,u.zw)(""!==n.nombreMenu?n.nombreMenu:""),1),(0,t.wy)((0,t._)("input",{style:(0,u.j5)(n.createProductCheckFields&&""==n.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>n.nombreSubMenu=e),readonly:"",onClick:a[3]||(a[3]=e=>n.openKeyBoardCampos("nombreSubMenu"))},null,4),[[v.nr,n.nombreSubMenu]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>n.crearMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear menu")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[5]||(a[5]=e=>n.modalCrearMenus=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(p,{id:"modalEditarMenu",tabindex:"-1",labelledby:"modalEditarMenu",modelValue:n.modalEditarMenu,"onUpdate:modelValue":a[12]||(a[12]=e=>n.modalEditarMenu=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",C,[(0,t._)("label",null,[(0,t.Uk)("Elija un nuevo nombre "+(0,u.zw)(n.editarEsMenu)+" ",1),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>n.editarNombreTxt=e),readonly:"",onClick:a[8]||(a[8]=e=>n.openKeyBoardCampos("editarNombreTxt"))},null,512),[[v.nr,n.editarNombreTxt]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[9]||(a[9]=e=>n.editarEsMenu?n.editMenuName():n.editSubMenuName())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[10]||(a[10]=e=>n.editarEsMenu?n.deleteAllProductsMenu():n.deleteAllProductsSubMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Eliminar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>n.modalEditarMenu=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"MenusComponentRef"},null,512),(0,t.Wm)(g,{ref:"keyboardRef"},null,512)],64)}var _=o(74834),M=o(74313),D=o(44870),k=o(91076),B=o(42492),x=o.n(B),T=o(78400),E={name:"ModalCrearProductoMenus",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MenusComponent:N,KeyBoardComponent:T.Z},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(!1),s=(0,D.iH)(!1),u=(0,D.iH)(!1),d=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),c=(0,D.iH)(!1),m=(0,D.iH)(""),p=(0,D.iH)(!1),v=(0,D.iH)(null),g=(0,D.iH)(0),b=(0,D.iH)(null),w=(0,D.iH)(null),h={nombreMenu:l,nombreSubMenu:i,editarNombreTxt:m};async function C(e){s.value=null==e,l.value=null==e?"":e,n.value=!0}async function y(){if(""==l.value||""==i.value&&u.value)return r.value=!0,void x().fire("Oops...","Algún campo está vacío o es incorrecto.","error");let e=l.value,a=Number(d.value.length);s.value&&(a+=1);let o=1==a.toString().length?"0"+a:a;u.value&&(e=`[${l.value}]${o} ${i.value}`),k.Z.post("articulos/anadirProducto",{nombreArticulo:"Producto por defecto",precioConIva:0,esSumable:!1,precioBase:0,tipoIva:0,menus:e,posicion:0,articuloExistente:!1}).then((e=>{x().fire("Menú creado","Se ha creado el menú correctamente","success"),_.W.cargarTeclado(),n.value=!1}))}async function M(e,a,o){1==o&&(m.value=e.nombre.substring(3)),0==o&&(m.value=e.nombre),p.value=0==o,g.value=a,v.value=e,c.value=!0}async function B(){let e=v.value,a=m.value;for(let o=0;o<d.value.length;o++)if(d.value[o].nombre.toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let o=0;o<e.arraySubmenus.length;o++)for(let t=0;t<e.arraySubmenus[o].arrayTeclas.length;t++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arraySubmenus[o].arrayTeclas[t].idArticle,nuevaPos:e.arraySubmenus[o].arrayTeclas[t].pos,nombreMenu:`[${a}]${e.arraySubmenus[o].nombre}`});x().fire("Menú editado","Se ha editado el menú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function T(){let e=v.value,a=m.value,o=g.value.value+1,t=1==o.toString().length?"0"+o:o,n=d.value[o-1].nombre;if(e.nombre.split(" ")[1].toUpperCase()==a.toUpperCase())return x().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let l=0;l<e.arrayTeclas.length;l++)k.Z.post("teclado/cambiarPosTecla",{idArticle:e.arrayTeclas[l].idArticle,nuevaPos:e.arrayTeclas[l].pos,nombreMenu:`[${n}]${t} ${a}`});x().fire("Submenú editado","Se ha editado el submenú correctamente","success"),_.W.cargarTeclado(),c.value=!1}async function E(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((e=>{if(e.isDismissed)return;let a=v.value;for(let o=0;o<4;o++)for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e].idArticle});o.dispatch("Teclado/setIndexMenuActivo",0),c.value=!1,_.W.cargarTeclado(),x().fire("Submenú eliminado","Se ha eliminado el Submenú correctamente","success")}))}async function A(){x().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((async e=>{let a=v.value;if(!e.isDismissed){if(a.arraySubmenus?.length&&a.arraySubmenus?.length>0)for(let e=0;e<4;e++)for(let o=0;o<a.arraySubmenus?.length;o++)for(let e=0;e<a.arraySubmenus[o]?.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arraySubmenus[o]?.arrayTeclas[e]?.idArticle});else for(let e=0;e<a.arrayTeclas.length;e++)k.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e]?.idArticle});await o.dispatch("Teclado/setIndexMenuActivo",0),_.W.cargarTeclado(),c.value=!1,x().fire("Menú eliminado","Se ha eliminado el menú correctamente","success")}}))}let I;function z(e){S(h[e])}async function S(e){try{w.value.abrirModal(e.value),I=setInterval((()=>{const a=w.value.getValue()[0];a!==e.value&&(e.value=a),w.value.getValue()[1]||clearInterval(I)}),100)}catch(a){console.log(a),I=void 0}}return a({openEditModal:M,abrirModal:C}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.DosNivells?"Si"==e.data?.DosNivells&&(u.value=!0):u.value=!1}))})),{modalCrearMenus:n,nombreMenu:l,nombreSubMenu:i,abrirModal:C,editMenuName:B,deleteAllProductsMenu:A,deleteAllProductsSubMenu:E,createProductCheckFields:r,crearMenu:y,MenusComponentRef:b,isSubmenu:s,editarMenuTeclado:v,editarEsMenu:p,haveSubmenu:u,modalEditarMenu:c,editSubMenuName:T,editarNombreTxt:m,editarTagCount:g,openKeyBoardCampos:z,keyboardRef:w}}},A=o(40089);const I=(0,A.Z)(E,[["render",y],["__scopeId","data-v-00a5a4d2"]]);var z=I,S={name:"MenusComponent",components:{ModalCrearProductoMenus:z},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),l=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.modoActual)),r=(0,D.iH)(null),s=(0,D.iH)(-1);function u(e){e==s.value&&"MODIFICAR_ARTICULO"==i.value&&r.value.openEditModal(n.value[e],e,0),s.value=e,o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{u(0)})),a({setActivo:u,indexMenuActivo:l}),{teclado:n,indexMenuActivo:l,setActivo:u,activo:s,modoActual:i,ModalCrearMenusRef:r}}};const H=(0,A.Z)(S,[["render",p],["__scopeId","data-v-2687fc6f"]]);var N=H;const F={class:"row",id:"submenu",style:{"margin-top":"1px","margin-right":"0px"}},P={key:0,class:"btn-group shadow-none",role:"group"},U={key:0},j=["onClick"];function W(e,a,o,n,l,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",F,[n.teclado&&n.teclado[n.indexMenuActivo]&&n.teclado[n.indexMenuActivo].arraySubmenus&&n.teclado[n.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",P,["MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.iD)("div",U,[(0,t._)("button",{onClick:a[0]||(a[0]=e=>n.ModalCrearMenusRef.abrirModal(n.teclado[n.indexMenuActivo].nombre)),class:"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100 newSubMenu"}," + Nuevo ")])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.teclado[n.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t._)("button",{class:(0,u.C_)([{activo:a==n.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>n.setIndexSubmenu(a)},(0,u.zw)(e.nombre),11,j)])))),128))])):(0,t.kq)("",!0)]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var O={name:"SubmenusComponent",components:{ModalCrearProductoMenus:z},setup(){const e=(0,f.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),n=(0,D.iH)(null),l=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo)),i=(0,t.Fl)((()=>e.state.modoActual)),r=(0,D.iH)(0);function s(t){t==r.value&&"MODIFICAR_ARTICULO"==i.value&&n.value.openEditModal(a.value[o.value].arraySubmenus[t],o,1),r.value=t,e.dispatch("Teclado/setIndexSubmenuActivo",t)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:l,setIndexSubmenu:s,modoActual:i,ModalCrearMenusRef:n}}};const V=(0,A.Z)(O,[["render",W],["__scopeId","data-v-4386dc8f"]]);var R=V;const $={key:0},Z={key:1},q=["onClick"];function L(e,a,o,n,l,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBtn"),d=(0,t.up)("PesoComponent"),c=(0,t.up)("SuplementosComponent"),m=(0,t.up)("ModalEditarProducto"),p=(0,t.up)("ModalCrearProducto"),f=(0,t.up)("ModalAlergenosVue"),v=(0,t.up)("ModalVaris");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[n.arrayTeclas&&n.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,u.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,l)=>(0,t._)("div",{class:(0,u.C_)(["col",[n.teclado[n.indexMenuActivo]?.arraySubmenus&&n.teclado[n.indexMenuActivo]?.arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:l},[n.arrayTeclas[l+6*o].idArticle?((0,t.wg)(),(0,t.j4)(s,{key:0,disabled:n.disabledTeclas,onMousedown:e=>n.startPress(n.arrayTeclas[l+6*o],e),onMouseup:e=>n.endPress(n.arrayTeclas[l+6*o],e),onTouchstartPassive:e=>n.startPress(n.arrayTeclas[l+6*o],e),onTouchendPassive:e=>n.endPress(n.arrayTeclas[l+6*o],e),class:(0,u.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[n.teclado[n.indexMenuActivo]?.arraySubmenus&&n.teclado[n.indexMenuActivo]?.arraySubmenus.length>0?"teclasConSubmenu":"teclas"]]),style:(0,u.j5)({"background-color":"#"+n.arrayTeclas[l+6*o].color.toString(16),color:n.getTextColor("#"+n.arrayTeclas[l+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{icon:n.arrayTeclas[l+6*o].esSumable?"":"balance-scale"},null,8,["icon"]),(0,t.Uk)("  "+(0,u.zw)(n.arrayTeclas[l+6*o].nombreArticulo)+" ",1),n.precioTecla&&0==n.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",$,(0,u.zw)(n.arrayTeclas[l+6*o]?.precioConIva?.toFixed(2))+"€ ",1)):n.precioTecla&&1==n.albaranNPT_o_vipPT?((0,t.wg)(),(0,t.iD)("p",Z,(0,u.zw)((Math.round(100*n.arrayTeclas[l+6*o]?.precioBase)/100).toFixed(2))+"€ ",1)):(0,t.kq)("",!0),n.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:2,class:"stock",style:(0,u.j5)({fontSize:(n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.fontSize||3.5)+"px",color:n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.fontColor})},(0,u.zw)(void 0!==n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.stock?n.arrayStock["stock-"+n.arrayTeclas[l+6*o]?.idArticle]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:2},1032,["disabled","onMousedown","onMouseup","onTouchstartPassive","onTouchendPassive","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,u.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==n.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==n.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==n.isEditarArticulos(!1)},null==n.teclado[n.indexMenuActivo]?.arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>n.editarArticulo(n.arrayTeclas[l+6*o].pos)},(0,u.zw)(e.$t("vacio","Vacío"))+" "+(0,u.zw)(n.isEditarArticulos(!0)),11,q))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(d,{ref:"modalPesoRef"},null,512),(0,t.Wm)(c,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(m,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(p,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(f,{ref:"modalAlergenosRef"},null,512),(0,t.Wm)(v,{ref:"modalVarisRef"},null,512)],64)}const Y=e=>((0,t.dD)("data-v-7d1b1c95"),e=e(),(0,t.Cn)(),e),K=Y((()=>(0,t._)("div",{"data-v-95b64bf4":"",class:"modal-header"},[(0,t._)("h5",{"data-v-95b64bf4":"",class:"modal-title",id:"staticBackdropLabel"}," Introduce los gramos ")],-1))),G={class:"row"},J={class:"row"};function Q(e,a,o,n,l,i){const r=(0,t.up)("MDBInput"),s=(0,t.up)("NumpadComponent"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:n.modalPeso,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalPeso=e),staticBackdrop:"",onShow:n.onModalShow,onShown:n.onModalShown,onHide:n.onModalHide,onHidden:n.onModalHidden},{default:(0,t.w5)((()=>[K,(0,t.Wm)(d,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",G,[n.numpadRef&&n.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(r,{key:0,modelValue:n.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>n.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",J,[((0,t.wg)(),(0,t.j4)(s,{disabled:n.isTransitioning,ref:"numpadRef",key:n.modalPeso},null,8,["disabled"]))])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[1]||(a[1]=e=>n.closeModal()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>n.insertarArticulo(n.numpadRef.cantidad))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onShow","onShown","onHide","onHidden"])}var X=o(33727),ee={name:"PesoComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBInput:M.u2,NumpadComponent:X.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),n=(0,f.oR)(),l=(0,t.Fl)((()=>n.state.Teclado.objTeclado)),i=(0,t.Fl)((()=>n.state.Teclado.indexMenuActivo)),r=(0,D.iH)(null),s=(0,D.iH)({idArticulo:null,idCesta:null,nombre:""}),u=(0,D.iH)(!0),d=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo));function m(e,a,t){s.value.idArticulo=e,s.value.idCesta=a,s.value.nombre=t,setTimeout((()=>{o.value=!0}),1)}function p(){o.value=!1}function v(e){k.Z.post("teclado/clickTeclaArticulo",{idArticulo:s.value.idArticulo,gramos:e,idCesta:s.value.idCesta,unidades:1,arraySuplementos:null,nombre:s.value.nombre,menu:l.value[i.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(s.value.nombre),worker:encodeURIComponent(d.value[c.value].nombre)}}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");s.value.idArticulo=null,s.value.idCesta=null,o.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function g(){u.value=!0}function b(){u.value=!1}function w(){u.value=!0}function h(){u.value=!1}function C(){}return a({abrirModal:m}),(0,t.JJ)("okValue",v),{modalPeso:o,numpadRef:r,closeModal:p,infoArticulo:s,test:C,insertarArticulo:v,isTransitioning:u,onModalShow:g,onModalShown:b,onModalHide:w,onModalHidden:h}}};const ae=(0,A.Z)(ee,[["render",Q],["__scopeId","data-v-7d1b1c95"]]);var oe=ae;const te=e=>((0,t.dD)("data-v-4c3afa16"),e=e(),(0,t.Cn)(),e),ne={class:"row"},le=["onClick"],ie=te((()=>(0,t._)("br",null,null,-1))),re={key:0},se={key:1},ue={class:"row"},de={key:0,class:"table-responsive divCesta reverso"},ce={class:"table colorFuente"},me={class:"tableBody"},pe=["onClick"],fe={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}},ve={key:0},ge={key:1};function be(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:n.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,u.zw)(n.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(d,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",ne,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,u.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:n.checkSuplementoActivo(e._id)}]]),onClick:a=>n.addSuplemento(e)},[(0,t.Uk)((0,u.zw)(e.nombre)+" ",1),ie,n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("span",re,(0,u.zw)(e.precioBase)+" €",1)):n.precioTecla&&!n.albaran?((0,t.wg)(),(0,t.iD)("span",se,(0,u.zw)(e.precioConIva.toFixed(2)),1)):(0,t.kq)("",!0)],10,le)])))),128))]),(0,t._)("div",ue,[n.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",de,[(0,t._)("table",ce,[(0,t._)("tbody",me,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,u.C_)(["itemCesta",{seleccionado:n.itemSeleccionado===a}]),onClick:e=>n.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",fe,(0,u.zw)(e.nombre),1)]),n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("td",ve,(0,u.zw)(e.precioBase)+" €",1)):!n.albaran&&n.precioTecla?((0,t.wg)(),(0,t.iD)("td",ge,(0,u.zw)(e.precioConIva.toFixed(2))+" € ",1)):(0,t.kq)("",!0)],10,pe)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"danger",onClick:a[0]||(a[0]=e=>n.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(c,{color:"secondary",onClick:a[1]||(a[1]=e=>n.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>n.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var we={name:"SuplementosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),u={idArticulo:null,idCesta:null,cliente:null,suplementos:null},d=(0,D.iH)(!1),c=(0,D.iH)([]),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),v=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let g=0;const b=(0,t.Fl)((()=>{if(c.value&&c.value.length>0){let e=0;for(let a=0;a<c.value.length;a++)e+=c.value[a].precioConIva;return e}return 0})),w=(0,D.iH)(!1);async function h(e,a,t,l,i,r){u.idArticulo=e,u.idCesta=a,u.cliente=t,g=i,w.value=r;const s=await k.Z.post("articulos/getSuplementos",{arrayIdSuplementos:l});if(!s)throw Error("No se ha podido obtener la lista de suplementos");m.value=s.data,m.value.sort(((e,a)=>e.nombre.localeCompare(a.nombre))),o.dispatch("Unidades/setUnidades",1),n.value=!0}function C(e){try{c.value.push(e)}catch(a){x().fire("Oops...",a.message,"error")}}function y(e){const a=c.value.findIndex((a=>a.suplemento===e));return-1!==a}function _(e){i.value=e}function M(){c.value.splice(i.value,1)}async function B(){n.value=!1;try{let e;for(let a=0;a<g;a++)e=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:u.idArticulo,gramos:0,idCesta:u.idCesta,unidades:1,arraySuplementos:c.value,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(u.idArticulo),worker:encodeURIComponent(p.value[v.value].nombre)}});if(u.idArticulo=null,u.idCesta=null,c.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos")}catch(e){x().fire("Oops...",e.message,"error")}}function T(){}return a({abrirModal:h}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(d.value=!0):d.value=!1}))})),(0,t.JJ)("okValue",B),{modalSuplementos:n,addSuplemento:C,checkSuplementoActivo:y,numpadRef:l,arrayCompletoSuplementos:m,suplementosSeleccionados:c,itemSeleccionado:i,insertarArticulo:B,setIndex:_,eliminarActivo:M,totalSuplementos:b,test:T,precioTecla:d,albaran:w}}};const he=(0,A.Z)(we,[["render",be],["__scopeId","data-v-4c3afa16"]]);var Ce=he;const ye=e=>((0,t.dD)("data-v-4e1acfb0"),e=e(),(0,t.Cn)(),e),_e={class:"row"},Me={for:"nombre"},De={for:"tipoIva"},ke=["value"],Be={for:"esSumable"},xe=ye((()=>(0,t._)("option",{value:"true"},"Si",-1))),Te=ye((()=>(0,t._)("option",{value:"false"},"No",-1))),Ee=[xe,Te],Ae={for:"precioIva"},Ie={for:"precioConIva"},ze={class:"row mt-3"},Se={class:"col text-center"};function He(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),f=(0,t.up)("KeyBoardComponent"),g=(0,t.up)("MDBInput"),b=(0,t.up)("NumpadComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:n.modalEditarProd,"onUpdate:modelValue":a[10]||(a[10]=e=>n.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",_e,[(0,t._)("label",Me,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e),readonly:"",onClick:a[1]||(a[1]=e=>n.openKeyboard())},null,512),[[v.nr,n.nombre]])]),(0,t._)("label",De,[(0,t.Uk)("Tipo de IVA "),(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[2]||(a[2]=e=>n.tipoIva=e),class:"form-control"},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.tiposIva,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.iva,value:parseInt(e.tipus)},(0,u.zw)(e.iva)+"% ",9,ke)))),128))],512),[[v.bM,n.tipoIva]])]),(0,t._)("label",Be,[(0,t.Uk)("¿Se vende a unidades? "),(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[3]||(a[3]=e=>n.esSumable=e),class:"form-control"},Ee,512),[[v.bM,n.esSumable]])]),(0,t._)("label",Ae,[(0,t.Uk)("Precio con "+(0,u.zw)(parseInt(n.tiposIva[n.tipoIva-1].iva))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=e=>n.precioConIva=e),readonly:"",onClick:a[5]||(a[5]=e=>n.openNumpad())},null,512),[[v.nr,n.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[6]||(a[6]=e=>n.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(c,{color:"warning",size:"lg",onClick:a[7]||(a[7]=e=>n.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[8]||(a[8]=e=>n.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(c,{color:"secondary",size:"lg",onClick:a[9]||(a[9]=e=>n.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"keyboardRef"},null,512),(0,t.Wm)(p,{id:"modalNumpad",tabindex:"-1",labelledby:"modalNumpadLabel",modelValue:n.modalNumpad,"onUpdate:modelValue":a[14]||(a[14]=e=>n.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalNumpadLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("precio_final","Precio final")),1)])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,u.C_)(["row",{shake:n.activarShake}])},[(0,t._)("label",Ie,[(0,t.Uk)("Precio con IVA "),n.numpadRef&&n.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(g,{key:0,modelValue:n.numpadRef.cantidad,"onUpdate:modelValue":a[11]||(a[11]=e=>n.numpadRef.cantidad=e),readonly:""},null,8,["modelValue"])):(0,t.kq)("",!0)])],2),(0,t._)("div",ze,[(0,t._)("div",Se,[(0,t.Wm)(b,{max3EntersDigits:!0,skipBalanza:!0,onActivarShake:n.handleShake,ref:"numpadRef",onSetValue:n.setPrecioConIva},null,8,["onActivarShake","onSetValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"secondary",onClick:a[12]||(a[12]=e=>n.modalNumpad=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"primary",size:"lg",onClick:a[13]||(a[13]=a=>e.cerrarCaja()),disabled:e.botonesBloqueados},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("confirmar_cierre","Confirmar cierre")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])],64)}var Ne={name:"ModalEditarProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,KeyBoardComponent:T.Z,NumpadComponent:X.Z,MDBInput:M.u2},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(0),l=(0,D.iH)(!1),i=(0,D.iH)(0),r=(0,D.iH)(0),s=o.getters["TiposIva/getTiposIva"],u=(0,D.iH)(""),d=(0,D.iH)(-1),c=(0,D.iH)(""),m=(0,D.iH)(!0),p=(0,D.iH)(null),v=(0,D.iH)(null),g=(0,D.iH)(!1),b=(0,D.iH)(!1);async function w(){await k.Z.post("articulos/editarArticulo",{idArticulo:d.value,nombre:u.value,precioBase:parseFloat(i.value)/parseFloat(r.value),precioConIva:parseFloat(i.value),tipoIva:r.value,essumable:JSON.parse(m.value)}).then((e=>{l.value=!1,x().fire("Producto guardado","Producto guardado correctamente","success"),_.W.cargarTeclado()}))}function h(){l.value=!1}function C(){l.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function y(e,a){await k.Z.post("articulos/moverArticulo",{id:d.value,posicion:e,menu:a}).then((a=>{x().fire("Producto establecido","Se ha movido el producto "+u.value+" correctamente a la celda "+e,"success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function M(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await k.Z.post("articulos/eliminarArticulo",{id:d.value}).then((e=>{x().fire("Producto eliminado","Se eliminado el producto "+u.value+" correctamente a la celda","success"),_.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),l.value=!1)}async function B(e,a,o,t,n,s){u.value=e,i.value=a,d.value=o,r.value=t,m.value=n,l.value=!0}let T;async function E(){try{p.value.abrirModal(u.value),T=setInterval((()=>{const e=p.value.getValue()[0];e!==u.value&&(u.value=e),p.value.getValue()[1]||clearInterval(T)}),100)}catch(e){console.log(e),T=void 0}}function A(){g.value=!0}function I(e){i.value=e}function z(){b.value=!0,setTimeout((()=>{b.value=!1}),500)}return(0,t.JJ)("okValue",(()=>g.value=!1)),(0,t.bv)((()=>{})),a({abrirModal:B,botonVacio:y}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:u,precioBase:n,precioConIva:i,id:d,modalEditarProd:l,tipoIva:r,confirmar:w,menus:c,cambiarPosicion:C,esSumable:m,tiposIva:s,salirSinGuardar:h,EliminarTecla:M,openKeyboard:E,keyboardRef:p,numpadRef:v,openNumpad:A,modalNumpad:g,setPrecioConIva:I,activarShake:b,handleShake:z}}};const Fe=(0,A.Z)(Ne,[["render",He],["__scopeId","data-v-4e1acfb0"]]);var Pe=Fe;const Ue=e=>((0,t.dD)("data-v-fb966688"),e=e(),(0,t.Cn)(),e),je={class:"row"},We={for:"nombre"},Oe=["disabled"],Ve=Ue((()=>(0,t._)("label",{for:"nombre"},[(0,t.Uk)("Nombre articulo "),(0,t._)("br")],-1))),Re={style:{display:"flex"}},$e={for:"tipoIva"},Ze=["disabled"],qe=Ue((()=>(0,t._)("option",{value:"4"},"0%",-1))),Le=Ue((()=>(0,t._)("option",{value:"1"},"4%",-1))),Ye=Ue((()=>(0,t._)("option",{value:"5"},"5%",-1))),Ke=Ue((()=>(0,t._)("option",{value:"2"},"10%",-1))),Ge=Ue((()=>(0,t._)("option",{value:"3"},"21%",-1))),Je=[qe,Le,Ye,Ke,Ge],Qe={for:"esSumable"},Xe=["disabled"],ea=Ue((()=>(0,t._)("option",{value:"true"},"Si",-1))),aa=Ue((()=>(0,t._)("option",{value:"false"},"No",-1))),oa=[ea,aa],ta={for:"precioIva"},na=["disabled"],la={class:"row"},ia={for:"nombre"},ra={key:0,class:"row"},sa={class:"col"},ua={class:"table-responsive w-100",style:{height:"400px"}},da={class:"table table-striped mt-1"},ca={class:"textoNombre d-inline-block text-truncate"},ma={for:"precioConIva"},pa={class:"row mt-3"},fa={class:"col text-center"};function va(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),g=(0,t.up)("KeyBoardComponent"),b=(0,t.up)("MDBInput"),w=(0,t.up)("NumpadComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:n.modalCrearProd,"onUpdate:modelValue":a[11]||(a[11]=e=>n.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",je,[(0,t._)("label",We,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{disabled:null!=n.articuloSeleccionado,id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e),readonly:"",onClick:a[1]||(a[1]=e=>n.openKeyBoardCampos("nombre"))},null,8,Oe),[[v.nr,n.nombre]])]),Ve,(0,t._)("div",Re,[null==n.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>n.nombre=e)},null,512)),[[v.nr,n.nombre]]):(0,t.kq)("",!0),null!=n.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:1,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>n.articuloSeleccionado.nombre=e)},null,512)),[[v.nr,n.articuloSeleccionado.nombre]]):(0,t.kq)("",!0),(0,t.Wm)(c,{onClick:a[4]||(a[4]=e=>n.articuloModal=!0),color:"secondary",floating:""},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"search",size:"0.5x"})])),_:1})]),(0,t._)("label",$e,[(0,t.Uk)("Tipo de IVA "),(0,t.wy)((0,t._)("select",{disabled:null!=n.articuloSeleccionado,name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[5]||(a[5]=e=>n.tipoIva=e),class:"form-control"},Je,8,Ze),[[v.bM,n.tipoIva]])]),(0,t._)("label",Qe,[(0,t.Uk)("¿Se vende a unidades? "),(0,t.wy)((0,t._)("select",{disabled:null!=n.articuloSeleccionado,name:"esSumable",id:"esSumable","onUpdate:modelValue":a[6]||(a[6]=e=>n.esSumable=e),class:"form-control"},oa,8,Xe),[[v.bM,n.esSumable]])]),(0,t._)("label",ta,[(0,t.Uk)("Precio con "+(0,u.zw)(parseInt(n.tiposIva[n.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{disabled:null!=n.articuloSeleccionado,id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>n.precioConIva=e),readonly:"",onClick:a[8]||(a[8]=e=>n.openNumpad())},null,8,na),[[v.nr,n.precioConIva]])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"success",size:"lg",onClick:a[9]||(a[9]=e=>n.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(c,{color:"danger",size:"lg",onClick:a[10]||(a[10]=e=>n.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{id:"articuloModal",tabindex:"-1",labelledby:"articuloModal",modelValue:n.articuloModal,"onUpdate:modelValue":a[15]||(a[15]=e=>n.articuloModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",la,[(0,t._)("label",ia,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[12]||(a[12]=e=>n.inputBusqueda=e),readonly:"",onClick:a[13]||(a[13]=e=>n.openKeyBoardCampos("inputBusqueda"))},null,512),[[v.nr,n.inputBusqueda]])]),n.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",ra,[(0,t._)("div",sa,[(0,t._)("div",ua,[(0,t._)("table",da,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",ca,(0,u.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(c,{color:"primary",size:"lg",onClick:e=>n.selectArticulo({articulo:a}),class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{onClick:a[14]||(a[14]=e=>n.deleteArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Borrar selección")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(g,{ref:"keyboardRef"},null,512),(0,t.Wm)(f,{id:"modalNumpad",tabindex:"-1",labelledby:"modalNumpadLabel",modelValue:n.modalNumpad,"onUpdate:modelValue":a[19]||(a[19]=e=>n.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalNumpadLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("precio_final","Precio final")),1)])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,u.C_)(["row",{shake:n.activarShake}])},[(0,t._)("label",ma,[(0,t.Uk)("Precio con IVA "),n.numpadRef&&n.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(b,{key:0,modelValue:n.numpadRef.cantidad,"onUpdate:modelValue":a[16]||(a[16]=e=>n.numpadRef.cantidad=e),readonly:""},null,8,["modelValue"])):(0,t.kq)("",!0)])],2),(0,t._)("div",pa,[(0,t._)("div",fa,[(0,t.Wm)(w,{max3EntersDigits:!0,skipBalanza:!0,onActivarShake:n.handleShake,ref:"numpadRef",onSetValue:n.setPrecioConIva},null,8,["onActivarShake","onSetValue"])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"secondary",onClick:a[17]||(a[17]=e=>n.modalNumpad=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"primary",size:"lg",onClick:a[18]||(a[18]=a=>e.cerrarCaja()),disabled:e.botonesBloqueados},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("confirmar_cierre","Confirmar cierre")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])],64)}var ga={name:"modalCrearProducto",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,MDBIcon:M.vm,MDBInput:M.u2,KeyBoardComponent:T.Z,NumpadComponent:X.Z},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,D.iH)(0),l=(0,D.iH)(!1),i=(0,D.iH)(!1),r=(0,D.iH)(0),s=(0,D.iH)(0),u=(0,D.iH)(0),d=[4,10,21,0,5],c=(0,D.iH)(""),m=(0,D.iH)(""),p=(0,D.iH)(-1),v=(0,D.iH)(""),g=(0,D.iH)(!0),b=(0,D.iH)(),w=(0,D.iH)(""),h=(0,D.iH)(null),C=(0,D.iH)(null),y=(0,D.iH)(null),M=(0,D.iH)(!1),B=(0,D.iH)(!1);function T(){k.Z.post("articulos/buscar",{busqueda:w.value,familia:"Todos",limit:20}).then((e=>{b.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function E(e){s.value=1,r.value=0,c.value="Nombre",g.value=!1,h.value=null,i.value=!1}async function A(e){s.value=e.articulo.tipoIva,r.value=e.articulo.precioConIva,c.value=e.articulo.nombre,g.value=e.articulo.esSumable,h.value=e.articulo,i.value=!1}async function I(){k.Z.post("articulos/anadirProducto",{nombreArticulo:c.value,precioConIva:parseFloat(r.value),esSumable:JSON.parse(g.value),precioBase:parseFloat(r.value)/parseFloat(s.value),tipoIva:parseFloat(s.value),menus:v.value,posicion:u.value,articuloExistente:null!=h.value,idArticulo:h.value?._id}).then((e=>{m.value="",n.value=0,r.value=0,s.value=3,g.value=!1,l.value=!1,x().fire("Producto creado","Producto creado correctamente","success"),_.W.cargarTeclado()}))}function z(){l.value=!1}function S(){l.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function H(e,a){u.value=e,c.value="Nombre",r.value="0.0",s.value="3",g.value=!0,l.value=!0,v.value=a}(0,t.YP)(w,(()=>{T()}));const N={nombre:c,inputBusqueda:w};let F;function P(e){U(N[e])}async function U(e){try{C.value.abrirModal(e.value),F=setInterval((()=>{const a=C.value.getValue()[0];a!==e.value&&(e.value=a),C.value.getValue()[1]||clearInterval(F)}),100)}catch(a){console.log(a),F=void 0}}function j(){B.value=!0}function W(e){r.value=e}function O(){M.value=!0,setTimeout((()=>{M.value=!1}),500)}return(0,t.JJ)("okValue",(()=>B.value=!1)),(0,t.bv)((()=>{})),a({abrirModal:H}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:c,precioBase:n,precioConIva:r,id:p,modalCrearProd:l,tipoIva:s,confirmar:I,menus:v,inputBusqueda:w,arrayArticulos:b,cambiarPosicion:S,esSumable:g,tiposIva:d,salirSinGuardar:z,articuloModal:i,selectArticulo:A,articuloSeleccionado:h,deleteArticulo:E,openKeyboard:U,keyboardRef:C,numpadRef:y,openNumpad:j,modalNumpad:B,setPrecioConIva:W,activarShake:M,handleShake:O,openKeyBoardCampos:P}}};const ba=(0,A.Z)(ga,[["render",va],["__scopeId","data-v-fb966688"]]);var wa=ba;const ha=["src"];function Ca(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),d=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(d,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:n.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:n.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,ha),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>n.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var ya={name:"ModalAlergenosComponent",components:{MDBModal:M.j3,MDBModalFooter:M.ab,MDBBtn:M.$v},setup(e,{expose:a}){const o=(0,D.iH)(!1),t=(0,D.iH)(""),n=(0,f.oR)(),l=n.getters["Configuracion/parametros"];function i(e){r(e),o.value=!0}function r(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${l?.licencia}`}return a({abrirModal:i}),{modalAlergenos:o,abrirModal:i,url:t}}};const _a=(0,A.Z)(ya,[["render",Ca]]);var Ma=_a;function Da(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),v=(0,t.up)("PesoComponent"),g=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalVaris",tabindex:"-1",labelledby:"tituloModalVaris",modelValue:n.modalVarisActivo,"onUpdate:modelValue":a[2]||(a[2]=e=>n.modalVarisActivo=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"tituloModalVaris"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("inserta_el_nombre","Inserta el nombre del articulo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:n.nombreArticulo,"onUpdate:modelValue":a[0]||(a[0]=e=>n.nombreArticulo=e),"aria-placeholder":"{{ $t('nombre', 'Nombre') }}",type:"text",ref:"inputRef",readonly:"",onClick:a[1]||(a[1]=e=>n.openKeyboard())},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{color:"success",onClick:n.handleSubmit},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("aceptar","Aceptar")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"modalPesoRef"},null,512),(0,t.Wm)(g,{ref:"keyboardRef"},null,512)],64)}var ka={name:"ModalVaris",components:{MDBBtn:M.$v,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalFooter:M.ab,MDBInput:M.u2,PesoComponent:oe,KeyBoardComponent:T.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),n=new Event("acabado"),l=(0,f.oR)(),i=(0,D.iH)(null),r=(0,t.Fl)((()=>l.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>l.state.Teclado.indexMenuActivo)),u=(0,D.iH)({idArticle:"",gramos:null,idCesta:"",unidades:0,arraySuplementos:null}),d=(0,D.iH)(""),c=(0,D.iH)(null),m=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),v=(0,D.iH)(null),g=async e=>{try{o.value=!0,d.value="",u.value=e}catch(a){console.log(a)}};a({abrirModal:g,nombreArticulo:d});const b=async()=>{let e=d.value;0===e.length&&(e=u.value.nom),u.value.idArticle?(u.value.peso?(o.value=!1,await i.value.abrirModal(u.value.idArticle,u.value.idCesta,e),d.value=void 0):async function(){const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:u.value.idArticle,gramos:u.value.gramos,idCesta:u.value.idCesta,unidades:u.value.unidades,arraySuplementos:null,nombre:e,menu:r.value[s.value].menu},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e),worker:encodeURIComponent(m.value[p.value].nombre)}});if(d.value="",!a.data)throw Error("No se ha podido añadir el artículo a la cesta");l.dispatch("Unidades/setUnidades",1)}(),d.value=void 0,o.value=!1):document.dispatchEvent(n)},w=()=>{c.value.focus()};let h;async function C(){try{v.value.abrirModal(d.value),h=setInterval((()=>{const e=v.value.getValue()[0];e!==d.value&&(d.value=e),v.value.getValue()[1]||clearInterval(h)}),100)}catch(e){console.log(e),h=void 0}}return{modalVarisActivo:o,nombreArticulo:d,handleSubmit:b,modalPesoRef:i,inputRef:c,getFocus:w,openKeyboard:C,keyboardRef:v}}};const Ba=(0,A.Z)(ka,[["render",Da]]);var xa=Ba,Ta=o(22483),Ea={name:"TeclasComponent",components:{PesoComponent:oe,MDBBtn:M.$v,SuplementosComponent:Ce,ModalEditarProducto:Pe,ModalCrearProducto:wa,ModalAlergenosVue:Ma,ModalVaris:xa,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,Ta.tv)(),l=(0,t.Fl)((()=>o.state.modoActual)),i=(0,t.Fl)((()=>o.state.Configuracion.parametros)),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),u=(0,D.iH)(!1),d=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),c=(0,D.iH)(null),m=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),p=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),v=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),g=(0,D.iH)(null),b=(0,D.iH)(!1),w=(0,D.iH)(null),h=(0,D.iH)(null),C=(0,D.iH)(null),y=(0,D.iH)(null),_=(0,t.Fl)((()=>o.state.Unidades.unidades)),M=(0,D.iH)(!1),B=(0,t.Fl)((()=>{if(d.value)for(let e=0;e<d.value.length;e++)if(m.value&&m.value[p.value]&&d.value[e]._id==m.value[p.value].idCesta)return d.value[e];return null})),T=(0,D.iH)(null),E=(0,D.iH)(!1),A=(0,D.iH)(!1),I=(0,D.iH)(!1),z=(0,D.iH)(!1),S=(0,D.iH)(null),H=(0,t.Fl)((()=>{if(S.value!==B.value?.idCliente)return S.value=B.value?.idCliente,B.value?.idCliente})),N=(0,t.Fl)((()=>o.state.Stock.arrayStock));function F(e){y.value.abrirModal(e)}function P(e){I.value=e}function U(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}function j(){k.Z.get("caja/estadoCaja").then((e=>{1==e.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=e.data&&3!=e.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&n.push("/menu/fichajes"):n.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function W(e,a=undefined){j();const t=e.nombreArticulo&&null!=e.nombreArticulo.match(/(Varis|Varios)/i);if(void 0!=a&&-1==a.pointerId)return;let n=e.idArticle,u=d.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===l.value||"MOVER_ARTICULO"===l.value)return"MOVER_ARTICULO"===l.value?void x().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void k.Z.post("articulos/getArticulo",{idArticulo:n,idCliente:u}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");h.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!B.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=i?.value?.prohibirSuplementos&&e.suplementos?.length>0)w.value.abrirModal(e.idArticle,B.value._id,B.value.idCliente,e.suplementos,_.value>0?_.value:1,z.value);else if(t)c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,peso:!1,nom:e.nombreArticulo});else try{o.dispatch("Procesando/procesandoClickTecla",!0);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value>0?_.value:1,arraySuplementos:null,nombre:"",menu:r.value[s.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombreArticulo),worker:encodeURIComponent(m.value[p.value].nombre)}});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}finally{o.dispatch("Procesando/procesandoClickTecla",!1)}else t?await c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:B.value._id,unidades:_.value,arraySuplementos:null,peso:!0,nom:e.nombreArticulo}):g.value.abrirModal(e.idArticle,B.value._id,e.nombreArticulo)}catch(f){x().fire("Oops...",f.message,"error")}}const O=(0,t.Fl)((()=>{let e=U();if(r.value&&r.value[s.value]&&r.value[s.value].arraySubmenus&&r.value[s.value].arraySubmenus[v.value])for(let a=0;a<r.value[s.value].arraySubmenus[v.value].arrayTeclas.length;a++)e[r.value[s.value].arraySubmenus[v.value].arrayTeclas[a].pos]=r.value[s.value].arraySubmenus[v.value].arrayTeclas[a];else if(r.value&&r.value[s.value]&&r.value[s.value].arrayTeclas)for(let a=0;a<r.value[s.value].arrayTeclas.length;a++)e[r.value[s.value].arrayTeclas[a].pos]=r.value[s.value].arrayTeclas[a];return e}));function V(e){return parseInt(e,16)||e}function R(e){return V(e)/255<=.03928?V(e)/255/12.92:Math.pow((V(e)/255+.055)/1.055,2.4)}function $(e){return.2126*R(e.substr(1,2))+.7152*R(e.substr(3,2))+.0722*R(e.substr(-2))}function Z(e,a){const o=$(e),t=$(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function q(e){const a=Z(e,"#ffffff"),o=Z(e,"#000000");return a>o?"#ffffff":"#000000"}function L(e){}function Y(e){return e?"MOVER_ARTICULO"==l.value?"Mover aqui":"Vacío":l.value}function K(e){let a=r.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[v.value].nombre,t=`[${a.nombre}]${o}`),"MOVER_ARTICULO"==l.value)return h.value.botonVacio(e,t);C.value.abrirModal(e,t)}async function G(e){return k.Z.post("clientes/getClienteById",{idCliente:e}).then((e=>!!e.data&&!(!e.data?.albaran&&!e.data?.vip))).catch((e=>(console.log("error comprobaralbaranNPT_o_vipPT",e),!1)))}function J(e,a=undefined){T.value=setTimeout((()=>{F(e.idArticle),T.value=null}),500)}function Q(e,a=undefined){T.value&&!E.value&&(clearTimeout(T.value),W(e,a),X()),clearTimeout(T.value)}function X(){E.value=!0,setTimeout((()=>{E.value=!1}),70)}function ee(e){if(!e)return 0;const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Math.round(100*o)/100}return(0,t.JJ)("addItem",L),(0,t.YP)((()=>H.value),(async()=>{try{if(B.value?.idCliente){const e=await G(B.value.idCliente);z.value=!0===e}else z.value=!1}catch(e){console.error("Error en watch:",e),z.value=!1}})),(0,t.bv)((async()=>{m.value&&0!==m.value?.length||n.push("menu/fichajes"),k.Z.post("parametros/getParametros").then((e=>{"Si"==e.data?.params?.textoStock&&(u.value=!0),void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(M.value=!0):M.value=!1,void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(b.value=!0):b.value=!1,void 0!=e.data?.nombreEmpresa&&void 0!=e.data?.params?.AlertaJoanets?"tena"==e.data?.nombreEmpresa?.toLowerCase()&&"Si"==e.data?.params?.AlertaJoanets&&(A.value=!0):A.value=!1})),H.value&&(z.value=await G(H.value))})),a({clickTecla:W,postDisabledTecla:P}),{teclado:r,precioTecla:b,indexMenuActivo:s,arrayTeclas:O,getTextColor:q,modalPesoRef:g,modalSuplementosRef:w,modalAlergenosRef:y,modalEditarProdRef:h,modalCrearProdRef:C,abrirFicha:F,clickTecla:W,NoSuplementos:M,isEditarArticulos:Y,editarArticulo:K,modalVarisRef:c,startPress:J,endPress:Q,pressTimeout:T,opBloquado:E,getAnimation:ee,AlertaJoanets:A,cesta:B,postDisabledTecla:P,disabledTeclas:I,albaranNPT_o_vipPT:z,textoStock:u,arrayStock:N}}};const Aa=(0,A.Z)(Ea,[["render",L],["__scopeId","data-v-61ffee65"]]);var Ia=Aa;const za=e=>((0,t.dD)("data-v-04d95a90"),e=e(),(0,t.Cn)(),e),Sa={key:0,class:"table-responsive divCesta reverso"},Ha={key:0,class:"col-md-6 verifactu",src:"/img/verifactu.png"},Na={class:"colorFuente",style:{"z-index":"20"}},Fa={class:"tableBody"},Pa=["onClick"],Ua={class:"cantidad"},ja={class:"d-inline-block text-truncate xUnidades"},Wa={key:1,id:"suplementos"},Oa={id:"promocionDetalles"},Va={key:0,class:"d-flex row col-12"},Ra={class:"col-12"},$a={"d-flex":"","justify-content-around":""},Za={style:{"max-width":"6.5rem","min-width":"6.5rem"},class:"nombreArtPromocion"},qa={class:"pe-1"},La={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},Ya={class:"xUnidades d-inline",style:{width:"fit-content",margin:"0 0.07rem"}},Ka={key:0,style:{"max-width":"15rem","min-width":"15rem","vertical-align":"middle",padding:"0.5rem 1.4rem","font-weight":"bold","text-align":"center"}},Ga={key:0},Ja={key:1},Qa=za((()=>(0,t._)("br",null,null,-1))),Xa={key:2,class:"detallesAlbIva"},eo={key:3,class:"detallesAlbIva"},ao={key:4,class:"detallesAlbIva"},oo={key:1},to={key:2},no={key:1},lo={key:0,class:"fw-bold"};function io(e,a,o,n,l,i){const r=(0,t.up)("MDBPopover"),s=(0,t.up)("MDBBtn"),d=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBCardTitle"),m=(0,t.up)("MDBCardText"),p=(0,t.up)("MDBCardBody"),f=(0,t.up)("MDBCard"),v=(0,t.up)("ModalDescuentosTiendaComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(r,{style:{position:"absolute"},modelValue:n.popOverTarifaEsp,"onUpdate:modelValue":a[0]||(a[0]=e=>n.popOverTarifaEsp=e),direction:"right"},{header:(0,t.w5)((()=>[(0,t.Uk)("Tarifa especial")])),body:(0,t.w5)((()=>[(0,t.Uk)(" Precio preferencial para clientes específicos. ")])),_:1},8,["modelValue"]),n.cesta&&n.cesta.lista?((0,t.wg)(),(0,t.iD)("div",Sa,[n.parametros?.nif?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("img",Ha)),(0,t._)("table",Na,[(0,t._)("tbody",Fa,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.cesta.lista,((e,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o,class:(0,u.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:n.indexItemCestaActivo===o&&n.parametros?.nif,seleccionadoNif:n.indexItemCestaActivo===o&&!n.parametros?.nif,sePuedeRegalar:n.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>n.clickItem(o)},[(0,t._)("td",Ua,[(0,t._)("span",ja,[e?.tarifaEsp?((0,t.wg)(),(0,t.iD)("span",{key:0,onMouseover:a[1]||(a[1]=(...e)=>n.showPopOver&&n.showPopOver(...e)),onMouseleave:a[2]||(a[2]=(...e)=>n.hidePopOver&&n.hidePopOver(...e)),class:"tarifaEsp"},"TE",32)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,u.zw)(e.nombre)+" ",1),e.arraySuplementos?.length>0?((0,t.wg)(),(0,t.iD)("div",Wa,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,u.zw)(e.nombre),1)))),128))])):(0,t.kq)("",!0),(0,t._)("div",Oa,[e.promocion?((0,t.wg)(),(0,t.iD)("tr",Va,[e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.promocion.grupos.flat(),((a,o)=>((0,t.wg)(),(0,t.iD)("li",Ra,[(0,t._)("span",$a,[(0,t._)("td",Za,(0,u.zw)(a.nombre),1),(0,t._)("td",qa,(0,u.zw)(a.precioPromoPorUnidad.toFixed(2))+" € ",1),(0,t._)("td",La," x"+(0,u.zw)(e.unidades*a.unidades),1)])])))),256)):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])]),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:0,onClick:a=>n.restar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.unidades<=1||e.pagado||n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" - ")])),_:2},1032,["onClick","disabled"])),(0,t._)("span",Ya," x"+(0,u.zw)(0!=e.gramos&&e.gramos?(e.gramos/1e3).toFixed(3)+"kg":e.unidades),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:1,onClick:a=>n.sumar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.pagado||n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Uk)(" + ")])),_:2},1032,["onClick","disabled"]))]),"DEVOLUCION"!==n.cesta.modo?((0,t.wg)(),(0,t.iD)("td",Ka,[e?.precioOrig?((0,t.wg)(),(0,t.iD)("span",Ja,(0,u.zw)(n.cOutPrecioOrig(e.precioOrig))+" €",1)):((0,t.wg)(),(0,t.iD)("span",Ga,(0,u.zw)(e.subtotal.toFixed(2))+" €",1)),Qa,e.subtotal>0&&e?.iva?((0,t.wg)(),(0,t.iD)("span",Xa,"+"+(0,u.zw)(e.iva)+"% IVA",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.descuentoTienda&&0!=e?.descuentoTienda?((0,t.wg)(),(0,t.iD)("span",eo," -"+(0,u.zw)(e.descuentoTienda)+"% DTO",1)):(0,t.kq)("",!0),e.subtotal>0&&e?.dto?((0,t.wg)(),(0,t.iD)("span",ao," -"+(0,u.zw)(e.dto)+"% DTO",1)):(0,t.kq)("",!0)])):(0,t.kq)("",!0),n.sePuedeRegalar(e)?((0,t.wg)(),(0,t.iD)("td",oo,[(0,t.Wm)(s,{color:"secondary",onClick:a=>n.clickRegalo(o,e),size:"sm",disabled:n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"gift",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0),"CONSUMO_PERSONAL"==n.cesta.modo?((0,t.wg)(),(0,t.iD)("td",to,[(0,t.Wm)(s,{color:"secondary",onClick:a=>n.clickDiscountShop(o,e),size:"sm",disabled:n.disabledCambiarUnidades},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{icon:"percent",size:"lg"})])),_:2},1032,["onClick","disabled"])])):(0,t.kq)("",!0)],10,Pa)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",no,[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),n.arrayTrabajadores&&n.arrayTrabajadores[n.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",lo,(0,u.zw)(n.arrayTrabajadores[n.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(s,{color:"primary",onClick:a[3]||(a[3]=e=>n.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,u.zw)(n.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})])),(0,t.Wm)(v,{ref:"modalDescuentosTienda"},null,512)],64)}const ro={class:"custom-select"},so=(0,t._)("option",{value:"0"},"0%",-1),uo=(0,t._)("option",{value:"100"},"100%",-1),co=["value"];function mo(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBPopover"),m=(0,t.up)("MDBIcon"),p=(0,t.up)("MDBBtn"),f=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(g,{id:"modalDescuentosTienda",title:"Selecciona un Descuento","static-backdrop":"",centered:"",modelValue:n.isModalOpen,"onUpdate:modelValue":a[4]||(a[4]=e=>n.isModalOpen=e),"data-mdb-autofocus":"false",enforceFocus:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("selecciona_un_descuento","Selecciona un descuento")),1)])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",ro,[(0,t.wy)((0,t._)("select",{name:"descuentoTienda",id:"descuentoTienda","onUpdate:modelValue":a[0]||(a[0]=e=>n.selectedDiscount=e),class:"form-control",onChange:a[1]||(a[1]=(...e)=>n.removeFocus&&n.removeFocus(...e))},[so,uo,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.discountValues,(e=>((0,t.wg)(),(0,t.iD)("option",{key:e.discount,value:parseInt(e.value)},(0,u.zw)(e.value)+"% ",9,co)))),128))],544),[[v.bM,n.selectedDiscount]])])])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:n.popOverHelp,"onUpdate:modelValue":a[2]||(a[2]=e=>n.popOverHelp=e),direction:"bottom"},{header:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("ayuda","Ayuda")),1)])),body:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("ayuda_descuentos_tienda","Si los descuentos del GDT no se muestran, dirígese a 'actualizar parámetros tienda'.")),1)])),_:1},8,["modelValue"]),(0,t.Wm)(p,{"aria-label":"Help",onClick:a[3]||(a[3]=e=>n.popOverHelp=!n.popOverHelp),color:"info"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{icon:"question-circle",size:"lg"})])),_:1}),(0,t.Wm)(p,{onClick:n.closeModal},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1},8,["onClick"]),(0,t.Wm)(p,{onClick:n.applyDiscount,disabled:!n.selectedDiscount},{default:(0,t.w5)((()=>[(0,t.Uk)("Aplicar")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["modelValue"])}var po={name:"ModalDescuentosTiendaComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE,MDBSelect:M.R3,MDBPopover:M.SW},setup(e,{expose:a,emit:o}){const n=(0,f.oR)(),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,t.Fl)((()=>n.state.Discounts.discounts)),s=(0,t.Fl)((()=>{if(!r.value)return[];const e=new Set;return r.value.filter((e=>null!==e.value&&0!=e.value&&100!=e.value)).filter((a=>{const o=parseInt(a.value);return!e.has(o)&&(e.add(o),!0)}))||[]})),u=(0,D.iH)(null),d=(0,D.iH)(null),c=(0,D.iH)(!1);function m(e=0,a,o=0){u.value=a,d.value=o,i.value=e,l.value=!0}const p=()=>{l.value=!1},v=async()=>{const e=await k.Z.post("/cestas/setDiscountShop",{cesta:u.value,index:d.value,discount:i.value});e.data.error?alert(e.data.error):(o("discountSelected",i.value),p())},g=()=>{document.getElementById("descuentoTienda").blur()};return a({showModal:m}),{isModalOpen:l,selectedDiscount:i,discountValues:s,discountsShop:r,closeModal:p,applyDiscount:v,popOverHelp:c,removeFocus:g}}};const fo=(0,A.Z)(po,[["render",mo]]);var vo,go,bo=fo,wo=(o(30541),o(23767),o(8585),o(68696),9e15),ho=1e9,Co="0123456789abcdef",yo="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_o="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Mo={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-wo,maxE:wo,crypto:!1},Do=!0,ko="[DecimalError] ",Bo=ko+"Invalid argument: ",xo=ko+"Precision limit exceeded",To=ko+"crypto unavailable",Eo="[object Decimal]",Ao=Math.floor,Io=Math.pow,zo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,So=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ho=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,No=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fo=1e7,Po=7,Uo=9007199254740991,jo=yo.length-1,Wo=_o.length-1,Oo={toStringTag:Eo};function Vo(e){var a,o,t,n=e.length-1,l="",i=e[0];if(n>0){for(l+=i,a=1;a<n;a++)t=e[a]+"",o=Po-t.length,o&&(l+=et(o)),l+=t;i=e[a],t=i+"",o=Po-t.length,o&&(l+=et(o))}else if(0===i)return"0";for(;i%10===0;)i/=10;return l+i}function Ro(e,a,o){if(e!==~~e||e<a||e>o)throw Error(Bo+e)}function $o(e,a,o,t){var n,l,i,r;for(l=e[0];l>=10;l/=10)--a;return--a<0?(a+=Po,n=0):(n=Math.ceil((a+1)/Po),a%=Po),l=Io(10,Po-a),r=e[n]%l|0,null==t?a<3?(0==a?r=r/100|0:1==a&&(r=r/10|0),i=o<4&&99999==r||o>3&&49999==r||5e4==r||0==r):i=(o<4&&r+1==l||o>3&&r+1==l/2)&&(e[n+1]/l/100|0)==Io(10,a-2)-1||(r==l/2||0==r)&&0==(e[n+1]/l/100|0):a<4?(0==a?r=r/1e3|0:1==a?r=r/100|0:2==a&&(r=r/10|0),i=(t||o<4)&&9999==r||!t&&o>3&&4999==r):i=((t||o<4)&&r+1==l||!t&&o>3&&r+1==l/2)&&(e[n+1]/l/1e3|0)==Io(10,a-3)-1,i}function Zo(e,a,o){for(var t,n,l=[0],i=0,r=e.length;i<r;){for(n=l.length;n--;)l[n]*=a;for(l[0]+=Co.indexOf(e.charAt(i++)),t=0;t<l.length;t++)l[t]>o-1&&(void 0===l[t+1]&&(l[t+1]=0),l[t+1]+=l[t]/o|0,l[t]%=o)}return l.reverse()}function qo(e,a){var o,t,n;if(a.isZero())return a;t=a.d.length,t<32?(o=Math.ceil(t/3),n=(1/ct(4,o)).toString()):(o=16,n="2.3283064365386962890625e-10"),e.precision+=o,a=dt(e,1,a.times(n),new e(1));for(var l=o;l--;){var i=a.times(a);a=i.times(i).minus(i).times(8).plus(1)}return e.precision-=o,a}Oo.absoluteValue=Oo.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),Yo(e)},Oo.ceil=function(){return Yo(new this.constructor(this),this.e+1,2)},Oo.clampedTo=Oo.clamp=function(e,a){var o,t=this,n=t.constructor;if(e=new n(e),a=new n(a),!e.s||!a.s)return new n(NaN);if(e.gt(a))throw Error(Bo+a);return o=t.cmp(e),o<0?e:t.cmp(a)>0?a:new n(t)},Oo.comparedTo=Oo.cmp=function(e){var a,o,t,n,l=this,i=l.d,r=(e=new l.constructor(e)).d,s=l.s,u=e.s;if(!i||!r)return s&&u?s!==u?s:i===r?0:!i^s<0?1:-1:NaN;if(!i[0]||!r[0])return i[0]?s:r[0]?-u:0;if(s!==u)return s;if(l.e!==e.e)return l.e>e.e^s<0?1:-1;for(t=i.length,n=r.length,a=0,o=t<n?t:n;a<o;++a)if(i[a]!==r[a])return i[a]>r[a]^s<0?1:-1;return t===n?0:t>n^s<0?1:-1},Oo.cosine=Oo.cos=function(){var e,a,o=this,t=o.constructor;return o.d?o.d[0]?(e=t.precision,a=t.rounding,t.precision=e+Math.max(o.e,o.sd())+Po,t.rounding=1,o=qo(t,mt(t,o)),t.precision=e,t.rounding=a,Yo(2==go||3==go?o.neg():o,e,a,!0)):new t(1):new t(NaN)},Oo.cubeRoot=Oo.cbrt=function(){var e,a,o,t,n,l,i,r,s,u,d=this,c=d.constructor;if(!d.isFinite()||d.isZero())return new c(d);for(Do=!1,l=d.s*Io(d.s*d,1/3),l&&Math.abs(l)!=1/0?t=new c(l.toString()):(o=Vo(d.d),e=d.e,(l=(e-o.length+1)%3)&&(o+=1==l||-2==l?"0":"00"),l=Io(o,1/3),e=Ao((e+1)/3)-(e%3==(e<0?-1:2)),l==1/0?o="5e"+e:(o=l.toExponential(),o=o.slice(0,o.indexOf("e")+1)+e),t=new c(o),t.s=d.s),i=(e=c.precision)+3;;)if(r=t,s=r.times(r).times(r),u=s.plus(d),t=Lo(u.plus(d).times(r),u.plus(s),i+2,1),Vo(r.d).slice(0,i)===(o=Vo(t.d)).slice(0,i)){if(o=o.slice(i-3,i+1),"9999"!=o&&(n||"4999"!=o)){+o&&(+o.slice(1)||"5"!=o.charAt(0))||(Yo(t,e+1,1),a=!t.times(t).times(t).eq(d));break}if(!n&&(Yo(r,e+1,0),r.times(r).times(r).eq(d))){t=r;break}i+=4,n=1}return Do=!0,Yo(t,e,c.rounding,a)},Oo.decimalPlaces=Oo.dp=function(){var e,a=this.d,o=NaN;if(a){if(e=a.length-1,o=(e-Ao(this.e/Po))*Po,e=a[e],e)for(;e%10==0;e/=10)o--;o<0&&(o=0)}return o},Oo.dividedBy=Oo.div=function(e){return Lo(this,new this.constructor(e))},Oo.dividedToIntegerBy=Oo.divToInt=function(e){var a=this,o=a.constructor;return Yo(Lo(a,new o(e),0,1,1),o.precision,o.rounding)},Oo.equals=Oo.eq=function(e){return 0===this.cmp(e)},Oo.floor=function(){return Yo(new this.constructor(this),this.e+1,3)},Oo.greaterThan=Oo.gt=function(e){return this.cmp(e)>0},Oo.greaterThanOrEqualTo=Oo.gte=function(e){var a=this.cmp(e);return 1==a||0===a},Oo.hyperbolicCosine=Oo.cosh=function(){var e,a,o,t,n,l=this,i=l.constructor,r=new i(1);if(!l.isFinite())return new i(l.s?1/0:NaN);if(l.isZero())return r;o=i.precision,t=i.rounding,i.precision=o+Math.max(l.e,l.sd())+4,i.rounding=1,n=l.d.length,n<32?(e=Math.ceil(n/3),a=(1/ct(4,e)).toString()):(e=16,a="2.3283064365386962890625e-10"),l=dt(i,1,l.times(a),new i(1),!0);for(var s,u=e,d=new i(8);u--;)s=l.times(l),l=r.minus(s.times(d.minus(s.times(d))));return Yo(l,i.precision=o,i.rounding=t,!0)},Oo.hyperbolicSine=Oo.sinh=function(){var e,a,o,t,n=this,l=n.constructor;if(!n.isFinite()||n.isZero())return new l(n);if(a=l.precision,o=l.rounding,l.precision=a+Math.max(n.e,n.sd())+4,l.rounding=1,t=n.d.length,t<3)n=dt(l,2,n,n,!0);else{e=1.4*Math.sqrt(t),e=e>16?16:0|e,n=n.times(1/ct(5,e)),n=dt(l,2,n,n,!0);for(var i,r=new l(5),s=new l(16),u=new l(20);e--;)i=n.times(n),n=n.times(r.plus(i.times(s.times(i).plus(u))))}return l.precision=a,l.rounding=o,Yo(n,a,o,!0)},Oo.hyperbolicTangent=Oo.tanh=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+7,t.rounding=1,Lo(o.sinh(),o.cosh(),t.precision=e,t.rounding=a)):new t(o.s)},Oo.inverseCosine=Oo.acos=function(){var e=this,a=e.constructor,o=e.abs().cmp(1),t=a.precision,n=a.rounding;return-1!==o?0===o?e.isNeg()?Qo(a,t,n):new a(0):new a(NaN):e.isZero()?Qo(a,t+4,n).times(.5):(a.precision=t+6,a.rounding=1,e=new a(1).minus(e).div(e.plus(1)).sqrt().atan(),a.precision=t,a.rounding=n,e.times(2))},Oo.inverseHyperbolicCosine=Oo.acosh=function(){var e,a,o=this,t=o.constructor;return o.lte(1)?new t(o.eq(1)?0:NaN):o.isFinite()?(e=t.precision,a=t.rounding,t.precision=e+Math.max(Math.abs(o.e),o.sd())+4,t.rounding=1,Do=!1,o=o.times(o).minus(1).sqrt().plus(o),Do=!0,t.precision=e,t.rounding=a,o.ln()):new t(o)},Oo.inverseHyperbolicSine=Oo.asinh=function(){var e,a,o=this,t=o.constructor;return!o.isFinite()||o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+2*Math.max(Math.abs(o.e),o.sd())+6,t.rounding=1,Do=!1,o=o.times(o).plus(1).sqrt().plus(o),Do=!0,t.precision=e,t.rounding=a,o.ln())},Oo.inverseHyperbolicTangent=Oo.atanh=function(){var e,a,o,t,n=this,l=n.constructor;return n.isFinite()?n.e>=0?new l(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(e=l.precision,a=l.rounding,t=n.sd(),Math.max(t,e)<2*-n.e-1?Yo(new l(n),e,a,!0):(l.precision=o=t-n.e,n=Lo(n.plus(1),new l(1).minus(n),o+e,1),l.precision=e+4,l.rounding=1,n=n.ln(),l.precision=e,l.rounding=a,n.times(.5))):new l(NaN)},Oo.inverseSine=Oo.asin=function(){var e,a,o,t,n=this,l=n.constructor;return n.isZero()?new l(n):(a=n.abs().cmp(1),o=l.precision,t=l.rounding,-1!==a?0===a?(e=Qo(l,o+4,t).times(.5),e.s=n.s,e):new l(NaN):(l.precision=o+6,l.rounding=1,n=n.div(new l(1).minus(n.times(n)).sqrt().plus(1)).atan(),l.precision=o,l.rounding=t,n.times(2)))},Oo.inverseTangent=Oo.atan=function(){var e,a,o,t,n,l,i,r,s,u=this,d=u.constructor,c=d.precision,m=d.rounding;if(u.isFinite()){if(u.isZero())return new d(u);if(u.abs().eq(1)&&c+4<=Wo)return i=Qo(d,c+4,m).times(.25),i.s=u.s,i}else{if(!u.s)return new d(NaN);if(c+4<=Wo)return i=Qo(d,c+4,m).times(.5),i.s=u.s,i}for(d.precision=r=c+10,d.rounding=1,o=Math.min(28,r/Po+2|0),e=o;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(Do=!1,a=Math.ceil(r/Po),t=1,s=u.times(u),i=new d(u),n=u;-1!==e;)if(n=n.times(s),l=i.minus(n.div(t+=2)),n=n.times(s),i=l.plus(n.div(t+=2)),void 0!==i.d[a])for(e=a;i.d[e]===l.d[e]&&e--;);return o&&(i=i.times(2<<o-1)),Do=!0,Yo(i,d.precision=c,d.rounding=m,!0)},Oo.isFinite=function(){return!!this.d},Oo.isInteger=Oo.isInt=function(){return!!this.d&&Ao(this.e/Po)>this.d.length-2},Oo.isNaN=function(){return!this.s},Oo.isNegative=Oo.isNeg=function(){return this.s<0},Oo.isPositive=Oo.isPos=function(){return this.s>0},Oo.isZero=function(){return!!this.d&&0===this.d[0]},Oo.lessThan=Oo.lt=function(e){return this.cmp(e)<0},Oo.lessThanOrEqualTo=Oo.lte=function(e){return this.cmp(e)<1},Oo.logarithm=Oo.log=function(e){var a,o,t,n,l,i,r,s,u=this,d=u.constructor,c=d.precision,m=d.rounding,p=5;if(null==e)e=new d(10),a=!0;else{if(e=new d(e),o=e.d,e.s<0||!o||!o[0]||e.eq(1))return new d(NaN);a=e.eq(10)}if(o=u.d,u.s<0||!o||!o[0]||u.eq(1))return new d(o&&!o[0]?-1/0:1!=u.s?NaN:o?0:1/0);if(a)if(o.length>1)l=!0;else{for(n=o[0];n%10===0;)n/=10;l=1!==n}if(Do=!1,r=c+p,i=lt(u,r),t=a?Jo(d,r+10):lt(e,r),s=Lo(i,t,r,1),$o(s.d,n=c,m))do{if(r+=10,i=lt(u,r),t=a?Jo(d,r+10):lt(e,r),s=Lo(i,t,r,1),!l){+Vo(s.d).slice(n+1,n+15)+1==1e14&&(s=Yo(s,c+1,0));break}}while($o(s.d,n+=10,m));return Do=!0,Yo(s,c,m)},Oo.minus=Oo.sub=function(e){var a,o,t,n,l,i,r,s,u,d,c,m,p=this,f=p.constructor;if(e=new f(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new f(e.d||p.s!==e.s?p:NaN):e=new f(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,m=e.d,r=f.precision,s=f.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!u[0])return new f(3===s?-0:0);e=new f(p)}return Do?Yo(e,r,s):e}if(o=Ao(e.e/Po),d=Ao(p.e/Po),u=u.slice(),l=d-o,l){for(c=l<0,c?(a=u,l=-l,i=m.length):(a=m,o=d,i=u.length),t=Math.max(Math.ceil(r/Po),i)+2,l>t&&(l=t,a.length=1),a.reverse(),t=l;t--;)a.push(0);a.reverse()}else{for(t=u.length,i=m.length,c=t<i,c&&(i=t),t=0;t<i;t++)if(u[t]!=m[t]){c=u[t]<m[t];break}l=0}for(c&&(a=u,u=m,m=a,e.s=-e.s),i=u.length,t=m.length-i;t>0;--t)u[i++]=0;for(t=m.length;t>l;){if(u[--t]<m[t]){for(n=t;n&&0===u[--n];)u[n]=Fo-1;--u[n],u[t]+=Fo}u[t]-=m[t]}for(;0===u[--i];)u.pop();for(;0===u[0];u.shift())--o;return u[0]?(e.d=u,e.e=Go(u,o),Do?Yo(e,r,s):e):new f(3===s?-0:0)},Oo.modulo=Oo.mod=function(e){var a,o=this,t=o.constructor;return e=new t(e),!o.d||!e.s||e.d&&!e.d[0]?new t(NaN):!e.d||o.d&&!o.d[0]?Yo(new t(o),t.precision,t.rounding):(Do=!1,9==t.modulo?(a=Lo(o,e.abs(),0,3,1),a.s*=e.s):a=Lo(o,e,0,t.modulo,1),a=a.times(e),Do=!0,o.minus(a))},Oo.naturalExponential=Oo.exp=function(){return nt(this)},Oo.naturalLogarithm=Oo.ln=function(){return lt(this)},Oo.negated=Oo.neg=function(){var e=new this.constructor(this);return e.s=-e.s,Yo(e)},Oo.plus=Oo.add=function(e){var a,o,t,n,l,i,r,s,u,d,c=this,m=c.constructor;if(e=new m(e),!c.d||!e.d)return c.s&&e.s?c.d||(e=new m(e.d||c.s===e.s?c:NaN)):e=new m(NaN),e;if(c.s!=e.s)return e.s=-e.s,c.minus(e);if(u=c.d,d=e.d,r=m.precision,s=m.rounding,!u[0]||!d[0])return d[0]||(e=new m(c)),Do?Yo(e,r,s):e;if(l=Ao(c.e/Po),t=Ao(e.e/Po),u=u.slice(),n=l-t,n){for(n<0?(o=u,n=-n,i=d.length):(o=d,t=l,i=u.length),l=Math.ceil(r/Po),i=l>i?l+1:i+1,n>i&&(n=i,o.length=1),o.reverse();n--;)o.push(0);o.reverse()}for(i=u.length,n=d.length,i-n<0&&(n=i,o=d,d=u,u=o),a=0;n;)a=(u[--n]=u[n]+d[n]+a)/Fo|0,u[n]%=Fo;for(a&&(u.unshift(a),++t),i=u.length;0==u[--i];)u.pop();return e.d=u,e.e=Go(u,t),Do?Yo(e,r,s):e},Oo.precision=Oo.sd=function(e){var a,o=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(Bo+e);return o.d?(a=Xo(o.d),e&&o.e+1>a&&(a=o.e+1)):a=NaN,a},Oo.round=function(){var e=this,a=e.constructor;return Yo(new a(e),e.e+1,a.rounding)},Oo.sine=Oo.sin=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+Math.max(o.e,o.sd())+Po,t.rounding=1,o=ut(t,mt(t,o)),t.precision=e,t.rounding=a,Yo(go>2?o.neg():o,e,a,!0)):new t(NaN)},Oo.squareRoot=Oo.sqrt=function(){var e,a,o,t,n,l,i=this,r=i.d,s=i.e,u=i.s,d=i.constructor;if(1!==u||!r||!r[0])return new d(!u||u<0&&(!r||r[0])?NaN:r?i:1/0);for(Do=!1,u=Math.sqrt(+i),0==u||u==1/0?(a=Vo(r),(a.length+s)%2==0&&(a+="0"),u=Math.sqrt(a),s=Ao((s+1)/2)-(s<0||s%2),u==1/0?a="5e"+s:(a=u.toExponential(),a=a.slice(0,a.indexOf("e")+1)+s),t=new d(a)):t=new d(u.toString()),o=(s=d.precision)+3;;)if(l=t,t=l.plus(Lo(i,l,o+2,1)).times(.5),Vo(l.d).slice(0,o)===(a=Vo(t.d)).slice(0,o)){if(a=a.slice(o-3,o+1),"9999"!=a&&(n||"4999"!=a)){+a&&(+a.slice(1)||"5"!=a.charAt(0))||(Yo(t,s+1,1),e=!t.times(t).eq(i));break}if(!n&&(Yo(l,s+1,0),l.times(l).eq(i))){t=l;break}o+=4,n=1}return Do=!0,Yo(t,s,d.rounding,e)},Oo.tangent=Oo.tan=function(){var e,a,o=this,t=o.constructor;return o.isFinite()?o.isZero()?new t(o):(e=t.precision,a=t.rounding,t.precision=e+10,t.rounding=1,o=o.sin(),o.s=1,o=Lo(o,new t(1).minus(o.times(o)).sqrt(),e+10,0),t.precision=e,t.rounding=a,Yo(2==go||4==go?o.neg():o,e,a,!0)):new t(NaN)},Oo.times=Oo.mul=function(e){var a,o,t,n,l,i,r,s,u,d=this,c=d.constructor,m=d.d,p=(e=new c(e)).d;if(e.s*=d.s,!m||!m[0]||!p||!p[0])return new c(!e.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:m&&p?0*e.s:e.s/0);for(o=Ao(d.e/Po)+Ao(e.e/Po),s=m.length,u=p.length,s<u&&(l=m,m=p,p=l,i=s,s=u,u=i),l=[],i=s+u,t=i;t--;)l.push(0);for(t=u;--t>=0;){for(a=0,n=s+t;n>t;)r=l[n]+p[t]*m[n-t-1]+a,l[n--]=r%Fo|0,a=r/Fo|0;l[n]=(l[n]+a)%Fo|0}for(;!l[--i];)l.pop();return a?++o:l.shift(),e.d=l,e.e=Go(l,o),Do?Yo(e,c.precision,c.rounding):e},Oo.toBinary=function(e,a){return pt(this,2,e,a)},Oo.toDecimalPlaces=Oo.toDP=function(e,a){var o=this,t=o.constructor;return o=new t(o),void 0===e?o:(Ro(e,0,ho),void 0===a?a=t.rounding:Ro(a,0,8),Yo(o,e+o.e+1,a))},Oo.toExponential=function(e,a){var o,t=this,n=t.constructor;return void 0===e?o=Ko(t,!0):(Ro(e,0,ho),void 0===a?a=n.rounding:Ro(a,0,8),t=Yo(new n(t),e+1,a),o=Ko(t,!0,e+1)),t.isNeg()&&!t.isZero()?"-"+o:o},Oo.toFixed=function(e,a){var o,t,n=this,l=n.constructor;return void 0===e?o=Ko(n):(Ro(e,0,ho),void 0===a?a=l.rounding:Ro(a,0,8),t=Yo(new l(n),e+n.e+1,a),o=Ko(t,!1,e+t.e+1)),n.isNeg()&&!n.isZero()?"-"+o:o},Oo.toFraction=function(e){var a,o,t,n,l,i,r,s,u,d,c,m,p=this,f=p.d,v=p.constructor;if(!f)return new v(p);if(u=o=new v(1),t=s=new v(0),a=new v(t),l=a.e=Xo(f)-p.e-1,i=l%Po,a.d[0]=Io(10,i<0?Po+i:i),null==e)e=l>0?a:u;else{if(r=new v(e),!r.isInt()||r.lt(u))throw Error(Bo+r);e=r.gt(a)?l>0?a:u:r}for(Do=!1,r=new v(Vo(f)),d=v.precision,v.precision=l=f.length*Po*2;;){if(c=Lo(r,a,0,1,1),n=o.plus(c.times(t)),1==n.cmp(e))break;o=t,t=n,n=u,u=s.plus(c.times(n)),s=n,n=a,a=r.minus(c.times(n)),r=n}return n=Lo(e.minus(o),t,0,1,1),s=s.plus(n.times(u)),o=o.plus(n.times(t)),s.s=u.s=p.s,m=Lo(u,t,l,1).minus(p).abs().cmp(Lo(s,o,l,1).minus(p).abs())<1?[u,t]:[s,o],v.precision=d,Do=!0,m},Oo.toHexadecimal=Oo.toHex=function(e,a){return pt(this,16,e,a)},Oo.toNearest=function(e,a){var o=this,t=o.constructor;if(o=new t(o),null==e){if(!o.d)return o;e=new t(1),a=t.rounding}else{if(e=new t(e),void 0===a?a=t.rounding:Ro(a,0,8),!o.d)return e.s?o:e;if(!e.d)return e.s&&(e.s=o.s),e}return e.d[0]?(Do=!1,o=Lo(o,e,0,a,1).times(e),Do=!0,Yo(o)):(e.s=o.s,o=e),o},Oo.toNumber=function(){return+this},Oo.toOctal=function(e,a){return pt(this,8,e,a)},Oo.toPower=Oo.pow=function(e){var a,o,t,n,l,i,r=this,s=r.constructor,u=+(e=new s(e));if(!r.d||!e.d||!r.d[0]||!e.d[0])return new s(Io(+r,u));if(r=new s(r),r.eq(1))return r;if(t=s.precision,l=s.rounding,e.eq(1))return Yo(r,t,l);if(a=Ao(e.e/Po),a>=e.d.length-1&&(o=u<0?-u:u)<=Uo)return n=at(s,r,o,t),e.s<0?new s(1).div(n):Yo(n,t,l);if(i=r.s,i<0){if(a<e.d.length-1)return new s(NaN);if(0==(1&e.d[a])&&(i=1),0==r.e&&1==r.d[0]&&1==r.d.length)return r.s=i,r}return o=Io(+r,u),a=0!=o&&isFinite(o)?new s(o+"").e:Ao(u*(Math.log("0."+Vo(r.d))/Math.LN10+r.e+1)),a>s.maxE+1||a<s.minE-1?new s(a>0?i/0:0):(Do=!1,s.rounding=r.s=1,o=Math.min(12,(a+"").length),n=nt(e.times(lt(r,t+o)),t),n.d&&(n=Yo(n,t+5,1),$o(n.d,t,l)&&(a=t+10,n=Yo(nt(e.times(lt(r,a+o)),a),a+5,1),+Vo(n.d).slice(t+1,t+15)+1==1e14&&(n=Yo(n,t+1,0)))),n.s=i,Do=!0,s.rounding=l,Yo(n,t,l))},Oo.toPrecision=function(e,a){var o,t=this,n=t.constructor;return void 0===e?o=Ko(t,t.e<=n.toExpNeg||t.e>=n.toExpPos):(Ro(e,1,ho),void 0===a?a=n.rounding:Ro(a,0,8),t=Yo(new n(t),e,a),o=Ko(t,e<=t.e||t.e<=n.toExpNeg,e)),t.isNeg()&&!t.isZero()?"-"+o:o},Oo.toSignificantDigits=Oo.toSD=function(e,a){var o=this,t=o.constructor;return void 0===e?(e=t.precision,a=t.rounding):(Ro(e,1,ho),void 0===a?a=t.rounding:Ro(a,0,8)),Yo(new t(o),e,a)},Oo.toString=function(){var e=this,a=e.constructor,o=Ko(e,e.e<=a.toExpNeg||e.e>=a.toExpPos);return e.isNeg()&&!e.isZero()?"-"+o:o},Oo.truncated=Oo.trunc=function(){return Yo(new this.constructor(this),this.e+1,1)},Oo.valueOf=Oo.toJSON=function(){var e=this,a=e.constructor,o=Ko(e,e.e<=a.toExpNeg||e.e>=a.toExpPos);return e.isNeg()?"-"+o:o};var Lo=function(){function e(e,a,o){var t,n=0,l=e.length;for(e=e.slice();l--;)t=e[l]*a+n,e[l]=t%o|0,n=t/o|0;return n&&e.unshift(n),e}function a(e,a,o,t){var n,l;if(o!=t)l=o>t?1:-1;else for(n=l=0;n<o;n++)if(e[n]!=a[n]){l=e[n]>a[n]?1:-1;break}return l}function o(e,a,o,t){for(var n=0;o--;)e[o]-=n,n=e[o]<a[o]?1:0,e[o]=n*t+e[o]-a[o];for(;!e[0]&&e.length>1;)e.shift()}return function(t,n,l,i,r,s){var u,d,c,m,p,f,v,g,b,w,h,C,y,_,M,D,k,B,x,T,E=t.constructor,A=t.s==n.s?1:-1,I=t.d,z=n.d;if(!I||!I[0]||!z||!z[0])return new E(t.s&&n.s&&(I?!z||I[0]!=z[0]:z)?I&&0==I[0]||!z?0*A:A/0:NaN);for(s?(p=1,d=t.e-n.e):(s=Fo,p=Po,d=Ao(t.e/p)-Ao(n.e/p)),x=z.length,k=I.length,b=new E(A),w=b.d=[],c=0;z[c]==(I[c]||0);c++);if(z[c]>(I[c]||0)&&d--,null==l?(_=l=E.precision,i=E.rounding):_=r?l+(t.e-n.e)+1:l,_<0)w.push(1),f=!0;else{if(_=_/p+2|0,c=0,1==x){for(m=0,z=z[0],_++;(c<k||m)&&_--;c++)M=m*s+(I[c]||0),w[c]=M/z|0,m=M%z|0;f=m||c<k}else{for(m=s/(z[0]+1)|0,m>1&&(z=e(z,m,s),I=e(I,m,s),x=z.length,k=I.length),D=x,h=I.slice(0,x),C=h.length;C<x;)h[C++]=0;T=z.slice(),T.unshift(0),B=z[0],z[1]>=s/2&&++B;do{m=0,u=a(z,h,x,C),u<0?(y=h[0],x!=C&&(y=y*s+(h[1]||0)),m=y/B|0,m>1?(m>=s&&(m=s-1),v=e(z,m,s),g=v.length,C=h.length,u=a(v,h,g,C),1==u&&(m--,o(v,x<g?T:z,g,s))):(0==m&&(u=m=1),v=z.slice()),g=v.length,g<C&&v.unshift(0),o(h,v,C,s),-1==u&&(C=h.length,u=a(z,h,x,C),u<1&&(m++,o(h,x<C?T:z,C,s))),C=h.length):0===u&&(m++,h=[0]),w[c++]=m,u&&h[0]?h[C++]=I[D]||0:(h=[I[D]],C=1)}while((D++<k||void 0!==h[0])&&_--);f=void 0!==h[0]}w[0]||w.shift()}if(1==p)b.e=d,vo=f;else{for(c=1,m=w[0];m>=10;m/=10)c++;b.e=c+d*p-1,Yo(b,r?l+b.e+1:l,i,f)}return b}}();function Yo(e,a,o,t){var n,l,i,r,s,u,d,c,m,p=e.constructor;e:if(null!=a){if(c=e.d,!c)return e;for(n=1,r=c[0];r>=10;r/=10)n++;if(l=a-n,l<0)l+=Po,i=a,d=c[m=0],s=d/Io(10,n-i-1)%10|0;else if(m=Math.ceil((l+1)/Po),r=c.length,m>=r){if(!t)break e;for(;r++<=m;)c.push(0);d=s=0,n=1,l%=Po,i=l-Po+1}else{for(d=r=c[m],n=1;r>=10;r/=10)n++;l%=Po,i=l-Po+n,s=i<0?0:d/Io(10,n-i-1)%10|0}if(t=t||a<0||void 0!==c[m+1]||(i<0?d:d%Io(10,n-i-1)),u=o<4?(s||t)&&(0==o||o==(e.s<0?3:2)):s>5||5==s&&(4==o||t||6==o&&(l>0?i>0?d/Io(10,n-i):0:c[m-1])%10&1||o==(e.s<0?8:7)),a<1||!c[0])return c.length=0,u?(a-=e.e+1,c[0]=Io(10,(Po-a%Po)%Po),e.e=-a||0):c[0]=e.e=0,e;if(0==l?(c.length=m,r=1,m--):(c.length=m+1,r=Io(10,Po-l),c[m]=i>0?(d/Io(10,n-i)%Io(10,i)|0)*r:0),u)for(;;){if(0==m){for(l=1,i=c[0];i>=10;i/=10)l++;for(i=c[0]+=r,r=1;i>=10;i/=10)r++;l!=r&&(e.e++,c[0]==Fo&&(c[0]=1));break}if(c[m]+=r,c[m]!=Fo)break;c[m--]=0,r=1}for(l=c.length;0===c[--l];)c.pop()}return Do&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function Ko(e,a,o){if(!e.isFinite())return it(e);var t,n=e.e,l=Vo(e.d),i=l.length;return a?(o&&(t=o-i)>0?l=l.charAt(0)+"."+l.slice(1)+et(t):i>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(e.e<0?"e":"e+")+e.e):n<0?(l="0."+et(-n-1)+l,o&&(t=o-i)>0&&(l+=et(t))):n>=i?(l+=et(n+1-i),o&&(t=o-n-1)>0&&(l=l+"."+et(t))):((t=n+1)<i&&(l=l.slice(0,t)+"."+l.slice(t)),o&&(t=o-i)>0&&(n+1===i&&(l+="."),l+=et(t))),l}function Go(e,a){var o=e[0];for(a*=Po;o>=10;o/=10)a++;return a}function Jo(e,a,o){if(a>jo)throw Do=!0,o&&(e.precision=o),Error(xo);return Yo(new e(yo),a,1,!0)}function Qo(e,a,o){if(a>Wo)throw Error(xo);return Yo(new e(_o),a,o,!0)}function Xo(e){var a=e.length-1,o=a*Po+1;if(a=e[a],a){for(;a%10==0;a/=10)o--;for(a=e[0];a>=10;a/=10)o++}return o}function et(e){for(var a="";e--;)a+="0";return a}function at(e,a,o,t){var n,l=new e(1),i=Math.ceil(t/Po+4);for(Do=!1;;){if(o%2&&(l=l.times(a),ft(l.d,i)&&(n=!0)),o=Ao(o/2),0===o){o=l.d.length-1,n&&0===l.d[o]&&++l.d[o];break}a=a.times(a),ft(a.d,i)}return Do=!0,l}function ot(e){return 1&e.d[e.d.length-1]}function tt(e,a,o){for(var t,n,l=new e(a[0]),i=0;++i<a.length;){if(n=new e(a[i]),!n.s){l=n;break}t=l.cmp(n),(t===o||0===t&&l.s===o)&&(l=n)}return l}function nt(e,a){var o,t,n,l,i,r,s,u=0,d=0,c=0,m=e.constructor,p=m.rounding,f=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);null==a?(Do=!1,s=f):s=a,r=new m(.03125);while(e.e>-2)e=e.times(r),c+=5;for(t=Math.log(Io(2,c))/Math.LN10*2+5|0,s+=t,o=l=i=new m(1),m.precision=s;;){if(l=Yo(l.times(e),s,1),o=o.times(++d),r=i.plus(Lo(l,o,s,1)),Vo(r.d).slice(0,s)===Vo(i.d).slice(0,s)){n=c;while(n--)i=Yo(i.times(i),s,1);if(null!=a)return m.precision=f,i;if(!(u<3&&$o(i.d,s-t,p,u)))return Yo(i,m.precision=f,p,Do=!0);m.precision=s+=10,o=l=r=new m(1),d=0,u++}i=r}}function lt(e,a){var o,t,n,l,i,r,s,u,d,c,m,p=1,f=10,v=e,g=v.d,b=v.constructor,w=b.rounding,h=b.precision;if(v.s<0||!g||!g[0]||!v.e&&1==g[0]&&1==g.length)return new b(g&&!g[0]?-1/0:1!=v.s?NaN:g?0:v);if(null==a?(Do=!1,d=h):d=a,b.precision=d+=f,o=Vo(g),t=o.charAt(0),!(Math.abs(l=v.e)<15e14))return u=Jo(b,d+2,h).times(l+""),v=lt(new b(t+"."+o.slice(1)),d-f).plus(u),b.precision=h,null==a?Yo(v,h,w,Do=!0):v;while(t<7&&1!=t||1==t&&o.charAt(1)>3)v=v.times(e),o=Vo(v.d),t=o.charAt(0),p++;for(l=v.e,t>1?(v=new b("0."+o),l++):v=new b(t+"."+o.slice(1)),c=v,s=i=v=Lo(v.minus(1),v.plus(1),d,1),m=Yo(v.times(v),d,1),n=3;;){if(i=Yo(i.times(m),d,1),u=s.plus(Lo(i,new b(n),d,1)),Vo(u.d).slice(0,d)===Vo(s.d).slice(0,d)){if(s=s.times(2),0!==l&&(s=s.plus(Jo(b,d+2,h).times(l+""))),s=Lo(s,new b(p),d,1),null!=a)return b.precision=h,s;if(!$o(s.d,d-f,w,r))return Yo(s,b.precision=h,w,Do=!0);b.precision=d+=f,u=i=v=Lo(c.minus(1),c.plus(1),d,1),m=Yo(v.times(v),d,1),n=r=1}s=u,n+=2}}function it(e){return String(e.s*e.s/0)}function rt(e,a){var o,t,n;for((o=a.indexOf("."))>-1&&(a=a.replace(".","")),(t=a.search(/e/i))>0?(o<0&&(o=t),o+=+a.slice(t+1),a=a.substring(0,t)):o<0&&(o=a.length),t=0;48===a.charCodeAt(t);t++);for(n=a.length;48===a.charCodeAt(n-1);--n);if(a=a.slice(t,n),a){if(n-=t,e.e=o=o-t-1,e.d=[],t=(o+1)%Po,o<0&&(t+=Po),t<n){for(t&&e.d.push(+a.slice(0,t)),n-=Po;t<n;)e.d.push(+a.slice(t,t+=Po));a=a.slice(t),t=Po-a.length}else t-=n;for(;t--;)a+="0";e.d.push(+a),Do&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function st(e,a){var o,t,n,l,i,r,s,u,d;if(a.indexOf("_")>-1){if(a=a.replace(/(\d)_(?=\d)/g,"$1"),No.test(a))return rt(e,a)}else if("Infinity"===a||"NaN"===a)return+a||(e.s=NaN),e.e=NaN,e.d=null,e;if(So.test(a))o=16,a=a.toLowerCase();else if(zo.test(a))o=2;else{if(!Ho.test(a))throw Error(Bo+a);o=8}for(l=a.search(/p/i),l>0?(s=+a.slice(l+1),a=a.substring(2,l)):a=a.slice(2),l=a.indexOf("."),i=l>=0,t=e.constructor,i&&(a=a.replace(".",""),r=a.length,l=r-l,n=at(t,new t(o),l,2*l)),u=Zo(a,o,Fo),d=u.length-1,l=d;0===u[l];--l)u.pop();return l<0?new t(0*e.s):(e.e=Go(u,d),e.d=u,Do=!1,i&&(e=Lo(e,n,4*r)),s&&(e=e.times(Math.abs(s)<54?Io(2,s):on.pow(2,s))),Do=!0,e)}function ut(e,a){var o,t=a.d.length;if(t<3)return a.isZero()?a:dt(e,2,a,a);o=1.4*Math.sqrt(t),o=o>16?16:0|o,a=a.times(1/ct(5,o)),a=dt(e,2,a,a);for(var n,l=new e(5),i=new e(16),r=new e(20);o--;)n=a.times(a),a=a.times(l.plus(n.times(i.times(n).minus(r))));return a}function dt(e,a,o,t,n){var l,i,r,s,u=e.precision,d=Math.ceil(u/Po);for(Do=!1,s=o.times(o),r=new e(t);;){if(i=Lo(r.times(s),new e(a++*a++),u,1),r=n?t.plus(i):t.minus(i),t=Lo(i.times(s),new e(a++*a++),u,1),i=r.plus(t),void 0!==i.d[d]){for(l=d;i.d[l]===r.d[l]&&l--;);if(-1==l)break}l=r,r=t,t=i,i=l}return Do=!0,i.d.length=d+1,i}function ct(e,a){var o=e;while(--a)o*=e;return o}function mt(e,a){var o,t=a.s<0,n=Qo(e,e.precision,1),l=n.times(.5);if(a=a.abs(),a.lte(l))return go=t?4:1,a;if(o=a.divToInt(n),o.isZero())go=t?3:2;else{if(a=a.minus(o.times(n)),a.lte(l))return go=ot(o)?t?2:3:t?4:1,a;go=ot(o)?t?1:4:t?3:2}return a.minus(n).abs()}function pt(e,a,o,t){var n,l,i,r,s,u,d,c,m,p=e.constructor,f=void 0!==o;if(f?(Ro(o,1,ho),void 0===t?t=p.rounding:Ro(t,0,8)):(o=p.precision,t=p.rounding),e.isFinite()){for(d=Ko(e),i=d.indexOf("."),f?(n=2,16==a?o=4*o-3:8==a&&(o=3*o-2)):n=a,i>=0&&(d=d.replace(".",""),m=new p(1),m.e=d.length-i,m.d=Zo(Ko(m),10,n),m.e=m.d.length),c=Zo(d,10,n),l=s=c.length;0==c[--s];)c.pop();if(c[0]){if(i<0?l--:(e=new p(e),e.d=c,e.e=l,e=Lo(e,m,o,t,0,n),c=e.d,l=e.e,u=vo),i=c[o],r=n/2,u=u||void 0!==c[o+1],u=t<4?(void 0!==i||u)&&(0===t||t===(e.s<0?3:2)):i>r||i===r&&(4===t||u||6===t&&1&c[o-1]||t===(e.s<0?8:7)),c.length=o,u)for(;++c[--o]>n-1;)c[o]=0,o||(++l,c.unshift(1));for(s=c.length;!c[s-1];--s);for(i=0,d="";i<s;i++)d+=Co.charAt(c[i]);if(f){if(s>1)if(16==a||8==a){for(i=16==a?4:3,--s;s%i;s++)d+="0";for(c=Zo(d,n,a),s=c.length;!c[s-1];--s);for(i=1,d="1.";i<s;i++)d+=Co.charAt(c[i])}else d=d.charAt(0)+"."+d.slice(1);d=d+(l<0?"p":"p+")+l}else if(l<0){for(;++l;)d="0"+d;d="0."+d}else if(++l>s)for(l-=s;l--;)d+="0";else l<s&&(d=d.slice(0,l)+"."+d.slice(l))}else d=f?"0p+0":"0";d=(16==a?"0x":2==a?"0b":8==a?"0o":"")+d}else d=it(e);return e.s<0?"-"+d:d}function ft(e,a){if(e.length>a)return e.length=a,!0}function vt(e){return new this(e).abs()}function gt(e){return new this(e).acos()}function bt(e){return new this(e).acosh()}function wt(e,a){return new this(e).plus(a)}function ht(e){return new this(e).asin()}function Ct(e){return new this(e).asinh()}function yt(e){return new this(e).atan()}function _t(e){return new this(e).atanh()}function Mt(e,a){e=new this(e),a=new this(a);var o,t=this.precision,n=this.rounding,l=t+4;return e.s&&a.s?e.d||a.d?!a.d||e.isZero()?(o=a.s<0?Qo(this,t,n):new this(0),o.s=e.s):!e.d||a.isZero()?(o=Qo(this,l,1).times(.5),o.s=e.s):a.s<0?(this.precision=l,this.rounding=1,o=this.atan(Lo(e,a,l,1)),a=Qo(this,l,1),this.precision=t,this.rounding=n,o=e.s<0?o.minus(a):o.plus(a)):o=this.atan(Lo(e,a,l,1)):(o=Qo(this,l,1).times(a.s>0?.25:.75),o.s=e.s):o=new this(NaN),o}function Dt(e){return new this(e).cbrt()}function kt(e){return Yo(e=new this(e),e.e+1,2)}function Bt(e,a,o){return new this(e).clamp(a,o)}function xt(e){if(!e||"object"!==typeof e)throw Error(ko+"Object expected");var a,o,t,n=!0===e.defaults,l=["precision",1,ho,"rounding",0,8,"toExpNeg",-wo,0,"toExpPos",0,wo,"maxE",0,wo,"minE",-wo,0,"modulo",0,9];for(a=0;a<l.length;a+=3)if(o=l[a],n&&(this[o]=Mo[o]),void 0!==(t=e[o])){if(!(Ao(t)===t&&t>=l[a+1]&&t<=l[a+2]))throw Error(Bo+o+": "+t);this[o]=t}if(o="crypto",n&&(this[o]=Mo[o]),void 0!==(t=e[o])){if(!0!==t&&!1!==t&&0!==t&&1!==t)throw Error(Bo+o+": "+t);if(t){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(To);this[o]=!0}else this[o]=!1}return this}function Tt(e){return new this(e).cos()}function Et(e){return new this(e).cosh()}function At(e){var a,o,t;function n(e){var a,o,t,l=this;if(!(l instanceof n))return new n(e);if(l.constructor=n,Nt(e))return l.s=e.s,void(Do?!e.d||e.e>n.maxE?(l.e=NaN,l.d=null):e.e<n.minE?(l.e=0,l.d=[0]):(l.e=e.e,l.d=e.d.slice()):(l.e=e.e,l.d=e.d?e.d.slice():e.d));if(t=typeof e,"number"===t){if(0===e)return l.s=1/e<0?-1:1,l.e=0,void(l.d=[0]);if(e<0?(e=-e,l.s=-1):l.s=1,e===~~e&&e<1e7){for(a=0,o=e;o>=10;o/=10)a++;return void(Do?a>n.maxE?(l.e=NaN,l.d=null):a<n.minE?(l.e=0,l.d=[0]):(l.e=a,l.d=[e]):(l.e=a,l.d=[e]))}return 0*e!==0?(e||(l.s=NaN),l.e=NaN,void(l.d=null)):rt(l,e.toString())}if("string"===t)return 45===(o=e.charCodeAt(0))?(e=e.slice(1),l.s=-1):(43===o&&(e=e.slice(1)),l.s=1),No.test(e)?rt(l,e):st(l,e);if("bigint"===t)return e<0?(e=-e,l.s=-1):l.s=1,rt(l,e.toString());throw Error(Bo+e)}if(n.prototype=Oo,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=xt,n.clone=At,n.isDecimal=Nt,n.abs=vt,n.acos=gt,n.acosh=bt,n.add=wt,n.asin=ht,n.asinh=Ct,n.atan=yt,n.atanh=_t,n.atan2=Mt,n.cbrt=Dt,n.ceil=kt,n.clamp=Bt,n.cos=Tt,n.cosh=Et,n.div=It,n.exp=zt,n.floor=St,n.hypot=Ht,n.ln=Ft,n.log=Pt,n.log10=jt,n.log2=Ut,n.max=Wt,n.min=Ot,n.mod=Vt,n.mul=Rt,n.pow=$t,n.random=Zt,n.round=qt,n.sign=Lt,n.sin=Yt,n.sinh=Kt,n.sqrt=Gt,n.sub=Jt,n.sum=Qt,n.tan=Xt,n.tanh=en,n.trunc=an,void 0===e&&(e={}),e&&!0!==e.defaults)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],a=0;a<t.length;)e.hasOwnProperty(o=t[a++])||(e[o]=this[o]);return n.config(e),n}function It(e,a){return new this(e).div(a)}function zt(e){return new this(e).exp()}function St(e){return Yo(e=new this(e),e.e+1,3)}function Ht(){var e,a,o=new this(0);for(Do=!1,e=0;e<arguments.length;)if(a=new this(arguments[e++]),a.d)o.d&&(o=o.plus(a.times(a)));else{if(a.s)return Do=!0,new this(1/0);o=a}return Do=!0,o.sqrt()}function Nt(e){return e instanceof on||e&&e.toStringTag===Eo||!1}function Ft(e){return new this(e).ln()}function Pt(e,a){return new this(e).log(a)}function Ut(e){return new this(e).log(2)}function jt(e){return new this(e).log(10)}function Wt(){return tt(this,arguments,-1)}function Ot(){return tt(this,arguments,1)}function Vt(e,a){return new this(e).mod(a)}function Rt(e,a){return new this(e).mul(a)}function $t(e,a){return new this(e).pow(a)}function Zt(e){var a,o,t,n,l=0,i=new this(1),r=[];if(void 0===e?e=this.precision:Ro(e,1,ho),t=Math.ceil(e/Po),this.crypto)if(crypto.getRandomValues)for(a=crypto.getRandomValues(new Uint32Array(t));l<t;)n=a[l],n>=429e7?a[l]=crypto.getRandomValues(new Uint32Array(1))[0]:r[l++]=n%1e7;else{if(!crypto.randomBytes)throw Error(To);for(a=crypto.randomBytes(t*=4);l<t;)n=a[l]+(a[l+1]<<8)+(a[l+2]<<16)+((127&a[l+3])<<24),n>=214e7?crypto.randomBytes(4).copy(a,l):(r.push(n%1e7),l+=4);l=t/4}else for(;l<t;)r[l++]=1e7*Math.random()|0;for(t=r[--l],e%=Po,t&&e&&(n=Io(10,Po-e),r[l]=(t/n|0)*n);0===r[l];l--)r.pop();if(l<0)o=0,r=[0];else{for(o=-1;0===r[0];o-=Po)r.shift();for(t=1,n=r[0];n>=10;n/=10)t++;t<Po&&(o-=Po-t)}return i.e=o,i.d=r,i}function qt(e){return Yo(e=new this(e),e.e+1,this.rounding)}function Lt(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Yt(e){return new this(e).sin()}function Kt(e){return new this(e).sinh()}function Gt(e){return new this(e).sqrt()}function Jt(e,a){return new this(e).sub(a)}function Qt(){var e=0,a=arguments,o=new this(a[e]);for(Do=!1;o.s&&++e<a.length;)o=o.plus(a[e]);return Do=!0,Yo(o,this.precision,this.rounding)}function Xt(e){return new this(e).tan()}function en(e){return new this(e).tanh()}function an(e){return Yo(e=new this(e),e.e+1,1)}Oo[Symbol.for("nodejs.util.inspect.custom")]=Oo.toString,Oo[Symbol.toStringTag]="Decimal";var on=Oo.constructor=At(Mo);yo=new on(yo),_o=new on(_o);var tn=on,nn={name:"CestaComponent",components:{MDBCard:M.Yl,MDBCardBody:M.H7,MDBCardTitle:M.QM,MDBCardText:M.Pp,MDBBtn:M.$v,MDBIcon:M.vm,MDBPopover:M.SW,ModalDescuentosTiendaComponent:bo},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),l=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),r=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),s=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>{let e=0;return c&&c.value?.lista&&c.value.lista.forEach((a=>{a.regalo&&(e+=a.puntos)})),e})),c=(0,t.Fl)((()=>{if(n.value)for(let e=0;e<n.value.length;e++)if(s.value&&s.value[u.value]&&n.value[e]._id==s.value[u.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",n.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),n.value[e];return null})),m=(0,D.iH)([]),p=(0,D.iH)(0),v=(0,t.Fl)((()=>o.state.Configuracion.parametros)),g=(0,D.iH)("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"),b=(0,D.iH)(!1),w=(0,D.iH)(!1),h=(0,t.f3)("postDisabledTecla"),C=(0,D.iH)(!1),y=(0,D.iH)(null),_=(0,D.iH)(null);(0,t.Fl)((()=>o.state.Discounts.discounts));function M(){c.value?.idCliente?k.Z.post("clientes/consultarPuntos",{idCliente:c.value?.idCliente}).then((e=>{"number"===typeof e.data?p.value=e.data:p.value=0})).catch((e=>{x().fire("Oops...",e.message,"error"),p.value=0})):p.value=0}const B=async e=>{if(e.regalo)return;await o.dispatch("Unidades/setUnidades",1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:c.value._id,unidades:1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[l.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[u.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",-1)},T=(0,D.iH)(!1),E=async e=>{if(e.unidades<=1||e.regalo||T.value)return;T.value=!0,await o.dispatch("Unidades/setUnidades",-1);const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:c.value._id,unidades:-1,arraySuplementos:e.arraySuplementos,nombre:"",menu:i.value[l.value].nombre},{headers:{"X-Source-Program":"TOCGAME",article:encodeURIComponent(e.nombre),worker:encodeURIComponent(s.value[u.value].nombre)}});a.data||o.dispatch("Unidades/setUnidades",1),T.value=!1};function A(){if(s.value&&void 0!=u.value&&null!=u.value&&s.value[u.value]){let e=!0;if(void 0!=c.value&&"DEVOLUCION"==c?.value?.modo)return;for(let a=0;a<n.value.length;a++)if(n.value[a].trabajador==s.value[u.value].idTrabajador){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:n.value[a]._id,idTrabajador:s.value[u.value]._id}),e=!1;break}if(!e)return;I(),e=!1}else s.value&&void 0!=u.value&&null!=u.value?x().fire("Oops...","Error desconocido #123","error"):x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function I(){s.value&&void 0!=u.value&&null!=u.value&&s.value[u.value]?await k.Z.post("cestas/crearCesta",{idTrabajador:s.value[u.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{x().fire("Oops...",e.message,"error")})):s.value&&void 0!=u.value&&null!=u.value||x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function z(e){return!(1==c.value?.albaran||1==c.value?.vip||null==c.value.idCliente||void 0==c.value.idCliente||""==c.value.idCliente||null==e.puntos||e.puntos<=0||e.subtotal<=0||"CONSUMO_PERSONAL"==c.value.modo)&&(p.value>d.value+e.puntos&&!e.regalo&&!m.value.includes(c.value.idCliente))}function S(e,a=null){k.Z.post("cestas/regalarProducto",{idCesta:c.value._id,indexLista:e,idPromoArtSel:a}).then((e=>{e.data?x().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):x().fire("Oops...","No se ha podido regalar el producto","error")}))}async function H(e,a){_.value=e,y.value?y.value.showModal(parseInt(a.descuentoTienda),c.value,e):console.error("modalDescuentosTienda no está definido.")}async function N(e,a){let t=a.promocion?a.promocion.grupos.flat():null;if(a.promocion&&t.length>1){let n='\n                <style>\n                input[type="radio"] {\n          appearance: none;\n          -webkit-appearance: none;\n          width: 20px;\n          height: 20px;\n          border: 2px solid black;\n          border-radius: 50%;\n\n          background-color: transparent;\n          position: relative;\n        }\n        .inputRegalo{\n          margin-left: 3rem ; /* Margen izquierdo de 2 columnas */\n          display: flex ; /* Display flex */\n          margin-top: 0.5rem ; /* Margen superior de 2 espacios */\n          margin-bottom: 0.5rem ;\n        }\n\n        label {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-left:5px;\n        }\n        .bloqueado {\n          pointer-events: none; /* Hace que el div no sea cliclable */\n          opacity: 0.6; /* Establece una opacidad inferior al normal (puedes ajustar el valor según tus preferencias) */\n        }\n        input[type="radio"]:checked::before {\n          content: "";\n          display: block;\n          width: 12px;\n          height: 12px;\n          background-color: #ca8489;\n          border-radius: 50%;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          animation: appear 0.8s;\n        }\n        @keyframes appear {\n          0% {\n            transform: translate(-50%, -50%) scale(0);\n            background-color: #fff;\n          }\n          45% {\n            transform: translate(-50%, -50%) scale(1.6);\n            background-color: #64aedf;\n          }\n          50% {\n            transform: translate(-50%, -50%) scale(1.7);\n            background-color: #ad97b3;\n          }\n          55% {\n            transform: translate(-50%, -50%) scale(1.6);\n          }\n          100% {\n            transform: translate(-50%, -50%) scale(1);\n            background-color: #ca8489;\n          }\n        }\n        </style>\n        <div class="col-12 mx-auto" >';for(let e of t){const o=(await k.Z.post("articulos/getArticuloById",{idArticulo:e.idArticulo})).data;n+=`<div class="inputRegalo ${null==o.puntos?"bloqueado":""}">\n              <input type="radio"  name="opcion" id="opcion1" value="${e.idArticulo}">\n              <label for="opcion1" class="col-9 d-flex">${e.nombre} \n                ${null==o.puntos?"":o.puntos*e.unidades*a.unidades+" p"}</label>\n            </div>`}n+="</div>",x().fire({title:"¿Cual articulo para regalar?",html:n,icon:"question",showDenyButton:!0,showConfirmButton:!0,confirmButtonText:"Si, regalar",denyButtonText:"No",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"},showClass:{popup:""},didOpen:()=>{const e=document.querySelector(".bloqueado");if(e){const a=e.querySelector("label").textContent;x().showValidationMessage(`${a} no se puede regalar`)}},preConfirm:()=>{const e=document.getElementsByName("opcion"),a=Array.from(e).find((e=>e.checked));return a?a.value:(x().showValidationMessage("Debes seleccionar una opción"),!1)}}).then((a=>{a.isConfirmed?(S(e,a.value),o.state.indexItemActivo=null):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}else x().fire({title:"¿Regalar este artículo?",text:`Se descontarán ${null!=a.puntos?a.puntos:0} puntos al cliente ${c.value.nombreCliente}`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?S(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}function F(e){o.dispatch("Cestas/setActivoAction",e)}function P(){const e=c.value.detalleIva,a=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((a,o)=>a+e[o]),0);return Number(a.toFixed(2))}function U(){if(!c.value)return;P();const e=c.value?.lista?c.value.lista.length:0;let a=0;for(let o=0;o<e;o++)a+=c.value.lista[o].subtotal;a>=12&&c.value?.idCliente==g.value&&!b.value?(w.value=!0,h(!0),b.value=!0):(c.value?.idCliente!=g.value||a<12||0==c.value.lista.length)&&b.value&&(w.value=!1,h(!1),b.value=!1,k.Z.post("/cestas/recalcularIvas",{idCesta:c.value._id}))}function j(){C.value=!0}function W(){C.value=!1}function O(e){const a=new tn(e).toDecimalPlaces(2).toFixed(2);return a}return(0,t.YP)((()=>c.value?.lista),(()=>{U()})),a({actualizarPuntos:M,BuscarCestas:A}),(0,t.bv)((()=>{M(),U(),k.Z.get("clientes/getEsClienteFacturacion").then((e=>{e.data&&(m.value=e.data)}))})),{cesta:c,arrayTrabajadores:s,indexTrabajadorActivo:u,indexItemCestaActivo:r,clickItem:F,inicializarCesta:I,BuscarCestas:A,sePuedeRegalar:z,puntos:p,sumar:B,restar:E,clickRegalo:N,disabledCambiarUnidades:w,popOverTarifaEsp:C,showPopOver:j,hidePopOver:W,clickDiscountShop:H,parametros:v,modalDescuentosTienda:y,cOutPrecioOrig:O}}};const ln=(0,A.Z)(nn,[["render",io],["__scopeId","data-v-04d95a90"]]);var rn=ln;const sn={class:"modoVenta d-block text-center"},un={key:0,class:"d-block textoNombreCliente text-center"},dn={class:"text-truncate",style:{"max-width":"10rem"}},cn={key:0,class:"d-flex justify-content-around mb-1"},mn={key:1,class:"d-block text-center textoNombreCliente"};function pn(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBBtnGroup"),c=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),f=(0,t.up)("ModalUnidadesComponent"),v=(0,t.up)("tarjetaClienteNumero"),g=(0,t.up)("ModalEncargosComponent"),b=(0,t.up)("ModalNuevoCliente"),w=(0,t.up)("ModalExtendidoClienteComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[n.vistaEspecial&&n.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,u.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==n.cesta.modo,fondoEncargo:"RECOGER ENCARGO"==n.cesta.modo,fondoCliente:n.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",sn,(0,u.zw)(n.cesta.modo),1),n.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",un,[(0,t._)("span",dn,(0,u.zw)(n.cesta.nombreCliente),1),n.clienteSeleccionado?((0,t.wg)(),(0,t.iD)("div",cn,[(0,t._)("span",null,"Encargos: "+(0,u.zw)(n.quantEncargo),1),(0,t._)("span",null,"Deudas: "+(0,u.zw)(n.quantDeuda),1)])):(0,t.kq)("",!0),(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>n.consultarPuntos(n.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",mn,(0,u.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),n.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(d,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>n.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[2]||(a[2]=e=>n.refModalArticulos.abrirModal()),outline:"secondary",class:(0,u.C_)(["botones ms-1",{oculto:n.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),n.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>n.refModalClientesSeleccionado.abrirModal(n.cesta.idCliente))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones ms-1",onMousedown:a[4]||(a[4]=e=>n.startPress()),onMouseup:a[5]||(a[5]=e=>n.endPress()),onTouchstartPassive:a[6]||(a[6]=e=>n.startPress()),onTouchendPassive:a[7]||(a[7]=e=>n.endPress()),disabled:"CONSUMO_PERSONAL"==n.cesta?.modo},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1},8,["disabled"]))])),_:1})),n.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(d,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{onClick:a[8]||(a[8]=e=>n.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[9]||(a[9]=e=>n.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[10]||(a[10]=e=>n.goTo("/cestas")),outline:"secondary",class:(0,u.C_)(["botones ms-1",{oculto:!n.siMesas}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1},8,["class"])])),_:1})),(0,t.Wm)(d,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==n.indexActivoCesta||null==n.indexActivoCesta?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones",onClick:a[11]||(a[11]=e=>n.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones",onClick:a[12]||(a[12]=e=>n.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(r,{onClick:a[13]||(a[13]=e=>n.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(r,{outline:"secondary",onClick:a[14]||(a[14]=e=>n.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",style:(0,u.j5)({fontSize:n.textoStock?"3em":"4em"})},null,8,["style"]),n.textoStock?((0,t.wg)(),(0,t.iD)("p",{key:0,class:"stock",style:(0,u.j5)({fontSize:"16px",color:n.arrayStock["stock-IndicadorPos1"]?.fontColor})},(0,u.zw)(void 0!==n.arrayStock["stock-IndicadorPos1"]?.stock?n.arrayStock["stock-IndicadorPos1"]?.stock||"0":""),5)):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(c,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(f,{ref:"refModalUnidades"},null,512),(0,t.Wm)(v,{ref:"tarjetaNum"},null,512),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512),(0,t.Wm)(b,{ref:"refModalNuevoCliente"},null,512),(0,t.Wm)(w,{ref:"refModalExtendidoCliente"},null,512)],64)}var fn=o(6411),vn=o(46626);const gn=e=>((0,t.dD)("data-v-87b8dff6"),e=e(),(0,t.Cn)(),e),bn={class:"header"},wn={class:"col-md-8"},hn=["value"],Cn=gn((()=>(0,t._)("div",{class:"col-md-12"},[(0,t._)("hr")],-1))),yn={class:"textoNombre d-inline-block text-truncate"},_n={key:0,class:"spinner-border",role:"status",style:{margin:"2%"}},Mn=gn((()=>(0,t._)("span",{class:"visually-hidden"},"Loading...",-1))),Dn=[Mn],kn={key:1,style:{margin:"2%"}},Bn={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function xn(e,a,o,n,l,i){const r=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBadge"),d=(0,t.up)("MDBListGroupItem"),c=(0,t.up)("MDBListGroup"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModal"),f=(0,t.up)("KeyBoardComponent"),g=(0,t.Q2)("mdb-infinite-scroll");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:n.modalArticulos,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",bn,[(0,t._)("div",wn,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",style:{"background-color":"#00ffff00"},placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example",readonly:"",onClick:a[0]||(a[0]=e=>n.openKeyboard()),"onUpdate:modelValue":a[1]||(a[1]=e=>n.inputBusqueda=e)},null,512),[[v.nr,n.inputBusqueda]])]),(0,t._)("select",{class:"Familia",onChange:a[2]||(a[2]=e=>n.selectFamilia(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.familias,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",value:n.familias[a].text},(0,u.zw)(n.familias[a].text),9,hn)))),256))],32)]),Cn,n.arrayArticulos?.length>0?(0,t.wy)(((0,t.wg)(),(0,t.j4)(c,{key:0,class:"container",style:{"max-height":"461px","overflow-y":"scroll"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.j4)(d,{key:e.i,style:{"justify-content":"space-between"},class:"d-flex align-items-center",onClick:e=>n.selectArticulo({nombreArticulo:a.nombre,idArticle:a._id,esSumable:a.esSumable})},{default:(0,t.w5)((()=>[(0,t._)("td",null,[(0,t.Wm)(r,{icon:"tag",size:"2x",class:"me-4"}),(0,t._)("span",yn,(0,u.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(s,{class:"textoFamilia d-inline-block text-truncate text-dark",badge:"info",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(a.familia),1)])),_:2},1024)])])),_:2},1032,["onClick"])))),128)),((0,t.wg)(),(0,t.j4)(d,{key:e.i,style:{"justify-content":"center"},class:"d-flex align-items-center"},{default:(0,t.w5)((()=>[n.maxLimit?((0,t.wg)(),(0,t.iD)("div",kn,[(0,t._)("span",Bn,(0,u.zw)(e.$t("sin_resultados","No hay mas resultados")),1)])):((0,t.wg)(),(0,t.iD)("div",_n,Dn))])),_:1}))])),_:1})),[[g,n.infiniteScroll]]):(0,t.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"keyboardRef"},null,512)],64)}var Tn={name:"ModalArticulosComponent",directives:{mdbInfiniteScroll:M.z9},components:{MDBModal:M.j3,MDBIcon:M.vm,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_,MDBSelect:M.R3,KeyBoardComponent:T.Z,MDBModalFooter:M.ab},setup(e,a){const o=(0,D.iH)(!1),n=(0,D.iH)(0),l=(0,D.iH)(null),i=(0,D.iH)(""),r=(0,D.iH)(),s=(0,D.iH)([{text:"Todos",value:"Todos"}]),u=(0,D.iH)("Todos"),d=(0,D.iH)(20),c=(0,D.iH)(!1),m=(0,t.f3)("clickTecla"),p=async()=>{d.value=d.value+20,await h()};function f(e){m(e),o.value=!1}async function v(){o.value=!0,d.value=20,c.value=!1,r.value=[],await b(),h()}function g(){n.value++}function b(){k.Z.post("articulos/familias").then((e=>{s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function w(e){u.value=e.target.value,d.value=20,c.value=!1,r.value=[],await h()}function h(){""!=i.value&&0==r.value.length&&(d.value=d.value+20*i.value.length),c.value=!1,k.Z.post("articulos/buscar",{busqueda:i.value,familia:u.value,limit:d.value}).then((e=>{r.value=e.data,d.value>r.value.length&&(c.value=!0)})).catch((e=>{x().fire("Oops...",e.message,"error")}))}let C;async function y(){try{l.value.abrirModal(i.value),C=setInterval((()=>{i.value=l.value.getValue()[0],l.value.getValue()[1]||clearInterval(C)}),100)}catch(e){console.log(e),C=void 0}}return(0,t.YP)(i,(()=>{h()})),a.expose({abrirModal:v,datoBorrar:n}),(0,t.bv)((async()=>{await b()})),{test:g,openKeyboard:y,maxLimit:c,datoBorrar:n,infiniteScroll:p,familias:s,keyboardRef:l,modalArticulos:o,selectFamilia:w,inputBusqueda:i,arrayArticulos:r,buscar:h,selectArticulo:f}}};const En=(0,A.Z)(Tn,[["render",xn],["__scopeId","data-v-87b8dff6"]]);var An=En;const In={class:"row"},zn={class:"row"},Sn={class:"text-center"};function Hn(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("NumpadComponent"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:n.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("introduce","Introduce"))+" "+(0,u.zw)(e.$t("las_unidades","las unidades"))+" "+(0,u.zw)(e.$t("y_marca","y marca"))+" "+(0,u.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",In,[n.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>n.refUnidadesComponent.cantidad=e)},null,512)),[[v.nr,n.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",zn,[(0,t._)("div",Sn,[(0,t.Wm)(d,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Nn={name:"UnidadesComponent",components:{NumpadComponent:X.Z,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalHeader:M.ol,MDBModalTitle:M.wo},setup(){const e=(0,D.iH)(null),a=(0,D.iH)(null),o=(0,f.oR)();function n(){a.value=!0}function l(e){if(e>100)return x().fire({title:"Has añadido muchos productos.",html:`Vas a añadir <b>${e}<b/> productos,<br/><i> ¿estás segur@ de esta acción?</i>`,showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",confirmButtonColor:"info",cancelButtonColor:"green",iconColor:"info",icon:"info"}).then((t=>{t.isConfirmed&&(a.value=!1,o.dispatch("Unidades/setUnidades",e))}));a.value=!1,o.dispatch("Unidades/setUnidades",e)}return(0,t.JJ)("okValue",l),{refUnidadesComponent:e,modalUnidades:a,abrirModal:n}}};const Fn=(0,A.Z)(Nn,[["render",Hn],["__scopeId","data-v-7e0f404e"]]);var Pn=Fn;const Un={class:"text-center col-12 p3"},jn={class:"text-center h2"},Wn={class:"row"},On={class:"d-inline-block text-center"},Vn={class:"d-inline-block text-center"},Rn={id:"salir",class:"text-center"};function $n(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal"),c=(0,t.up)("ModalEncargosComponent"),m=(0,t.up)("ModalDeudasComponent"),p=(0,t.up)("ModalFichaCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(d,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalClientesSeleccionado,"onUpdate:modelValue":a[5]||(a[5]=e=>n.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Un,[(0,t._)("span",jn,(0,u.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,u.zw)(n.cesta?.nombreCliente),1)]),(0,t._)("div",Wn,[(0,t._)("div",On,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),void 0==n.cliente?.noPagaEnTienda||!1===n.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:0,color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>n.abrirModalEncargos())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("encargos","Encargos")),1)])),_:1})):(0,t.kq)("",!0),void 0==n.cliente?.noPagaEnTienda||!1===n.cliente?.noPagaEnTienda?((0,t.wg)(),(0,t.j4)(r,{key:1,disabled:n.recogiendoEncargos,color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>n.abrirModalDeuda())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("Deudas","deudas")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0)]),(0,t._)("div",Vn,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.nuevoPedido},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("nuevo_pedido","Nuevo pedido")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>n.ficha())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("ficha","Ficha")),1)])),_:1})]),(0,t._)("div",Rn,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>n.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"refModalEncargos"},null,512),(0,t.Wm)(m,{ref:"refModalDeudas"},null,512),(0,t.Wm)(p,{ref:"refModalFichaCliente",callback:n.cambiosCliente},null,8,["callback"])],64)}const Zn=e=>((0,t.dD)("data-v-0073e22a"),e=e(),(0,t.Cn)(),e),qn={class:"row"},Ln={class:"d-inline-block text-center"},Yn={class:"p-0"},Kn={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},Gn={class:"d-flex align-content-center ps-5"},Jn={class:"content-date"},Qn=["min","max"],Xn=Zn((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),el={class:"content-date"},al=["min","max"],ol={class:"d-flex pe-5 my-1"},tl={class:"m-auto px-2"},nl=["onClick"],ll={class:"d-flex flex-row-reverse"},il={class:"d-flex m-0 p-0 justify-content-between"},rl={key:0,class:"p-0"},sl={key:0},ul={key:1},dl={key:1,class:"p-0",type:"button"},cl={key:2,class:"p-0",type:"button"},ml={class:"d-flex justify-content-between px-0 py-2 m-0"},pl={class:"d-flex m-0 p-0 justify-content-between"},fl={class:"productos"},vl={class:"col-12"},gl={class:"col-3"},bl={class:"col-1"},wl={class:"col-1"},hl={class:"col-2"},Cl={class:"col-2"},yl={class:"col-3"},_l={class:"d-flex flex-column justify-content-center"},Ml={key:0},Dl={key:1},kl={key:1},Bl={class:"sinResultados position-relative"},xl={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Tl={id:"salir"},El={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},Al=Zn((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),Il={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},zl=Zn((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1))),Sl={class:"h4 mx-2 pb-2 border-bottom"},Hl={class:"d-flex justify-content-around"},Nl={class:"my-3 d-flex flex-column content-date"},Fl={for:"dateStart",class:"h5"},Pl=["min","max"],Ul={class:"my-3 d-flex flex-column content-date"},jl={for:"dateFinal",class:"h5"},Wl=["min","max"],Ol={class:"h4 mx-2 pb-2 border-bottom"},Vl={class:"d-flex justify-content-around my-3"},Rl=Zn((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),$l={for:"orden1",class:"h6"},Zl=Zn((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),ql={for:"orden2",class:"h6"},Ll=Zn((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),Yl={for:"orden3",class:"h6"},Kl={class:"h6"},Gl=Zn((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function Jl(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),m=(0,t.up)("MDBModalTitle"),p=(0,t.up)("MDBModalHeader"),f=(0,t.up)("MDBModalFooter");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",labelledby:"tituloModalClientes",modelValue:n.modalEncargos,"onUpdate:modelValue":a[6]||(a[6]=e=>n.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",qn,[(0,t._)("div",Ln,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.goTo("/menu/encargos")),disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1},8,["disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.recoger,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.anular,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.abrirModalImprimir,disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick","disabled"])]),(0,t._)("div",Yn,[(0,t._)("div",Kn,[(0,t._)("div",Gn,[(0,t._)("div",Jn,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>n.startSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[2]||(a[2]=e=>(n.mostrar(),n.currentPage=1))},null,40,Qn),[[v.nr,n.startSelectedDate]])]),Xn,(0,t._)("div",el,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>n.finalSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[4]||(a[4]=e=>(n.mostrar(),n.currentPage=1))},null,40,al),[[v.nr,n.finalSelectedDate]])])]),(0,t._)("div",ol,[(0,t._)("span",tl,(0,u.zw)(n.startRange)+" - "+(0,u.zw)(n.endRange)+" de "+(0,u.zw)(n.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])])]),(0,t.Wm)(v.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[n.encargos&&n.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>n.onClickEncargo(o),class:(0,u.C_)({active:n.seleccionado===o,horaTarde:1==n.horaTarde(a),diaTarde:1==n.diaTarde(a)})},[(0,t._)("div",ll,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>n.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",il,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",rl,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",sl,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",ul,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",dl,[(0,t._)("p",null,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",cl,[(0,t._)("p",null,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(e.$t("cada","Cada"))+" "+(0,u.zw)(a?.dias[0]?.dia)+" - "+(0,u.zw)(a?.dias[0]?.dia)+" "+(0,u.zw)(e.$t("proximo","Próximo"))+" "+(0,u.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,u.zw)(a?.nombreCliente),1)]),(0,t._)("div",ml,[(0,t._)("p",null,(0,u.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,u.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,u.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("faltan","Faltan"))+": "+(0,u.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",pl,[(0,t._)("p",null,(0,u.zw)(e.$t("productos","Productos"))+": "+(0,u.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,u.zw)(e.$t("dependienta","Dependienta"))+": "+(0,u.zw)(a?.nombreDependienta),1)]),(0,t._)("div",fl,[(0,t._)("table",vl,[(0,t._)("tr",null,[(0,t._)("th",gl,(0,u.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",bl,(0,u.zw)(e.$t("precio","Precio")),1),(0,t._)("th",wl,(0,u.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",hl,(0,u.zw)(e.$t("total","Total")),1),(0,t._)("th",Cl,(0,u.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",yl,(0,u.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,u.zw)(e?.nombre),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,u.zw)(e?.unidades),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",_l,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Ml,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,u.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Dl,"Ninguno"))]),(0,t._)("td",null,(0,u.zw)(e?.comentario),1)])))),128))])])],10,nl)])))),128)):((0,t.wg)(),(0,t.iD)("div",kl,[(0,t._)("div",Bl,[(0,t._)("span",xl,(0,u.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",Tl,[(0,t._)("div",El,[Al,(0,t._)("span",null,(0,u.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[5]||(a[5]=e=>n.cerrarModal()),disabled:n.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("salir","Salir")),1)])),_:1},8,["disabled"]),(0,t._)("div",Il,[zl,(0,t._)("span",null,(0,u.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:n.modalImprimirEncargos,"onUpdate:modelValue":a[14]||(a[14]=e=>n.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:n.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("h2",Sl,(0,u.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",Hl,[(0,t._)("div",Nl,[(0,t._)("label",Fl,(0,u.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[7]||(a[7]=e=>n.dateStart=e),min:n.startInputDate,max:n.finalInputDate},null,8,Pl),[[v.nr,n.dateStart]])]),(0,t._)("div",Ul,[(0,t._)("label",jl,(0,u.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[8]||(a[8]=e=>n.dateFinal=e),min:n.startInputDate,max:n.finalInputDate},null,8,Wl),[[v.nr,n.dateFinal]])])]),(0,t._)("h2",Ol,(0,u.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",Vl,[(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>n.orden="producto")},[Rl,(0,t._)("label",$l,(0,u.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[10]||(a[10]=e=>n.orden="Cliente")},[Zl,(0,t._)("label",ql,(0,u.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[11]||(a[11]=e=>n.orden="producto_resumido")},[Ll,(0,t._)("label",Yl,(0,u.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,u.C_)([{"d-none":!n.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",Kl,[Gl,(0,t.Uk)(" "+(0,u.zw)(n.commentError),1)])],2)])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[12]||(a[12]=e=>n.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[13]||(a[13]=e=>n.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"])],64)}var Ql={name:"modalEncargosComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm},setup(e,a){const o=(0,D.iH)(!1),n=(0,f.oR)(),l=(0,Ta.tv)(),i=(0,D.iH)(null),r=((0,D.iH)(0),(0,D.iH)()),s=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>s.value&&void 0!=u.value&&null!=u.value&&s.value[u.value]?s.value[u.value]:null)),c=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(s.value&&s.value[u.value]&&c.value[e]._id==s.value[u.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(!1),v=new Date,g=(0,D.iH)(-1),b=new Date(v.getFullYear(),v.getMonth(),v.getDate(),0,0,0),w=(0,D.iH)(null),h=(0,D.iH)(null),C=(0,D.iH)(null),y=(0,D.iH)(null);b.setDate(b.getDate()+1);let _="1";const M=(0,D.iH)([]),B=(0,D.iH)(null),T=(0,D.iH)(!1),E=(0,D.iH)(null),A=(0,D.iH)(null),I=(0,D.iH)(null),z=(0,D.iH)(null),S=(0,D.iH)(!1),H=(0,D.iH)(null),N=(0,D.iH)(null),F=(0,t.Fl)((()=>n.state.Encargos.encargoToModalEnc));function P(e,a){N.value=e,H.value=a,i.value=!0,Z()}const U=(0,D.iH)(1),j=(0,D.iH)(20),W=(0,t.Fl)((()=>B.value?Math.ceil(B.value.length/j.value):0)),O=(0,t.Fl)((()=>(U.value-1)*j.value+1)),V=(0,t.Fl)((()=>Math.min(U.value*j.value,B.value?.length||0))),R=(0,t.f3)("cerrarModalClientesSeleccionado"),$=(0,t.f3)("eliminarCestaActual");async function Z(){await k.Z.post("/encargos/getEncargosByIdCliente",{idCliente:H.value}).then((e=>{M.value=e.data,M.value&&0!==M.value.length&&(q(M.value),K())}))}function q(e){let a=null,o=null;for(const t of e){1==t.opcionRecogida&&"am"==t.amPm&&(t.hora="14:59"),1==t.opcionRecogida&&"pm"==t.amPm&&(t.hora="23:59");const e=new Date(t.fecha);(null===a||e<a)&&(a=e),(null===o||e>o)&&(o=e)}C.value=a?.toISOString().slice(0,10),w.value=a?.toISOString().slice(0,10),h.value=o?.toISOString().slice(0,10),y.value=o?.toISOString().slice(0,10)}function L(e,a=!1){i.value=!0,p.value=!0,k.Z.post("/encargos/getEncargoById",{idEncargo:e}).then((async e=>{if(B.value=[e.data],"SIN_RECOGER"!=B.value[0].estado)return i.value=!1,void x().fire({icon:"info",title:"Este encargo ya se ha pagado/anulado",showConfirmButton:!0});if(1==B.value.length&&a&&(g.value=0),q(B.value),!a){Q(0);const e=ee();oe(e)}}))}function Y(e){l.push(e)}function K(){if(B.value=[],M.value=M.value||[],Array.isArray(M.value)){for(const e of M.value){const a=e.fecha;a>=w.value&&a<=h.value&&B.value.push(e)}B.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}}function G(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),n=a.getMinutes(),l=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(l<t||l==t&&i<n)}function J(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function Q(e){g.value=e}function X(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function ee(){return g.value+(U.value-1)*j.value}async function ae(){o.value=!0;const e=ee();if(-1!=g.value){let a=X(B.value[e].total-B.value[e].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+a+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cesta",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async a=>{a.isConfirmed?oe(e):o.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),o.value=!1}function oe(e){try{let a=X(B.value[e].total-B.value[e].dejaCuenta,2);n.dispatch("Cestas/setCestaBaseAction",N.value);const o=B.value[e].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:o}).then((async o=>{if(!o.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.data,idTrabajador:d.value._id}).then((async l=>{let i=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let e=0;e<i.value.length;e++)if(i.value[e]._id==o.data)return i.value[e]}));(r.value.modo="RECOGER ENCARGO")&&(n.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:a}),p.value||R(),me(),n.dispatch("Encargos/setEncargoSeleccionado",B.value[e]))}))}))}catch(a){}finally{o.value=!1}}function te(){const e=ee();-1!=g.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((a=>{a.isConfirmed&&(B.value[e].dejaCuenta>0?x().fire({title:"Devolver anticipo de "+B.value[e].dejaCuenta+"€ al cliente?",icon:"warning",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",denyButtonText:"No",confirmButtonText:"Si",cancelButtonText:"Cancelar",confirmButtonColor:"green",denyButtonColor:"red",cancelButtonColor:"gray"}).then((a=>{a.isConfirmed?k.Z.post("movimientos/nuevoMovimiento",{cantidad:B.value[e].dejaCuenta,concepto:"dejaACuenta",idTrabajador:d.value._id,tipo:"SALIDA",nombreCliente:B.value[e].nombreCliente}).then((a=>{if(a.data)return k.Z.post("impresora/abrirCajon"),void ne(e);throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})):a.isDenied?ne(e):o.value=!1})):ne(e))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function ne(e){k.Z.post("/encargos/anularEncargo",{id:B.value[e]._id}).then((async a=>{if(a?.data){const a=await n.dispatch("Encargos/cancelarEncargoEnUso",{id:B.value[e]._id});a&&$(),B.value.splice(g.value,1),g.value=-1,Z(),p.value&&me(),x().fire("Perfecto","Encargo anulado correctamente","success")}else x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function le(){T.value=!0}function ie(){S.value=!1,z.value="",T.value=!1,I.value=null}function re(){if(!E.value||!A.value)return z.value="Por favor, ingresa ambas fechas",void(S.value=!0);if(A.value<E.value)return z.value="La fecha final no puede ser anterior a la fecha inicial",void(S.value=!0);if(null==I.value)return z.value="Elige una opción de orden",void(S.value=!0);{const e=[];for(const a of M.value){const o=a.fecha;o>=E.value&&o<=A.value&&e.push(a)}if(0==e.length)return z.value="El intervalo de fechas seleccionado no contiene encargos.",void(S.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:I.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),ie()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function se(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function ue(){const e=(U.value-1)*j.value,a=e+j.value;return B.value.slice(e,a)}function de(){U.value<W.value&&U.value++}function ce(){U.value>1&&U.value--}function me(){p.value=!1,g.value=-1,i.value=!1}return(0,t.YP)(U,(()=>{g.value=-1})),(0,t.YP)(B,(()=>{B.value.length<O.value&&(U.value=1)})),(0,t.YP)(F,((e,a)=>{if(e&&e._id&&e!==a){const a=e._id;H.value=e.idCliente,n.dispatch("Encargos/deleteEncargoToModalEnc"),L(a,!0)}}),{deep:!0}),a.expose({abrirModal:P,getEncargo:L}),{modalEncargos:i,arrayClientes:r,cesta:m,goTo:Y,encargos:B,mostrar:K,listado:_,seleccionado:g,onClickEncargo:Q,recoger:ae,anular:te,redondearDecimales:X,diaTarde:J,horaTarde:G,cargarEncargos:Z,imprimir:re,botonBloqueado:o,getEncargo:L,startSelectedDate:w,finalSelectedDate:h,startInputDate:C,finalInputDate:y,abrirModalImprimir:le,modalImprimirEncargos:T,errorValidacionImp:S,dateStart:E,dateFinal:A,orden:I,commentError:z,cerrarModalImprimir:ie,currentPage:U,itemsPerPage:j,totalPages:W,paginatedItems:ue,nextPage:de,prevPage:ce,startRange:O,endRange:V,cerrarModal:me,printCharge:se}}};const Xl=(0,A.Z)(Ql,[["render",Jl],["__scopeId","data-v-0073e22a"]]);var ei=Xl;const ai=e=>((0,t.dD)("data-v-581484df"),e=e(),(0,t.Cn)(),e),oi={class:"row"},ti={class:"d-inline-block text-center"},ni={class:"p-0"},li={class:"d-flex justify-content-between px-5"},ii={class:"d-flex pe-5 my-1"},ri={class:"m-auto px-2"},si={class:"d-flex"},ui={class:"text-center d-flex justify-content-center align-items-center"},di=ai((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),ci={class:"size ps-2"},mi={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},pi=ai((()=>(0,t._)("div",{class:"spinner"},null,-1))),fi=[pi],vi=["onClick"],gi={class:"d-flex m-0 p-0 justify-content-between"},bi={class:"d-flex justify-content-between px-0 py-2 m-0"},wi={class:"productos"},hi={class:"col-12"},Ci=ai((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),yi={class:"d-flex flex-column justify-content-center"},_i={key:0},Mi={key:1},Di={key:2},ki={class:"sinResultados position-relative"},Bi={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},xi={id:"salir"},Ti={key:0},Ei=ai((()=>(0,t._)("h5",{class:"mb-4"},"Selecciona el tipo de pago",-1))),Ai={class:"list-group"},Ii={class:"list-group-item d-flex align-items-center"},zi=ai((()=>(0,t._)("strong",null,"Pago total",-1))),Si=ai((()=>(0,t._)("br",null,null,-1))),Hi={class:"text-muted"},Ni={key:0,class:"list-group-item d-flex flex-column"},Fi={class:"d-flex align-items-center"},Pi=ai((()=>(0,t._)("div",null,[(0,t._)("strong",null,"Pago parcial")],-1))),Ui={key:0,class:"mt-2 ms-4"},ji={key:1,class:"list-group-item d-flex align-items-center"},Wi=ai((()=>(0,t._)("strong",null,"Pago combinado",-1))),Oi=ai((()=>(0,t._)("br",null,null,-1))),Vi={class:"text-muted"},Ri={key:0,class:"alert alert-info mt-4"},$i={class:"row"},Zi={class:"col"},qi={class:"input-group input-group-lg"},Li={class:"row"},Yi={class:"col text-center"};function Ki(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBBadge"),c=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal"),p=(0,t.up)("MDBInput"),f=(0,t.up)("MDBModalFooter"),g=(0,t.up)("MDBModalHeader"),b=(0,t.up)("NumpadComponent"),w=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(m,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalDeudas,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalDeudas=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",oi,[(0,t._)("div",ti,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>n.goTo("/menu/deudas"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("nueva_deuda","Nueva deuda")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.findOutPagar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.eliminar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("eliminar","Eliminar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:n.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",ni,[(0,t._)("div",li,[(0,t._)("div",ii,[(0,t._)("span",ri,(0,u.zw)(n.startRange)+" - "+(0,u.zw)(n.endRange)+" de "+(0,u.zw)(n.arrayDeudas?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right"})])),_:1},8,["onClick","disabled"])]),(0,t._)("div",si,[(0,t.Wm)(r,{onClick:a[1]||(a[1]=e=>n.selectAllDebtsClient()),class:"bg-info text-white my-1 me-2"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1}),(0,t._)("div",ui,[di,(0,t._)("span",ci,(0,u.zw)(n.seleccionados.length),1)])])]),(0,t.Wm)(v.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("div",mi,fi)):n.arrayDeudas&&n.arrayDeudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:o},[(0,t._)("div",{type:"button",onClick:e=>n.onClickDeuda(a._id),class:(0,u.C_)({active:n.seleccionados.includes(a._id)})},[(0,t._)("div",gi,[(0,t._)("p",null,"Fecha deuda: "+(0,u.zw)(n.getFecha(a?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,u.zw)(a?.nombreCliente),1),a?.albaran?((0,t.wg)(),(0,t.j4)(d,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",bi,[(0,t._)("p",null,(0,u.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,u.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,u.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("faltan","Faltan"))+": "+(0,u.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,u.zw)(a?.cesta?.lista?.length),1),(0,t._)("div",wi,[(0,t._)("table",hi,[Ci,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,u.zw)(e?.nombre),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,u.zw)(e?.unidades),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",yi,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",_i,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,u.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Mi,"Ninguno"))])])))),128))])])],10,vi)])))),128)):((0,t.wg)(),(0,t.iD)("div",Di,[(0,t._)("div",ki,[(0,t._)("span",Bi,(0,u.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t._)("div",xi,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[2]||(a[2]=e=>n.cerrarModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalPagoDeudasRef",tabindex:"-1",labelledby:"ModalPagoDeudas",modelValue:n.modalPagoDeudasRef,"onUpdate:modelValue":a[13]||(a[13]=e=>n.modalPagoDeudasRef=e),centered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[n.modalPagoDeudasRef?((0,t.wg)(),(0,t.iD)("div",Ti,[Ei,(0,t._)("div",Ai,[(0,t._)("label",Ii,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoTotal",value:"total","onUpdate:modelValue":a[4]||(a[4]=e=>n.tipoPago=e),onChange:a[5]||(a[5]=e=>n.pagoParcial=n.totalAPagar)},null,544),[[v.G2,n.tipoPago]]),(0,t._)("div",null,[zi,(0,t.Uk)(),Si,(0,t._)("small",Hi,"("+(0,u.zw)(n.totalAPagar.toFixed(2))+"€)",1)])]),n.hayArticulosEnCesta?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("label",Ni,[(0,t._)("div",Fi,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoParcial",value:"parcial","onUpdate:modelValue":a[6]||(a[6]=e=>n.tipoPago=e),onChange:a[7]||(a[7]=e=>n.pagoParcial=0)},null,544),[[v.G2,n.tipoPago]]),Pi]),"parcial"===n.tipoPago?((0,t.wg)(),(0,t.iD)("div",Ui,[(0,t.Wm)(p,{type:"number",id:"pagoDeudaInput",min:0,max:n.totalAPagar,step:"0.01",modelValue:n.pagoParcial,"onUpdate:modelValue":a[8]||(a[8]=e=>n.pagoParcial=e),onClick:a[9]||(a[9]=e=>n.openTecladoNum()),readonly:"",class:"form-control col-6",placeholder:"Ingresa el monto parcial"},null,8,["max","modelValue"])])):(0,t.kq)("",!0)])),n.hayArticulosEnCesta?((0,t.wg)(),(0,t.iD)("label",ji,[(0,t.wy)((0,t._)("input",{class:"form-check-input me-3",type:"radio",name:"tipoPago",id:"pagoCombinado",value:"combinado","onUpdate:modelValue":a[10]||(a[10]=e=>n.tipoPago=e),onChange:a[11]||(a[11]=e=>n.pagoParcial=n.totalAPagar)},null,544),[[v.G2,n.tipoPago]]),(0,t._)("div",null,[Wi,Oi,(0,t._)("small",Vi," ("+(0,u.zw)(n.totalAPagar.toFixed(2))+"€ "+(0,u.zw)(e.$t("deuda","deuda"))+" + "+(0,u.zw)(n.getTotal(n.cestaMain).toFixed(2))+"€ "+(0,u.zw)(e.$t("en_cesta","en cesta"))+") ",1)])])):(0,t.kq)("",!0)]),n.hayArticulosEnCesta?((0,t.wg)(),(0,t.iD)("div",Ri,(0,u.zw)(e.$t("hay","Hay"))+" "+(0,u.zw)(n.cestaMain.lista.length)+" "+(0,u.zw)(e.$t("articulos","artículo"))+"(s) "+(0,u.zw)(e.$t("en_la_cesta_actual","en la cesta actual"))+". ",1)):(0,t.kq)("",!0)])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"primary",onClick:n.pagar},{default:(0,t.w5)((()=>[(0,t.Uk)(" Ir a Cobrar ")])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"danger",onClick:a[12]||(a[12]=e=>n.cerrarModalPagoDeudas())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:n.modalTecladoNum,"onUpdate:modelValue":a[17]||(a[17]=e=>n.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,t.w5)((()=>[(0,t.Wm)(g),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",$i,[(0,t._)("div",Zi,[(0,t._)("div",qi,[n.numpadRef?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[14]||(a[14]=e=>n.numpadRef.cantidad=e)},null,512)),[[v.nr,n.numpadRef.cantidad]]):(0,t.kq)("",!0)])])]),(0,t._)("div",Li,[(0,t._)("div",Yi,[(0,t.Wm)(b,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",onClick:a[15]||(a[15]=e=>n.closeTecladoNum()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[16]||(a[16]=e=>n.finishTecladoNum())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(w,{ref:"keyboardRef"},null,512)],64)}var Gi={name:"modaldeudasComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,KeyBoardComponentVue:T.Z,MDBBadge:M.m_,MDBIcon:M.vm,MDBModalFooter:M.ab,MDBInput:M.u2,NumpadComponent:X.Z},setup(e,a){const o=(0,D.iH)(null),n=(0,Ta.tv)(),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)([]),s=(0,D.iH)(-1),u=(0,D.iH)(null),d=(0,D.iH)(""),c=(0,D.iH)("1"),m=(0,f.oR)(),p=(0,D.iH)(null),v=(0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),g=(0,t.Fl)((()=>m.state.Trabajadores.arrayTrabajadores)),b=((0,t.Fl)((()=>m.state.Trabajadores.indexActivo)),(0,t.Fl)((()=>g.value&&void 0!=v.value&&null!=v.value&&g.value[v.value]?g.value[v.value]:null))),w=(0,D.iH)(null),h=(0,t.Fl)((()=>m.state.ModalCobroView.modalCobroViewAbierto)),C=(0,D.iH)(null),y=(0,t.Fl)((()=>m.state.Cestas.arrayCestas)),_=(0,t.Fl)((()=>y.value?y.value.find((e=>e._id==p.value)):null)),M=(0,t.Fl)((()=>{if(!p.value||!_.value)return!1;const e=_?.value;return e&&e.lista&&e.lista.length>0})),B=(0,D.iH)(!1),T=(0,D.iH)(0),E=(0,D.iH)(0),A=(0,D.iH)("total"),I=()=>{T.value=0,B.value=!1},z=(0,D.iH)(null),S=(0,D.iH)(null);function H(e,a){p.value=e,C.value=a,o.value=!0,R()}const N=(0,D.iH)(!1),F=(0,t.f3)("cerrarModalClientesSeleccionado"),P=(0,t.Fl)((()=>m.state.Deudas.deudasToModal)),U=(0,D.iH)(1),j=(0,D.iH)(5),W=(0,t.Fl)((()=>i.value?Math.ceil(i.value.length/j.value):0)),O=(0,t.Fl)((()=>(U.value-1)*j.value+1)),V=(0,t.Fl)((()=>Math.min(U.value*j.value,i.value?.length||0)));function R(){N.value=!0,k.Z.post("/deudas/getDeudasByIdCliente",{idCliente:C.value}).then((async e=>{l.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),l.value.sort(((e,a)=>e.timestamp-a.timestamp));for(const a of l.value){const e=(await k.Z.post("clientes/getClienteById",{idCliente:a.idCliente})).data;a.albaran=e?.albaran,a.dejaCuenta||(a.dejaCuenta=0)}i.value=l.value,N.value=!1,$()})).catch((e=>{N.value=!1}))}function $(){switch(c.value){case"1":i.value.sort(((e,a)=>e.timestamp-a.timestamp));break;case"2":i.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":i.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function Z(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function q(){r.value=i.value.map((e=>e._id))}function L(e){const a=i.value.find((a=>a._id===e)).idCliente,o=i.value.find((a=>a._id===e))._id;r.value.includes(o)?r.value.splice(r.value.indexOf(o),1):w.value&&a!=w.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):r.value.push(o),Y()}function Y(){r.value.length>=1&&null==w.value&&(w.value=i.value.find((e=>e._id===r.value[0])).idCliente),0==r.value.length&&(w.value=null)}function K(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),n=("0"+a.getDate()).slice(-2),l=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+n+" "+l+":"+i+":"+r);return s}function G(){let e=0,a=i.value.filter((e=>r.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}function J(){let e=0;return e=G(),"combinado"===A.value&&(e+=ee(_.value)),e}function Q(){B.value=!0}async function X(){0!=r.value.length?(Q(),E.value=Z(G(),2)):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function ee(e){const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Number(o.toFixed(2))}async function ae(){if("total"!=A.value&&"combinado"!=A.value||(T.value=E.value),T.value<0)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser negativo"});if(T.value>E.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser mayor al total a pagar"});if(0==T.value&&0!=E.value)return void x().fire({icon:"info",title:"Oops...",text:"El pago no puede ser 0"});const e=i.value.filter((e=>r.value.includes(e._id))),a=Z(e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),2),o=Math.max(...e.map((e=>e.total-e.dejaCuenta))),n=Z(a-o,2);if(T.value<n)return void x().fire({icon:"info",title:"Oops...",text:"El pago debe superar el monto minimo de "+n});const l=r.value,s=[];try{m.dispatch("Cestas/setCestaBaseAction",p.value);const e=[];for(const o of l)e.push(i.value.find((e=>e._id===o)).cesta),s.push(i.value.find((e=>e._id===o)));"combinado"===A.value&&e.push(_.value);const a="combinado"===A.value?"cestas/cestaCombinada":"cestas/cestaDeudas";k.Z.post(a,{cestas:e}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:b.value._id}).then((async a=>{let o=(0,t.Fl)((()=>m.state.Cestas.arrayCestas)),n=await(0,t.Fl)((()=>{if(o.value)for(let a=0;a<o.value.length;a++)if(o.value[a]._id==e.data)return o.value[a]}));(n.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:G()}),m.dispatch("Deudas/setDeudasSeleccionadas",s),T.value!=E.value&&m.dispatch("Deudas/setTotalAPagar",T.value),m.dispatch("ModalCobroView/abrirModalCobroView"),I())}))}))}catch(u){console.log("Error",u),x().fire("Oops...",u.message,"error")}}function oe(){R(),d.value="",n.push("/main")}function te(){0!=r.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+r.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=r.value;try{const a=[];for(const o of e)a.push(await ne(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success"),ce.value&&se()}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}oe()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function ne(e){const a=i.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function le(){const e=(U.value-1)*j.value,a=e+j.value;return i.value.slice(e,a)}function ie(){U.value<W.value&&U.value++}function re(){U.value>1&&U.value--}function se(){o.value=!1,U.value=1,s.value=-1,r.value=[],ce.value=!1}function ue(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input">\n          </div>\n          <div id="fechas my-input-class"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function de(){const e=d?.value,a=[];if(e&&e.length>0){for(let o=0;o<l.value.length;o++)l.value[o].nombreCliente.toLowerCase().includes(e.toLocaleLowerCase())&&a.push(l.value[o]);i.value=a}else i.value=l.value}const ce=(0,D.iH)(!1);function me(e){o.value=!0,r.value=e.map((e=>e._id)),ce.value=!0,i.value=e}const pe=()=>{z.value=!0},fe=()=>{z.value=!1},ve=()=>{let e=Number(S.value.cantidad);T.value=Number(e.toFixed(2)),fe()};function ge(e){n.push(e)}let be;async function we(){try{u.value.abrirModal(d.value),be=setInterval((()=>{d.value=u.value.getValue()[0],u.value.getValue()[1]||clearInterval(be)}),100)}catch(e){console.log(e),be=void 0}}return(0,t.JJ)("okValue",(()=>z.value?ve():pe())),(0,t.YP)(i,(()=>{i.value.length<O.value&&(U.value=1)})),(0,t.YP)(d,(()=>{de()})),(0,t.YP)(h,(()=>{!h.value&&o.value&&(ce.value||(F(),k.Z.post("impresora/despedida",{precioTotal:J()})),se())})),(0,t.YP)(P,((e,a)=>{if(e&&JSON.stringify(e)!==JSON.stringify(a)&&e.length>0){const a=e;C.value=a[0].idCliente,me(a),m.dispatch("Deudas/deleteDeudasToModal")}})),(0,t.YP)(M,(e=>{e||"combinado"!==A.value?e&&"parcial"===A.value&&(A.value="total"):A.value="total"})),a.expose({abrirModal:H,getDeuda:me}),{modalDeudas:o,goTo:ge,cargarDeudas:R,redondearDecimales:Z,deudasFiltradas:l,arrayDeudas:i,onClickDeuda:L,seleccionado:s,seleccionados:r,pagar:ae,getFecha:K,eliminar:te,imprimir:ue,buscar:de,openKeyboard:we,keyboardRef:u,inputBusqueda:d,loading:N,filtrarLista:$,selectFiltro:c,cerrarModal:se,currentPage:U,itemsPerPage:j,totalPages:W,paginatedItems:le,nextPage:ie,prevPage:re,startRange:O,endRange:V,getTotalSeleccionados:G,findOutPagar:X,modalPagoDeudasRef:B,pagoParcial:T,totalAPagar:E,cerrarModalPagoDeudas:I,tipoPago:A,modalTecladoNum:z,numpadRef:S,openTecladoNum:pe,closeTecladoNum:fe,finishTecladoNum:ve,selectAllDebtsClient:q,hayArticulosEnCesta:M,cestaMain:_,getTotal:ee}}};const Ji=(0,A.Z)(Gi,[["render",Ki],["__scopeId","data-v-581484df"]]);var Qi=Ji;const Xi={class:"row"},er={class:"col w-50"},ar={class:"col w-50 datos"},or={key:0,class:"spinner"},tr={key:1};function nr(e,a,o,n,l,i){const r=(0,t.up)("MDBModalHeader"),s=(0,t.up)("MDBInput"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),f=(0,t.up)("KeyBoardComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:n.modalFichaCliente,"onUpdate:modelValue":a[16]||(a[16]=e=>n.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,u.zw)(n.nombre),1)])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",Xi,[(0,t._)("div",er,[(0,t.Wm)(s,{label:"Nombre",modelValue:n.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e),style:{"margin-top":"10px"},readonly:"",onClick:a[1]||(a[1]=e=>n.openKeyBoardCampos("nombre"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Teléfono",modelValue:n.telefono,"onUpdate:modelValue":a[2]||(a[2]=e=>n.telefono=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[3]||(a[3]=e=>n.openKeyBoardCampos("telefono"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Correo electrónico",modelValue:n.email,"onUpdate:modelValue":a[4]||(a[4]=e=>n.email=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[5]||(a[5]=e=>n.openKeyBoardCampos("email"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Dirección",modelValue:n.direccion,"onUpdate:modelValue":a[6]||(a[6]=e=>n.direccion=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[7]||(a[7]=e=>n.openKeyBoardCampos("direccion"))},null,8,["modelValue"])]),(0,t._)("div",ar,[(0,t.Wm)(s,{label:"Tarjeta cliente",modelValue:n.tarjeta,"onUpdate:modelValue":a[8]||(a[8]=e=>n.tarjeta=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[9]||(a[9]=e=>n.openKeyBoardCampos("tarjeta"))},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Documento de identidad",modelValue:n.nif,"onUpdate:modelValue":a[10]||(a[10]=e=>n.nif=e),class:"datos",style:{"margin-top":"10px"},readonly:"",onClick:a[11]||(a[11]=e=>n.openKeyBoardCampos("nif"))},null,8,["modelValue"]),!n.clienteToc||n.clienteToc?.albaran||n.clienteToc?.vip?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(s,{key:0,label:"Descuento aplicado",min:"0",max:"100",type:"number",modelValue:n.descuento,"onUpdate:modelValue":a[12]||(a[12]=e=>n.descuento=e),class:"datos",style:{"margin-top":"10px"},onChange:n.validateDescuento,readonly:"",onClick:a[13]||(a[13]=e=>n.openKeyBoardCampos("descuento"))},null,8,["modelValue","onChange"]))])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"primary",onClick:a[14]||(a[14]=e=>n.guardarCliente()),disabled:n.loading,class:"btnSpinner d-flex align-items-center justify-content-center"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("span",or)):((0,t.wg)(),(0,t.iD)("span",tr,"Guardar"))])),_:1},8,["disabled"]),(0,t.Wm)(c,{color:"danger",onClick:a[15]||(a[15]=e=>n.modalFichaCliente=!1),ref:"salirBoton",disabled:n.loading},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"keyboardRef"},null,512)],64)}var lr={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:M.$v,MDBInput:M.u2,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBModalHeader:M.ol,KeyBoardComponent:T.Z},setup(e,a){const o=(0,D.iH)(!1),n=e=>{o.value=!0,C(e)};a.expose({abrirModal:n});const l=(0,D.iH)(null),i=(0,D.iH)(""),r=(0,D.iH)(""),s=(0,D.iH)(""),u=(0,D.iH)(""),d=(0,D.iH)(""),c=(0,D.iH)(""),m=(0,D.iH)("0"),p=(0,D.iH)(null),f=(0,D.iH)(null),v=(0,D.iH)(null),g={nombre:i,email:s,direccion:u,tarjeta:d,nif:c,descuento:m,telefono:r},b=(0,t.f3)("cambiosCliente"),w=(0,D.iH)(!1),h=()=>{""!=i.value?isNaN(Number(m.value))?x().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):(w.value=!0,k.Z.post("clientes/actualizarCliente",{idCliente:p.value,nombre:i.value,telefono:r.value,email:s.value,direccion:u.value,tarjetaCliente:d.value,nif:c.value,descuento:m.value}).then((()=>{x().fire({title:"Cliente actualizado",icon:"success",confirmButtonText:"Aceptar"}),e.callback({nombre:i.value,descuento:m.value}),o.value=!1})).catch((e=>{x().fire({title:"Vaya...",text:"No se ha podido actualizar el cliente",icon:"error",confirmButtonText:"Aceptar"})})).finally((()=>{w.value=!1}))):x().fire({title:"Vaya...",text:"No se puede dejar el nombre vacio",icon:"error",confirmButtonText:"Aceptar"})},C=async e=>{const{data:a}=await k.Z.post("/clientes/getClienteById",{idCliente:e});if(!a)throw new Error("No se ha podido cargar el cliente");f.value=a,i.value="null"==a.nombre?"":a.nombre,r.value="null"==a.telefono?"":a.telefono,s.value="null"==a.email?"":a.email,u.value="null"==a.direccion?"":a.direccion,d.value="null"==a.tarjetaCliente?"":a.tarjetaCliente,c.value="null"==a.nif?"":a.nif,m.value="null"==a.descuento?"":a.descuento,p.value="null"==a.id?"":a.id};function y(e){const a=m.value;if(void 0===a||null===a||""===a)return;const o=a.replace(/[^0-9.]/g,""),[t,n]=o.split("."),i=n&&n.length>2?n.slice(0,2):n,r=t+(i?`.${i}`:""),s=parseFloat(r);let u="";isNaN(s)||(u=s<0?"0":s>100?"100":r),m.value!==u&&(m.value=u,l.value.setText(u))}let _;function M(e){B(g[e])}async function B(e){try{l.value.abrirModal(e.value),_=setInterval((()=>{const a=l.value.getValue()[0];a!==e.value&&(e.value=a),l.value.getValue()[1]||clearInterval(_)}),100)}catch(a){console.log(a),_=void 0}}return(0,t.YP)(m,(e=>{y()})),{modalFichaCliente:o,guardarCliente:h,nombre:i,telefono:r,email:s,direccion:u,tarjeta:d,nif:c,descuento:m,salirBoton:v,cambiosCliente:b,loading:w,clienteToc:f,validateDescuento:y,openKeyBoardCampos:M,keyboardRef:l}}};const ir=(0,A.Z)(lr,[["render",nr],["__scopeId","data-v-18950909"]]);var rr=ir,sr={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalEncargosComponent:ei,ModalDeudasComponent:Qi,ModalFichaCliente:rr},setup(e,a){const o=(0,f.oR)(),n=(0,D.iH)(null),l=((0,D.iH)(0),(0,D.iH)()),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),u=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=((0,t.Fl)((()=>u.value&&void 0!=d.value&&null!=d.value&&u.value[d.value]?u.value[d.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),m=(0,t.Fl)((()=>{if(c.value)for(let e=0;e<c.value.length;e++)if(u.value&&u.value[d.value]&&c.value[e]._id==u.value[d.value].idCesta)return c.value[e];return null})),p=(0,D.iH)(null),v=(0,D.iH)(null),g=(0,t.Fl)((()=>!!m.value&&"RECOGER ENCARGO"==m.value.modo));function b(e){w(e),n.value=!0}async function w(e){try{const a=await k.Z.post("clientes/getClienteById",{idCliente:e});a.data&&(v.value=a.data)}catch(a){}}async function h(){if(c.value&&m.value)for(let e=0;e<c.value.length;e++)if(c.value[e]._id===m.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),await o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset"),k.Z.post("cestas/recalcularIvas",{idCesta:m.value._id});break}y()}a.expose({abrirModal:b});const C=()=>{s.value.abrirModal(m.value.idCliente)};function y(){n.value=!1}function _({nombre:e,descuento:a}){m.value.nombreCliente=e,o.dispatch("Cestas/setDescuentoAction",Number(a/100))}function M(){k.Z.get("deudas/getUpdateDeudas").then((e=>{e.data?r.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando deudas",html:"Descargando deudas debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("deudas/descargarDeudas").then((e=>{e.data?(r.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar las deudas. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&r.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}function B(){k.Z.get("encargos/getUpdateEncargos").then((e=>{e.data?i.value.abrirModal(m.value._id,m.value.idCliente):x().fire({title:"Actualizando encargos",html:"Descargando encargos debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{x().showLoading(),k.Z.post("encargos/descargarEncargos").then((e=>{e.data?(i.value.abrirModal(m.value._id,m.value.idCliente),x().close()):x().fire({title:"Error",text:"No se han podido actualizar los encargos. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&i.value.abrirModal(m.value._id,m.value.idCliente)}))})).catch((e=>{x().fire("Oops...",e.message,"error")}))}})}))}async function T(){p.value?(await h(),setTimeout((()=>{E("/menu/nuevos-pedidos")}),200)):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function E(e){fn.Z.push(e)}return(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{p.value=e.data})).catch((e=>{p.value=!1}))})),(0,t.JJ)("cambiosClientes",_),(0,t.JJ)("cerrarModalClientesSeleccionado",y),{modalClientesSeleccionado:n,arrayClientes:l,cesta:m,resetGeneral:h,refModalEncargos:i,refModalDeudas:r,ficha:C,refModalFichaCliente:s,cambiosCliente:_,abrirModalDeuda:M,abrirModalEncargos:B,cliente:v,nuevoPedido:T,clientePedidosTienda:p,recogiendoEncargos:g}}};const ur=(0,A.Z)(sr,[["render",$n],["__scopeId","data-v-5065ebca"]]);var dr=ur,cr=o(92471);const mr={class:"d-flex justify-content-between"},pr={class:"d-flex"};function fr(e,a,o,n,l,i){const r=(0,t.up)("MDBTabItem"),s=(0,t.up)("MDBTabNav"),d=(0,t.up)("MDBBtn"),c=(0,t.up)("ListadoEncargosComponent"),m=(0,t.up)("MDBTabPane"),p=(0,t.up)("ListadoDeudasComponent"),f=(0,t.up)("MDBTabContent"),v=(0,t.up)("MDBTabs"),g=(0,t.up)("MDBModalBody"),b=(0,t.up)("MDBModalFooter"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"modalExtendidoClient",title:"Datos extendidos del cliente",modelValue:n.modalExtendidoCliente,"onUpdate:modelValue":a[4]||(a[4]=e=>n.modalExtendidoCliente=e),size:"xl","static-backdrop":""},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{class:"pb-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{modelValue:n.activeTabId,"onUpdate:modelValue":a[2]||(a[2]=e=>n.activeTabId=e)},{default:(0,t.w5)((()=>[(0,t._)("div",mr,[(0,t.Wm)(s,{tabsClasses:" text-center border-bottom d-flex tabMenuCliente"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:(0,u.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab1"===n.activeTabId}]),tag:"button",wrap:!1,tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("encargos","Encargos")),1)])),_:1},8,["class"]),(0,t.Wm)(r,{tag:"button",class:(0,u.C_)(["sizeBotones m-0 tabItem",{"active-tab":"tab2"===n.activeTabId}]),wrap:!1,tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("deudas","Deudas")),1)])),_:1},8,["class"])])),_:1}),(0,t._)("div",pr,["tab1"==n.activeTabId?((0,t.wg)(),(0,t.j4)(d,{key:0,onClick:a[0]||(a[0]=e=>n.sendToModalEncargos()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0),"tab2"==n.activeTabId?((0,t.wg)(),(0,t.j4)(d,{key:1,onClick:a[1]||(a[1]=e=>n.sendToModalDeudas()),class:"btn my-0 btn-primary sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Gestionar ")])),_:1})):(0,t.kq)("",!0)])]),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{tabId:"tab1"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref:"refListadoEncargos"},null,512)])),_:1}),(0,t.Wm)(m,{tabId:"tab2"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref:"refListadoDeudas"},null,512)])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{class:"d-flex justify-content-center"},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(d,{id:"salir",color:"danger",class:"ms-2 col-4",onClick:a[3]||(a[3]=a=>{e.seleccionado=-1,n.modalExtendidoCliente=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("salir","Salir")),1)])),_:1})])])),_:1})])),_:1},8,["modelValue"])}const vr=e=>((0,t.dD)("data-v-2cdf9ebb"),e=e(),(0,t.Cn)(),e),gr={class:"p-0"},br={class:"text-center d-flex justify-content-between my-2 h4 no-bold"},wr={class:"d-flex align-content-center px-3"},hr={class:"content-date"},Cr=["min","max"],yr=vr((()=>(0,t._)("p",{class:"m-auto px-2"},"al",-1))),_r={class:"content-date"},Mr=["min","max"],Dr={class:"d-flex my-1"},kr={class:"m-auto px-2 range"},Br=["onClick"],xr={class:"d-flex flex-row-reverse"},Tr={class:"d-flex m-0 p-0 justify-content-between"},Er={key:0,class:"p-0"},Ar={key:0},Ir={key:1},zr={key:1,class:"p-0",type:"button"},Sr={key:2,class:"p-0",type:"button"},Hr={class:"d-flex justify-content-between px-0 py-2 m-0"},Nr={class:"d-flex m-0 p-0 justify-content-between"},Fr={class:"productos"},Pr={class:"col-12"},Ur={class:"col-3"},jr={class:"col-1"},Wr={class:"col-1"},Or={class:"col-2"},Vr={class:"col-2"},Rr={class:"col-3"},$r={class:"d-flex flex-column justify-content-center"},Zr={key:0},qr={key:1},Lr={key:1},Yr={class:"sinResultados position-relative"},Kr={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},Gr={class:"h4 mx-2 pb-2 border-bottom"},Jr={class:"d-flex justify-content-around"},Qr={class:"my-3 d-flex flex-column content-date"},Xr={for:"dateStart",class:"h5"},es=["min","max"],as={class:"my-3 d-flex flex-column content-date"},os={for:"dateFinal",class:"h5"},ts=["min","max"],ns={class:"h4 mx-2 pb-2 border-bottom"},ls={class:"d-flex justify-content-around my-3"},is=vr((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),rs={for:"orden1",class:"h6"},ss=vr((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),us={for:"orden2",class:"h6"},ds=vr((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"producto_resumido"},null,-1))),cs={for:"orden3",class:"h6"},ms={class:"h6"},ps=vr((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function fs(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBModalTitle"),c=(0,t.up)("MDBModalHeader"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),g=(0,t.up)("ModalEncargos");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",gr,[(0,t._)("div",br,[(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>n.nuevoPedido()),class:"sizeBotones my-auto",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Nuevo pedido ")])),_:1}),(0,t._)("div",wr,[(0,t._)("div",hr,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>n.startSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[2]||(a[2]=e=>(n.mostrar(),n.currentPage=1))},null,40,Cr),[[v.nr,n.startSelectedDate]])]),yr,(0,t._)("div",_r,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>n.finalSelectedDate=e),class:"datePicker",min:n.startInputDate,max:n.finalInputDate,onChange:a[4]||(a[4]=e=>(n.mostrar(),n.currentPage=1))},null,40,Mr),[[v.nr,n.finalSelectedDate]])])]),(0,t._)("div",Dr,[(0,t._)("span",kr,(0,u.zw)(n.startRange)+" - "+(0,u.zw)(n.endRange)+" de "+(0,u.zw)(n.encargos?.length||0),1),(0,t.Wm)(r,{color:"secondary",onClick:n.prevPage,disabled:1==n.currentPage},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-left"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"secondary",onClick:n.nextPage,disabled:n.currentPage==n.totalPages},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"angle-right",size:"1x"})])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{class:"ms-5",onClick:n.abrirModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])]),(0,t.Wm)(v.W3,{name:"fade",id:"lista",tag:"div"},{default:(0,t.w5)((()=>[n.encargos&&n.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(n.paginatedItems(),((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{onClick:e=>n.onClickEncargo(o),class:(0,u.C_)({active:n.seleccionado===o,horaTarde:1==n.horaTarde(a),diaTarde:1==n.diaTarde(a)})},[(0,t._)("div",xr,[(0,t.Wm)(s,{class:"p-1",icon:"print",size:"lg",onClick:e=>n.printCharge(a?._id)},null,8,["onClick"])]),(0,t._)("div",Tr,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Er,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",Ar,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",Ir,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",zr,[(0,t._)("p",null,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(a?.fecha)+" "+(0,u.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Sr,[(0,t._)("p",null,(0,u.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,u.zw)(e.$t("cada","Cada"))+" "+(0,u.zw)(a?.dias[0]?.dia)+" - "+(0,u.zw)(a?.dias[0]?.dia)+" "+(0,u.zw)(e.$t("proximo","Próximo"))+" "+(0,u.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,u.zw)(a?.nombreCliente),1)]),(0,t._)("div",Hr,[(0,t._)("p",null,(0,u.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,u.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,u.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("faltan","Faltan"))+": "+(0,u.zw)(n.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",Nr,[(0,t._)("p",null,(0,u.zw)(e.$t("productos","Productos"))+": "+(0,u.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,u.zw)(e.$t("dependienta","Dependienta"))+": "+(0,u.zw)(a?.nombreDependienta),1)]),(0,t._)("div",Fr,[(0,t._)("table",Pr,[(0,t._)("tr",null,[(0,t._)("th",Ur,(0,u.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",jr,(0,u.zw)(e.$t("precio","Precio")),1),(0,t._)("th",Wr,(0,u.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",Or,(0,u.zw)(e.$t("total","Total")),1),(0,t._)("th",Vr,(0,u.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",Rr,(0,u.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,u.zw)(e?.nombre),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,u.zw)(e?.unidades),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",$r,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Zr,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,u.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",qr,"Ninguno"))]),(0,t._)("td",null,(0,u.zw)(e?.comentario),1)])))),128))])])],10,Br)])))),128)):((0,t.wg)(),(0,t.iD)("div",Lr,[(0,t._)("div",Yr,[(0,t._)("span",Kr,(0,u.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(f,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:n.modalImprimirEncargos,"onUpdate:modelValue":a[12]||(a[12]=e=>n.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:n.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("h2",Gr,(0,u.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",Jr,[(0,t._)("div",Qr,[(0,t._)("label",Xr,(0,u.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[5]||(a[5]=e=>n.dateStart=e),min:n.startInputDate,max:n.finalInputDate},null,8,es),[[v.nr,n.dateStart]])]),(0,t._)("div",as,[(0,t._)("label",os,(0,u.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[6]||(a[6]=e=>n.dateFinal=e),min:n.startInputDate,max:n.finalInputDate},null,8,ts),[[v.nr,n.dateFinal]])])]),(0,t._)("h2",ns,(0,u.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",ls,[(0,t._)("div",{class:"inputOrden",onClick:a[7]||(a[7]=e=>n.orden="producto")},[is,(0,t._)("label",rs,(0,u.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[8]||(a[8]=e=>n.orden="Cliente")},[ss,(0,t._)("label",us,(0,u.zw)(e.$t("cliente","Cliente")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>n.orden="producto_resumido")},[ds,(0,t._)("label",cs,(0,u.zw)(e.$t("producto_resumido","Producto resumido")),1)])]),(0,t._)("div",{class:(0,u.C_)([{"d-none":!n.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",ms,[ps,(0,t.Uk)(" "+(0,u.zw)(n.commentError),1)])],2)])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"success",size:"lg",onClick:a[10]||(a[10]=e=>n.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(r,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>n.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"]),(0,t.Wm)(g,{ref:"refModalEncargos"},null,512)],64)}var vs={name:"ListadoEncargosComponent",components:{TransitionGroup:v.W3,MDBBtn:M.$v,MDBIcon:M.vm,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalBody:M.Yz,MDBModalFooter:M.ab,ModalEncargos:ei},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,Ta.tv)(),l=new Date,i=(new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),(0,D.iH)(null)),r=(0,D.iH)(!1),s=(0,D.iH)(null),u=(0,D.iH)(null),d=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),v=(0,D.iH)(null),g=(0,D.iH)(!1),b=(0,D.iH)(null),w=(0,D.iH)([]),h=(0,D.iH)(null),C=(0,D.iH)(!1),y=(0,D.iH)(-1),_=(0,D.iH)(1),M=(0,D.iH)(20),B=(0,t.Fl)((()=>h.value?Math.ceil(h.value.length/M.value):0)),T=(0,t.Fl)((()=>(_.value-1)*M.value+1)),E=(0,t.Fl)((()=>Math.min(_.value*M.value,h.value?.length||0))),A=(0,t.f3)("cerrarModalExtendidoCliente"),I=(0,D.iH)(null),z=(0,t.f3)("resetGeneral");function S(){k.Z.post("/encargos/getEncargos").then((e=>{w.value=e.data;let a=null,o=null;if(0!=w.length){for(const e of w.value){1==e.opcionRecogida&&"am"==e.amPm&&(e.hora="14:59"),1==e.opcionRecogida&&"pm"==e.amPm&&(e.hora="23:59");const t=new Date(e.fecha);(null===a||t<a)&&(a=t),(null===o||t>o)&&(o=t)}d.value=a?.toISOString().slice(0,10),s.value=a?.toISOString().slice(0,10),u.value=o?.toISOString().slice(0,10),c.value=o?.toISOString().slice(0,10),H()}}))}function H(){h.value=[];for(const e of w.value){const a=e.fecha;a>=s.value&&a<=u.value&&h.value.push(e)}h.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function N(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),n=a.getMinutes(),l=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getMonth()==o.getMonth()&&a.getFullYear()==o.getFullYear()&&a.getDate()==o.getDate()&&(l<t||l==t&&i<n)}function F(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getFullYear()>o.getFullYear()||a.getFullYear()===o.getFullYear()&&a.getMonth()>o.getMonth()||a.getFullYear()===o.getFullYear()&&a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function P(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function U(e){y.value=e}function j(){return y.value+(_.value-1)*M.value}async function W(e,a){C.value=!0;const n=j();if(-1!=y.value){let l=P(h.value[n].total-h.value[n].dejaCuenta,2);await x().fire({title:"Precio por pagar: "+l+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async i=>{if(i.isConfirmed)try{o.dispatch("Cestas/setCestaBaseAction",e);const i=h.value[n].cesta;k.Z.post("cestas/generarCestaEncargos",{cestaEncargo:i}).then((async e=>{if(!e.data)throw Error("No se ha podido cargar la cesta");await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:a}).then((async a=>{let i=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),r=await(0,t.Fl)((()=>{if(i.value)for(let a=0;a<i.value.length;a++)if(i.value[a]._id==e.data)return i.value[a]}));(r.value.modo="RECOGER ENCARGO")&&(o.dispatch("EstadoDinamico/setVistaCliente",!0),await k.Z.post("impresora/despedida",{precioTotal:l}),A(),o.dispatch("Encargos/setEncargoSeleccionado",h.value[n]),o.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(r){}finally{C.value=!1}else C.value=!1}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),C.value=!1}function O(e){const a=j();-1!=y.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((o=>{o.isConfirmed&&(h.value[a].dejaCuenta>0&&k.Z.post("movimientos/nuevoMovimiento",{cantidad:h.value[a].dejaCuenta,concepto:"dejaACuenta",idTrabajador:e,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})),k.Z.post("/encargos/anularEncargo",{id:h.value[a]._id}).then((e=>{e?.data?(h.value.splice(y.value,1),y.value=-1,S(),x().fire("Perfecto","Encargo anulado correctamente","success")):x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")})))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function V(){if(-1==y.value)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"});const e=j();o.dispatch("Encargos/setEncargoToModalEnc",h.value[e]),A()}function R(){r.value=!0}function $(){g.value=!1,b.value="",r.value=!1,v.value=null}function Z(){if(!m.value||!p.value)return b.value="Por favor, ingresa ambas fechas",void(g.value=!0);if(p.value<m.value)return b.value="La fecha final no puede ser anterior a la fecha inicial",void(g.value=!0);if(null==v.value)return b.value="Elige una opción de orden",void(g.value=!0);{const e=[];for(const a of w.value){const o=a.fecha;o>=m.value&&o<=p.value&&e.push(a)}if(0==e.length)return b.value="El intervalo de fechas seleccionado no contiene encargos.",void(g.value=!0);k.Z.post("/encargos/imprimirEncargosHoy",{orden:v.value,array:e}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","error al imprimir","error"),$()})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}async function q(e){try{const a=await k.Z.post("/encargos/imprimirEncargo",{id:e});if(a.data.error)throw new Error(a.data.error)}catch(a){x().fire("Oops...","No se pudo imprimir el encargo. Contacte con servicio","error")}}function L(){const e=(_.value-1)*M.value,a=e+M.value;return h.value.slice(e,a)}function Y(){_.value<B.value&&_.value++}function K(){_.value>1&&_.value--}async function G(){I.value?(await z(),J("/menu/nuevos-pedidos")):x().fire({title:"Error",text:"Consulte al técnico para habilitar los pedidos",icon:"error"})}function J(e){n.push(e)}return(0,t.YP)(_,(()=>{y.value=-1})),(0,t.YP)(h,(()=>{h.value.length<T.value&&(_.value=1),y.value=-1})),a({cargarEncargos:S,recoger:W,anular:O,sendToModalEncargos:V}),(0,t.bv)((()=>{k.Z.get("clientes/getClientePedidosTienda").then((e=>{I.value=e.data})).catch((e=>{I.value=!1})),S()})),{startSelectedDate:s,finalSelectedDate:u,modalImprimirEncargos:r,startInputDate:d,finalInputDate:c,dateStart:m,dateFinal:p,orden:v,encargos:h,currentPage:_,itemsPerPage:M,totalPages:B,startRange:T,endRange:E,cargarEncargos:S,mostrar:H,horaTarde:N,diaTarde:F,redondearDecimales:P,paginatedItems:L,nextPage:Y,prevPage:K,abrirModalImprimir:R,cerrarModalImprimir:$,imprimir:Z,errorValidacionImp:g,commentError:b,nuevoPedido:G,clientePedidosTienda:I,seleccionado:y,onClickEncargo:U,refModalEncargos:i,printCharge:q}}};const gs=(0,A.Z)(vs,[["render",fs],["__scopeId","data-v-2cdf9ebb"]]);var bs=gs;const ws=e=>((0,t.dD)("data-v-2f1433f4"),e=e(),(0,t.Cn)(),e),hs={class:"p-0"},Cs={class:"d-flex justify-content-around"},ys={class:"d-flex justify-content-between py-2 col-12"},_s={class:"d-flex col-6 align-items-center"},Ms={class:"col-md-2 text-center d-flex justify-content-center align-items-center"},Ds=ws((()=>(0,t._)("i",{class:"fa fa-file fa-2x"},null,-1))),ks={class:"size ps-2"},Bs={class:"d-flex col-4 justify-content-between"},xs={class:"d-flex col-7"},Ts=ws((()=>(0,t._)("div",{class:"d-flex align-items-center col-2 size"},[(0,t._)("i",{class:"fas fa-filter"})],-1))),Es={class:"col-10"},As={value:"1"},Is={value:"2"},zs={value:"3"},Ss={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},Hs=ws((()=>(0,t._)("div",{class:"spinner"},null,-1))),Ns=[Hs],Fs=["onClick"],Ps={class:"clientStatusToggle"},Us={key:1,class:"fas fa-chevron-up"},js={key:2,class:"fas fa-chevron-down"},Ws=["onClick"],Os={class:"d-flex m-0 p-0 justify-content-between"},Vs={class:"d-flex justify-content-between px-0 py-2 m-0"},Rs={class:"productos"},$s={class:"col-12"},Zs=ws((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),qs={class:"d-flex flex-column justify-content-center"},Ls={key:0},Ys={key:1},Ks={key:2},Gs={class:"sinResultados position-relative"},Js={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function Qs(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("MDBBadge"),c=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",hs,[(0,t._)("div",Cs,[(0,t._)("div",ys,[(0,t._)("div",_s,[(0,t.wy)((0,t._)("input",{class:"form-control input w-100",type:"text",placeholder:"Buscar por cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>n.inputBusqueda=e),onClick:a[1]||(a[1]=e=>n.openKeyboard()),readonly:"",style:{"background-color":"white"}},null,512),[[v.nr,n.inputBusqueda]]),(0,t._)("div",Ms,[Ds,(0,t._)("span",ks,(0,u.zw)(n.seleccionados.length),1)]),(0,t.Wm)(r,{style:(0,u.j5)({visibility:n.viewedDebts?"visible":"hidden"}),onClick:a[2]||(a[2]=e=>n.selectAllDebtsClient()),class:"col-3 btn bg-info text-white"},{default:(0,t.w5)((()=>[(0,t.Uk)("Seleccionar todo")])),_:1},8,["style"])]),(0,t._)("div",Bs,[(0,t._)("div",xs,[Ts,(0,t._)("div",Es,[(0,t.wy)((0,t._)("select",{id:"filtro",class:"form-select input",name:"filtro","aria-label":".form-control-lg example","onUpdate:modelValue":a[3]||(a[3]=e=>n.selectFiltro=e),onChange:a[4]||(a[4]=e=>n.filtrarLista())},[(0,t._)("option",As,(0,u.zw)(e.$t("nombre","Nombre")),1),(0,t._)("option",Is,(0,u.zw)(e.$t("albaranes","Albaranes")),1),(0,t._)("option",zs,(0,u.zw)(e.$t("no_albaranes","No Albaranes")),1)],544),[[v.bM,n.selectFiltro]])])]),(0,t.Wm)(r,{class:"col-3 inputIcon",onClick:n.imprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"2x"})])),_:1},8,["onClick"])])])]),(0,t.Wm)(v.W3,{name:"fade",tag:"div",id:"lista"},{default:(0,t.w5)((()=>[n.loading?((0,t.wg)(),(0,t.iD)("div",Ss,Ns)):n.arrayByClients&&n.arrayByClients.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(n.computedClientList,((a,o)=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("div",{class:"DebtsClient",onClick:e=>n.displayDebtsClient(a.idCliente)},[(0,t._)("span",null,(0,u.zw)(a.nombreCliente)+": "+(0,u.zw)(a.deudas.length)+" "+(0,u.zw)(1===a.deudas.length?"Deuda":"Deudas")+", total de "+(0,u.zw)(n.sumDebtClient(a.deudas))+"€",1),(0,t._)("div",Ps,[a.albaran?((0,t.wg)(),(0,t.j4)(d,{key:0,badge:"info",class:"text-dark textoAlbaran",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0),n.viewedDebts==a.idCliente?((0,t.wg)(),(0,t.iD)("i",Us)):((0,t.wg)(),(0,t.iD)("i",js))])],8,Fs),a.deudas&&a.deudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(a.deudas,((o,l)=>(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:l},[(0,t._)("div",{onClick:e=>n.onClickDeuda(o),class:(0,u.C_)({active:n.seleccionados.includes(o._id)})},[(0,t._)("div",Os,[(0,t._)("p",null,"Fecha deuda: "+(0,u.zw)(n.getFecha(o?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,u.zw)(o?.nombreCliente),1),o?.albaran?((0,t.wg)(),(0,t.j4)(d,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)])]),(0,t._)("div",Vs,[(0,t._)("p",null,(0,u.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,u.zw)(o?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,u.zw)(o?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,u.zw)(e.$t("faltan","Faltan"))+": "+(0,u.zw)(n.redondearDecimales(o?.total-o?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,"Productos: "+(0,u.zw)(o?.cesta?.lista?.length),1),(0,t._)("div",Rs,[(0,t._)("table",$s,[Zs,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(o?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,u.zw)(e?.nombre),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,u.zw)(e?.unidades),1),(0,t._)("td",null,(0,u.zw)(n.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",qs,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",Ls,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,u.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Ys,"Ninguno"))])])))),128))])])],10,Ws)])),[[v.F8,n.viewedDebts==a.idCliente]]))),128)):(0,t.kq)("",!0)])))),256)):((0,t.wg)(),(0,t.iD)("div",Ks,[(0,t._)("div",Gs,[(0,t._)("span",Js,(0,u.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})]),(0,t.Wm)(c,{class:"position-absolute",ref:"keyboardRef"},null,512)],64)}var Xs={name:"ListadoDeudasComponent",components:{MDBBtn:M.$v,MDBBadge:M.m_,TransitionGroup:v.W3,KeyBoardComponentVue:T.Z,MDBIcon:M.vm},setup(e,{expose:a}){const o=(0,D.iH)([]),n=(0,D.iH)([]),l=(0,D.iH)([]),i=(0,t.Fl)((()=>l.value.filter((e=>!!e.nombreCliente&&e.nombreCliente.toLocaleLowerCase().includes(c.value.toLocaleLowerCase()))))),r=(0,D.iH)(""),s=(0,Ta.tv)(),u=(0,D.iH)([]),d=(0,D.iH)(null),c=(0,D.iH)(""),m=(0,D.iH)("1"),p=(0,f.oR)(),v=(0,D.iH)(null),g=(0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),b=(0,t.Fl)((()=>p.state.Trabajadores.arrayTrabajadores)),w=((0,t.Fl)((()=>p.state.Trabajadores.indexActivo)),(0,D.iH)(!1)),h=(0,t.Fl)((()=>b.value&&void 0!=g.value&&null!=g.value&&b.value[g.value]?b.value[g.value]:null)),C=(0,D.iH)(null),y=(0,t.Fl)((()=>p.state.ModalCobroView.modalCobroViewAbierto)),_=(0,t.f3)("cerrarModalExtendidoCliente");function M(){w.value=!0,k.Z.post("/deudas/getDeudas").then((async e=>{o.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),o.value.sort(((e,a)=>e.timestamp-a.timestamp));const a={};for(const t of o.value){const e=t.idCliente;if(!a[e]){const o=(await k.Z.post("clientes/getClienteById",{idCliente:t.idCliente})).data;a[e]={idCliente:e,nombreCliente:t.nombreCliente,albaran:o?.albaran||!1,deudas:[]}}a[e].deudas.push(t)}l.value=Object.values(a),l.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente))),w.value=!1,T()})).catch((e=>{w.value=!1}))}function B(e){e&&(r.value=e==r.value?"":e)}function T(){switch(m.value){case"1":l.value.sort(((e,a)=>e.nombreCliente.localeCompare(a.nombreCliente)));break;case"2":l.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":l.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function E(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function A(){if(r.value){const e=l.value.find((e=>e.idCliente==r.value));e&&(u.value=e.deudas.map((e=>e._id)))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona un cliente"})}function I(e){const a=e.idCliente,o=e._id;u.value.includes(o)?u.value.splice(u.value.indexOf(o),1):C.value&&a!=C.value?x().fire({icon:"info",title:"Oops...",text:"No puedes seleccionar deudas de diferentes clientes"}):u.value.push(o),z()}function z(){u.value.length>=1&&null==C.value&&(C.value=l.value.find((e=>e.deudas.some((e=>e._id===u.value[0])))).idCliente),0==u.value.length&&(C.value=null)}function S(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),n=("0"+a.getDate()).slice(-2),l=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+n+" "+l+":"+i+":"+r);return s}function H(){k.Z.post("impresora/abrirCajon")}function N(){let e=0,a=n.value.filter((e=>u.value.includes(e._id)));return e=a.reduce(((e,a)=>e+a.total-a.dejaCuenta),0),e}async function F(){if(0!=u.value.length){H();const e=N();await x().fire({title:"Dinero total: "+E(e,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a cobrar",cancelButtonText:"Cancelar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=u.value,o=[];try{p.dispatch("Cestas/setCestaBaseAction",v.value);const a=[];for(const t of e)a.push(n.value.find((e=>e._id===t)).cesta),o.push(n.value.find((e=>e._id===t)));k.Z.post("cestas/cestaDeudas",{cestas:a}).then((async e=>{e.data&&await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:h.value._id}).then((async a=>{let n=(0,t.Fl)((()=>p.state.Cestas.arrayCestas)),l=await(0,t.Fl)((()=>{if(n.value)for(let a=0;a<n.value.length;a++)if(n.value[a]._id==e.data)return n.value[a]}));(l.value.modo="PAGO DEUDA")&&(await k.Z.post("impresora/despedida",{precioTotal:N()}),p.dispatch("Deudas/setDeudasSeleccionadas",o),p.dispatch("ModalCobroView/abrirModalCobroView"))}))}))}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}}}))}else x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function P(){M(),c.value="",s.push("/main")}function U(){0!=u.value.length?x().fire({title:"Estas seguro?",html:"Se eliminarán "+u.value.length+" deudas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed){const e=u.value;try{const a=[];for(const o of e)a.push(await j(o));Promise.all(a).then((e=>{})),x().fire("Perfecto","Deuda eliminada correctamente","success")}catch(a){console.log("Error",a),x().fire("Oops...",a.message,"error")}P()}})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}async function j(e){const a=n.value.find((a=>a._id===e));try{const e=await k.Z.post("deudas/eliminarDeuda",{idDeuda:a._id,albaran:a.albaran});if(e.data.error)throw Error("No se ha podido pagar la deuda");return!0}catch(o){throw Error(o.message)}}function W(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input m-0">\n          </div>\n          <div id="fechas my-input-class" class="d-flex justify-content-between align-items-center m-1"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input m-0">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function O(e){const a=e.reduce(((e,a)=>e+a.total-a.dejaCuenta),0);return Math.round(100*a)/100}function V(){if(0==u.value.length)return void x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"});const e=[];for(const a of u.value)e.push(o.value.find((e=>e._id===a)));p.dispatch("Deudas/setDeudasToModal",e),_()}let R;async function $(){try{d.value.abrirModal(c.value),R=setInterval((()=>{c.value=d.value.getValue()[0],d.value.getValue()[1]||clearInterval(R)}),100)}catch(e){console.log(e),R=void 0}}return(0,t.YP)(i,(()=>{r.value="",u.value=[],C.value=null})),(0,t.YP)(y,(()=>{y.value||P()})),a({cargarDeudas:M,pagar:F,eliminar:U,sendToModalDeudas:V}),(0,t.bv)((()=>{M()})),{arrayDeudas:n,inputBusqueda:c,selectFiltro:m,filtrarLista:T,redondearDecimales:E,getFecha:S,imprimir:W,openKeyboard:$,keyboardRef:d,loading:w,openKeyboard:$,onClickDeuda:I,eliminar:U,seleccionados:u,arrayByClients:l,computedClientList:i,viewedDebts:r,displayDebtsClient:B,sumDebtClient:O,selectAllDebtsClient:A}}};const eu=(0,A.Z)(Xs,[["render",Qs],["__scopeId","data-v-2f1433f4"]]);var au=eu,ou={name:"ModalExtendidoClienteComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBIcon:M.vm,ListadoEncargosComponent:bs,ListadoDeudasComponent:au,MDBTabs:M.zk,MDBTabNav:M.JH,MDBTabItem:M.kX,MDBTabContent:M.oJ,MDBTabPane:M.jE},setup(e,{expose:a}){const o=(0,D.iH)(null),n=(0,D.iH)(null),l=(0,D.iH)(null);function i(){o.value=!0}function r(){o.value=!1}const s=(0,f.oR)(),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>u.value&&void 0!=d.value&&null!=d.value&&u.value[d.value]?u.value[d.value]:null)),m=(0,t.Fl)((()=>s.state.Cestas.arrayCestas)),p=(0,t.Fl)((()=>{if(m.value)for(let e=0;e<m.value.length;e++)if(u.value&&u.value[d.value]&&m.value[e]._id==u.value[d.value].idCesta)return m.value[e];return null}));function v(){l.value.pagar()}function g(){l.value.eliminar()}function b(){l.value.sendToModalDeudas()}function w(){n.value.recoger(p.value._id,c.value._id)}function h(){n.value.anular(c.value._id)}function C(){n.value.sendToModalEncargos()}(0,t.JJ)("cerrarModalExtendidoCliente",r);const y=(0,D.iH)("tab1");return a({abrirModal:i}),{modalExtendidoCliente:o,refListadoEncargos:n,refListadoDeudas:l,activeTabId:y,pagarDeuda:v,eliminarDeuda:g,recogerEncargo:w,anularEncargo:h,sendToModalDeudas:b,sendToModalEncargos:C}}};const tu=(0,A.Z)(ou,[["render",fr],["__scopeId","data-v-cd69a014"]]);var nu=tu,lu={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:M.Ff,MDBBtn:M.$v,MDBIcon:M.vm,ModalClientesComponent:vn.Z,ModalArticulosComponent:An,ModalNuevoCliente:cr.Z,ModalUnidadesComponent:Pn,CestaComponentVue:rn,ModalClientesSeleccionadoComponent:dr,ModalEncargosComponent:ei,ModalExtendidoClienteComponent:nu},setup(e,{expose:a}){const o=(0,f.oR)(),n=(0,t.Fl)((()=>o.state.Configuracion.parametros)),l=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),u=(0,D.iH)(null),d=(0,D.iH)(null),c=(0,D.iH)(null),m=(0,D.iH)(null),p=(0,D.iH)(null),v=(0,D.iH)(!1),g=(0,D.iH)(null),b=(0,D.iH)(!1),w=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),h=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),C=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),y=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),_=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let M="",B="";const T=(0,D.iH)(!1),E=(0,D.iH)(!0),A=(0,t.Fl)((()=>{if(h.value)for(let e=0;e<h.value.length;e++)if(C.value&&C.value[_.value]&&h.value[e]._id==C.value[_.value].idCesta)return h.value[e];return null})),I=(0,D.iH)(!1),z=(0,t.Fl)((()=>o.state.Stock.arrayStock)),S=(0,t.Fl)((()=>A.value?.idCliente||null)),H=(0,D.iH)(0),N=(0,D.iH)(0);function F(){null!=y.value&&void 0!=y.value&&A.value&&o.dispatch("Cestas/deleteIndex",{index:y.value,idCesta:A.value._id})}async function P(){A.value&&(o.dispatch("Cestas/deleteLista",A.value._id),await k.Z.post("impresora/saludo").catch((e=>{x().fire("Oops...",e.message,"error")})))}function U(){w.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function j(e){fn.Z.push(e)}function W(e){k.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");x().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function O(){if(h.value&&A.value)for(let e=0;e<h.value.length;e++)if(h.value[e]._id===A.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==A.value.modo){for(let e=0;e<h.value.length;e++)if(h.value[e].trabajador==C.value[_.value].idTrabajador&&"DEVOLUCION"!==h.value[e].modo){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:h.value[e]._id,idTrabajador:C.value[_.value]._id});break}}else{if("RECOGER ENCARGO"==A.value.modo)return void await V(A.value._id);if(h.value&&A.value)for(let e=0;e<h.value.length;e++)if(h.value[e]._id===A.value._id){const a=h.value[e].modo;let t=!1;o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),null!=A.value.idCliente&&(t=!0,o.dispatch("Cestas/setDescuentoAction",Number(0))),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),(t||"CONSUMO_PERSONAL"==a)&&k.Z.post("cestas/recalcularIvas",{idCesta:A.value._id}),o.dispatch("EstadoDinamico/reset");break}}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),o.dispatch("EstadoDinamico/reset");break}}async function V(e=null){if(!A.value)return;const a=e||A.value._id;k.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((e=>{x().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:C.value[o.state.Trabajadores.indexActivo]._id}).then((e=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}async function R(e){const a=u.value;a&&k.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((async a=>{a.data?l.value.selectCliente(a.data.id,a.data.nombre,a.data.albaran,a.data.vip):e&&13==e.length?x().fire({title:"Tarjeta sin cliente",text:"¿Desea crear un nuevo cliente?",icon:"warning",showCancelButton:!0,confirmButtonColor:"green",cancelButtonColor:"#d33",confirmButtonText:"Crear",cancelButtonText:"Cancelar"}).then((a=>{a.isConfirmed&&u.value.abrirModal(e)})):x().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}async function $(e){const a=await k.Z.post("encargos/getEncargoByNumber",{idEncargo:e});return!!a.data&&(s.value?.getEncargo(a.data._id),!0)}async function Z(e){if("Shift"==e)return null;if("Enter"==e){const e=await $(B);return e||R(M),M="",void(B="")}B+=e,M+=e}function q(){k.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(g.value=e.data[0]._id,k.Z.post("impresora/imprimirTicket",{idTicket:g.value}).catch((e=>{x().fire("Oops...",e.message,"error")}))):x().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}function L(){p.value=setTimeout((()=>{m.value.abrirModal(),p.value=null}),360)}function Y(){v.value=!0,setTimeout((()=>{v.value=!1}),70)}function K(){p.value&&!v.value&&(clearTimeout(p.value),l.value.abrirModal(),Y()),clearTimeout(p.value)}(0,t.JJ)("eliminarCestaActual",V),a({resetGeneral:O});const G=e=>{if("Shift"==e.key)return null;const a=document.activeElement;"Enter"===e.key&&a&&a.blur(),Z(e.key)};async function J(e){await k.Z.post("clientes/getCantidadEncargosDeudas",{idCliente:e}).then((e=>{e.data?(H.value=e.data.cantidadEncargos,N.value=e.data.cantidadDeudas):(H.value=0,N.value=0)})).catch((e=>{N.value=0,H.value=0}))}return(0,t.bv)((()=>{document.addEventListener("keydown",G),A.value&&(A.value.idCliente||"VENTA"!=A.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),A.value&&A.value.idCliente&&J(A.value.idCliente),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?(E.value="Si"==e.data?.params?.mesas,T.value="Si"==e.data?.params?.prohibirBuscarArticulos):(T.value=!1,E.value=!0),"Si"==e.data?.params?.textoStock&&(I.value=!0)}))})),(0,t.YP)(S,((e,a)=>{e!=a&&null!=e&&J(e)})),{indexActivoCesta:y,borrarItem:F,borrarLista:P,vistaEspecial:w,changeVistaCliente:U,cesta:A,goTo:j,refModalClientes:l,refModalArticulos:i,refModalUnidades:r,CestaComponent:d,resetGeneral:O,consultarPuntos:W,parametros:n,NoBuscarProducte:T,siMesas:E,imprimirUltimoTicket:q,idTicket:g,getCodigo:Z,refModalNuevoCliente:u,tarjetaClienteNumero:M,refModalClientesSeleccionado:c,clickEncargoAtajo:$,refModalEncargos:s,hayPagados:b,textoStock:I,arrayStock:z,startPress:L,endPress:K,opBloqueado:v,refModalExtendidoCliente:m,clienteSeleccionado:S,quantEncargo:H,quantDeuda:N}}};const iu=(0,A.Z)(lu,[["render",pn],["__scopeId","data-v-09a795ca"]]);var ru=iu;const su=e=>((0,t.dD)("data-v-4365756e"),e=e(),(0,t.Cn)(),e),uu={class:"row"},du={class:"nombreMesa d-inline-block text-truncate"},cu={key:0},mu={key:1},pu=["value"],fu={class:"row rowEstadoDatafono"},vu={class:"col colEstadoDatafono"},gu={class:"row"},bu={class:"disponible"},wu={class:"nodisponible"},hu={class:"again"},Cu={class:"esperandoVenta"},yu={key:4,class:"d-inline text-center grupoContento pt-1"},_u=su((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"100",height:"35"},null,-1))),Mu=[_u],Du={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},ku={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},Bu={key:7,class:"d-inline text-center grupoContento pt-1"},xu={class:"col-auto colEstadoCashlogy"},Tu={class:"w-100 h-100",style:{margin:"0 0.12rem"}},Eu={class:"row mt-1"},Au=su((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),Iu={class:"letraTotal ms-3 mt-2"},zu={class:"text-start fst-italic informacion"},Su={class:"nomTienda"};function Hu(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),d=(0,t.up)("CashlogyMenuNotificaciones"),c=(0,t.up)("modalCobroViewVue"),m=(0,t.up)("modalUltimosImportes");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",uu,[(0,t._)("div",du,[n.cesta&&n.cesta.indexMesa>=0&&n.arrayMesas[n.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",cu,(0,u.zw)(n.arrayMesas[n.cesta?.indexMesa].nombre),1)):(0,t.kq)("",!0),(n.cesta||n.cesta?.indexMesa||n.arrayMesas)&&n.arrayMesas[n.cesta?.indexMesa]?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",mu,(0,u.zw)(e.$t("en_tu_cesta","En tu cesta")),1))]),(0,t.wy)((0,t._)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.indiceTrabajadorActivo=e),class:"nombreTrabajador selecTrabajador",onChange:a[1]||(a[1]=e=>n.selectDependienta(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{key:a,dropdownDirection:"up",value:a},(0,u.zw)(n.arrayTrabajadores[a].nombre),9,pu)))),128))],544),[[v.bM,n.indiceTrabajadorActivo]])]),(0,t._)("div",fu,[(0,t._)("div",vu,[(0,t._)("div",gu,["ONLINE"!==n.estadoDatafono||n.use3g?"OFFLINE"!==n.estadoDatafono||n.use3g?"AGAIN"!==n.estadoDatafono||n.use3g?"PENDIENTE"!==n.estadoDatafono||n.use3g?"BUSCANDO"!==n.estadoDatafono||n.use3g?"APROBADA"!==n.estadoDatafono||n.use3g?"DENEGADA"!==n.estadoDatafono||n.use3g?n.Cashlogy_activado?((0,t.wg)(),(0,t.iD)("div",Bu)):(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",ku,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",Du,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"})])):((0,t.wg)(),(0,t.iD)("div",yu,Mu)):((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Cu,(0,u.zw)(n.procesoDatafono),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:2,outline:"warning",class:"botonEstado",onClick:a[4]||(a[4]=e=>n.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",hu,(0,u.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,onClick:a[3]||(a[3]=e=>{n.datafonoDisponible(),n.modalUltimosImportesRef.abrirModal(n.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",wu,(0,u.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:a[2]||(a[2]=e=>{n.datafonoDisponible(),n.modalUltimosImportesRef.abrirModal(n.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",bu,(0,u.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1}))])]),(0,t.wy)((0,t._)("div",xu,[(0,t._)("div",Tu,[(0,t.Wm)(d,{miniMenu:"",ref:"CashlogyMiniMenuRef"},null,512)])],512),[[v.F8,n.Cashlogy_activado&&n.showMiniMenuCashlogy]])]),(0,t._)("div",Eu,[n.cesta&&n.cesta.lista.length&&"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual&&"DEVOLUCION"===n.cesta.modo?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"primary",class:"botonPagar",disabled:n.disabledBtns,onClick:a[5]||(a[5]=e=>n.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),Au])),_:1},8,["disabled"])):n.cesta&&n.cesta.lista.length&&"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"primary",class:"botonPagar",disabled:n.disabledBtns,style:(0,u.j5)((n.getTotal(n.cesta)-n.dejaCuenta).toFixed(2)>=3e3&&!n.cesta?.idCliente?"color: darkgray; border-color: darkgray;":""),onClick:a[6]||(a[6]=e=>n.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",Iu,(0,u.zw)((n.getTotal(n.cesta)-n.dejaCuenta).toFixed(2))+" € ",1)])),_:1},8,["disabled","style"])):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==n.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:2,onClick:a[7]||(a[7]=e=>n.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=n.modoActual&&"MOVER_ARTICULO"!=n.modoActual&&n.cesta&&!n.cesta.lista.length?((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonPagar",onClick:a[8]||(a[8]=e=>n.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",zu,[(0,t.Uk)("("+(0,u.zw)(n.conexionInternet)+")(v"+(0,u.zw)(n.tocVersion)+") (",1),(0,t._)("a",Su,(0,u.zw)(n.nombreTienda),1),(0,t.Uk)(") "+(0,u.zw)(n.getClock),1)])]),(0,t.Wm)(c,{ref:"modalCobroViewVueRef"},null,512),(0,t.Wm)(m,{ref:"modalUltimosImportesRef"},null,512)],64)}var Nu=o(26762);const Fu=e=>((0,t.dD)("data-v-66e63997"),e=e(),(0,t.Cn)(),e),Pu=Fu((()=>(0,t._)("div",{class:"d-inline text-center mx-auto pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"300"})],-1))),Uu=Fu((()=>(0,t._)("h2",{class:"text-center mb-3"},"Últimos Importes",-1))),ju={key:0,class:"Resultados d-flex flex-column col-8 mx-auto"},Wu={class:"col-12"},Ou=["onClick"],Vu={class:"m-0"},Ru={class:"m-0"},$u={class:"m-0"},Zu={class:"m-0"},qu={class:"tcodPos"},Lu={class:"divMain"},Yu=Fu((()=>(0,t._)("span",{class:"h3 mb-3"},"Información de PayTef",-1))),Ku=Fu((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Datos de la transacción ",-1))),Gu={class:"info paytef col-10 mx-auto"},Ju=Fu((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Información de transacción:")],-1))),Qu={class:"m-0"},Xu={class:"m-0"},ed={class:"m-0"},ad={class:"m-0"},od={class:"m-0"},td=Fu((()=>(0,t._)("hr",null,null,-1))),nd={class:"info paytef col-10 mx-auto"},ld=Fu((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Datos bancarios:")],-1))),id={class:"m-0"},rd={class:"m-0"},sd=Fu((()=>(0,t._)("span",{class:"h3 mb-3"},"Información del ticket",-1))),ud=Fu((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Productos del ticket ",-1))),dd={class:"col-12"},cd={class:"ms-2 me-auto"},md={class:"col-12"},pd={class:"text-truncate"},fd={class:"ms-2"},vd={class:"ms-2 me-auto text-truncate"},gd={class:"ms-2 me-auto mb-0"};function bd(e,a,o,n,l,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBIcon"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal"),v=(0,t.up)("MDBBadge"),g=(0,t.up)("MDBListGroupItem"),b=(0,t.up)("MDBListGroup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(f,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalUltimosImportes,"onUpdate:modelValue":a[1]||(a[1]=e=>n.modalUltimosImportes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Datos del datáfono")])),_:1})])),_:1}),n.loading?((0,t.wg)(),(0,t.j4)(d,{key:0,style:{"align-self":"center"}},{default:(0,t.w5)((()=>[Pu])),_:1})):((0,t.wg)(),(0,t.j4)(d,{key:1},{default:(0,t.w5)((()=>[Uu,(n.importeEncontrado,(0,t.wg)(),(0,t.iD)("div",ju,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.array,((e,a)=>((0,t.wg)(),(0,t.iD)("div",Wu,[(0,t._)("div",{class:"d-flex justify-content-between border border-2 p-2",style:(0,u.j5)([{"margin-bottom":"2%"},e.approved?"background-color:rgb(5 213 5 / 20%)":"background-color: rgb(227 100 100 / 20%)"]),onClick:o=>n.abrirModalDetallesImpote(a,e.reference)},[(0,t._)("p",Vu,"#"+(0,u.zw)(a+1),1),(0,t._)("p",Ru,"Fecha: "+(0,u.zw)(e.timestamp),1),(0,t._)("p",$u,"Núm Ticket: "+(0,u.zw)(e.reference),1),(0,t._)("p",Zu,"Precio: "+(0,u.zw)(e.amountWithSign)+" €",1),(0,t._)("div",null,[(0,t.Wm)(c,{icon:e.approved?"check-circle":"times-circle",style:(0,u.j5)(e.approved?"color: #33bf61":"color: red;")},null,8,["icon","style"])])],12,Ou)])))),256))]))])),_:1})),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t._)("p",qu,"TCod: "+(0,u.zw)(n.tcod),1),(0,t.Wm)(m,{color:"secondary",onClick:a[0]||(a[0]=e=>n.modalUltimosImportes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:n.modalDetallesImporte,"onUpdate:modelValue":a[3]||(a[3]=e=>n.modalDetallesImporte=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" Ref. Paytef #"+(0,u.zw)(n.selectedTicket.reference),1)])),_:1}),n.selectedTicket.approved?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(m,{key:0,class:"ms-auto ms-4 modalHeader",color:"danger",onClick:a[2]||(a[2]=e=>n.tarjetaTicketById(n.selectedTicket.reference))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1}))])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",Lu,[(0,t._)("div",null,[Yu,Ku,(0,t._)("div",Gu,[Ju,(0,t._)("p",Qu,[(0,t.Wm)(c,{icon:"server"}),(0,t._)("span",{style:(0,u.j5)(1==n.selectedTicket.approved?"color:seagreen;":"color:indianred;")},"   "+(0,u.zw)(1==n.selectedTicket.approved?"Aprobado ✓":"Denegado ✖"),5)]),(0,t._)("p",Xu,[(0,t.Wm)(c,{icon:"calendar-alt"}),(0,t.Uk)("    "+(0,u.zw)(n.fechaImporte),1)]),(0,t._)("p",ed,[(0,t.Wm)(c,{icon:"question"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.typeName),1)]),(0,t._)("p",ad,[(0,t.Wm)(c,{icon:"clipboard-check"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.reference),1)]),(0,t._)("p",od,[(0,t.Wm)(c,{icon:"euro-sign"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.amountWithSign)+" € ",1)])]),td,(0,t._)("div",nd,[ld,(0,t._)("p",id,[(0,t.Wm)(c,{icon:"university"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.issuerNameAndCountry),1)]),(0,t._)("p",rd,[(0,t.Wm)(c,{icon:"credit-card"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.hiddenCardNumber),1)]),(0,t._)("p",null,[(0,t.Wm)(c,{icon:"globe-europe"}),(0,t.Uk)("    "+(0,u.zw)(n.selectedTicket.country),1)])])]),(0,t._)("div",null,[sd,ud,(0,t._)("div",dd,[(0,t.Wm)(b,{light:"",class:"productos"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.productosArray,((e,a)=>((0,t.wg)(),(0,t.j4)(g,{class:"d-flex justify-content-between align-items-center"},{default:(0,t.w5)((()=>[(0,t._)("div",cd,[(0,t._)("div",md,[(0,t._)("span",pd,(0,u.zw)(e.nombre),1),(0,t._)("span",fd,"x"+(0,u.zw)(e.unidades),1)]),null!=e.arraySuplementos?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",vd," - "+(0,u.zw)(e.nombre.replace("(","")),1)))),256)):(0,t.kq)("",!0),null!=e.promocion?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(e.promocion.grupos.flat(),(a=>((0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("p",gd,(0,u.zw)(a.nombre)+" x"+(0,u.zw)(e.unidades*a.unidades),1)])))),256)):(0,t.kq)("",!0)]),(0,t.Wm)(v,{class:"badge-primary",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.subtotal)+" €",1)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])])])])),_:1}),(0,t.Wm)(p)])),_:1},8,["modelValue"])],64)}var wd=o(36797),hd=o.n(wd),Cd={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,MDBIcon:M.vm,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalFooter:M.ab,MDBListGroup:M.d8,MDBListGroupItem:M.FQ,MDBBadge:M.m_},setup(e,a){const o=(0,f.oR)(),n=(0,D.iH)(!1),l=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),u=(0,D.iH)([]),d=(0,D.iH)("cargando..."),c=(0,D.iH)(null),m=(0,D.iH)([]),p=(0,t.Fl)((()=>o.state.Caja.arrayVentas)),v=(0,D.iH)(!0),g=(0,D.iH)(null);function b(e){g.value=e,n.value=!0,y()}async function w(){for(const e of m.value){let{year:a,month:o,day:t,hour:n,minute:l,second:i,millisecond:r}=e.timestamp,s=`${a}-${(o<10?"0":"")+o}-${(t<10?"0":"")+t} ${(n<10?"0":"")+n}:${(l<10?"0":"")+l}:${(i<10?"0":"")+i}.${(r<10?"0":"")+r}`;e["timestamp"]=s}}async function h(e,a){try{C.value=m.value[e],hd().locale("es"),s.value=hd()(new Date(C.value.timestamp)).format("LLL"),u.value=await(0,t.Fl)((()=>p.value.find((e=>e._id==a)).cesta.lista)).value,l.value=!0}catch(o){console.log(o)}}const C=(0,D.iH)(null);async function y(){await k.Z.post("paytef/getLastFive").then((async e=>{e.data&&(m.value=e.data.reverse(),await w(),v.value=!1)}))}function _(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function M(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}function B(e){k.Z.post("paytef/cobrarTicketById",{idTrabajador:g.value.idTrabajador,idTicket:e}).then((()=>{o.dispatch("Datafono/setEstado","PENDIENTE"),n.value=!1,l.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:b}),(0,t.bv)((async()=>{d.value=await k.Z.post("parametros/getParametros").then((e=>e.data.payteftcod))})),{modalUltimosImportes:n,importeEncontrado:i,importe:r,tcod:d,fecha:c,array:m,productosArray:u,modalDetallesImporte:l,abrirModalDetallesImpote:h,selectedTicket:C,fechaImporte:s,loading:v,recortarNombreArtPrinc:_,recortarNombreArtSec:M,tarjetaTicketById:B,trabajadorActivo:g}}};const yd=(0,A.Z)(Cd,[["render",bd],["__scopeId","data-v-66e63997"]]);var _d=yd,Md=o(69523),Dd={name:"MenuDerechaComponent",components:{MDBIcon:M.vm,MDBBtn:M.$v,MDBSelect:M.R3,modalCobroViewVue:Nu.Z,modalUltimosImportes:_d,MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,CashlogyMenuNotificaciones:Md.Z},setup(){const e=(0,D.iH)(""),a=(0,D.iH)(""),o=(0,D.iH)(""),n=(0,f.oR)(),l=(0,D.iH)(!1),i=(0,D.iH)(null),r=(0,Ta.tv)(),s=(0,D.iH)([]),u=(0,t.Fl)((()=>n.state.Cestas.Descuento)),d=(0,t.f3)("resetGeneral"),c=(0,D.iH)(""),m=(0,D.iH)(null),p=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),v=(0,D.iH)(null),g=(0,t.Fl)((()=>!(!v.value?.mini_menu_activo||!(l.value||["ONLINE","OFFLINE","BUSCANDO"].indexOf(B.value)>=0)))),b=(0,D.iH)(!1);(0,t.bv)((async()=>{b.value=await(v.value?.activado())}));const w=(0,t.Fl)((()=>{if(n.state.ModalCobroView.modalCobroViewAbierto)return!0}));(0,t.m0)((()=>{w.value&&i.value.abrirModal()}));let h=!1;async function C(){if(!h){try{let e=(await k.Z.post("checkers/internet_with_pings")).data;c.value=e?"🟢":"🔴"}catch(e){}setTimeout(C,1e4)}}(0,t.Ah)((()=>{h=!0})),C();const y=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),_=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),M=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),B=(0,t.Fl)((()=>n.state.Datafono.estado)),T=(0,t.Fl)((()=>n.state.Datafono.procesoActual)),E=(0,t.Fl)((()=>n.state.modoActual)),A=(0,t.Fl)((()=>y.value&&void 0!=M.value&&null!=M.value&&y.value[M.value]?y.value[M.value]:null)),I=(0,t.Fl)((()=>{if(_.value)for(let e=0;e<_.value.length;e++)if(y.value&&y.value[M.value]&&_.value[e]._id==y.value[M.value].idCesta)return _.value[e];return null})),z=(0,t.Fl)((()=>n.state.Deudas.deudasSeleccionadas)),S=(0,t.Fl)((()=>n.state.Encargos.encargoSeleccionado)),H=(0,t.Fl)((()=>{if(z.value.length>0){let e=0;for(const a of z.value)a.dejaCuenta&&(e+=a.dejaCuenta);return e}return S.value&&"RECOGER ENCARGO"==I?.value?.modo&&S.value.dejaCuenta||0})),N=(0,D.iH)(!1);function F(e){n.dispatch("Trabajadores/setIndexActivo",Number(e.target.value)),O("/main")}function P(e){let a=0;return e.forEach((e=>{a+=e.subtotal})),a=Math.round(100*a)/100,a}function U(e){const a=e.detalleIva,o=Object.keys(a).filter((e=>e.startsWith("importe"))).reduce(((e,o)=>e+a[o]),0);return Number(o.toFixed(2))}function j(){k.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");s.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function W(){"PENDIENTE"!=B.value&&(n.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((e=>n.dispatch("Datafono/setEstado",e.data))).catch((e=>n.dispatch("Datafono/setEstado","OFFLINE"))))}function O(e){r.push(e)}function V(){let e=!1;I.value&&I.value.lista.length>0&&I.value.lista.forEach((a=>{if(a?.regalo)return e=!0,void Z()})),e||(k.Z.post("impresora/abrirCajon"),x().fire("AVISO","elige un artículo para ir a cobrar","info"))}function R(){k.Z.post("articulos/saveTeclas"),n.dispatch("setModoActual","NORMAL")}function $(){k.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:A.value._id}).then((()=>{n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function Z(){if((U(I.value)-H.value).toFixed(2)>=3e3&&!I.value?.idCliente)return x().fire({title:"Cliente Requerido",text:"Para cobrar mas de 3000€, debe seleccionar un cliente de facturación.",icon:"info"});if(!n.state.Procesando.clickTecla)if(Y(),I.value.idCliente&&"RECOGER ENCARGO"!==I.value.modo)try{const{nombreCliente:e,lista:a,_id:o,idCliente:t}=I.value,n=P(a);if("Too Good To Go Spain S.L.U. "===e){if(n<12)return void x().fire({title:"Promoción Requerida",text:"Para proceder con el cobro, debe aplicar la promoción 3.99€ del Too Good To Go. El importe mínimo es de 12€",icon:"warning"});3.99!==n&&await k.Z.post("/cestas/recalcularIvas",{idCesta:o})}q()}catch(e){q()}else q()}async function q(){if((U(I.value)-H.value).toFixed(2)>=3e3&&!I.value?.idCliente)return x().fire({title:"Cliente Requerido",text:"Para cobrar mas de 3000€, debe seleccionar un cliente de facturación.",icon:"info"});const e=JSON.parse(JSON.stringify(I.value.lista));try{if(I.value){const a=U(I.value);if("VENTA"===I.value.modo||"RECOGER ENCARGO"==I.value.modo)if(I.value.idCliente&&""!=I.value.idCliente){const e=(await k.Z.post("clientes/getClienteById",{idCliente:I.value.idCliente})).data;e?.albaran&&e?.noPagaEnTienda?k.Z.post("albaranes/crearAlbaran",{total:a,cestaFrontEnd:I.value,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");x().fire({icon:"success",title:"Albaran registrada correctamente",showConfirmButton:!1,timer:1500}),await k.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{x().fire("Oops...",e.message,"error")}))})).catch((e=>{x().fire("Oops...",e.message,"error")})):e?.noPagaEnTienda?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,estado:"NO_PAGA_EN_TIENDA",tipo:"DEUDA",tkrsData:null}).then((e=>{if(!e.data)throw Error("No se ha podida registrar la venta en modo deuda");x().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:1500})})):(await k.Z.post("impresora/abrirCajon"),i.value.abrirModal())}else e.every((e=>e.pagado))?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,tipo:"HONEI",tkrsData:null}):(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal());else"DEVOLUCION"===I.value.modo?k.Z.post("devoluciones/nuevaDevolucion",{total:a,idCesta:I.value._id,idTrabajador:A.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await x().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),d()})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===I.value.modo&&0==a?k.Z.post("tickets/crearTicket",{total:a,idCesta:I.value._id,idTrabajador:A.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");x().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"==I.value.modo&&a>0&&(await k.Z.post("impresora/abrirCajon"),await k.Z.post("impresora/despedida",{precioTotal:a}),i.value.abrirModal())}else x().fire("Oops...","El modo de la cesta es incorrecto","error")}catch(a){}finally{setTimeout((()=>{L()}),500)}}function L(){N.value=!1}function Y(){N.value=!0}function K(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),n=e.getHours();o.value=("0"+n).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(K,1e3),(0,t.bv)((async()=>{j(),W(),k.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{x().fire("Error en getVersion CATCH")})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.tipoDatafono?"3G"==e.data?.tipoDatafono&&(l.value=!0):l.value=!1}))})),{trabajadorActivo:A,DescuentoCliente:u,estadoDatafono:B,DescuentoCliente:u,cesta:I,arrayMesas:s,getTotal:U,goTo:O,abrirCajon:V,tarjetaUltimoTicket:$,modoActual:E,handleCobro:q,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:R,datafonoDisponible:W,procesoDatafono:T,use3g:l,selectDependienta:F,modalCobroViewVueRef:i,arrayTrabajadores:y,conexionInternet:c,modalUltimosImportesRef:m,handleCobroCondicional:Z,abrirModalCobroView:w,indiceTrabajadorActivo:p,disabledBtns:N,enableBtns:L,disableBtns:Y,CashlogyMiniMenuRef:v,showMiniMenuCashlogy:g,Cashlogy_activado:b,dejaCuenta:H}}};const kd=(0,A.Z)(Dd,[["render",Hu],["__scopeId","data-v-4365756e"]]);var Bd=kd,xd=o(32066),Td=o(48466);const Ed={class:"container"},Ad={class:"h3 text-center"},Id={key:0,class:"row mt-2 container"},zd=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),Sd={class:"h5",style:{"text-align":"center"}},Hd={key:1,class:"row mt-2 container"},Nd={class:"h3"},Fd={key:0,class:"d-inline text-center grupoContento pt-1"},Pd=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),Ud=[Pd],jd={key:1,class:"h5",style:{"text-align":"center",color:"red"}},Wd={class:"again py-5"},Od={class:"again py-5"};function Vd(e,a,o,n,l,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),d=(0,t.up)("MDBModal"),c=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(d,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:n.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>n.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ed,[(0,t._)("p",Ad,(0,u.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),n.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",Id,[zd,(0,t._)("span",Sd,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,u.zw)(n.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),n.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Hd,[(0,t._)("p",Nd,(0,u.zw)(e.$t("seleccione","seleccione"))+":",1),n.tryCount>0?((0,t.wg)(),(0,t.iD)("div",Fd,Ud)):(0,t.kq)("",!0),n.tryCount>3?((0,t.wg)(),(0,t.iD)("span",jd,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),n.tryCount<=0?((0,t.wg)(),(0,t.j4)(r,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>n.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",Wd,(0,u.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(r,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>n.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",Od,(0,u.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var Rd={name:"modalDatafonoConexion",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalErrorDatafonoQueHacerComponent:Td.Z},setup(e,{expose:a}){const o=(0,D.iH)(0),n=(0,D.iH)(!0),l=(0,D.iH)(0),i=(0,D.iH)(null),r=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,f.oR)(),u=(0,D.iH)(0),d=(0,D.iH)(!1),c=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>c.value&&void 0!=m.value&&null!=m.value&&c.value[m.value]?c.value[m.value]:null));function p(e){u.value=e,d.value=!0,g(),s.dispatch("Datafono/setEstado","OFFLINE")}async function v(){try{x().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){await k.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});x().fire("OK","¡El datáfono se ha apagado correctamente!","success"),d.value=!1}}))}catch(e){x().fire("Oops...",e.message,"error")}}async function g(){n.value=!0,l.value=60;let e=!1,a=!1,o=setInterval((async()=>{e||(l.value-=1,await k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async t=>{e||"ONLINE"===t.data&&(s.dispatch("Datafono/setEstado","ONLINE"),a||(a=!0,await k.Z.post("paytef/comprobarUltimoTicket",{idticket:u.value}).then((a=>{e||(clearInterval(o),e=!0,i.value.abrirModal(u.value,a.data),d.value=!1)})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),a=!1))})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),e||l.value<=0&&(clearInterval(o),e=!0,x().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),n.value=!1))}),1e3)}async function b(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async e=>"OFFLINE"===e.data&&o.value<10?b():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await k.Z.post("paytef/comprobarUltimoTicket",{idticket:u.value}).then((e=>{i.value.abrirModal(u.value,e.data),d.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:d,apagarDatafono:v,reconectarDatafon:b,estadoDatafono:r,tryCount:o,ModalErrorQueHacerRef:i,conexionAutomatica:n,counterAutomatico:l}}};const $d=(0,A.Z)(Rd,[["render",Vd]]);var Zd=$d,qd=(o(43666),{name:"MainView",components:{MenusComponent:N,SubmenusComponent:R,TeclasComponent:Ia,CestaComponent:rn,MenuIzquierdaComponent:ru,MenuDerechaComponent:Bd,modalDatafonoConexion:Zd,ModalErrorDatafonoVentaComponent:Td.Z},setup(){const e=(0,Ta.tv)(),a=(0,D.iH)(null),o=(0,D.iH)(null),n=(0,D.iH)(null),l=(0,D.iH)(null),i=(0,D.iH)(null);function r(e){a.value.clickTecla(e)}const s=(0,f.oR)(),u=(0,xd.io)("http://"+s.state.TocGameURL+":5051"),d=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>d.value&&void 0!=c.value&&null!=c.value&&d.value[c.value]?d.value[c.value]:null));function p(){o.value.resetGeneral()}function v(){n.value.actualizarPuntos()}function g(e){a.value.postDisabledTecla(e)}return(0,t.JJ)("clickTecla",r),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",v),(0,t.JJ)("postDisabledTecla",g),u.on("consultaPaytefRefund",(e=>{try{e.ok}catch(a){}})),u.on("consultaPaytef",(e=>{e.valid})),(0,t.bv)((async()=>{k.Z.get("caja/estadoCaja").then((a=>{1==a.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id&&e.push("/menu/fichajes"):e.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:d,indexTrabajadorActivo:c,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:n,modalErrorConexionDatafonoRef:l,modalErrorVentaDatafonoRef:i}}});const Ld=(0,A.Z)(qd,[["render",s]]);var Yd=Ld}}]);
//# sourceMappingURL=999.9026166f.js.map