"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[0],{44e3:function(a,e,t){t.d(e,{Z:function(){return ua}});var o=t(73396),l=t(87139);const i=a=>((0,o.dD)("data-v-e053e5be"),a=a(),(0,o.Cn)(),a),r={class:"row"},s={class:"row mt-2"},n={class:"col-md-3"},d={class:"text-center"},u={class:"mt-4"},c={id:"detalleTicket"},m={class:"contencionTicket"},v={class:"table"},p={class:"titulosTicket"},f={class:"titulosTicket"},g={class:"titulosTicket"},b=i((()=>(0,o._)("hr",null,null,-1))),C={class:"sizeLetrasCambio"},T={key:0,class:"sizeLetrasCambio"},w={key:1,class:"estiloFalta sizeLetrasCambio"},k={key:2,class:"estiloPerfecto sizeLetrasCambio"},_={key:3,class:"estiloSobra sizeLetrasCambio"},h={class:"col-md-9",style:{"padding-left":"4vmin"}},D={class:"row"},y={class:"col text-end",style:{"margin-top":"2vmin"}},E=["src","onClick"],A={class:"row mt-2"},F={class:"col text-end",style:{"margin-top":"2vmin"}},P=["src","onClick"],j={class:"row"},z={class:"col mt-4"},O={class:"divBotones"},V=["disabled"],M=["disabled"],B=["disabled"],R=["disabled"],I={class:"row"},N={class:"cantidad text-center"},S={class:"row mt-2"},x={class:"col text-center"},H={key:0,class:"estadoPaytef"},Z=i((()=>(0,o._)("h3",null,"Estado:",-1))),W={style:{"margin-top":"1vm","font-weight":"300",color:"orangered","font-size":"1.3em"}},$={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function J(a,e,t,i,J,G){const L=(0,o.up)("MDBCardTitle"),U=(0,o.up)("MDBCardText"),q=(0,o.up)("MDBBtn"),K=(0,o.up)("MDBCardBody"),Y=(0,o.up)("MDBCard"),Q=(0,o.up)("ModalTkrsComponent"),X=(0,o.up)("NumpadComponent"),aa=(0,o.up)("MDBModalBody"),ea=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(ea,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:i.modalCobro,"onUpdate:modelValue":e[9]||(e[9]=a=>i.modalCobro=a),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,o.w5)((()=>[(0,o.Wm)(aa,{style:{"background-color":"#fff5e9"}},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",s,[(0,o._)("div",n,[(0,o.Wm)(Y,{class:"cardInfoCambio",style:{height:"80vmin"}},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{style:{display:"flex","flex-direction":"column","justify-content":"space-evenly"}},{default:(0,o.w5)((()=>[(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o._)("h2",d,(0,l.zw)(a.$t("ticket","Ticket"))+":",1)])),_:1}),(0,o._)("div",u,[(0,o._)("div",c,[(0,o._)("div",m,[(0,o._)("table",v,[(0,o._)("tr",null,[(0,o._)("th",p,(0,l.zw)(a.$t("producto","Producto")),1),(0,o._)("th",f,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",g,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.productos,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,style:(0,l.j5)(a.pagado?"text-decoration: line-through":"")},[(0,o._)("td",null,(0,l.zw)(a.nombre),1),(0,o._)("td",null,(0,l.zw)((a.subtotal-a.subtotal*i.DescuentoCliente).toFixed(2))+" € ",1),(0,o._)("td",null,(0,l.zw)(a.unidades),1)],4)))),128))])]),b])]),(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o._)("li",C,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*(i.aPagar+i.dejaCuenta))/100).toFixed(2))+" € ",1),null!=i.cantidadTkrs&&void 0!=i.cantidadTkrs?((0,o.wg)(),(0,o.iD)("li",T,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(i.totalRecibido+i.cantidadTkrs+i.dejaCuenta).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta>0?((0,o.wg)(),(0,o.iD)("li",w,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*i.cuenta)/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&0==i.cuenta?((0,o.wg)(),(0,o.iD)("li",k,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0?((0,o.wg)(),(0,o.iD)("li",_,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(i.aPagar-i.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0)])),_:1}),(0,o._)("div",null,[(0,o.Wm)(q,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>i.deshacer()),class:"sizeBotones"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,o.Wm)(q,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>i.limpiar())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])])),_:1})])),_:1})]),(0,o._)("div",h,[(0,o._)("div",D,[(0,o._)("div",y,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([.01,.02,.05,.1,.2,.5,1,2],(a=>(0,o._)("img",{src:"/img/"+(a<1?100*a+"cts":1==a?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:e=>i.sumar(a)},null,8,E))),64))])]),(0,o._)("div",A,[(0,o._)("div",F,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([5,10,20,50,100,200,500],(a=>(0,o._)("img",{src:"/img/"+a+"euros.png",class:"sizeBilletes",onClick:e=>i.sumar(a)},null,8,P))),64))])]),(0,o._)("div",j,[(0,o._)("div",z,[(0,o._)("div",O,[(0,o._)("img",{disabled:i.loading,src:"img/img-efectivo.png",onClick:e[2]||(e[2]=a=>i.setFormaPago("EFECTIVO")),style:(0,l.j5)("EFECTIVO"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,12,V),i.modalTkrsRef&&!i.prohibirTkRestaurant?((0,o.wg)(),(0,o.iD)("img",{key:0,disabled:i.loading,src:"img/img-tkrs.png",onClick:e[3]||(e[3]=a=>i.loading?null:i.modalTkrsRef.abrirModal()),style:(0,l.j5)("TKRS"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,12,M)):(0,o.kq)("",!0),0===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:1,disabled:i.loading,src:"img/img-tarjetas.png",onClick:e[4]||(e[4]=a=>i.setFormaPago("TARJETA")),style:(0,l.j5)("TARJETA"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,12,B)):(0,o.kq)("",!0),1===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:2,disabled:i.loading,src:"img/img-3g.png",onClick:e[5]||(e[5]=a=>i.setFormaPago("DATAFONO_3G")),style:(0,l.j5)("DATAFONO_3G"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,12,R)):(0,o.kq)("",!0)])])])])])]),(0,o.Wm)(Q,{ref:"modalTkrsRef"},null,512),(0,o.Wm)(ea,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:i.modalNumpad,"onUpdate:modelValue":e[6]||(e[6]=a=>i.modalNumpad=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(aa,null,{default:(0,o.w5)((()=>[(0,o._)("div",I,[(0,o._)("span",N,(0,l.zw)(),1)]),(0,o._)("div",S,[(0,o._)("div",x,[(0,o.Wm)(X,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(q,{class:"ms-2 botoncicos-abajo",disabled:i.loading,color:"warning",onClick:e[7]||(e[7]=a=>i.cancelarVenta())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("volver","VOLVER")),1)])),_:1},8,["disabled"]),i.loading?((0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("div",null,[Z,(0,o._)("span",W,(0,l.zw)(i.procesoDatafono),1)])])):(0,o.kq)("",!0),(0,o.Wm)(q,{class:"botonCobrar botoncicos-abajo",color:"primary",disabled:i.loading,onClick:e[8]||(e[8]=a=>i.cobrar()),style:{right:"4vmin"}},{default:(0,o.w5)((()=>[i.loading?((0,o.wg)(),(0,o.iD)("span",$)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,l.zw)(a.$t("pagar","Pagar")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])}t(57658);var G=t(44870),L=t(79066),U=t(32374),q=t(38020),K=t(42492),Y=t.n(K),Q=t(61837),X=t(91076),aa=t(74313),ea=t(20065),ta=t(22483),oa=t(92136);function la(a,e,t,o,l){oa.socket.emit("logFrontend",a,e,t,o,l)}let ia={Debug:function(a,e,t,o){la("Debug",a,e,t,o)},Trace:function(a,e,t,o){la("Trace",a,e,t,o)},Info:function(a,e,t,o){la("Info",a,e,t,o)},Warn:function(a,e,t,o){la("Warn",a,e,t,o)},Error:function(a,e,t,o){la("Error",a,e,t,o)},Fatal:function(a,e,t,o){la("Fatal",a,e,t,o)},Log:function(a,e,t,o,l){la(a,e,t,o,l)}};var ra=ia,sa={name:"CobroView",components:{CambioComponent:L.Z,MDBCard:aa.Yl,MDBBtn:aa.$v,MDBCardBody:aa.H7,MDBCardText:aa.Pp,NumpadComponent:Q.Z,VolverComponent:U.Z,ModalTkrsComponent:q.Z,MDBIcon:aa.vm,MDBModal:aa.j3,MDBModalBody:aa.Yz},setup(a,{expose:e}){const t=(0,ea.oR)(),l=(0,G.iH)(!1),i=(0,G.iH)(!1),r=(0,ta.tv)(),s=(0,o.Fl)((()=>t.state.Datafono.procesoActual)),n=(0,G.iH)(null),d=(0,G.iH)("EFECTIVO"),u=(0,G.iH)(0),c=(0,G.iH)(null),m=(0,G.iH)(!1),v=(0,G.iH)(!1),p=(0,G.iH)(!1),f=(0,G.iH)(0),g=(0,G.iH)(!1),b=(0,G.iH)(0),C=(0,G.iH)(0),T=(0,G.iH)([]),w=(0,o.Fl)((()=>j.value?.lista)),k=((0,o.f3)("resetGeneral"),(0,G.iH)(null));let _=(0,o.Fl)((()=>C.value-f.value<0?0:C.value-(b.value+f.value)));const h=(0,o.Fl)((()=>t.state.Trabajadores.indexActivo)),D=(0,o.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),y=(0,o.Fl)((()=>t.state.Cestas.arrayCestas)),E=(0,o.Fl)((()=>{const a=t.state.Cestas.Descuento;return void 0===a||isNaN(a)?0:a})),A=(0,o.Fl)((()=>D.value&&void 0!=h.value&&null!=h.value&&D.value[h.value]?D.value[h.value]:null)),F=(0,o.Fl)((()=>t.state.Deudas.deudasSeleccionadas)),P=(0,o.Fl)((()=>{if(F.value.length>0){let a=0;for(const e of F.value)e.dejaCuenta&&(a+=e.dejaCuenta);return a}return 0}));let j=(0,G.iH)(null);function z(a){f.value=Number(a),a>=Z(j.value)?d.value="TKRS":d.value="EFECTIVO"}function O(a){g.value||(f.value<Z(j.value)?"TARJETA"===a&&f.value>0?Y().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):d.value=a:Y().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error"))}async function V(a){j=(0,o.Fl)((()=>{if(y.value)for(let a=0;a<y.value.length;a++)if(y.value[a]._id==D.value[h.value].idCesta)return y.value[a];return null}));const e=j.value?j.value.lista.filter((a=>a.pagado)).reduce(((a,e)=>a+e.subtotal),0):0;C.value=j.value?Z(j.value)-e:0,l.value=!0}async function M(){g.value?ra.Warn(`cobrar loading.value: ${g.value}`,"modalCobroView.vue"):(g.value=!0,ra.Info("cobrar inicio","modalCobroView.vue"),"PAGO DEUDA"==j.value.modo?await B():await R())}async function B(){try{let a;if(a="TARJETA"==d.value?await X.Z.post("deudas/crearPagoDeudaPaytef",{total:Z(j.value),idCesta:j.value._id,idTrabajador:A.value._id,tipo:d.value,tkrsData:{cantidadTkrs:f.value,formaPago:"EFECTIVO"},arrayDeudas:F.value}):await X.Z.post("deudas/crearPagoDeuda",{total:Z(j.value),idCesta:j.value._id,idTrabajador:A.value._id,tipo:d.value,tkrsData:{cantidadTkrs:f.value,formaPago:"EFECTIVO"},arrayDeudas:F.value}),!a.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el pago de deuda")}Y().fire({icon:"success",title:"Pago deuda registrada correctamente",showConfirmButton:!1,timer:500}),await X.Z.post("impresora/saludo").catch((a=>{Y().fire("Oops...",a.message,"error")})),N(),await H(j.value._id),d.value="EFECTIVO",x(!0)}catch(a){Y().fire("Oops...",a.message,"error")}g.value=!1,L()}async function R(){try{const a=JSON.parse(JSON.stringify(j.value.lista)),e=a.some((a=>a.pagado));let o;const l="PAGO SEPARADO"==j.value.modo;if("TARJETA"==d.value?(t.dispatch("Datafono/setEstado","PENDIENTE"),o=await X.Z.post("tickets/crearTicketPaytef",{total:Z(j.value),idCesta:j.value._id,idTrabajador:A.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*f.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e})):o=await X.Z.post("tickets/crearTicket",{total:Z(j.value),idCesta:j.value._id,idTrabajador:A.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*f.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e}),!o.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el ticket")}Y().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),await X.Z.post("impresora/saludo").catch((a=>{Y().fire("Oops...",a.message,"error")})),p.value&&"TARJETA"!=d.value&&await X.Z.post("tickets/getUltimoTicket").then((async a=>{a.data[0]?._id?await X.Z.post("impresora/imprimirTicket",{idTicket:a.data[0]?._id}).catch((a=>{Y().fire("Oops...",a.message,"error")})):Y().fire("AVISO","Crea un ticket en esta caja abierta","info")})),console.log(l,"cestaPagoSeparado"),l&&await H(j.value._id),I(),d.value="EFECTIVO",x(!0)}catch(a){Y().fire("Oops...",a.message,"error")}g.value=!1,L(),ra.Info("cobrar fin","modalCobroView.vue")}function I(){let a=!1;y.value.forEach((e=>{if(!a&&e.trabajador===D.value[h.value]._id&&"DEVOLUCION"!=e.modo){a=!0;let t=e._id;X.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t,idTrabajador:D.value[h.value]._id})}}))}function N(){t.dispatch("Deudas/deleteDeudasSeleccionadas")}async function S(){ra.Info(`cancelarVenta loading:${g.value}`,"modalCobroView.vue"),x(),L(),"PAGO DEUDA"==j.value.modo?(N(),await H(j.value._id)):"PAGO SEPARADO"==j.value.modo&&await X.Z.post("cestas/DevolverProductosACestaSep",{cesta:t.getters["Cestas/getCestaBaseActivo"],articulos:j.value.lista}).then((async a=>{await H(j.value._id)}))}function x(a=!1){const e=r.currentRoute.value.path;t.dispatch("ModalCobroView/cerrarModalCobroView"),"/cestas"===e&&a&&r.push("/main"),l.value=!1}async function H(a){X.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((a=>{Y().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await X.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t.getters["Cestas/getCestaBaseActivo"],idTrabajador:D.value[t.state.Trabajadores.indexActivo]._id}).then((a=>{t.dispatch("Cestas/setCestaBaseAction",null)}))}function Z(a){let e=a.detalleIva.importe1+a.detalleIva.importe2+a.detalleIva.importe3+a.detalleIva.importe4+a.detalleIva.importe5;return e-=P.value,e=Math.round(100*e)/100,e}function W(){X.Z.get("caja/estadoCaja").then((a=>{1==a.data&&Y().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id&&r.push("/menu/fichajes"):r.push("/abrirCaja")})).catch((a=>{Y().fire("Oops...",a.message,"error")}))}function $(a){b.value+=a,T.value.push(a)}function J(){T.value.pop();let a=0;T.value.forEach((e=>{a+=e})),b.value=a}function L(){b.value=0,f.value=0,T.value=[],_=(0,o.Fl)((()=>C.value-f.value<0?0:C.value-(b.value+f.value)))}function U(a){C.value=Number(a)}return(0,o.JJ)("setTkrs",z),e({abrirModal:V}),(0,o.bv)((()=>{W(),X.Z.post("parametros/getParametros").then((a=>{"3G"!==a.data?.tipoDatafono&&"0.0.0.0"!=a.data?.ipTefpay||(u.value=1),void 0!=a.data?.params?.SempreTicket?"Si"==a.data?.params?.SempreTicket&&(p.value=!0):p.value=!1,void 0!=a.data?.params?.prohibirTkRestaurant?"Si"==a.data?.params?.prohibirTkRestaurant&&(m.value=!0):m.value=!1,void 0!=a.data?.params?.TicketDFAuto?"Si"==a.data?.params?.TicketDFAuto&&(v.value=!0):v.value=!1}))})),{DescuentoCliente:E,cesta:j,getTotal:Z,cobrar:M,formaPago:d,modalTkrsRef:c,prohibirTkRestaurant:m,setFormaPago:O,loading:g,tipoDatafono3G:u,eliminarAlPagarFnc:H,modalNumpad:i,cancelarVenta:S,modalCobro:l,abrirModal:V,sumar:$,totalRecibido:b,aPagar:C,numPadRef:n,deshacer:J,limpiar:L,procesoDatafono:s,setTkrs:z,cantidadTkrs:f,setAPagar:U,cuenta:_,productos:w,TicketDFAuto:v,cliente:k,dejaCuenta:P}}},na=t(40089);const da=(0,na.Z)(sa,[["render",J],["__scopeId","data-v-e053e5be"]]);var ua=da}}]);
//# sourceMappingURL=0.f58bb942.js.map