"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[582],{34233:function(e,o,a){a.r(o),a.d(o,{default:function(){return q}});var t=a(73396),l=a(87139),d=a(49242);const r=e=>((0,t.dD)("data-v-3d7b2ed4"),e=e(),(0,t.Cn)(),e),n={id:"main"},i={id:"vueMenuPedido"},s={class:"pedidos"},u={class:"text-center m-auto pt-3 h5"},c={class:""},p=r((()=>(0,t._)("hr",{class:"hrPedido"},null,-1))),m={class:"productos"},v={key:0,style:{"overflow-y":"scroll",height:"28vh"}},_={class:"ms-5 h6"},g={class:"d-flex flex-column juatify-content-center"},C={style:{"max-width":"270px"}},h=["onUpdate:modelValue"],b=r((()=>(0,t._)("br",null,null,-1))),D={key:1},M=r((()=>(0,t._)("hr",{class:"hrPedido"},null,-1))),w={class:"pedidos-footer mx-5"},y=r((()=>(0,t._)("h2",{id:"emailHelp",class:"h6"},"Precio total:",-1))),f={class:"mb-0 mt-2"},B={class:""},x=["disabled"];function H(e,o,a,r,H,P){const T=(0,t.up)("ModalClientesComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",n,[(0,t._)("div",i,[(0,t._)("div",null,[(0,t._)("div",s,[(0,t._)("h1",u,(0,l.zw)(e.$t("pedido_nuevo","Pedido nuevo")),1),(0,t._)("div",c,[p,(0,t._)("div",m,[r.productos.length?((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("h2",_,(0,l.zw)(e.$t("productos","Productos"))+":",1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.productos,((e,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:o},[(0,t._)("div",g,[(0,t._)("span",C,"- "+(0,l.zw)(e.nombre),1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,o)=>((0,t.wg)(),(0,t.iD)("span",{key:o},(0,l.zw)(e.nombre),1)))),128))]),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":o=>e.comentario=o},null,8,h),[[d.nr,e.comentario]])])))),128)),b])):((0,t.wg)(),(0,t.iD)("div",D,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),M,(0,t._)("div",w,[(0,t._)("div",null,[y,(0,t._)("p",f,(0,l.zw)(r.precioTotal)+"€",1)]),(0,t._)("div",B,[(0,t._)("input",{type:"button",value:"Crear pedido",class:"btn btn-primary btn-lg",onClick:o[0]||(o[0]=(...e)=>r.crearPedido&&r.crearPedido(...e)),disabled:r.botonBloqueado},null,8,x)])])])])])])]),(0,t.Wm)(T,{ref:"refModalClientes"},null,512)],64)}a(57658);var P=a(44870),T=a(74313),k=a(20065),I=a(62361),S=a(61837),j=a(42492),z=a.n(j),$=a(87853),A=a(91076),Z=a(16797),E={name:"PedidosComponent",components:{ModalClientesComponent:I.Z,NumpadComponent:S.Z,MDBCard:T.Yl,MDBCardBody:T.H7,MDBCardTitle:T.QM,MDBCardText:T.Pp,MDBBtn:T.$v,MDBCheckbox:T.IH,MDBModal:T.j3,MDBModalHeader:T.ol,MDBModalTitle:T.wo,MDBModalBody:T.Yz,MDBModalFooter:T.ab,MDBIcon:T.vm,MDBLoading:T.J$},setup(){const e=(0,P.iH)(!1),o=(0,P.iH)(null),a=(0,k.oR)(),{t:l}=(0,$.QT)(),d=a.getters["Cestas/getCestaActiva"],r=a.getters["Cestas/getCestaActivaIndex"],n=(0,t.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),i=(0,t.Fl)((()=>a.state.Trabajadores.indexActivo)),s=(0,t.Fl)((()=>n.value&&null!=i.value&&void 0!=i.value&&n.value[i.value]?n.value[i.value]:null)),u=(0,P.iH)(null),c={idCliente:d.idCliente,nombreCliente:d.nombreCliente},p=(0,P.iH)(null),m=(0,P.iH)(d.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),v=(0,P.iH)(null),_=()=>{let e=d.detalleIva.importe1+d.detalleIva.importe2+d.detalleIva.importe3+d.detalleIva.importe4+d.detalleIva.importe5;return e=Math.round(100*e)/100,e},g=()=>{if(e.value=!0,!m.value.length)return C(l("toc_game_pedidos_error_no_productos","Tienes que haber al menos un producto para crear el pedido."),"error"),void(e.value=!1);const o=new Date,a=new Date(o);a.setDate(o.getDate()+1);let t=a.getHours(),r=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,n=t>=12?"pm":"am";const i={idCliente:u.value.id,nombreCliente:u.value.nombre,opcionRecogida:2,amPm:n,fecha:a.toISOString().slice(0,10),hora:r,dias:[],dejaCuenta:0,total:_(),productos:m.value,cesta:d,idTrabajador:s.value._id,nombreDependienta:s.value.nombre,pedido:!0};A.Z.post("encargos/setEncargo",i).then((({data:o})=>o&&o.msg?o.error?(C(o.msg,"error"),void(e.value=!1)):(e.value=!1,void C(l("toc_game_pedidos_ok","pedido creado!"),"success",h)):(C(l("toc_game_pedidos_error_general","Error general"),"error"),void(e.value=!1)))).catch((o=>{e.value=!1,C(l("toc_game_pedidos_error_general","Error general"),"error")}))},C=(e,o,a=(()=>{}))=>{z().fire("error"===o?"Oops...":"Ok!!",e,o).then((()=>a()))},h=async()=>(await a.dispatch("Cestas/setModoCesta",{index:r,modo:"VENTA"}),a.dispatch("Cestas/setClienteCesta",{index:r,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),a.dispatch("EstadoDinamico/reset"),a.dispatch("Cestas/deleteLista",d._id),b("/main"),Promise.resolve()),b=e=>Z.Z.push(e);return(0,t.bv)((()=>{A.Z.get("clientes/getClientePedidosTienda").then((e=>{u.value=e.data})).catch((e=>{u.value=!1})),v.value=_()})),{refModalClientes:o,cestaActiva:d,clienteData:c,productos:m,crearPedido:g,precioTotal:v,botonBloqueado:e,numpadRef:p}}},Y=a(40089);const F=(0,Y.Z)(E,[["render",H],["__scopeId","data-v-3d7b2ed4"]]);var q=F}}]);
//# sourceMappingURL=582.4fee23b1.js.map