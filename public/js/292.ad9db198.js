"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[292],{48466:function(a,e,t){t.d(e,{Z:function(){return y}});var o=t(73396),i=t(87139);const l={class:"container"},n={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},c={key:2,class:"h3 text-center"},s={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},d={class:"again py-5"},v={class:"again py-5"},m={class:"again py-5"};function _(a,e,t,_,p,k){const f=(0,o.up)("MDBBtn"),g=(0,o.up)("MDBModalBody"),w=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(w,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:_.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":e[4]||(e[4]=a=>_.ModalErrorDatafonoQueHacerComponent=a),staticBackdrop:"",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o._)("div",l,[1==_.ticketExist?((0,o.wg)(),(0,o.iD)("p",n," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,o.kq)("",!0),2==_.ticketExist?((0,o.wg)(),(0,o.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,o.kq)("",!0),3==_.ticketExist?((0,o.wg)(),(0,o.iD)("p",c," Ultimo pago fallido ¿Que hacemos? ")):(0,o.kq)("",!0)]),(0,o._)("div",s,[1==_.ticketExist?((0,o.wg)(),(0,o.j4)(f,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:e[0]||(e[0]=a=>_.darComoValido())},{default:(0,o.w5)((()=>[(0,o._)("span",u,(0,i.zw)(a.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),_.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:_.esperandoConexion?"":a.disabled,onClick:e[1]||(e[1]=a=>{_.tarjetaUltimoTicket(),_.esperandoConexion=!0})},{default:(0,o.w5)((()=>[(0,o._)("span",d,(0,i.zw)(a.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,o.kq)("",!0),_.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:e[2]||(e[2]=a=>_.pagoDependienta())},{default:(0,o.w5)((()=>[(0,o._)("span",v,(0,i.zw)(a.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,o.kq)("",!0),_.ticketExist>2?((0,o.wg)(),(0,o.j4)(f,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:e[3]||(e[3]=a=>_.esborrarTicket())},{default:(0,o.w5)((()=>[(0,o._)("span",m,(0,i.zw)(a.$t("anular","Anular ticket")),1)])),_:1})):(0,o.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}t(57658);var p=t(20065),k=t(91076),f=t(74313),g=t(42492),w=t.n(g),T=t(44870),A={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:f.j3,MDBModalBody:f.Yz,MDBBtn:f.$v},setup(a,{expose:e}){const t=(0,T.iH)(null),i=(0,T.iH)(0),l=(0,T.iH)(!1),n=(0,p.oR)(),r=(0,T.iH)(!1),c=(0,o.Fl)((()=>n.state.Trabajadores.arrayTrabajadores));let s=(0,T.iH)(!1);const u=(0,o.Fl)((()=>n.state.Trabajadores.indexActivo)),d=(0,o.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null));function v(a,e){if(4==e)return w().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});t.value=a,i.value=e,r.value=!0}async function m(){await k.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,n.dispatch("Datafono/setEstado","APROBADA")})).catch((a=>{r.value=!0,w().fire("Oops...",a.message,"error")})),w().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function _(){null!=t.value&&(await g()?k.Z.post("tickets/anularTicket",{ticketId:t.value}).then((a=>{r.value=!1,a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo)?(l.value&&f(),w().fire({icon:"success",title:"Ticket anulado"+(l.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):a.data.res?router.push("/main"):w().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{w().fire(a.message)})):w().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function f(){k.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((a=>{w().fire("Oops...",a.message,"error")}))}async function g(){return await w().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async a=>!!a.isConfirmed))}function A(){s.value=!0,k.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,s.value=!1,n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((a=>{s.value=!1,r.value=!0,w().fire("Oops...",a.message,"error")})),s.value=!1,w().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function h(){w().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return e({abrirModal:v}),(0,o.bv)((async()=>{const{data:a}=await k.Z.post("parametros/getParametros");l.value="Si"==a.params?.TicketAlAnular})),{store:n,darComoValido:m,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:A,esperandoConexion:s,TicketAlAnular:l,arrayTrabajadores:c,indexTrabajadorActivo:u,esborrarTicket:_,idSeleccionado:t,pagoDependienta:h,ticketExist:i}}},h=t(40089);const C=(0,h.Z)(A,[["render",_],["__scopeId","data-v-266e01f8"]]);var y=C},3820:function(a,e,t){t.r(e),t.d(e,{default:function(){return na}});var o=t(73396),i=t(87139);const l=a=>((0,o.dD)("data-v-215b9bb6"),a=a(),(0,o.Cn)(),a),n={class:"col-md-7 listaTickets"},r={class:"th-sm"},c={class:"th-sm"},s={class:"th-sm"},u={class:"th-sm"},d=["onClick"],v={key:0,class:"col-md-5"},m={id:"detalleTicket"},_={class:"text-center"},p={class:"text-center"},k=l((()=>(0,o._)("br",null,null,-1))),f=l((()=>(0,o._)("hr",null,null,-1))),g={class:"contencionTicket"},w={class:"table"},T={class:"titulosTicket"},A={class:"titulosTicket"},h={class:"titulosTicket"},C=l((()=>(0,o._)("hr",null,null,-1))),y={class:"text-center"};function b(a,e,t,l,b,D){const E=(0,o.up)("MDBTable"),x=(0,o.up)("MDBIcon"),O=(0,o.up)("MDBBtn"),P=(0,o.up)("CashlogyAnulacionView");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",n,[(0,o.Wm)(E,{hover:""},{default:(0,o.w5)((()=>[(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",r,(0,i.zw)(a.$t("numero_ticket","Número ticket")),1),(0,o._)("th",c,(0,i.zw)(a.$t("hora","Hora")),1),(0,o._)("th",s,(0,i.zw)(a.$t("tipo_pago","Tipo pago")),1),(0,o._)("th",u,(0,i.zw)(a.$t("total","Total")),1)])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.arrayTickets,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,class:(0,i.C_)({"table-active":a._id===l.idActivo}),onClick:t=>l.setActivo(a,e)},[(0,o._)("td",null,(0,i.zw)(a._id),1),(0,o._)("td",null,(0,i.zw)(l.getTiempo(a.timestamp)),1),(0,o._)("td",null,(0,i.zw)(a.tipoPago),1),(0,o._)("td",null,(0,i.zw)(a.total.toFixed(2))+" €",1)],10,d)))),128))])])),_:1})]),null!=l.indexTicket?((0,o.wg)(),(0,o.iD)("div",v,[(0,o._)("div",m,[(0,o._)("h2",_,(0,i.zw)(a.$t("ticket","Ticket"))+" "+(0,i.zw)(l.arrayTickets[l.indexTicket]._id),1),(0,o._)("h6",p,(0,i.zw)(l.getTiempo(l.arrayTickets[l.indexTicket].timestamp)),1),k,f,(0,o._)("div",g,[(0,o._)("table",w,[(0,o._)("tr",null,[(0,o._)("th",T,(0,i.zw)(a.$t("producto","Producto")),1),(0,o._)("th",A,(0,i.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",h,(0,i.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.arrayTickets[l.indexTicket]?.cesta?.lista,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[(0,o._)("td",null,(0,i.zw)(a.nombre),1),(0,o._)("td",null,(0,i.zw)(a.subtotal.toFixed(2))+" €",1),(0,o._)("td",null,(0,i.zw)(a.unidades),1)])))),128))])]),C,(0,o._)("h1",y,(0,i.zw)(a.$t("total","Total"))+": "+(0,i.zw)(l.arrayTickets[l.indexTicket].total.toFixed(2)),1),(0,o.Wm)(O,{onClick:e[0]||(e[0]=a=>l.imprimirTicket()),color:"success",class:"w-100"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:"print",size:"3x"})])),_:1}),"DATAFONO_3G"!==l.arrayTickets[l.indexTicket].tipoPago&&"TARJETA"===l.arrayTickets[l.indexTicket].tipoPago||"DEVUELTO"===l.arrayTickets[l.indexTicket].tipoPago||"DEV_DATAFONO_PAYTEF"===l.arrayTickets[l.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(O,{key:0,onClick:e[1]||(e[1]=a=>l.imprimirTicketPaytef()),color:"info",class:"w-100 mt-3"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:"file-invoice-dollar",size:"3x"})])),_:1})):(0,o.kq)("",!0),"EFECTIVO"===l.arrayTickets[l.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(O,{key:1,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[2]||(e[2]=a=>l.cambiarTipoPago(l.arrayTickets[l.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_tarjeta","Pagar con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),"DATAFONO_3G"===l.arrayTickets[l.indexTicket].tipoPago?((0,o.wg)(),(0,o.j4)(O,{key:2,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[3]||(e[3]=a=>l.pagarEfectivo(l.arrayTickets[l.indexTicket]._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_efectivo","Pagar con efectivo")),1)])),_:1})):(0,o.kq)("",!0),l.prohibirAnularTicket||"DATAFONO_3G"===l.arrayTickets[l.indexTicket].tipoPago&&l.prohibirAnular3g||"ANULADO"==l.arrayTickets[l.indexTicket].tipoPago||"DEVUELTO"==l.arrayTickets[l.indexTicket].tipoPago||!l.mostrarPorAlbaran?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(O,{key:3,onClick:e[4]||(e[4]=a=>l.esborrarTicket()),disabled:l.anulando,color:"danger",class:"w-100 mt-4",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("devolucion_con_tarjeta_efectivo","Devolución con tarjeta/efectivo")),1)])),_:1},8,["disabled"]))])])):(0,o.kq)("",!0),(0,o.Wm)(P,{ref:"CashlogyAnulacionViewRef"},null,512)],64)}t(57658);var D=t(74834),E=t(74313),x=t(44870),O=t(20065),P=t(36797),U=t.n(P),N=t(91076),B=t(42492),I=t.n(B),R=t(92136),z=t(6411),L=t(48466),H=t(12195),Z=t(74025),j=t(17799),M=t(13150),S=t(16683),V=t(34730),$=t(88807);const F={key:0,class:"frame-Cashlogy flex-column"},q={class:"d-flex flex-column",style:{gap:"2px"}},G={key:1,class:"frame-Cashlogy flex-column"},W={class:"d-flex flex-column",style:{gap:"2px"}},Y=(0,o._)("span",null,"Falta cambios para la devolución",-1),Q={key:2,class:"frame-Cashlogy flex-column"},J={class:"d-flex flex-column",style:{gap:"2px"}},K={key:3,class:"frame-Cashlogy flex-column"},X=(0,o._)("br",null,null,-1);var aa={__name:"CashlogyAnulacionView",setup(a,{expose:e}){const t=(0,x.iH)(null),l=(0,x.iH)(null),n=(0,x.iH)(""),r=(0,x.iH)(""),c=(0,x.iH)(""),s=(0,x.iH)(!1),u=(0,x.iH)(!1);async function d(){return M.Z.activado()}const v=(0,x.iH)({}),m=new S.JQ((a=>{n.value=(0,S.vg)(a.importe_a_devolver,!0),k.value="PANTALLA_SELECCIONAR_TIPO"})),_=new S.JQ((a=>{n.value=(0,S.vg)(a.importe_falta_devolver,!0),u.value=a.opcion_cancelar,k.value="PANTALLA_FALTA_CAMBIO_DEVOLUCION"}));function p(){s.value=!0,M.Z.boton_pulsar("BOT_ACEPTAR")}const k=(0,x.iH)(null);function f(a){R.socket[a]("Cashlogy.update",g)}function g(a){switch(k.value=a.proceso,a.proceso){case"AÑADIR_CAMBIOS":v.value=(0,S.c)(a),r.value=(0,S.vg)(a.importe_entrado,!0),c.value=(0,S.vg)(a.importe_recicladores,!0);break;case"SOLO_DISPENSAR":n.value=(0,S.vg)(a.importe_a_devolver,!0);break}}let w=!1;async function T(a){let e;if(w=!0,k.value=null,$.Z.Info({importe_a_devolver:a},"CashlogyAnulacionView","run-in"),await(0,S.R_)(t),t.value.texto_botones_para_abort("DEVOLVER MANUALMENTE","CANCELAR DEVOLUCIÓN"),e=await t.value.start(),e)return $.Z.Info(e,"CashlogyAnulacionView","run-out"),w=!1,e;f("on");try{let[o,i]=await t.value.startPantalla_withReset(m,{importe_a_devolver:a});if(i)e=i;else if("CASHLOGY"==o&&0==a&&(o="MANUAL"),"CASHLOGY"==o){k.value=null,await M.Z.saveGrupoProcesos("ANULACION",{importe_a_devolver:a});let o=await M.Z.solo_dispensar(a);e=await(t.value?.informacionAbort_y_cancel(o));let i=o.importe_falta_devolver??0,n=0,r=o.error_en_la_devolucion;while(!e){if(k.value="ERROR_DEVOLUCION",await(0,S.R_)(l),await l.value.run({error_en_la_devolucion:r}),0==i){e={importe_falta_devolver:0,importe_anadido_en_cambios:n};break}let[o,c]=await t.value.startPantalla_withReset(_,{importe_falta_devolver:i,opcion_cancelar:i==a});if(c)e=c;else if("AÑADIR"==o){k.value=null,s.value=!1;let a=await M.Z.anadir_cambios_y_devolver(i);e=await(t.value?.informacionAbort_y_cancel(a)),e?e.importe_falta_devolver=i:(r=a.error_en_la_devolucion,i=a.importe_falta_devolver,n+=a.importe_anadido_en_cambios,await M.Z.saveGrupoProcesos(null,{importe_anadido_en_cambios:n}))}else e="CANCELAR"==o?{cancelado:!0,importe_falta_devolver:i,importe_anadido_en_cambios:n}:{manual:!0,importe_falta_devolver:i,importe_anadido_en_cambios:n}}}else e="CANCELAR"==o?{cancelado:!0}:{manual:!0};e.abort_id||(await M.Z.saveGrupoProcesos(null),await(0,V.i_)(e.importe_anadido_en_cambios,"Añadir Cambios","ENTRADA_DINERO"))}catch(o){console.log(o),e={cancelado:!0}}return f("off"),t.value?.end(),$.Z.Info(e,"CashlogyAnulacionView","run-out"),w=!1,e}return(0,o.Ah)((()=>{w&&M.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),e({run:T,activado:d}),(a,e)=>((0,o.wg)(),(0,o.j4)(j.Z,{enProceso:null!=k.value,ref_key:"CashlogyPantalla_ref",ref:t},{default:(0,o.w5)((()=>["PANTALLA_SELECCIONAR_TIPO"==k.value?((0,o.wg)(),(0,o.iD)("div",F,[(0,o._)("div",q,[(0,o.Wm)((0,x.SU)(E.$v),{onClick:e[0]||(e[0]=a=>(0,x.SU)(m).R("CASHLOGY")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Devolución con Cashlogy ")])),_:1}),(0,o.Wm)((0,x.SU)(E.$v),{onClick:e[1]||(e[1]=a=>(0,x.SU)(m).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" devolucion manual ")])),_:1}),(0,o.Wm)((0,x.SU)(E.$v),{onClick:e[2]||(e[2]=a=>(0,x.SU)(m).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" cancelar ")])),_:1})])])):(0,o.kq)("",!0),"PANTALLA_FALTA_CAMBIO_DEVOLUCION"==k.value?((0,o.wg)(),(0,o.iD)("div",G,[(0,o._)("div",W,[Y,(0,o._)("span",null,"Importe falta devolver: "+(0,i.zw)(n.value),1),(0,o.Wm)((0,x.SU)(E.$v),{onClick:e[3]||(e[3]=a=>(0,x.SU)(_).R("AÑADIR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" añadir cambios ")])),_:1}),(0,o.Wm)((0,x.SU)(E.$v),{onClick:e[4]||(e[4]=a=>(0,x.SU)(_).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" devolucion manual ")])),_:1}),u.value?((0,o.wg)(),(0,o.j4)((0,x.SU)(E.$v),{key:0,onClick:e[5]||(e[5]=a=>(0,x.SU)(_).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" cancelar ")])),_:1})):(0,o.kq)("",!0)])])):(0,o.kq)("",!0),"AÑADIR_CAMBIOS"==k.value?((0,o.wg)(),(0,o.iD)("div",Q,[(0,o.Wm)(H.Z,{tabla:v.value,style:{flex:"0 0 75%"}},null,8,["tabla"]),(0,o._)("div",J,[(0,o._)("span",null,"Importe introducido : "+(0,i.zw)(r.value),1),(0,o._)("span",null,"Importe total: "+(0,i.zw)(c.value),1),(0,o._)("span",null,"Importe falta devolver: "+(0,i.zw)(n.value),1),(0,o.Wm)((0,x.SU)(E.$v),{disabled:s.value,onClick:p,color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"SOLO_DISPENSAR"==k.value?((0,o.wg)(),(0,o.iD)("div",K,[(0,o._)("div",null,[(0,o.Uk)(" Dispensando"),X,(0,o.Uk)(" Importe a devolver: "+(0,i.zw)(n.value),1)])])):(0,o.kq)("",!0),"ERROR_DEVOLUCION"==k.value?((0,o.wg)(),(0,o.j4)(Z.Z,{key:4,ref_key:"CashlogyErrorDevolucion_ref",ref:l},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const ea=aa;var ta=ea,oa={name:"TicketsComponent",components:{MDBTable:E.re,MDBBtn:E.$v,MDBIcon:E.vm,ModalErrorDatafonoComponent:L.Z,CashlogyAnulacionView:ta},setup(a){const e=(0,O.oR)(),t=(0,x.iH)(null),i=(0,x.iH)(!1),l=(0,x.iH)(!1),n=(0,x.iH)(null),r=(0,x.iH)(!0),c=(0,x.iH)(!1),s=(0,x.iH)(!1),u=(e.getters["Configuracion/parametros"],(0,o.Fl)((()=>e.state.Trabajadores.arrayTrabajadores))),d=(0,o.Fl)((()=>e.state.Trabajadores.indexActivo)),v=(0,o.Fl)((()=>u.value&&void 0!=d.value&&null!=d.value&&u.value[d.value]?u.value[d.value]:null)),m=(0,o.Fl)((()=>e.state.Caja.arrayVentas));(0,o.YP)(m,((a,e)=>{let o=null;for(let i=0;i<a.length;i++)if(a[i]._id===t.value){o=i;break}n.value=o}));const _=(0,x.iH)(null),p=(0,x.iH)(null),k=(0,x.iH)(!1);function f(a){const e=new Date(a);return U()(e).format("HH:mm:ss DD/MM/YYYY")}function g(){N.Z.post("impresora/imprimirTicket",{idTicket:m.value[n.value]._id}).catch((a=>{I().fire("Oops...",a.message,"error")}))}function w(){N.Z.post("impresora/imprimirTicketPaytef",{idTicket:m.value[n.value]._id}).catch((a=>{I().fire("Oops...",a.message,"error")}))}function T(a,e){t.value=a._id,n.value=e,A(a?.cesta?.idCliente)}const A=a=>{s.value?N.Z.post("/clientes/getClienteById",{idCliente:a}).then((a=>{r.value=!a.data?.albaran})).catch((a=>{console.log(a)})):r.value=!0};function h(a){N.Z.post("/movimientos/PayWithCash",{idTicket:a}).then((a=>{t.value=null,n.value=null,z.Z.push("/main")})).catch((a=>{console.log(a)}))}async function C(a){function o(){N.Z.post("/movimientos/PayWith3G",{idTicket:a}).then((a=>{})).catch((a=>{console.log(a)}))}function i(){e.dispatch("Datafono/setEstado","PENDIENTE"),R.socket.emit("iniciarTransaccion",{idTicket:a,idTrabajador:v.value._id})}await N.Z.post("parametros/getParametros").then((a=>{"3G"===a.data?.tipoDatafono||"0.0.0.0"==a.data?.ipTefpay?o():i()})),t.value=null,n.value=null,z.Z.push("/main")}async function y(){if(null!=n.value)if("DEUDA"!=m.value[n.value].tipoPago){if(confirm("¿Confirma ANULACIÓN de ticket?")){k.value=!0;let e=!1,t=m.value[n.value]._id;if(await p.value.activado())try{if((await N.Z.post("tickets/isTicketAnulable",{ticketId:t})).data){let a=await p.value.run(m.value[n.value].total);a.cancelado&&(e=!0)}}catch(a){I().fire(a.message)}e?k.value=!1:N.Z.post("tickets/anularTicket",{ticketId:t}).then((a=>{a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo)?(g(),I().fire({icon:"success",title:"Ticket anulado"+(c.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):a.data.res?z.Z.push("/main"):I().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{I().fire(a.message)})).finally((()=>{k.value=!1}))}}else N.Z.post("deudas/getDeudaByIdTicket",{idTicket:m.value[n.value]._id,timestamp:m.value[n.value].timestamp}).then((a=>{let e=0;m.value[n.value].movimientos.length>0&&(e=m.value[n.value].movimientos.length-1),a&&(""==a.data&&"DEUDA"==m.value[n.value].movimientos[e].tipo||"SIN_PAGAR"==a.data.estado)?I().fire({icon:"info",title:"No se puede anular la deuda desde tickets",showConfirmButton:!0}):a&&""==a.data?I().fire({icon:"info",title:"Deuda ya saldada",showConfirmButton:!0}):a.data&&""!=a.data&&"ANULADO"==a.data.estado?I().fire({icon:"info",title:"Este ticket ya se ha anulado en deudas",showConfirmButton:!0}):"PAGADO"==a.data.estado&&I().fire({icon:"info",title:"Este ticket ya se ha pagado, Num ticket: "+a.data.idTicket,showConfirmButton:!0})})).catch((a=>{I().fire(a.message)}));else I().fire("Primero selecciona el ticket")}function b(a){z.Z.push(a)}return(0,o.bv)((async()=>{D.W.cargarVentas();const{data:a}=await N.Z.post("parametros/getParametros");i.value="Si"==a.params?.ProhibirAnulacioTicket,l.value="Si"==a.params?.prohibirAnular3g,s.value="Si"==a.params?.prohibirAnularTkAlbaran,c.value="Si"==a.params?.TicketAlAnular,m.value&&m.value.length>0&&T(m.value[0],0)})),{modalErrorDatafonoRef:_,arrayTickets:m,getTiempo:f,setActivo:T,idActivo:t,cambiarTipoPago:C,imprimirTicket:g,esborrarTicket:y,prohibirAnularTicket:i,goTo:b,pagarEfectivo:h,prohibirAnular3g:l,indexTicket:n,imprimirTicketPaytef:w,mostrarPorAlbaran:r,CashlogyAnulacionViewRef:p,anulando:k}}},ia=t(40089);const la=(0,ia.Z)(oa,[["render",b],["__scopeId","data-v-215b9bb6"]]);var na=la}}]);
//# sourceMappingURL=292.ad9db198.js.map