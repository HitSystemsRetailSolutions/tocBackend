"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[91],{4286:function(e,a,o){o.d(a,{Z:function(){return h}});var t=o(73396),l=o(87139);const n={class:"container"},r={key:0,class:"h3 text-center"},i={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},d={class:"row mt-2 container botonesCaja"},c={class:"again py-5"},u={class:"again py-5"},m={class:"again py-5"};function p(e,a,o,p,v,f){const b=(0,t.up)("MDBBtn"),g=(0,t.up)("MDBModalBody"),w=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(w,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[3]||(a[3]=e=>p.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t._)("div",n,[1==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago cancelado, que hacemos? ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",d,[1==p.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>p.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",c,(0,l.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",size:"lg",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,l.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",size:"lg",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>p.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,l.zw)(e.$t("pago en efectivo","PAGO EN EFECTIVO O EN 3G")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}var v=o(20065),f=o(44161),b=o(74313),g=o(42492),w=o.n(g),C=o(44870),_={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,C.iH)(null),l=(0,C.iH)(0),n=(0,v.oR)(),r=(0,C.iH)(!1),i=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores));let s=(0,C.iH)(!1);const d=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>i.value&&void 0!=d.value&&null!=d.value&&i.value[d.value]?i.value[d.value]:null));function u(e,a){if(4==a)return w().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,l.value=a,r.value=!0}async function m(){await f.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,n.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{r.value=!0,w().fire("Oops...",e.message,"error")})),w().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}function p(){s.value=!0,f.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:c.value._id}).then((()=>{r.value=!1,s.value=!1,n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{s.value=!1,r.value=!0,w().fire("Oops...",e.message,"error")})),s.value=!1,w().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function b(){w().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return a({abrirModal:u}),(0,t.bv)((()=>{})),{store:n,darComoValido:m,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:p,esperandoConexion:s,arrayTrabajadores:i,indexTrabajadorActivo:d,idSeleccionado:o,pagoDependienta:b,ticketExist:l}}},y=o(40089);const M=(0,y.Z)(_,[["render",p],["__scopeId","data-v-1ca4de76"]]);var h=M},27034:function(e,a,o){o.r(a),o.d(a,{default:function(){return ui}});var t=o(73396);const l={class:"row mt-1"},n={class:"col-md-3"},r={class:"col-md-6"},i={class:"col-md-3"};function s(e,a,o,s,d,c){const u=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),v=(0,t.up)("MenuIzquierdaComponent"),f=(0,t.up)("CestaComponent"),b=(0,t.up)("MenuDerechaComponent"),g=(0,t.up)("ModalErrorDatafonoVentaComponent"),w=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",l,[(0,t._)("div",n,[(0,t.Wm)(v,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(f,{ref:"cestaRef"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(b)])]),(0,t.Wm)(g,{ref:"modalErrorVentaDatafonoRef"},null,512),(0,t.Wm)(w,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(57658);var d=o(87139);const c={class:"row",id:"menu",style:{"margin-top":"1px"}},u={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,l,n,r){const i=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",c,[(0,t._)("div",u,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(null)),class:"newMenu btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"}," + Nuevo ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,class:(0,d.C_)([{activo:a==l.indexMenuActivo},"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"]),onClick:e=>l.setActivo(a)},(0,d.zw)(e.nombre),11,m)))),128))])]),(0,t.Wm)(i,{ref:"ModalCrearMenusRef"},null,512)],64)}var v=o(20065),f=o(49242);const b=e=>((0,t.dD)("data-v-5474bf1b"),e=e(),(0,t.Cn)(),e),g={class:"row"},w={key:0},C=b((()=>(0,t._)("br",null,null,-1))),_={class:"row"};function y(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),v=(0,t.up)("MenusComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalCrearMenus",tabindex:"-1",labelledby:"modalCrearMenus",modelValue:l.modalCrearMenus,"onUpdate:modelValue":a[4]||(a[4]=e=>l.modalCrearMenus=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",g,[l.isSubmenu?((0,t.wg)(),(0,t.iD)("label",w,[(0,t.Uk)("Nombre del menu "),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreMenu=e)},null,4),[[f.nr,l.nombreMenu]])])):(0,t.kq)("",!0),C,(0,t._)("label",null,[(0,t.Uk)("Nombre del Submenú "+(0,d.zw)(""!==l.nombreMenu?"para ":"")+" ",1),(0,t._)("b",null,(0,d.zw)(""!==l.nombreMenu?l.nombreMenu:""),1),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>l.nombreSubMenu=e)},null,4),[[f.nr,l.nombreSubMenu]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.crearMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear menu")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[3]||(a[3]=e=>l.modalCrearMenus=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(p,{id:"modalEditarMenu",tabindex:"-1",labelledby:"modalEditarMenu",modelValue:l.modalEditarMenu,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalEditarMenu=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del menu ")])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",_,[(0,t._)("label",null,[(0,t.Uk)("Elija un nuevo nombre "+(0,d.zw)(l.editarEsMenu)+" ",1),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[5]||(a[5]=e=>l.editarNombreTxt=e)},null,512),[[f.nr,l.editarNombreTxt]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[6]||(a[6]=e=>l.editarEsMenu?l.editMenuName():l.editSubMenuName())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[7]||(a[7]=e=>l.editarEsMenu?l.deleteAllProductsMenu():l.deleteAllProductsSubMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Eliminar")])),_:1}),(0,t.Wm)(u,{color:"warning",size:"lg",onClick:a[8]||(a[8]=e=>l.modalEditarMenu=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"MenusComponentRef"},null,512)],64)}var M=o(74834),h=o(74313),k=o(44870),D=o(44161),B=o(42492),T=o.n(B),x={name:"ModalCrearProductoMenus",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v,MenusComponent:H},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,k.iH)(!1),n=(0,k.iH)(""),r=(0,k.iH)(""),i=(0,k.iH)(!1),s=(0,k.iH)(!1),d=(0,k.iH)(!1),c=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),u=(0,k.iH)(!1),m=(0,k.iH)(""),p=(0,k.iH)(!1),f=(0,k.iH)(null),b=(0,k.iH)(0),g=(0,k.iH)(null);async function w(e){s.value=null==e,n.value=null==e?"":e,l.value=!0}async function C(){if(""==n.value||""==r.value&&d.value)return i.value=!0,void T().fire("Oops...","Algún campo está vacío o es incorrecto.","error");let e=n.value,a=Number(c.value.length);s.value&&(a+=1);let o=1==a.toString().length?"0"+a:a;d.value&&(e=`[${n.value}]${o} ${r.value}`),D.Z.post("articulos/anadirProducto",{nombreArticulo:"Producto por defecto",precioConIva:0,esSumable:!1,precioBase:0,tipoIva:0,menus:e,posicion:0,articuloExistente:!1}).then((e=>{T().fire("Menú creado","Se ha creado el menú correctamente","success"),M.W.cargarTeclado(),l.value=!1}))}async function _(e,a,o){1==o&&(m.value=e.nombre.substring(3)),0==o&&(m.value=e.nombre),p.value=0==o,b.value=a,f.value=e,u.value=!0}async function y(){let e=f.value,a=m.value;for(let o=0;o<c.value.length;o++)if(c.value[o].nombre.toUpperCase()==a.toUpperCase())return T().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let o=0;o<e.arraySubmenus.length;o++)for(let t=0;t<e.arraySubmenus[o].arrayTeclas.length;t++)D.Z.post("teclado/cambiarPosTecla",{idArticle:e.arraySubmenus[o].arrayTeclas[t].idArticle,nuevaPos:e.arraySubmenus[o].arrayTeclas[t].pos,nombreMenu:`[${a}]${e.arraySubmenus[o].nombre}`});T().fire("Menú editado","Se ha editado el menú correctamente","success"),M.W.cargarTeclado(),u.value=!1}async function h(){let e=f.value,a=m.value,o=b.value.value+1,t=1==o.toString().length?"0"+o:o,l=c.value[o-1].nombre;if(e.nombre.split(" ")[1].toUpperCase()==a.toUpperCase())return T().fire("¡Nombre en uso!","¡El nombre introducido ya está en uso!","error");for(let n=0;n<e.arrayTeclas.length;n++)D.Z.post("teclado/cambiarPosTecla",{idArticle:e.arrayTeclas[n].idArticle,nuevaPos:e.arrayTeclas[n].pos,nombreMenu:`[${l}]${t} ${a}`});T().fire("Submenú editado","Se ha editado el submenú correctamente","success"),M.W.cargarTeclado(),u.value=!1}async function B(){T().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((e=>{if(e.isDismissed)return;let a=f.value;for(let o=0;o<4;o++)for(let e=0;e<a.arrayTeclas.length;e++)D.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e].idArticle});o.dispatch("Teclado/setIndexMenuActivo",0),u.value=!1,M.W.cargarTeclado(),T().fire("Submenú eliminado","Se ha eliminado el Submenú correctamente","success")}))}async function x(){T().fire({title:"¿Desea realmente BORRAR el menú? ",html:"¡Todos los productos serán eliminados y no se podrá deshacer!",showCancelButton:!0,confirmButtonText:"BORRAR",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.8)"}).then((async e=>{let a=f.value;if(!e.isDismissed){if(a.arraySubmenus?.length&&a.arraySubmenus?.length>0)for(let e=0;e<4;e++)for(let o=0;o<a.arraySubmenus?.length;o++)for(let e=0;e<a.arraySubmenus[o]?.arrayTeclas.length;e++)D.Z.post("articulos/eliminarMenu",{id:a.arraySubmenus[o]?.arrayTeclas[e]?.idArticle});else for(let e=0;e<a.arrayTeclas.length;e++)D.Z.post("articulos/eliminarMenu",{id:a.arrayTeclas[e]?.idArticle});await o.dispatch("Teclado/setIndexMenuActivo",0),M.W.cargarTeclado(),u.value=!1,T().fire("Menú eliminado","Se ha eliminado el menú correctamente","success")}}))}return a({openEditModal:_,abrirModal:w}),(0,t.bv)((()=>{D.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.DosNivells?"Si"==e.data?.DosNivells&&(d.value=!0):d.value=!1}))})),{modalCrearMenus:l,nombreMenu:n,nombreSubMenu:r,abrirModal:w,editMenuName:y,deleteAllProductsMenu:x,deleteAllProductsSubMenu:B,createProductCheckFields:i,crearMenu:C,MenusComponentRef:g,isSubmenu:s,editarMenuTeclado:f,editarEsMenu:p,haveSubmenu:d,modalEditarMenu:u,editSubMenuName:h,editarNombreTxt:m,editarTagCount:b}}},A=o(40089);const z=(0,A.Z)(x,[["render",y],["__scopeId","data-v-5474bf1b"]]);var E=z,I={name:"MenusComponent",components:{ModalCrearProductoMenus:E},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),r=(0,t.Fl)((()=>o.state.modoActual)),i=(0,k.iH)(null),s=(0,k.iH)(-1);function d(e){e==s.value&&"MODIFICAR_ARTICULO"==r.value&&i.value.openEditModal(l.value[e],e,0),s.value=e,o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{d(0)})),a({setActivo:d,indexMenuActivo:n}),{teclado:l,indexMenuActivo:n,setActivo:d,modoActual:r,ModalCrearMenusRef:i}}};const S=(0,A.Z)(I,[["render",p],["__scopeId","data-v-a286c2a4"]]);var H=S;const U={class:"row",id:"submenu",style:{"margin-top":"1px","margin-right":"0px"}},j={key:0,class:"btn-group shadow-none",role:"group"},F={key:0},V=["onClick"];function W(e,a,o,l,n,r){const i=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",U,[l.teclado&&l.teclado[l.indexMenuActivo]&&l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",j,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("div",F,[(0,t._)("button",{onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(l.teclado[l.indexMenuActivo].nombre)),class:"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100 newSubMenu"}," + Nuevo ")])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado[l.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t._)("button",{class:(0,d.C_)([{activo:a==l.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>l.setIndexSubmenu(a)},(0,d.zw)(e.nombre),11,V)])))),128))])):(0,t.kq)("",!0)]),(0,t.Wm)(i,{ref:"ModalCrearMenusRef"},null,512)],64)}var O={name:"SubmenusComponent",components:{ModalCrearProductoMenus:E},setup(){const e=(0,v.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),l=(0,k.iH)(null),n=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo)),r=(0,t.Fl)((()=>e.state.modoActual)),i=(0,k.iH)(0);function s(t){t==i.value&&"MODIFICAR_ARTICULO"==r.value&&l.value.openEditModal(a.value[o.value].arraySubmenus[t],o,1),i.value=t,e.dispatch("Teclado/setIndexSubmenuActivo",t)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:n,setIndexSubmenu:s,modoActual:r,ModalCrearMenusRef:l}}};const P=(0,A.Z)(O,[["render",W],["__scopeId","data-v-4386dc8f"]]);var R=P;const N={key:0},$=["onClick"];function Z(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("PesoComponent"),c=(0,t.up)("SuplementosComponent"),u=(0,t.up)("ModalEditarProducto"),m=(0,t.up)("ModalCrearProducto"),p=(0,t.up)("ModalAlergenosVue"),v=(0,t.up)("ModalVaris");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[l.arrayTeclas&&l.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,n)=>(0,t._)("div",{class:(0,d.C_)(["col",[l.teclado[l.indexMenuActivo]?.arraySubmenus&&l.teclado[l.indexMenuActivo]?.arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:n},[l.arrayTeclas[n+6*o].idArticle?((0,t.wg)(),(0,t.j4)(i,{key:0,onMousedown:e=>l.startPress(l.arrayTeclas[n+6*o],e),onMouseup:e=>l.endPress(l.arrayTeclas[n+6*o],e),onTouchstart:e=>l.startPress(l.arrayTeclas[n+6*o],e),onTouchend:e=>l.endPress(l.arrayTeclas[n+6*o],e),class:(0,d.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[l.teclado[l.indexMenuActivo]?.arraySubmenus&&l.teclado[l.indexMenuActivo]?.arraySubmenus.length>0?"teclasConSubmenu":"teclas",l.getAnimation(l.cesta)>4&&l.AlertaJoanets&&8910==l.arrayTeclas[n+6*o].idArticle?"parpadear":""]]),style:(0,d.j5)({"background-color":"#"+l.arrayTeclas[n+6*o].color.toString(16),color:l.getTextColor("#"+l.arrayTeclas[n+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(l.arrayTeclas[n+6*o].nombreArticulo)+" ",1),l.precioTecla?((0,t.wg)(),(0,t.iD)("p",N,(0,d.zw)(l.arrayTeclas[n+6*o]?.precioConIva?.toFixed(2))+"€ ",1)):(0,t.kq)("",!0)])),_:2},1032,["onMousedown","onMouseup","onTouchstart","onTouchend","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,d.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==l.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==l.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==l.isEditarArticulos(!1)},null==l.teclado[l.indexMenuActivo]?.arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>l.editarArticulo(l.arrayTeclas[n+6*o].pos)},(0,d.zw)(e.$t("vacio","Vacío"))+" "+(0,d.zw)(l.isEditarArticulos(!0)),11,$))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(s,{ref:"modalPesoRef"},null,512),(0,t.Wm)(c,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(u,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(m,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(p,{ref:"modalAlergenosRef"},null,512),(0,t.Wm)(v,{ref:"modalVarisRef"},null,512)],64)}const L=e=>((0,t.dD)("data-v-78cc6cbe"),e=e(),(0,t.Cn)(),e),q=L((()=>(0,t._)("div",{"data-v-95b64bf4":"",class:"modal-header"},[(0,t._)("h5",{"data-v-95b64bf4":"",class:"modal-title",id:"staticBackdropLabel"}," Introduce los gramos ")],-1))),Y={class:"row"},G={class:"row"};function J(e,a,o,l,n,r){const i=(0,t.up)("MDBInput"),s=(0,t.up)("NumpadComponent"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalPeso,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalPeso=e),staticBackdrop:""},{default:(0,t.w5)((()=>[q,(0,t.Wm)(c,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",Y,[l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(i,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>l.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",G,[((0,t.wg)(),(0,t.j4)(s,{ref:"numpadRef",key:l.modalPeso}))])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"danger",onClick:a[1]||(a[1]=e=>l.closeModal()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo(l.numpadRef.cantidad))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var K=o(38304),Q={name:"PesoComponent",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v,MDBInput:h.u2,NumpadComponent:K.Z},setup(e,{expose:a}){const o=(0,k.iH)(!1),l=(0,v.oR)(),n=(0,t.Fl)((()=>l.state.Teclado.objTeclado)),r=(0,t.Fl)((()=>l.state.Teclado.indexMenuActivo)),i=(0,k.iH)(null),s=(0,k.iH)({idArticulo:null,idCesta:null,nombre:""});function d(e,a,t){s.value.idArticulo=e,s.value.idCesta=a,s.value.nombre=t,setTimeout((()=>{o.value=!0}),1)}function c(){o.value=!1}function u(e){D.Z.post("teclado/clickTeclaArticulo",{idArticulo:s.value.idArticulo,gramos:e,idCesta:s.value.idCesta,unidades:1,arraySuplementos:null,nombre:s.value.nombre,menu:n.value[r.value].nombre}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");s.value.idArticulo=null,s.value.idCesta=null,o.value=!1})).catch((e=>{T().fire("Oops...",e.message,"error")}))}function m(){}return a({abrirModal:d}),(0,t.JJ)("okValue",u),{modalPeso:o,numpadRef:i,closeModal:c,infoArticulo:s,test:m,insertarArticulo:u}}};const X=(0,A.Z)(Q,[["render",J],["__scopeId","data-v-78cc6cbe"]]);var ee=X;const ae=e=>((0,t.dD)("data-v-876e91b8"),e=e(),(0,t.Cn)(),e),oe={class:"row"},te=["onClick"],le=ae((()=>(0,t._)("br",null,null,-1))),ne={class:"row"},re={key:0,class:"table-responsive divCesta reverso"},ie={class:"table colorFuente"},se={class:"tableBody"},de=["onClick"],ce={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}};function ue(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,d.zw)(l.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(c,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",oe,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,d.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:l.checkSuplementoActivo(e._id)}]]),onClick:a=>l.addSuplemento(e)},[(0,t.Uk)((0,d.zw)(e.nombre)+" ",1),le,(0,t.Uk)(" "+(0,d.zw)(e.precioConIva)+" € ",1)],10,te)])))),128))]),(0,t._)("div",ne,[l.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",re,[(0,t._)("table",ie,[(0,t._)("tbody",se,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{seleccionado:l.itemSeleccionado===a}]),onClick:e=>l.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",ce,(0,d.zw)(e.nombre),1)]),(0,t._)("td",null,(0,d.zw)(e.precioConIva.toFixed(2))+" €",1)],10,de)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"danger",onClick:a[0]||(a[0]=e=>l.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(u,{color:"secondary",onClick:a[1]||(a[1]=e=>l.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var me={name:"SuplementosComponent",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,k.iH)(!1),n=(0,k.iH)(null),r=(0,k.iH)(null),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d={idArticulo:null,idCesta:null,cliente:null,suplementos:null},c=(0,k.iH)([]),u=(0,k.iH)([]);let m=0;const p=(0,t.Fl)((()=>{if(c.value&&c.value.length>0){let e=0;for(let a=0;a<c.value.length;a++)e+=c.value[a].precioConIva;return e}return 0}));async function f(e,a,t,n,r){d.idArticulo=e,d.idCesta=a,d.cliente=t,m=r;const i=await D.Z.post("articulos/getSuplementos",{arrayIdSuplementos:n});if(!i)throw Error("No se ha podido obtener la lista de suplementos");u.value=i.data,o.dispatch("Unidades/setUnidades",1),l.value=!0}function b(e){try{c.value.push(e)}catch(a){T().fire("Oops...",a.message,"error")}}function g(e){const a=c.value.findIndex((a=>a.suplemento===e));return-1!==a}function w(e){r.value=e}function C(){c.value.splice(r.value,1)}async function _(){l.value=!1;try{let e;for(let a=0;a<m;a++)e=await D.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.idArticulo,gramos:0,idCesta:d.idCesta,unidades:1,arraySuplementos:c.value,nombre:"",menu:i.value[s.value].nombre});if(d.idArticulo=null,d.idCesta=null,c.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos")}catch(e){T().fire("Oops...",e.message,"error")}}function y(){}return a({abrirModal:f}),(0,t.JJ)("okValue",_),{modalSuplementos:l,addSuplemento:b,checkSuplementoActivo:g,numpadRef:n,arrayCompletoSuplementos:u,suplementosSeleccionados:c,itemSeleccionado:r,insertarArticulo:_,setIndex:w,eliminarActivo:C,totalSuplementos:p,test:y}}};const pe=(0,A.Z)(me,[["render",ue],["__scopeId","data-v-876e91b8"]]);var ve=pe;const fe=e=>((0,t.dD)("data-v-4a92832f"),e=e(),(0,t.Cn)(),e),be={class:"row"},ge={for:"nombre"},we=fe((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),Ce=fe((()=>(0,t._)("option",{value:"4"},"0%",-1))),_e=fe((()=>(0,t._)("option",{value:"1"},"4%",-1))),ye=fe((()=>(0,t._)("option",{value:"5"},"5%",-1))),Me=fe((()=>(0,t._)("option",{value:"2"},"10%",-1))),he=fe((()=>(0,t._)("option",{value:"3"},"21%",-1))),ke=[Ce,_e,ye,Me,he],De=fe((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Be=fe((()=>(0,t._)("option",{value:"true"},"Si",-1))),Te=fe((()=>(0,t._)("option",{value:"false"},"No",-1))),xe=[Be,Te],Ae={for:"precioIva"};function ze(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:l.modalEditarProd,"onUpdate:modelValue":a[8]||(a[8]=e=>l.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",be,[(0,t._)("label",ge,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,512),[[f.nr,l.nombre]])]),we,(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[1]||(a[1]=e=>l.tipoIva=e),class:"form-control"},ke,512),[[f.bM,l.tipoIva]]),De,(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[2]||(a[2]=e=>l.esSumable=e),class:"form-control"},xe,512),[[f.bM,l.esSumable]]),(0,t._)("label",Ae,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>l.precioConIva=e)},null,512),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(u,{color:"warning",size:"lg",onClick:a[5]||(a[5]=e=>l.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[6]||(a[6]=e=>l.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(u,{color:"secondary",size:"lg",onClick:a[7]||(a[7]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ee={name:"ModalEditarProducto",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,k.iH)(0),n=(0,k.iH)(!1),r=(0,k.iH)(0),i=(0,k.iH)(0),s=[4,10,21,0,5],d=(0,k.iH)(""),c=(0,k.iH)(-1),u=(0,k.iH)(""),m=(0,k.iH)(!0);async function p(){await D.Z.post("articulos/editarArticulo",{idArticulo:c.value,nombre:d.value,precioBase:parseFloat(r.value)/parseFloat(i.value),precioConIva:parseFloat(r.value),tipoIva:i.value,essumable:JSON.parse(m.value)}).then((e=>{n.value=!1,T().fire("Producto guardado","Producto guardado correctamente","success"),M.W.cargarTeclado()}))}function f(){n.value=!1}function b(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function g(e,a){await D.Z.post("articulos/moverArticulo",{id:c.value,posicion:e,menu:a}).then((a=>{T().fire("Producto establecido","Se ha movido el producto "+d.value+" correctamente a la celda "+e,"success"),M.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function w(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await D.Z.post("articulos/eliminarArticulo",{id:c.value}).then((e=>{T().fire("Producto eliminado","Se eliminado el producto "+d.value+" correctamente a la celda","success"),M.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),n.value=!1)}async function C(e,a,o,t,l,s){d.value=e,r.value=a,c.value=o,i.value=t,m.value=l,n.value=!0}return(0,t.bv)((()=>{})),a({abrirModal:C,botonVacio:g}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:d,precioBase:l,precioConIva:r,id:c,modalEditarProd:n,tipoIva:i,confirmar:p,menus:u,cambiarPosicion:b,esSumable:m,tiposIva:s,salirSinGuardar:f,EliminarTecla:w}}};const Ie=(0,A.Z)(Ee,[["render",ze],["__scopeId","data-v-4a92832f"]]);var Se=Ie;const He=e=>((0,t.dD)("data-v-f5908666"),e=e(),(0,t.Cn)(),e),Ue={class:"row"},je={for:"nombre"},Fe=["disabled"],Ve=He((()=>(0,t._)("label",{for:"nombre"},[(0,t.Uk)("Nombre articulo "),(0,t._)("br")],-1))),We={style:{display:"flex"}},Oe=He((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),Pe=["disabled"],Re=He((()=>(0,t._)("option",{value:"4"},"0%",-1))),Ne=He((()=>(0,t._)("option",{value:"1"},"4%",-1))),$e=He((()=>(0,t._)("option",{value:"5"},"5%",-1))),Ze=He((()=>(0,t._)("option",{value:"2"},"10%",-1))),Le=He((()=>(0,t._)("option",{value:"3"},"21%",-1))),qe=[Re,Ne,$e,Ze,Le],Ye=He((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Ge=["disabled"],Je=He((()=>(0,t._)("option",{value:"true"},"Si",-1))),Ke=He((()=>(0,t._)("option",{value:"false"},"No",-1))),Qe=[Je,Ke],Xe={for:"precioIva"},ea=["disabled"],aa={class:"row"},oa={for:"nombre"},ta={key:0,class:"row"},la={class:"col"},na={class:"table-responsive w-100",style:{height:"400px"}},ra={class:"table table-striped mt-1"},ia={class:"textoNombre d-inline-block text-truncate"};function sa(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:l.modalCrearProd,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ue,[(0,t._)("label",je,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,8,Fe),[[f.nr,l.nombre]])]),Ve,(0,t._)("div",We,[null==l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>l.nombre=e)},null,512)),[[f.nr,l.nombre]]):(0,t.kq)("",!0),null!=l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:1,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>l.articuloSeleccionado.nombre=e)},null,512)),[[f.nr,l.articuloSeleccionado.nombre]]):(0,t.kq)("",!0),(0,t.Wm)(u,{onClick:a[3]||(a[3]=e=>l.articuloModal=!0),color:"secondary",floating:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{icon:"search",size:"0.5x"})])),_:1})]),Oe,(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[4]||(a[4]=e=>l.tipoIva=e),class:"form-control"},qe,8,Pe),[[f.bM,l.tipoIva]]),Ye,(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"esSumable",id:"esSumable","onUpdate:modelValue":a[5]||(a[5]=e=>l.esSumable=e),class:"form-control"},Qe,8,Ge),[[f.bM,l.esSumable]]),(0,t._)("label",Xe,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>l.precioConIva=e)},null,8,ea),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[7]||(a[7]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[8]||(a[8]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{id:"articuloModal",tabindex:"-1",labelledby:"articuloModal",modelValue:l.articuloModal,"onUpdate:modelValue":a[12]||(a[12]=e=>l.articuloModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",aa,[(0,t._)("label",oa,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>l.inputBusqueda=e)},null,512),[[f.nr,l.inputBusqueda]])]),l.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",ta,[(0,t._)("div",la,[(0,t._)("div",na,[(0,t._)("table",ra,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",ia,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(u,{color:"primary",size:"lg",onClick:e=>l.selectArticulo({articulo:a}),class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{onClick:a[11]||(a[11]=e=>l.deleteArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Borrar selección")])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var da={name:"modalCrearProducto",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v,MDBIcon:h.vm},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,k.iH)(0),n=(0,k.iH)(!1),r=(0,k.iH)(!1),i=(0,k.iH)(0),s=(0,k.iH)(0),d=(0,k.iH)(0),c=[4,10,21,0,5],u=(0,k.iH)(""),m=(0,k.iH)(""),p=(0,k.iH)(-1),f=(0,k.iH)(""),b=(0,k.iH)(!0),g=(0,k.iH)(),w=(0,k.iH)(""),C=(0,k.iH)(null);function _(){D.Z.post("articulos/buscar",{busqueda:w.value,familia:"Todos",limit:20}).then((e=>{g.value=e.data})).catch((e=>{T().fire("Oops...",e.message,"error")}))}async function y(e){s.value=1,i.value=0,u.value="Nombre",b.value=!1,C.value=null,r.value=!1}async function h(e){s.value=e.articulo.tipoIva,i.value=e.articulo.precioConIva,u.value=e.articulo.nombre,b.value=e.articulo.esSumable,C.value=e.articulo,r.value=!1}async function B(){D.Z.post("articulos/anadirProducto",{nombreArticulo:u.value,precioConIva:parseFloat(i.value),esSumable:JSON.parse(b.value),precioBase:parseFloat(i.value)/parseFloat(s.value),tipoIva:parseFloat(s.value),menus:f.value,posicion:d.value,articuloExistente:null!=C.value,idArticulo:C.value?._id}).then((e=>{m.value="",l.value=0,i.value=0,s.value=3,b.value=!1,n.value=!1,T().fire("Producto creado","Producto creado correctamente","success"),M.W.cargarTeclado()}))}function x(){n.value=!1}function A(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function z(e,a){d.value=e,u.value="Nombre",i.value="0.0",s.value="3",b.value=!0,n.value=!0,f.value=a}return(0,t.YP)(w,(()=>{_()})),(0,t.bv)((()=>{})),a({abrirModal:z}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:u,precioBase:l,precioConIva:i,id:p,modalCrearProd:n,tipoIva:s,confirmar:B,menus:f,inputBusqueda:w,arrayArticulos:g,cambiarPosicion:A,esSumable:b,tiposIva:c,salirSinGuardar:x,articuloModal:r,selectArticulo:h,articuloSeleccionado:C,deleteArticulo:y}}};const ca=(0,A.Z)(da,[["render",sa],["__scopeId","data-v-f5908666"]]);var ua=ca;const ma=["src"];function pa(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),c=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(c,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:l.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:l.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,ma),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>l.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var va={name:"ModalAlergenosComponent",components:{MDBModal:h.j3,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,k.iH)(!1),t=(0,k.iH)(""),l=(0,v.oR)(),n=l.getters["Configuracion/parametros"];function r(e){i(e),o.value=!0}function i(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${n?.licencia}`}return a({abrirModal:r}),{modalAlergenos:o,abrirModal:r,url:t}}};const fa=(0,A.Z)(va,[["render",pa]]);var ba=fa;function ga(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBInput"),u=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),f=(0,t.up)("PesoComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalVaris",tabindex:"-1",labelledby:"tituloModalVaris",modelValue:l.modalVarisActivo,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalVarisActivo=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"tituloModalVaris"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("inserta_el_nombre","Inserta el nombre del articulo")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:l.nombreArticulo,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreArticulo=e),"aria-placeholder":"{{ $t('nombre', 'Nombre') }}",type:"text",ref:"inputRef"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{color:"success",onClick:l.handleSubmit},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"modalPesoRef"},null,512)],64)}var wa={name:"ModalVaris",components:{MDBBtn:h.$v,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalHeader:h.ol,MDBModalFooter:h.ab,MDBInput:h.u2,PesoComponent:ee},setup(e,{expose:a}){const o=(0,k.iH)(!1),l=new Event("acabado"),n=(0,v.oR)(),r=(0,k.iH)(null),i=(0,t.Fl)((()=>n.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>n.state.Teclado.indexMenuActivo)),d=(0,k.iH)({idArticle:"",gramos:null,idCesta:"",unidades:0,arraySuplementos:null}),c=(0,k.iH)(""),u=(0,k.iH)(null),m=async e=>{try{o.value=!0,c.value="",d.value=e}catch(a){console.log(a)}};a({abrirModal:m,nombreArticulo:c});const p=async()=>{let e=c.value;0===e.length&&(e=d.value.nom),d.value.idArticle?(d.value.peso&&(o.value=!1,await r.value.abrirModal(d.value.idArticle,d.value.idCesta,e),c.value=void 0),async function(){const a=await D.Z.post("teclado/clickTeclaArticulo",{idArticulo:d.value.idArticle,gramos:d.value.gramos,idCesta:d.value.idCesta,unidades:d.value.unidades,arraySuplementos:null,nombre:e,menu:i.value[s.value].menu});if(c.value="",!a.data)throw Error("No se ha podido añadir el artículo a la cesta");n.dispatch("Unidades/setUnidades",1)}(),c.value=void 0,o.value=!1):document.dispatchEvent(l)},f=()=>{u.value.focus()};return{modalVarisActivo:o,nombreArticulo:c,handleSubmit:p,modalPesoRef:r,inputRef:u,getFocus:f}}};const Ca=(0,A.Z)(wa,[["render",ga]]);var _a=Ca,ya=o(22483),Ma={name:"TeclasComponent",components:{PesoComponent:ee,MDBBtn:h.$v,SuplementosComponent:ve,ModalEditarProducto:Se,ModalCrearProducto:ua,ModalAlergenosVue:ba,ModalVaris:_a},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,ya.tv)(),n=(0,t.Fl)((()=>o.state.modoActual)),r=(0,t.Fl)((()=>o.state.Configuracion.parametros)),i=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),c=(0,k.iH)(null),u=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),p=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),f=(0,k.iH)(null),b=(0,k.iH)(!1),g=(0,k.iH)(null),w=(0,k.iH)(null),C=(0,k.iH)(null),_=(0,k.iH)(null),y=(0,t.Fl)((()=>o.state.Unidades.unidades)),M=(0,k.iH)(!1),h=(0,t.Fl)((()=>{if(d.value)for(let e=0;e<d.value.length;e++)if(u.value&&u.value[m.value]&&d.value[e]._id==u.value[m.value].idCesta)return d.value[e];return null})),B=(0,k.iH)(null),x=(0,k.iH)(!1),A=(0,k.iH)(!1);function z(e){_.value.abrirModal(e)}function E(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}function I(){D.Z.get("caja/estadoCaja").then((e=>{1==e.data&&T().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=e.data&&3!=e.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&l.push("/menu/fichajes"):l.push("/abrirCaja")})).catch((e=>{T().fire("Oops...",e.message,"error")}))}async function S(e,a=undefined){I();const t=null!=e.nombreArticulo.match(/(Varis|Varios)/i);if(void 0!=a&&-1==a.pointerId)return;let l=e.idArticle,u=d.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===n.value||"MOVER_ARTICULO"===n.value)return"MOVER_ARTICULO"===n.value?void T().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void D.Z.post("articulos/getArticulo",{idArticulo:l,idCliente:u}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");w.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!h.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=r?.value?.prohibirSuplementos&&e.suplementos?.length>0)g.value.abrirModal(e.idArticle,h.value._id,h.value.idCliente,e.suplementos,y.value>0?y.value:1);else if(t)c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:h.value._id,unidades:y.value>0?y.value:1,arraySuplementos:null,peso:!1,nom:e.nombreArticulo});else{const a=await D.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:h.value._id,unidades:y.value>0?y.value:1,arraySuplementos:null,nombre:"",menu:i.value[s.value].nombre});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}else t?await c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:h.value._id,unidades:y.value,arraySuplementos:null,peso:!0,nom:e.nombreArticulo}):f.value.abrirModal(e.idArticle,h.value._id,e.nombreArticulo)}catch(m){T().fire("Oops...",m.message,"error")}}const H=(0,t.Fl)((()=>{let e=E();if(i.value&&i.value[s.value]&&i.value[s.value].arraySubmenus&&i.value[s.value].arraySubmenus[p.value])for(let a=0;a<i.value[s.value].arraySubmenus[p.value].arrayTeclas.length;a++)e[i.value[s.value].arraySubmenus[p.value].arrayTeclas[a].pos]=i.value[s.value].arraySubmenus[p.value].arrayTeclas[a];else if(i.value&&i.value[s.value]&&i.value[s.value].arrayTeclas)for(let a=0;a<i.value[s.value].arrayTeclas.length;a++)e[i.value[s.value].arrayTeclas[a].pos]=i.value[s.value].arrayTeclas[a];return e}));function U(e){return parseInt(e,16)||e}function j(e){return U(e)/255<=.03928?U(e)/255/12.92:Math.pow((U(e)/255+.055)/1.055,2.4)}function F(e){return.2126*j(e.substr(1,2))+.7152*j(e.substr(3,2))+.0722*j(e.substr(-2))}function V(e,a){const o=F(e),t=F(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function W(e){const a=V(e,"#ffffff"),o=V(e,"#000000");return a>o?"#ffffff":"#000000"}function O(e){}function P(e){return e?"MOVER_ARTICULO"==n.value?"Mover aqui":"Vacío":n.value}function R(e){let a=i.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[p.value].nombre,t=`[${a.nombre}]${o}`),"MOVER_ARTICULO"==n.value)return w.value.botonVacio(e,t);C.value.abrirModal(e,t)}function N(e,a=undefined){B.value=setTimeout((()=>{z(e.idArticle),B.value=null}),500)}function $(e,a=undefined){B.value&&!x.value&&(clearTimeout(B.value),S(e,a),Z()),clearTimeout(B.value)}function Z(){x.value=!0,setTimeout((()=>{x.value=!1}),70)}function L(e){if(!e)return 0;let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return a}return(0,t.JJ)("addItem",O),(0,t.bv)((()=>{u.value&&0!==u.value?.length||l.push("menu/fichajes"),D.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(M.value=!0):M.value=!1,void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(b.value=!0):b.value=!1,void 0!=e.data?.nombreEmpresa&&void 0!=e.data?.params?.AlertaJoanets?"tena"==e.data?.nombreEmpresa?.toLowerCase()&&"Si"==e.data?.params?.AlertaJoanets&&(A.value=!0):A.value=!1}))})),a({clickTecla:S}),{teclado:i,precioTecla:b,indexMenuActivo:s,arrayTeclas:H,getTextColor:W,modalPesoRef:f,modalSuplementosRef:g,modalAlergenosRef:_,modalEditarProdRef:w,modalCrearProdRef:C,abrirFicha:z,clickTecla:S,NoSuplementos:M,isEditarArticulos:P,editarArticulo:R,modalVarisRef:c,startPress:N,endPress:$,pressTimeout:B,opBloquado:x,getAnimation:L,AlertaJoanets:A,cesta:h}}};const ha=(0,A.Z)(Ma,[["render",Z],["__scopeId","data-v-938c647a"]]);var ka=ha;const Da={key:0,class:"table-responsive divCesta reverso"},Ba={class:"table colorFuente"},Ta={class:"tableBody"},xa=["onClick"],Aa={class:"cantidad"},za={class:"d-inline-block text-truncate xUnidades",style:{"max-width":"18rem","min-width":"14rem"}},Ea={key:0,id:"suplementos"},Ia={id:"promocionDetalles"},Sa={key:0,class:"col-12"},Ha={"d-flex":"","justify-content-around":"",style:{"max-width":"7rem","min-width":"7rem"}},Ua={class:"ms-2 d-inline nombreArtPromocion"},ja={class:"ms-2 d-inline"},Fa={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},Va={key:1,class:"d-flex row col-12"},Wa={class:"col-12"},Oa={"d-flex":"","justify-content-around":""},Pa={style:{"max-width":"7rem","min-width":"7rem"},class:"nombreArtPromocion"},Ra={class:"pe-1"},Na={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},$a={class:"col-12"},Za={"d-flex":"","justify-content-around":""},La={style:{"max-width":"7rem","min-width":"7rem"},class:"nombreArtPromocion"},qa={class:"pe-1"},Ya={class:"xUnidades ms-2 d-inline",style:{width:"fit-content"}},Ga={class:"xUnidades d-inline",style:{width:"fit-content",margin:"0 0.07rem"}},Ja={key:0,style:{"max-width":"6rem","min-width":"10rem","vertical-align":"middle",padding:"0.5rem 1.4rem","font-weight":"bold"}},Ka={key:1},Qa={key:0,class:"fw-bold"};function Xa(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBCardTitle"),u=(0,t.up)("MDBCardText"),m=(0,t.up)("MDBCardBody"),p=(0,t.up)("MDBCard");return l.cesta&&l.cesta.lista?((0,t.wg)(),(0,t.iD)("div",Da,[(0,t._)("table",Ba,[(0,t._)("tbody",Ta,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cesta.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:l.indexItemCestaActivo===a,sePuedeRegalar:l.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>l.clickItem(a)},[(0,t._)("td",Aa,[(0,t._)("span",za,[(0,t.Uk)((0,d.zw)(e.nombre)+" ",1),e.arraySuplementos?.length>0?((0,t.wg)(),(0,t.iD)("div",Ea,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,d.zw)(e.nombre),1)))),128))])):(0,t.kq)("",!0),(0,t._)("div",Ia,[null==e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("li",Sa,[(0,t._)("span",Ha,[(0,t._)("td",Ua,(0,d.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",ja,(0,d.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",Fa," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])])):null!=e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("tr",Va,[(0,t._)("li",Wa,[(0,t._)("span",Oa,[(0,t._)("td",Pa,(0,d.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",Ra,(0,d.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",Na," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])]),(0,t._)("li",$a,[(0,t._)("span",Za,[(0,t._)("td",La,(0,d.zw)(l.recortarNombreArtSec(e)),1),(0,t._)("td",qa,(0,d.zw)(e.promocion.precioRealArticuloSecundario)+" € ",1),(0,t._)("td",Ya," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloSecundario),1)])])])):(0,t.kq)("",!0)])]),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:0,onClick:a=>l.restar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.unidades<=1||e.pagado},{default:(0,t.w5)((()=>[(0,t.Uk)(" - ")])),_:2},1032,["onClick","disabled"])),(0,t._)("span",Ga," x"+(0,d.zw)(0!=e.gramos&&e.gramos?(e.gramos/1e3).toFixed(3)+"kg":e.unidades),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:1,onClick:a=>l.sumar(e),color:"primary",floating:"",class:"cambiarUnidades",disabled:e.promocion||e.pagado},{default:(0,t.w5)((()=>[(0,t.Uk)(" + ")])),_:2},1032,["onClick","disabled"]))]),"CONSUMO_PERSONAL"!==l.cesta.modo&&"DEVOLUCION"!==l.cesta.modo?((0,t.wg)(),(0,t.iD)("td",Ja,[(0,t.Uk)((0,d.zw)(e.subtotal.toFixed(2))+" € ",1),l.sePuedeRegalar(e)?((0,t.wg)(),(0,t.j4)(i,{key:0,color:"secondary",onClick:o=>l.clickRegalo(a,e),size:"sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"gift",size:"lg"})])),_:2},1032,["onClick"])):(0,t.kq)("",!0)])):(0,t.kq)("",!0)],10,xa)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",Ka,[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),l.arrayTrabajadores&&l.arrayTrabajadores[l.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",Qa,(0,d.zw)(l.arrayTrabajadores[l.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(i,{color:"primary",onClick:a[0]||(a[0]=e=>l.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,d.zw)(l.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})]))}var eo={name:"CestaComponent",components:{MDBCard:h.Yl,MDBCardBody:h.H7,MDBCardTitle:h.QM,MDBCardText:h.Pp,MDBBtn:h.$v,MDBIcon:h.vm},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),i=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),s=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),c=(0,k.iH)(0),u=(0,t.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(s.value&&s.value[d.value]&&l.value[e]._id==s.value[d.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",l.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),l.value[e];return null})),m=(0,k.iH)(0);function p(){u.value?.idCliente?D.Z.post("clientes/consultarPuntos",{idCliente:u.value?.idCliente}).then((e=>{"number"===typeof e.data?m.value=e.data:m.value=0})).catch((e=>{T().fire("Oops...",e.message,"error"),m.value=0})):m.value=0}const f=async e=>{if(e.regalo)return;await o.dispatch("Unidades/setUnidades",1);const a=await D.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:u.value._id,unidades:1,arraySuplementos:e.arraySuplementos,nombre:"",menu:r.value[n.value].nombre});a.data||o.dispatch("Unidades/setUnidades",-1)},b=(0,k.iH)(!1),g=async e=>{if(e.unidades<=1||e.regalo||b.value)return;b.value=!0,await o.dispatch("Unidades/setUnidades",-1);const a=await D.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:u.value._id,unidades:-1,arraySuplementos:e.arraySuplementos,nombre:"",menu:r.value[n.value].nombre});a.data||o.dispatch("Unidades/setUnidades",1),b.value=!1};function w(){if(s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]){let e=!0;if(void 0!=u.value&&"DEVOLUCION"==u?.value?.modo)return;for(let a=0;a<l.value.length;a++)if(l.value[a].trabajador==s.value[d.value].idTrabajador){D.Z.post("cestas/cambiarCestaTrabajador",{idCesta:l.value[a]._id,idTrabajador:s.value[d.value]._id}),e=!1;break}if(!e)return;C(),e=!1}else s.value&&void 0!=d.value&&null!=d.value?T().fire("Oops...","Error desconocido #123","error"):T().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function C(){s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?(await D.Z.post("cestas/crearCesta",{idTrabajador:s.value[d.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{T().fire("Oops...",e.message,"error")})),c.value=0):s.value&&void 0!=d.value&&null!=d.value||T().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function _(e){return 1!=u.value?.albaran&&null!=u.value.idCliente&&void 0!=u.value.idCliente&&""!=u.value.idCliente&&null!=e.puntos&&(m.value>c.value+e.puntos&&!e.regalo)}function y(e,a=null){D.Z.post("cestas/regalarProducto",{idCesta:u.value._id,indexLista:e,idPromoArtSel:a}).then((e=>{e.data?T().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):T().fire("Oops...","No se ha podido regalar el producto","error")}))}function M(){u.value&&(c.value=0,u.value.lista.forEach((e=>{e.regalo&&(c.value+=e.puntos)})))}async function h(e,a){if(null!=a.promocion?.idArticuloSecundario){const t=await D.Z.post("articulos/getArticuloById",{idArticulo:a.promocion.idArticuloPrincipal}),l=await D.Z.post("articulos/getArticuloById",{idArticulo:a.promocion.idArticuloSecundario}),n=null==t.data.puntos?"bloqueado":"",r=null==l.data.puntos?"bloqueado":"",i=`\n                <style>\n                input[type="radio"] {\n          appearance: none;\n          -webkit-appearance: none;\n          width: 20px;\n          height: 20px;\n          border: 2px solid black;\n          border-radius: 50%;\n\n          background-color: transparent;\n          position: relative;\n        }\n        .inputRegalo{\n          margin-left: 3rem ; /* Margen izquierdo de 2 columnas */\n          display: flex ; /* Display flex */\n          margin-top: 0.5rem ; /* Margen superior de 2 espacios */\n          margin-bottom: 0.5rem ;\n        }\n\n        label {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-left:5px;\n        }\n        .bloqueado {\n          pointer-events: none; /* Hace que el div no sea cliclable */\n          opacity: 0.6; /* Establece una opacidad inferior al normal (puedes ajustar el valor según tus preferencias) */\n        }\n        input[type="radio"]:checked::before {\n          content: "";\n          display: block;\n          width: 12px;\n          height: 12px;\n          background-color: #ca8489;\n          border-radius: 50%;\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n          animation: appear 0.8s;\n        }\n        @keyframes appear {\n          0% {\n            transform: translate(-50%, -50%) scale(0);\n            background-color: #fff;\n          }\n          45% {\n            transform: translate(-50%, -50%) scale(1.6);\n            background-color: #64aedf;\n          }\n          50% {\n            transform: translate(-50%, -50%) scale(1.7);\n            background-color: #ad97b3;\n          }\n          55% {\n            transform: translate(-50%, -50%) scale(1.6);\n          }\n          100% {\n            transform: translate(-50%, -50%) scale(1);\n            background-color: #ca8489;\n          }\n        }\n        </style>\n        <div class="col-12 mx-auto" >\n          <div class="inputRegalo ${n}">\n            <input type="radio"  name="opcion" id="opcion1" value="${a.promocion.idArticuloPrincipal}">\n            <label for="opcion1" class="col-9 d-flex">${x(a)} ${t.data.puntos=""==n?t.data.puntos*a.promocion.cantidadArticuloPrincipal*a.unidades+" p":""}</label>\n          </div>\n          <div class="inputRegalo ${r}">\n            <input type="radio"  name="opcion" id="opcion2" value="${a.promocion.idArticuloSecundario}">\n            <label for="opcion2" class="col-9 d-flex">${A(a)} ${l.data.puntos=""==r?l.data.puntos*a.promocion.cantidadArticuloSecundario*a.unidades+" p":""}</label>\n          </div>\n        </div>\n        `;T().fire({title:"¿Cual articulo para regalar?",html:i,icon:"question",showDenyButton:!0,showConfirmButton:!0,confirmButtonText:"Si, regalar",denyButtonText:"No",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"},showClass:{popup:""},didOpen:()=>{const e=document.querySelector(".bloqueado");if(e){const a=e.querySelector("label").textContent;T().showValidationMessage(`${a} no se puede regalar`)}},preConfirm:()=>{const e=document.getElementsByName("opcion"),a=Array.from(e).find((e=>e.checked));return a?a.value:(T().showValidationMessage("Debes seleccionar una opción"),!1)}}).then((a=>{a.isConfirmed?(y(e,a.value),o.state.indexItemActivo=null):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}else T().fire({title:"¿Regalar este artículo?",text:`Se descontarán ${null!=a.puntos?a.puntos:0} puntos al cliente ${u.value.nombreCliente}`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?y(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)}))}function B(e){o.dispatch("Cestas/setActivoAction",e)}function x(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function A(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}return(0,t.YP)((()=>u.value?.lista),(()=>{M()})),a({actualizarPuntos:p,BuscarCestas:w}),(0,t.bv)((()=>{p()})),{cesta:u,arrayTrabajadores:s,indexTrabajadorActivo:d,indexItemCestaActivo:i,clickItem:B,inicializarCesta:C,BuscarCestas:w,sePuedeRegalar:_,puntos:m,recortarNombreArtPrinc:x,recortarNombreArtSec:A,sumar:f,restar:g,clickRegalo:h}}};const ao=(0,A.Z)(eo,[["render",Xa],["__scopeId","data-v-1fe5b679"]]);var oo=ao;const to={class:"modoVenta d-block text-center"},lo={key:0,class:"d-block textoNombreCliente text-center"},no={class:"text-truncate",style:{"max-width":"10rem"}},ro={key:1,class:"d-block text-center textoNombreCliente"};function io(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBBtnGroup"),u=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),v=(0,t.up)("ModalUnidadesComponent"),f=(0,t.up)("tarjetaClienteNumero"),b=(0,t.up)("ModalEncargosComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[l.vistaEspecial&&l.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==l.cesta.modo,fondoCliente:l.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",to,(0,d.zw)(l.cesta.modo),1),l.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",lo,[(0,t._)("span",no,(0,d.zw)(l.cesta.nombreCliente),1),(0,t.Wm)(i,{onClick:a[0]||(a[0]=e=>l.consultarPuntos(l.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",ro,(0,d.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(c,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>l.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[2]||(a[2]=e=>l.refModalArticulos.abrirModal()),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:l.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),l.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>l.refModalClientesSeleccionado.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"secondary",class:"botones ms-1",onClick:a[4]||(a[4]=e=>l.refModalClientes.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1}))])),_:1})),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(c,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{onClick:a[5]||(a[5]=e=>l.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[6]||(a[6]=e=>l.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(i,{onClick:a[7]||(a[7]=e=>l.goTo("/cestas")),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:!l.siMesas}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1},8,["class"])])),_:1})),(0,t.Wm)(c,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==l.indexActivoCesta||null==l.indexActivoCesta?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"secondary",class:"botones",onClick:a[8]||(a[8]=e=>l.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"secondary",class:"botones",onClick:a[9]||(a[9]=e=>l.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(i,{onClick:a[10]||(a[10]=e=>l.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(i,{outline:"secondary",onClick:a[11]||(a[11]=e=>l.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",size:"4x"})])),_:1})])),_:1}),(0,t.Wm)(u,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(v,{ref:"refModalUnidades"},null,512),(0,t.Wm)(f,{ref:"tarjetaNum"},null,512),(0,t.Wm)(b,{ref:"refModalEncargos"},null,512)],64)}var so=o(54455),co=o(89131);const uo=e=>((0,t.dD)("data-v-87b8dff6"),e=e(),(0,t.Cn)(),e),mo={class:"header"},po={class:"col-md-8"},vo=["value"],fo=uo((()=>(0,t._)("div",{class:"col-md-12"},[(0,t._)("hr")],-1))),bo={class:"textoNombre d-inline-block text-truncate"},go={key:0,class:"spinner-border",role:"status",style:{margin:"2%"}},wo=uo((()=>(0,t._)("span",{class:"visually-hidden"},"Loading...",-1))),Co=[wo],_o={key:1,style:{margin:"2%"}},yo={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function Mo(e,a,o,l,n,r){const i=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBBadge"),c=(0,t.up)("MDBListGroupItem"),u=(0,t.up)("MDBListGroup"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModal"),v=(0,t.up)("KeyBoardComponent"),b=(0,t.Q2)("mdb-infinite-scroll");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:l.modalArticulos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",mo,[(0,t._)("div",po,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",style:{"background-color":"#00ffff00"},placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example",readonly:"",onClick:a[0]||(a[0]=e=>l.openKeyboard()),"onUpdate:modelValue":a[1]||(a[1]=e=>l.inputBusqueda=e)},null,512),[[f.nr,l.inputBusqueda]])]),(0,t._)("select",{class:"Familia",onChange:a[2]||(a[2]=e=>l.selectFamilia(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.familias,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",value:l.familias[a].text},(0,d.zw)(l.familias[a].text),9,vo)))),256))],32)]),fo,l.arrayArticulos?.length>0?(0,t.wy)(((0,t.wg)(),(0,t.j4)(u,{key:0,class:"container",style:{"max-height":"461px","overflow-y":"scroll"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.j4)(c,{key:e.i,style:{"justify-content":"space-between"},class:"d-flex align-items-center",onClick:e=>l.selectArticulo({nombreArticulo:a.nombre,idArticle:a._id,esSumable:a.esSumable})},{default:(0,t.w5)((()=>[(0,t._)("td",null,[(0,t.Wm)(i,{icon:"tag",size:"2x",class:"me-4"}),(0,t._)("span",bo,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(s,{class:"textoFamilia d-inline-block text-truncate text-dark",badge:"info",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(a.familia),1)])),_:2},1024)])])),_:2},1032,["onClick"])))),128)),((0,t.wg)(),(0,t.j4)(c,{key:e.i,style:{"justify-content":"center"},class:"d-flex align-items-center"},{default:(0,t.w5)((()=>[l.maxLimit?((0,t.wg)(),(0,t.iD)("div",_o,[(0,t._)("span",yo,(0,d.zw)(e.$t("sin_resultados","No hay mas resultados")),1)])):((0,t.wg)(),(0,t.iD)("div",go,Co))])),_:1}))])),_:1})),[[b,l.infiniteScroll]]):(0,t.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{ref:"keyboardRef"},null,512)],64)}var ho=o(61562),ko={name:"ModalArticulosComponent",directives:{mdbInfiniteScroll:h.z9},components:{MDBModal:h.j3,MDBIcon:h.vm,MDBModalBody:h.Yz,MDBBtn:h.$v,MDBListGroup:h.d8,MDBListGroupItem:h.FQ,MDBBadge:h.m_,MDBSelect:h.R3,KeyBoardComponent:ho.Z,MDBModalFooter:h.ab},setup(e,a){const o=(0,k.iH)(!1),l=(0,k.iH)(0),n=(0,k.iH)(null),r=(0,k.iH)(""),i=(0,k.iH)(),s=(0,k.iH)([{text:"Todos",value:"Todos"}]),d=(0,k.iH)("Todos"),c=(0,k.iH)(20),u=(0,k.iH)(!1),m=(0,t.f3)("clickTecla"),p=async()=>{c.value=c.value+20,await C()};function v(e){m(e),o.value=!1}async function f(){o.value=!0,c.value=20,u.value=!1,i.value=[],await g(),C()}function b(){l.value++}function g(){D.Z.post("articulos/familias").then((e=>{s.value=e.data})).catch((e=>{T().fire("Oops...",e.message,"error")}))}async function w(e){d.value=e.target.value,c.value=20,u.value=!1,i.value=[],await C()}function C(){""!=r.value&&0==i.value.length&&(c.value=c.value+20*r.value.length),u.value=!1,D.Z.post("articulos/buscar",{busqueda:r.value,familia:d.value,limit:c.value}).then((e=>{i.value=e.data,c.value>i.value.length&&(u.value=!0)})).catch((e=>{T().fire("Oops...",e.message,"error")}))}let _;async function y(){try{n.value.abrirModal(r.value),_=setInterval((()=>{r.value=n.value.getValue()[0],n.value.getValue()[1]||clearInterval(_)}),100)}catch(e){console.log(e),_=void 0}}return(0,t.YP)(r,(()=>{C()})),a.expose({abrirModal:f,datoBorrar:l}),(0,t.bv)((async()=>{await g()})),{test:b,openKeyboard:y,maxLimit:u,datoBorrar:l,infiniteScroll:p,familias:s,keyboardRef:n,modalArticulos:o,selectFamilia:w,inputBusqueda:r,arrayArticulos:i,buscar:C,selectArticulo:v}}};const Do=(0,A.Z)(ko,[["render",Mo],["__scopeId","data-v-87b8dff6"]]);var Bo=Do;const To={class:"row"},xo={class:"row"},Ao={class:"text-center"};function zo(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("NumpadComponent"),u=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:l.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("introduce","Introduce"))+" "+(0,d.zw)(e.$t("las_unidades","las unidades"))+" "+(0,d.zw)(e.$t("y_marca","y marca"))+" "+(0,d.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",To,[l.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>l.refUnidadesComponent.cantidad=e)},null,512)),[[f.nr,l.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",xo,[(0,t._)("div",Ao,[(0,t.Wm)(c,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Eo={name:"UnidadesComponent",components:{NumpadComponent:K.Z,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalHeader:h.ol,MDBModalTitle:h.wo},setup(){const e=(0,k.iH)(null),a=(0,k.iH)(null),o=(0,v.oR)();function l(){a.value=!0}function n(e){if(e>100)return T().fire({title:"Has añadido muchos productos.",html:`Vas a añadir <b>${e}<b/> productos,<br/><i> ¿estás segur@ de esta acción?</i>`,showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",confirmButtonColor:"info",cancelButtonColor:"green",iconColor:"info",icon:"info"}).then((t=>{t.isConfirmed&&(a.value=!1,o.dispatch("Unidades/setUnidades",e))}));a.value=!1,o.dispatch("Unidades/setUnidades",e)}return(0,t.JJ)("okValue",n),{refUnidadesComponent:e,modalUnidades:a,abrirModal:l}}};const Io=(0,A.Z)(Eo,[["render",zo],["__scopeId","data-v-7e0f404e"]]);var So=Io;const Ho={class:"text-center col-12 p3"},Uo={class:"text-center h2"},jo={class:"row"},Fo={class:"d-inline-block text-center"},Vo={class:"d-inline-block text-center"},Wo={id:"salir",class:"text-center"};function Oo(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),u=(0,t.up)("ModalEncargosComponent"),m=(0,t.up)("ModalDeudasComponent"),p=(0,t.up)("ModalFichaCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalClientesSeleccionado,"onUpdate:modelValue":a[5]||(a[5]=e=>l.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ho,[(0,t._)("span",Uo,(0,d.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,d.zw)(l.cesta.nombreCliente),1)]),(0,t._)("div",jo,[(0,t._)("div",Fo,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>l.abrirModalEncargos())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>l.abrirModalDeuda())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("Deudas","deudas")),1)])),_:1})]),(0,t._)("div",Vo,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>l.ficha())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ficha","Ficha")),1)])),_:1})]),(0,t._)("div",Wo,[(0,t.Wm)(i,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>l.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"refModalEncargos"},null,512),(0,t.Wm)(m,{ref:"refModalDeudas"},null,512),(0,t.Wm)(p,{ref:"refModalFichaCliente",callback:l.cambiosCliente},null,8,["callback"])],64)}const Po=e=>((0,t.dD)("data-v-7b7d4cd6"),e=e(),(0,t.Cn)(),e),Ro={class:"row"},No={class:"d-inline-block text-center"},$o={class:"p-0"},Zo={class:"text-center mt-2 mb-3"},Lo=["min","max"],qo=["min","max"],Yo={id:"lista"},Go=["onClick"],Jo={class:"d-flex m-0 p-0 justify-content-between"},Ko={key:0,class:"p-0"},Qo={key:0},Xo={key:1},et={key:1,class:"p-0",type:"button"},at={key:2,class:"p-0",type:"button"},ot={class:"d-flex justify-content-between px-0 py-2 m-0"},tt={class:"d-flex m-0 p-0 justify-content-between"},lt={class:"productos"},nt={class:"col-12"},rt={class:"col-3"},it={class:"col-1"},st={class:"col-1"},dt={class:"col-2"},ct={class:"col-2"},ut={class:"col-3"},mt={class:"d-flex flex-column justify-content-center"},pt={key:0},vt={key:1},ft={key:1},bt={class:"sinResultados position-relative"},gt={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},wt={id:"salir"},Ct={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},_t=Po((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),yt={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},Mt=Po((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1))),ht={class:"h4 mx-2 pb-2 border-bottom"},kt={class:"d-flex justify-content-around"},Dt={class:"my-3 d-flex flex-column"},Bt={for:"dateStart",class:"h5"},Tt=["min","max"],xt={class:"my-3 d-flex flex-column"},At={for:"dateFinal",class:"h5"},zt=["min","max"],Et={class:"h4 mx-2 pb-2 border-bottom"},It={class:"d-flex justify-content-around my-3"},St=Po((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden1",value:"producto"},null,-1))),Ht={for:"orden1",class:"h6"},Ut=Po((()=>(0,t._)("input",{type:"radio",name:"orden",id:"orden2",value:"cliente"},null,-1))),jt={for:"orden2",class:"h6"},Ft={class:"h6"},Vt=Po((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function Wt(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),u=(0,t.up)("MDBModalTitle"),m=(0,t.up)("MDBModalHeader"),p=(0,t.up)("MDBModalFooter");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",labelledby:"tituloModalClientes",modelValue:l.modalEncargos,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ro,[(0,t._)("div",No,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/encargos")),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1},8,["disabled"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.recoger,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.anular,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.abrirModalImprimir,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick","disabled"])]),(0,t._)("div",$o,[(0,t._)("h4",Zo,[(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>l.startSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[2]||(a[2]=e=>l.mostrar())},null,40,Lo),[[f.nr,l.startSelectedDate]]),(0,t.Uk)(" al "),(0,t.wy)((0,t._)("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>l.finalSelectedDate=e),class:"datePicker",min:l.startInputDate,max:l.finalInputDate,onChange:a[4]||(a[4]=e=>l.mostrar())},null,40,qo),[[f.nr,l.finalSelectedDate]])]),(0,t._)("div",Yo,[l.encargos&&l.encargos.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(l.encargos,((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>l.onClickEncargo(o),class:(0,d.C_)({active:l.seleccionado===o,horaTarde:1==l.horaTarde(a),diaTarde:1==l.diaTarde(a)})},[(0,t._)("div",Jo,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Ko,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",Qo,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",Xo,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",et,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",at,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a.dias[0].dia)+" - "+(0,d.zw)(a.dias[0].dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",ot,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta.toFixed(2))+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("div",tt,[(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("p",null,(0,d.zw)(e.$t("dependienta","Dependienta"))+": "+(0,d.zw)(a?.nombreDependienta),1)]),(0,t._)("div",lt,[(0,t._)("table",nt,[(0,t._)("tr",null,[(0,t._)("th",rt,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",it,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",st,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",dt,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",ct,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",ut,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",mt,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",pt,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",vt,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,Go)])))),128)):((0,t.wg)(),(0,t.iD)("div",ft,[(0,t._)("div",bt,[(0,t._)("span",gt,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])]),(0,t._)("div",wt,[(0,t._)("div",Ct,[_t,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(i,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[5]||(a[5]=e=>{l.seleccionado=-1,l.modalEncargos=!1}),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1},8,["disabled"]),(0,t._)("div",yt,[Mt,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{id:"modalImprimirEncargos",tabindex:"-1",labelledby:"tituloModalImprimirEncargos",modelValue:l.modalImprimirEncargos,"onUpdate:modelValue":a[13]||(a[13]=e=>l.modalImprimirEncargos=e),staticBackdrop:"",centered:"",onHidden:l.cerrarModalImprimir},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir_encargos","Imprimir encargos")),1)])),_:1})])),_:1}),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("h2",ht,(0,d.zw)(e.$t("selecciona_un_intervalo","Selecciona un intervalo")),1),(0,t._)("div",kt,[(0,t._)("div",Dt,[(0,t._)("label",Bt,(0,d.zw)(e.$t("fecha_inicial","Fecha inicial"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateStart",class:"h5","onUpdate:modelValue":a[7]||(a[7]=e=>l.dateStart=e),min:l.startInputDate,max:l.finalInputDate},null,8,Tt),[[f.nr,l.dateStart]])]),(0,t._)("div",xt,[(0,t._)("label",At,(0,d.zw)(e.$t("fecha_final","Fecha final"))+":",1),(0,t.wy)((0,t._)("input",{type:"date",name:"",id:"dateFinal",class:"h5","onUpdate:modelValue":a[8]||(a[8]=e=>l.dateFinal=e),min:l.startInputDate,max:l.finalInputDate},null,8,zt),[[f.nr,l.dateFinal]])])]),(0,t._)("h2",Et,(0,d.zw)(e.$t("orden_de_impresion:","Orden de impresión"))+": ",1),(0,t._)("div",It,[(0,t._)("div",{class:"inputOrden",onClick:a[9]||(a[9]=e=>l.orden="producto")},[St,(0,t._)("label",Ht,(0,d.zw)(e.$t("producto","Producto")),1)]),(0,t._)("div",{class:"inputOrden",onClick:a[10]||(a[10]=e=>l.orden="Cliente")},[Ut,(0,t._)("label",jt,(0,d.zw)(e.$t("cliente","Cliente")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!l.errorValidacionImp},"my-2 text-center"])},[(0,t._)("p",Ft,[Vt,(0,t.Uk)(" "+(0,d.zw)(l.commentError),1)])],2)])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{color:"success",size:"lg",onClick:a[11]||(a[11]=e=>l.imprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","imprimir")),1)])),_:1}),(0,t.Wm)(i,{color:"warning",size:"lg",onClick:a[12]||(a[12]=e=>l.cerrarModalImprimir())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","onHidden"])],64)}var Ot={name:"modalEncargosComponent",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalFooter:h.ab,MDBModalBody:h.Yz,MDBBtn:h.$v},setup(e,a){const o=(0,k.iH)(!1),l=(0,v.oR)(),n=(0,ya.tv)(),r=(0,k.iH)(null),i=((0,k.iH)(0),(0,k.iH)()),s=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?s.value[d.value]:null)),u=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(s.value&&s.value[d.value]&&u.value[e]._id==s.value[d.value].idCesta)return u.value[e];return null})),p=new Date,f=(0,k.iH)(-1),b=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0),g=(0,k.iH)(null),w=(0,k.iH)(null),C=(0,k.iH)(null),_=(0,k.iH)(null);b.setDate(b.getDate()+1);let y="1";const M=(0,k.iH)(null),h=(0,k.iH)(null),B=(0,k.iH)(!1),x=(0,k.iH)(null),A=(0,k.iH)(null),z=(0,k.iH)(null),E=(0,k.iH)(null),I=(0,k.iH)(!1);function S(){r.value=!0,H()}function H(){D.Z.post("/encargos/getEncargos").then((e=>{M.value=e.data;let a=null,o=null;if(0!=M.length){for(const e of M.value){1==e.opcionRecogida&&"am"==e.amPm&&(e.hora="14:59"),1==e.opcionRecogida&&"pm"==e.amPm&&(e.hora="23:59");const t=new Date(e.fecha);(null===a||t<a)&&(a=t),(null===o||t>o)&&(o=t)}C.value=a?.toISOString().slice(0,10),g.value=a?.toISOString().slice(0,10),w.value=o?.toISOString().slice(0,10),_.value=o?.toISOString().slice(0,10),F()}}))}function U(e){r.value=!0,D.Z.post("/encargos/getEncargoById",{idEncargo:e}).then((async e=>{if(h.value=[e.data],"SIN_RECOGER"!=h.value[0].estado)return r.value=!1,void T().fire({icon:"info",title:"Este encargo ya se ha pagado/anulado",showConfirmButton:!0});if(h.value[0].total==h.value[0].dejaCuenta){try{const e=await D.Z.post("tickets/crearTicketEncargo",{idEncargo:h.value[0]._id,total:h.value[0].total,dejaCuenta:h.value[0].dejaCuenta,tipo:"EFECTIVO",idTrabajador:c.value._id});if(!e.data)throw Error("No se ha podido crear el ticket");h.value.splice(0,1),f.value=-1,H(),T().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!0}),n.push("/main"),r.value=!1}catch(a){T().fire("Oops...",a.message,"error")}finally{o.value=!1}F()}}))}function j(e){n.push(e)}function F(){h.value=[];for(const e of M.value){const a=e.fecha;a>=g.value&&a<=w.value&&h.value.push(e)}h.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function V(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),l=a.getMinutes(),n=o.getHours(),r=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getDate()==o.getDate()&&(n<t||n==t&&r<l)}function W(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getMonth()>o.getMonth()||a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function O(e){f.value=e}function P(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}async function R(){o.value=!0,-1!=f.value?await T().fire({title:"Precio por pagar: "+P(h.value[f.value].total-h.value[f.value].dejaCuenta,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar compra",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed)try{const e=await D.Z.post("tickets/crearTicketEncargo",{idEncargo:h.value[f.value]._id,total:h.value[f.value].total,dejaCuenta:h.value[f.value].dejaCuenta,tipo:"EFECTIVO",idTrabajador:c.value._id});if(!e.data)throw Error("No se ha podido crear el ticket");h.value.splice(f.value,1),f.value=-1,H(),T().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),n.push("/main")}catch(a){T().fire("Oops...",a.message,"error")}finally{o.value=!1}else o.value=!1})):(T().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),o.value=!1)}function N(){-1!=f.value?T().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((e=>{e.isConfirmed&&(h.value[f.value].dejaCuenta>0&&D.Z.post("movimientos/nuevoMovimiento",{cantidad:h.value[f.value].dejaCuenta,concepto:"dejaACuenta",idTrabajador:c.value._id,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{T().fire("Oops...",e.message,"error")})),D.Z.post("/encargos/anularEncargo",{id:h.value[f.value]._id}).then((e=>{e?.data?(h.value.splice(f.value,1),f.value=-1,H(),T().fire("Perfecto","Encargo anulado correctamente","success")):T().fire("Oops...","Encargo no anulado","error")})).catch((e=>{T().fire("Oops...",e.message,"error")})))})):T().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function $(){B.value=!0}function Z(){I.value=!1,E.value="",B.value=!1,z.value=null}function L(){if(!x.value||!A.value)return E.value="Por favor, ingresa ambas fechas",void(I.value=!0);if(A.value<x.value)return E.value="La fecha final no puede ser anterior a la fecha inicial",void(I.value=!0);if(null==z.value)return E.value="Elige una opción de orden",void(I.value=!0);{const e=[];for(const a of M.value){const o=a.fecha;o>=x.value&&o<=A.value&&e.push(a)}D.Z.post("/encargos/imprimirEncargosHoy",{orden:z.value,array:e}).then((e=>{e?.data?T().fire("Perfecto","imprimiendo encargos","success"):T().fire("Oops...","error al imprimir","error"),Z()})).catch((e=>{T().fire("Oops...",e.message,"error")}))}}return a.expose({abrirModal:S,getEncargo:U}),{modalEncargos:r,arrayClientes:i,cesta:m,goTo:j,encargos:h,mostrar:F,listado:y,seleccionado:f,onClickEncargo:O,recoger:R,anular:N,redondearDecimales:P,diaTarde:W,horaTarde:V,cargarEncargos:H,imprimir:L,botonBloqueado:o,getEncargo:U,startSelectedDate:g,finalSelectedDate:w,startInputDate:C,finalInputDate:_,abrirModalImprimir:$,modalImprimirEncargos:B,errorValidacionImp:I,dateStart:x,dateFinal:A,orden:z,commentError:E,cerrarModalImprimir:Z}}};const Pt=(0,A.Z)(Ot,[["render",Wt],["__scopeId","data-v-7b7d4cd6"]]);var Rt=Pt;const Nt=e=>((0,t.dD)("data-v-39291f62"),e=e(),(0,t.Cn)(),e),$t={class:"row"},Zt={class:"d-inline-block text-center"},Lt={class:"p-0"},qt={class:"d-flex justify-content-around"},Yt={class:"pb-2"},Gt={class:"col-md-3 pb-2"},Jt=Nt((()=>(0,t._)("option",{value:"1"},"Todos",-1))),Kt=Nt((()=>(0,t._)("option",{value:"2"},"Albaranes",-1))),Qt=Nt((()=>(0,t._)("option",{value:"3"},"No Albaranes",-1))),Xt=[Jt,Kt,Qt],el={id:"lista"},al={key:0,class:"sinResultados d-flex align-items-center justify-content-center"},ol=Nt((()=>(0,t._)("div",{class:"spinner"},null,-1))),tl=[ol],ll=["onClick"],nl={class:"d-flex m-0 p-0 justify-content-between"},rl={class:"productos"},il={class:"col-12"},sl=Nt((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),dl={class:"d-flex flex-column justify-content-center"},cl={key:0},ul={key:1},ml={key:2},pl={class:"sinResultados position-relative"},vl={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"},fl={id:"salir"};function bl(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBBadge"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBModal"),m=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalDeudas,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalDeudas=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",$t,[(0,t._)("div",Zt,[(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/deudas"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nueva_deuda","Nueva deuda")),1)])),_:1}),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.pagar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.eliminar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(i,{color:"primary",class:"ms-2 sizeBotones",onClick:l.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",Lt,[(0,t._)("div",qt,[(0,t._)("div",Yt,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por cliente","aria-label":".form-control-lg example","onUpdate:modelValue":a[1]||(a[1]=e=>l.inputBusqueda=e),onClick:a[2]||(a[2]=e=>l.openKeyboard()),readonly:"",style:{"background-color":"white"}},null,512),[[f.nr,l.inputBusqueda]])]),(0,t._)("div",Gt,[(0,t.wy)((0,t._)("select",{id:"filtro",class:"form-select selectFiltro w-100",name:"filtro","aria-label":".form-control-lg example","onUpdate:modelValue":a[3]||(a[3]=e=>l.selectFiltro=e),onChange:a[4]||(a[4]=e=>l.filtrarLista())},Xt,544),[[f.bM,l.selectFiltro]])])]),(0,t._)("div",el,[l.loading?((0,t.wg)(),(0,t.iD)("div",al,tl)):l.arrayDeudas&&l.arrayDeudas.length>0?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:1},(0,t.Ko)(l.arrayDeudas,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:a},[(0,t._)("div",{type:"button",onClick:e=>l.onClickDeuda(a),class:(0,d.C_)({active:l.seleccionado===a})},[(0,t._)("div",nl,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(l.getFecha(e?.timestamp)),1),(0,t._)("p",null,[(0,t.Uk)(" Cliente: "+(0,d.zw)(e?.nombreCliente),1),e?.albaran?((0,t.wg)(),(0,t.j4)(s,{key:0,badge:"info",class:"text-dark custom-badge",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Albaran")])),_:1})):(0,t.kq)("",!0)]),(0,t._)("p",null,"Dinero a pagar: "+(0,d.zw)(e?.total.toFixed(2))+"€",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(e?.cesta?.lista?.length),1),(0,t._)("div",rl,[(0,t._)("table",il,[sl,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",dl,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",cl,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",ul,"Ninguno"))])])))),128))])])],10,ll)])))),128)):((0,t.wg)(),(0,t.iD)("div",ml,[(0,t._)("div",pl,[(0,t._)("span",vl,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])]),(0,t._)("div",fl,[(0,t.Wm)(i,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[5]||(a[5]=e=>{l.seleccionado=-1,l.modalDeudas=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(m,{ref:"keyboardRef"},null,512)],64)}var gl={name:"modaldeudasComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,KeyBoardComponentVue:ho.Z,MDBBadge:h.m_},setup(e,a){const o=(0,k.iH)(null),l=(0,ya.tv)(),n=(0,k.iH)(null),r=(0,k.iH)(null),i=(0,k.iH)(-1),s=(0,k.iH)(null),d=(0,k.iH)(""),c=(0,k.iH)("1");function u(){o.value=!0,p()}const m=(0,k.iH)(!1);function p(){m.value=!0,D.Z.post("/deudas/getDeudas").then((async e=>{n.value=e.data.filter((e=>!e?.pagado||!e?.enviado)),n.value.sort(((e,a)=>e.timestamp-a.timestamp));for(const a of n.value){const e=(await D.Z.post("clientes/getClienteById",{idCliente:a.idCliente})).data;a.albaran=e?.albaran}r.value=n.value,m.value=!1,v()})).catch((e=>{m.value=!1}))}function v(){switch(c.value){case"1":r.value.sort(((e,a)=>e.timestamp-a.timestamp));break;case"2":r.value.sort(((e,a)=>e.albaran&&!a.albaran?-1:!e.albaran&&a.albaran?1:0));break;case"3":r.value.sort(((e,a)=>e.albaran&&!a.albaran?1:!e.albaran&&a.albaran?-1:0));break;default:break}}function f(e=0,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e?.toFixed(a)):0===Number(e?.toFixed(a))?0:e}function b(e){i.value=e}function g(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2),n=("0"+a.getHours()).slice(-2),r=("0"+a.getMinutes()).slice(-2),i=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+l+" "+n+":"+r+":"+i);return s}function w(){D.Z.post("impresora/abrirCajon")}async function C(){-1!=i.value?(w(),await T().fire({title:"Precio por pagar: "+f(r.value[i.value].total,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar compra",cancelButtonText:"Cancelar",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed)try{const e=await D.Z.post("deudas/ticketPagado",{idDeuda:r.value[i.value]._id});if(e.data.error)throw Error("No se ha podido pagar la deuda");r.value.splice(i.value,1),i.value=-1,p(),T().fire({icon:"success",title:"Deuda pagada correctamente",showConfirmButton:!1,timer:500}),l.push("/main")}catch(a){T().fire("Oops...",a.message,"error")}}))):T().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function _(){-1!=i.value?T().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((e=>{e.isConfirmed&&D.Z.post("/deudas/eliminarDeuda",{idDeuda:r.value[i.value]._id}).then((e=>{e?.data?(r.value.splice(i.value,1),i.value=-1,p(),T().fire("Perfecto","Deuda eliminada correctamente","success")):T().fire("Oops...","Deuda no eliminada","error")})).catch((e=>{T().fire("Oops...",e.message,"error")}))})):T().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function y(){T().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input">\n          </div>\n          <div id="fechas my-input-class"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input">\n          </div>',showCancelButton:!0,cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||T().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(T().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;D.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&T().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function M(){const e=d?.value,a=[];if(e&&e.length>0){for(let o=0;o<n.value.length;o++)n.value[o].nombreCliente.toLowerCase().includes(e.toLocaleLowerCase())&&a.push(n.value[o]);r.value=a}else r.value=n.value}function h(e){l.push(e)}let B;async function x(){try{s.value.abrirModal(d.value),B=setInterval((()=>{d.value=s.value.getValue()[0],s.value.getValue()[1]||clearInterval(B)}),100)}catch(e){console.log(e),B=void 0}}return(0,t.YP)(d,(()=>{M()})),a.expose({abrirModal:u}),{modalDeudas:o,goTo:h,cargarDeudas:p,redondearDecimales:f,deudasFiltradas:n,arrayDeudas:r,onClickDeuda:b,seleccionado:i,pagar:C,getFecha:g,eliminar:_,imprimir:y,buscar:M,openKeyboard:x,keyboardRef:s,inputBusqueda:d,loading:m,filtrarLista:v,selectFiltro:c}}};const wl=(0,A.Z)(gl,[["render",bl],["__scopeId","data-v-39291f62"]]);var Cl=wl;const _l={class:"row"},yl={class:"col w-50"},Ml={class:"col w-50 datos"};function hl(e,a,o,l,n,r){const i=(0,t.up)("MDBModalHeader"),s=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:l.modalFichaCliente,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,d.zw)(l.nombre),1)])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",_l,[(0,t._)("div",yl,[(0,t.Wm)(s,{label:"Nombre",modelValue:l.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e),style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Teléfono",modelValue:l.telefono,"onUpdate:modelValue":a[1]||(a[1]=e=>l.telefono=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Correo electrónico",modelValue:l.email,"onUpdate:modelValue":a[2]||(a[2]=e=>l.email=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Dirección",modelValue:l.direccion,"onUpdate:modelValue":a[3]||(a[3]=e=>l.direccion=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])]),(0,t._)("div",Ml,[(0,t.Wm)(s,{label:"Tarjeta cliente",modelValue:l.tarjeta,"onUpdate:modelValue":a[4]||(a[4]=e=>l.tarjeta=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Documento de identidad",modelValue:l.nif,"onUpdate:modelValue":a[5]||(a[5]=e=>l.nif=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Descuento aplicado",modelValue:l.descuento,"onUpdate:modelValue":a[6]||(a[6]=e=>l.descuento=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"primary",onClick:a[7]||(a[7]=e=>l.guardarCliente())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Guardar ")])),_:1}),(0,t.Wm)(u,{color:"danger",onClick:a[8]||(a[8]=e=>l.modalFichaCliente=!1),ref:"salirBoton"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},512)])),_:1})])),_:1},8,["modelValue"])}var kl={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:h.$v,MDBInput:h.u2,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBModalHeader:h.ol},setup(e,a){const o=(0,k.iH)(!1),l=e=>{o.value=!0,b(e)};a.expose({abrirModal:l});const n=(0,k.iH)(""),r=(0,k.iH)(""),i=(0,k.iH)(""),s=(0,k.iH)(""),d=(0,k.iH)(""),c=(0,k.iH)(""),u=(0,k.iH)("0"),m=(0,k.iH)(null),p=(0,k.iH)(null),v=(0,t.f3)("cambiosCliente"),f=()=>{""!=n.value?isNaN(Number(u.value))?T().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):D.Z.post("clientes/actualizarCliente",{idCliente:m.value,nombre:n.value,telefono:r.value,email:i.value,direccion:s.value,tarjetaCliente:d.value,nif:c.value,descuento:u.value}).then((()=>{T().fire({title:"Cliente actualizado",icon:"success",confirmButtonText:"Aceptar"}),o.value=!1})).finally((()=>{e.callback({nombre:n.value,descuento:u.value})})):T().fire({title:"Vaya...",text:"No se puede dejar el nombre vacio",icon:"error",confirmButtonText:"Aceptar"})},b=async e=>{const{data:a}=await D.Z.post("/clientes/getClienteById",{idCliente:e});if(!a)throw new Error("No se ha podido cargar el cliente");n.value="null"==a.nombre?"":a.nombre,r.value="null"==a.telefono?"":a.telefono,i.value="null"==a.email?"":a.email,s.value="null"==a.direccion?"":a.direccion,d.value="null"==a.tarjetaCliente?"":a.tarjetaCliente,c.value="null"==a.nif?"":a.nif,u.value="null"==a.descuento?"":a.descuento,m.value="null"==a.id?"":a.id};return{modalFichaCliente:o,guardarCliente:f,nombre:n,telefono:r,email:i,direccion:s,tarjeta:d,nif:c,descuento:u,salirBoton:p,cambiosCliente:v}}};const Dl=(0,A.Z)(kl,[["render",hl]]);var Bl=Dl,Tl={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,ModalEncargosComponent:Rt,ModalDeudasComponent:Cl,ModalFichaCliente:Bl},setup(e,a){const o=(0,v.oR)(),l=(0,k.iH)(null),n=((0,k.iH)(0),(0,k.iH)()),r=(0,k.iH)(null),i=(0,k.iH)(null),s=(0,k.iH)(null),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),u=((0,t.Fl)((()=>d.value&&void 0!=c.value&&null!=c.value&&d.value[c.value]?d.value[c.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),m=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(d.value&&d.value[c.value]&&u.value[e]._id==d.value[c.value].idCesta)return u.value[e];return null}));function p(){l.value=!0}async function f(){if(u.value&&m.value)for(let e=0;e<u.value.length;e++)if(u.value[e]._id===m.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),await o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}l.value=!1}a.expose({abrirModal:p});const b=()=>{s.value.abrirModal(m.value.idCliente)};function g({nombre:e,descuento:a}){m.value.nombreCliente=e,o.dispatch("Cestas/setDescuentoAction",Number(a/100))}function w(){D.Z.get("deudas/getUpdateDeudas").then((e=>{e.data?i.value.abrirModal():T().fire({title:"Actualizando deudas",html:"Descargando deudas debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{T().showLoading(),D.Z.post("deudas/descargarDeudas").then((e=>{e.data?(i.value.abrirModal(),T().close()):T().fire({title:"Error",text:"No se han podido actualizar las deudas. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&i.value.abrirModal()}))})).catch((e=>{T().fire("Oops...",e.message,"error")}))}})}))}function C(){D.Z.get("encargos/getUpdateEncargos").then((e=>{e.data?r.value.abrirModal():T().fire({title:"Actualizando encargos",html:"Descargando encargos debido a cambios en el toc",allowOutsideClick:!1,didOpen:()=>{T().showLoading(),D.Z.post("encargos/descargarEncargos").then((e=>{e.data?(r.value.abrirModal(),T().close()):T().fire({title:"Error",text:"No se han podido actualizar los encargos. ¿Deseas entrar de todos modos?",icon:"error",showCancelButton:!0,confirmButtonText:"Entrar de todos modos",cancelButtonText:"Cerrar"}).then((e=>{e.isConfirmed&&r.value.abrirModal()}))})).catch((e=>{T().fire("Oops...",e.message,"error")}))}})}))}return(0,t.JJ)("cambiosClientes",g),{modalClientesSeleccionado:l,arrayClientes:n,cesta:m,resetGeneral:f,refModalEncargos:r,refModalDeudas:i,ficha:b,refModalFichaCliente:s,cambiosCliente:g,abrirModalDeuda:w,abrirModalEncargos:C}}};const xl=(0,A.Z)(Tl,[["render",Oo],["__scopeId","data-v-8e64418e"]]);var Al=xl,zl={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:h.Ff,MDBBtn:h.$v,MDBIcon:h.vm,ModalClientesComponent:co.Z,ModalArticulosComponent:Bo,ModalUnidadesComponent:So,CestaComponentVue:oo,ModalClientesSeleccionadoComponent:Al,ModalEncargosComponent:Rt},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Configuracion.parametros)),n=(0,k.iH)(null),r=(0,k.iH)(null),i=(0,k.iH)(null),s=(0,k.iH)(null),d=(0,k.iH)(null),c=(0,k.iH)(null),u=(0,k.iH)(null),m=(0,k.iH)(!1),p=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),f=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),b=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),g=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),w=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let C="",_="";const y=(0,k.iH)(!1),M=(0,k.iH)(!0),h=(0,t.Fl)((()=>{if(f.value)for(let e=0;e<f.value.length;e++)if(b.value&&b.value[w.value]&&f.value[e]._id==b.value[w.value].idCesta)return f.value[e];return null}));function B(){null!=g.value&&void 0!=g.value&&h.value&&o.dispatch("Cestas/deleteIndex",{index:g.value,idCesta:h.value._id})}async function x(){h.value&&(o.dispatch("Cestas/deleteLista",h.value._id),await D.Z.post("impresora/saludo").catch((e=>{T().fire("Oops...",e.message,"error")})))}function A(){p.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function z(e){so.Z.push(e)}function E(e){D.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");T().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{T().fire("Oops...",e.message,"error")}))}async function I(){if(f.value&&h.value)for(let e=0;e<f.value.length;e++)if(f.value[e]._id===h.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==h.value.modo)D.Z.post("cestas/fulminarCesta",{idCesta:h.value._id}).then((e=>{if(!e.data)throw Error("No se ha podido eliminar la cesta en el servidor")})).catch((e=>{T().fire("Oops...",e.message,"error")}));else if(f.value&&h.value)for(let e=0;e<f.value.length;e++)if(f.value[e]._id===h.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),null!=h.value.idCliente&&o.dispatch("Cestas/setDescuentoAction",Number(0)),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}}function S(e){D.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((e=>{e.data?n.value.selectCliente(e.data.id,e.data.nombre):T().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}async function H(e){const a=await D.Z.post("encargos/getEncargoByNumber",{idEncargo:e});return!!a.data&&(s.value?.getEncargo(a.data._id),!0)}async function U(e){if("Shift"==e)return null;if("Enter"==e){const e=await H(_);return e||S(C),C="",void(_="")}_+=e,C+=e}function j(){D.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(u.value=e.data[0]._id,D.Z.post("impresora/imprimirTicket",{idTicket:u.value}).catch((e=>{T().fire("Oops...",e.message,"error")}))):T().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}return a({resetGeneral:I}),(0,t.bv)((()=>{h.value&&(h.value.idCliente||"VENTA"!=h.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),D.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?(M.value="Si"==e.data?.params?.mesas,y.value="Si"==e.data?.params?.prohibirBuscarArticulos):(y.value=!1,M.value=!0)}))})),{indexActivoCesta:g,borrarItem:B,borrarLista:x,vistaEspecial:p,changeVistaCliente:A,cesta:h,goTo:z,refModalClientes:n,refModalArticulos:r,refModalUnidades:i,CestaComponent:d,resetGeneral:I,consultarPuntos:E,parametros:l,NoBuscarProducte:y,siMesas:M,imprimirUltimoTicket:j,idTicket:u,getCodigo:U,tarjetaClienteNumero:C,refModalClientesSeleccionado:c,clickEncargoAtajo:H,refModalEncargos:s,hayPagados:m}},methods:{onKeydown(e){if("Shift"==e.key)return null;this.getCodigo(e.key)}},mounted(){document.addEventListener("keydown",this.onKeydown)}};const El=(0,A.Z)(zl,[["render",io],["__scopeId","data-v-8d90d70c"]]);var Il=El;const Sl=e=>((0,t.dD)("data-v-322855d2"),e=e(),(0,t.Cn)(),e),Hl={class:"row"},Ul={class:"nombreMesa d-inline-block text-truncate"},jl={key:0},Fl={key:1},Vl=["selected","value"],Wl={class:"row"},Ol={class:"disponible"},Pl={class:"nodisponible"},Rl={class:"again"},Nl={class:"esperandoVenta"},$l={key:4,class:"d-inline text-center grupoContento pt-1"},Zl=Sl((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"100",height:"35"},null,-1))),Ll=[Zl],ql={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},Yl={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},Gl={class:"row mt-1"},Jl=Sl((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),Kl={class:"letraTotal ms-3 mt-2"},Ql={class:"text-start fst-italic informacion"},Xl={class:"nomTienda"},en={class:"h4 mx-2 py-2 border-bottom"},an={class:"d-flex justify-content-between mt-3 mx-2"},on=Sl((()=>(0,t._)("input",{type:"radio",name:"tipo",id:"tipo1",value:"CONSUMO_PERSONAL"},null,-1))),tn={for:"tipo1",class:"h5"},ln=Sl((()=>(0,t._)("input",{type:"radio",name:"tipo",id:"tipo2",value:"VENTA"},null,-1))),nn={for:"tipo2",class:"h5"},rn={class:"h5"},sn=Sl((()=>(0,t._)("i",{class:"fa fa-exclamation-circle text-danger","aria-hidden":"true"},null,-1)));function dn(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBModalTitle"),u=(0,t.up)("MDBModalHeader"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),f=(0,t.up)("modalCobroViewVue"),b=(0,t.up)("modalUltimosImportes");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Hl,[(0,t._)("div",Ul,[l.cesta&&l.cesta.indexMesa>=0&&l.arrayMesas[l.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",jl,(0,d.zw)(l.arrayMesas[l.cesta?.indexMesa].nombre),1)):(0,t.kq)("",!0),(l.cesta||l.cesta?.indexMesa||l.arrayMesas)&&l.arrayMesas[l.cesta?.indexMesa]?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",Fl,(0,d.zw)(e.$t("en_tu_cesta","En tu cesta")),1))]),(0,t._)("select",{class:"nombreTrabajador selecTrabajador",onChange:a[0]||(a[0]=e=>l.selectDependienta(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",selected:l.arrayTrabajadores[a]==l.trabajadorActivo,value:a},(0,d.zw)(l.arrayTrabajadores[a].nombre),9,Vl)))),256))],32)]),(0,t._)("div",Wl,["ONLINE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:0,onClick:a[1]||(a[1]=e=>{l.datafonoDisponible(),l.modalUltimosImportesRef.abrirModal(l.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Ol,(0,d.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1})),"OFFLINE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:1,onClick:a[2]||(a[2]=e=>{l.datafonoDisponible(),l.modalUltimosImportesRef.abrirModal(l.trabajadorActivo)}),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Pl,(0,d.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})),"AGAIN"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:2,outline:"warning",class:"botonEstado",onClick:a[3]||(a[3]=e=>l.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",Rl,(0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})),"PENDIENTE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(i,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",Nl,(0,d.zw)(l.procesoDatafono),1)])),_:1})),"BUSCANDO"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",$l,Ll)),"APROBADA"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",ql,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"fas",size:"2x"})])),"DENEGADA"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Yl,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"fas",size:"2x"})]))]),(0,t._)("div",Gl,[l.cesta&&l.getTotal(l.cesta)>0&&"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&("CONSUMO_PERSONAL"===l.cesta.modo||"DEVOLUCION"===l.cesta.modo)?((0,t.wg)(),(0,t.j4)(i,{key:0,outline:"primary",class:"botonPagar",onClick:a[4]||(a[4]=e=>l.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),Jl])),_:1})):l.cesta&&l.getTotal(l.cesta)>0&&"CONSUMO_PERSONAL"!==l.cesta.modo?((0,t.wg)(),(0,t.j4)(i,{key:1,outline:"primary",class:"botonPagar",onClick:a[5]||(a[5]=e=>l.handleCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",Kl,(0,d.zw)(l.getTotal(l.cesta).toFixed(2))+" € ",1)])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.j4)(i,{key:2,onClick:a[6]||(a[6]=e=>l.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&l.cesta&&0===l.getTotal(l.cesta)?((0,t.wg)(),(0,t.j4)(i,{key:3,outline:"primary",class:"botonPagar",onClick:a[7]||(a[7]=e=>l.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",Ql,[(0,t.Uk)("("+(0,d.zw)(l.conexionInternet)+")(v"+(0,d.zw)(l.tocVersion)+") (",1),(0,t._)("a",Xl,(0,d.zw)(l.nombreTienda),1),(0,t.Uk)(") "+(0,d.zw)(l.getClock),1)])]),(0,t.Wm)(v,{id:"modalCobroCondicional",tabindex:"-1",labelledby:"modalCobroCondicional",modelValue:l.modalCobroCondicional,"onUpdate:modelValue":a[12]||(a[12]=e=>l.modalCobroCondicional=e),staticBackdrop:"",centered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{class:"h3 ms-2"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(l.cesta.nombreCliente)+" "+(0,d.zw)(e.$t("es_un_trabajador","es un trabajador")),1)])),_:1})])),_:1}),(0,t.Wm)(m,{class:"py-3"},{default:(0,t.w5)((()=>[(0,t._)("h2",en,(0,d.zw)(e.$t("elige_el_tipo_de_cobro","Elige el tipo de cobro"))+": ",1),(0,t._)("div",an,[(0,t._)("div",{class:"inputCobroCond",onClick:a[8]||(a[8]=e=>l.tipo="CONSUMO_PERSONAL")},[on,(0,t._)("label",tn,(0,d.zw)(e.$t("consumo_personal","Consumo personal")),1)]),(0,t._)("div",{class:"inputCobroCond",onClick:a[9]||(a[9]=e=>l.tipo="VENTA")},[ln,(0,t._)("label",nn,(0,d.zw)(e.$t("ticket_normal","Ticket normal")),1)])]),(0,t._)("div",{class:(0,d.C_)([{"d-none":!l.errorValidacionTipo},"m-2 text-center"])},[(0,t._)("p",rn,[sn,(0,t.Uk)(" "+(0,d.zw)(l.commentError),1)])],2)])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,{color:"success",size:"lg",onClick:a[10]||(a[10]=e=>l.confirmarTipo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("confirmar","confirmar")),1)])),_:1}),(0,t.Wm)(i,{color:"warning",size:"lg",onClick:a[11]||(a[11]=e=>l.cerrarModalCobroCondicional())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cancelar","Cancelar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{ref:"modalCobroViewVueRef"},null,512),(0,t.Wm)(b,{ref:"modalUltimosImportesRef"},null,512)],64)}const cn=e=>((0,t.dD)("data-v-2af12cf4"),e=e(),(0,t.Cn)(),e),un={class:"row"},mn={class:"row mt-2"},pn={class:"col-md-3"},vn={class:"text-center"},fn={class:"mt-4"},bn={id:"detalleTicket"},gn={class:"contencionTicket"},wn={class:"table"},Cn={class:"titulosTicket"},_n={class:"titulosTicket"},yn={class:"titulosTicket"},Mn=cn((()=>(0,t._)("hr",null,null,-1))),hn={class:"sizeLetrasCambio"},kn={key:0,class:"sizeLetrasCambio"},Dn={key:1,class:"estiloFalta sizeLetrasCambio"},Bn={key:2,class:"estiloPerfecto sizeLetrasCambio"},Tn={key:3,class:"estiloSobra sizeLetrasCambio"},xn={class:"col-md-9",style:{"padding-left":"4vmin"}},An={class:"row"},zn={class:"col text-end",style:{"margin-top":"2vmin"}},En=["src","onClick"],In={class:"row mt-2"},Sn={class:"col text-end",style:{"margin-top":"2vmin"}},Hn=["src","onClick"],Un={class:"row"},jn={class:"col mt-4"},Fn={class:"divBotones"},Vn={class:"row"},Wn={class:"cantidad text-center"},On={class:"row mt-2"},Pn={class:"col text-center"},Rn={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Nn(e,a,o,l,n,r){const i=(0,t.up)("MDBCardTitle"),s=(0,t.up)("MDBCardText"),c=(0,t.up)("MDBBtn"),u=(0,t.up)("MDBCardBody"),m=(0,t.up)("MDBCard"),p=(0,t.up)("ModalTkrsComponent"),v=(0,t.up)("NumpadComponent"),f=(0,t.up)("MDBModalBody"),b=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(b,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:l.modalCobro,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalCobro=e),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{style:{"background-color":"#fff5e9"}},{default:(0,t.w5)((()=>[(0,t._)("div",un,[(0,t._)("div",mn,[(0,t._)("div",pn,[(0,t.Wm)(m,{class:"cardInfoCambio",style:{height:"80vmin"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{style:{display:"flex","flex-direction":"column","justify-content":"space-evenly"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t._)("h2",vn,(0,d.zw)(e.$t("ticket","Ticket"))+": "+(0,d.zw)(e.ticket),1)])),_:1}),(0,t._)("div",fn,[(0,t._)("div",bn,[(0,t._)("div",gn,[(0,t._)("table",wn,[(0,t._)("tr",null,[(0,t._)("th",Cn,(0,d.zw)(e.$t("producto","Producto")),1),(0,t._)("th",_n,(0,d.zw)(e.$t("subtotal","Subtotal")),1),(0,t._)("th",yn,(0,d.zw)(e.$t("unidades","Unidades")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,style:(0,d.j5)(e.pagado?"text-decoration: line-through":"")},[(0,t._)("td",null,(0,d.zw)(e.nombre),1),(0,t._)("td",null,(0,d.zw)((e.subtotal-e.subtotal*l.DescuentoCliente).toFixed(2))+" € ",1),(0,t._)("td",null,(0,d.zw)(e.unidades),1)],4)))),128))])]),Mn])]),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("li",hn,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,d.zw)((Math.round(100*l.aPagar)/100).toFixed(2))+" € ",1),null!=l.cantidadTkrs&&void 0!=l.cantidadTkrs?((0,t.wg)(),(0,t.iD)("li",kn,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido:"))+" "+(0,d.zw)(Number(l.totalRecibido+l.cantidadTkrs).toFixed(2))+" € ",1)):(0,t.kq)("",!0),null!=l.cuenta&&void 0!=l.cuenta&&l.cuenta>0?((0,t.wg)(),(0,t.iD)("li",Dn,(0,d.zw)(e.$t("faltan","Faltan"))+" "+(0,d.zw)((Math.round(100*l.cuenta)/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0),null!=l.cuenta&&void 0!=l.cuenta&&0==l.cuenta?((0,t.wg)(),(0,t.iD)("li",Bn,(0,d.zw)(e.$t("cambio_perfecto","Cambio perfecto")),1)):(0,t.kq)("",!0),null!=l.cuenta&&void 0!=l.cuenta&&l.cuenta<0?((0,t.wg)(),(0,t.iD)("li",Tn,(0,d.zw)(e.$t("sobran","Sobran"))+" "+(0,d.zw)((Math.round(100*(l.aPagar-l.totalRecibido))/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0)])),_:1}),(0,t._)("div",null,[(0,t.Wm)(c,{size:"lg",color:"warning",onClick:a[0]||(a[0]=e=>l.deshacer()),class:"sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("desahcer","Deshacer")),1)])),_:1}),(0,t.Wm)(c,{size:"lg",color:"danger",class:"sizeBotones",onClick:a[1]||(a[1]=e=>l.limpiar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("limpiar","Limpiar")),1)])),_:1})])])),_:1})])),_:1})]),(0,t._)("div",xn,[(0,t._)("div",An,[(0,t._)("div",zn,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([.01,.02,.05,.1,.2,.5,1,2],(e=>(0,t._)("img",{src:"/img/"+(e<1?100*e+"cts":1==e?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:a=>l.sumar(e)},null,8,En))),64))])]),(0,t._)("div",In,[(0,t._)("div",Sn,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([5,10,20,50,100,200,500],(e=>(0,t._)("img",{src:"/img/"+e+"euros.png",class:"sizeBilletes",onClick:a=>l.sumar(e)},null,8,Hn))),64))])]),(0,t._)("div",Un,[(0,t._)("div",jn,[(0,t._)("div",Fn,[(0,t._)("img",{src:"img/img-efectivo.png",onClick:a[2]||(a[2]=e=>l.setFormaPago("EFECTIVO")),style:(0,d.j5)("EFECTIVO"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,4),l.modalTkrsRef&&!l.prohibirTkRestaurant?((0,t.wg)(),(0,t.iD)("img",{key:0,src:"img/img-tkrs.png",onClick:a[3]||(a[3]=e=>l.modalTkrsRef.abrirModal()),style:(0,d.j5)("TKRS"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,4)):(0,t.kq)("",!0),0!==l.tipoDatafono3G||l.cliente?.albaran?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("img",{key:1,src:"img/img-tarjetas.png",onClick:a[4]||(a[4]=e=>l.setFormaPago("TARJETA")),style:(0,d.j5)("TARJETA"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,4)),1===l.tipoDatafono3G?((0,t.wg)(),(0,t.iD)("img",{key:2,src:"img/img-3g.png",onClick:a[5]||(a[5]=e=>l.setFormaPago("DATAFONO_3G")),style:(0,d.j5)("DATAFONO_3G"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,4)):(0,t.kq)("",!0)])])])])])]),(0,t.Wm)(p,{ref:"modalTkrsRef"},null,512),(0,t.Wm)(b,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:l.modalNumpad,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t._)("div",Vn,[(0,t._)("span",Wn,(0,d.zw)(),1)]),(0,t._)("div",On,[(0,t._)("div",Pn,[(0,t.Wm)(v,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{class:"ms-2 botoncicos-abajo",color:"warning",onClick:a[7]||(a[7]=e=>l.cancelarVenta())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("volver","VOLVER")),1)])),_:1}),(0,t.Wm)(c,{class:(0,d.C_)(["botonCobrar botoncicos-abajo",{disabled:l.loading}]),color:"primary",onClick:a[8]||(a[8]=e=>l.cobrar()),style:{right:"4vmin"}},{default:(0,t.w5)((()=>[l.loading?((0,t.wg)(),(0,t.iD)("span",Rn)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["class"])])),_:1})])),_:1},8,["modelValue"])}var $n=o(79066),Zn=o(32374),Ln=o(38020),qn={name:"CobroView",components:{CambioComponent:$n.Z,MDBCard:h.Yl,MDBBtn:h.$v,MDBCardBody:h.H7,MDBCardText:h.Pp,NumpadComponent:K.Z,VolverComponent:Zn.Z,ModalTkrsComponent:Ln.Z,MDBIcon:h.vm,MDBModal:h.j3,MDBModalBody:h.Yz},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,k.iH)(!1),n=(0,k.iH)(!1),r=(0,ya.tv)(),i=(0,k.iH)(null),s=(0,k.iH)("EFECTIVO"),d=(0,k.iH)(0),c=(0,k.iH)(null),u=(0,k.iH)(!1),m=(0,k.iH)(!1),p=(0,k.iH)(!1),f=(0,k.iH)(0),b=(0,k.iH)(!1),g=(0,k.iH)(0),w=(0,k.iH)(0),C=(0,k.iH)([]),_=(0,k.iH)([]),y=(0,t.f3)("resetGeneral"),M=(0,k.iH)(null);let h=(0,t.Fl)((()=>w.value-f.value<0?0:w.value-(g.value+f.value)));const B=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),x=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),A=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),z=(0,t.Fl)((()=>o.state.Cestas.Descuento)),E=(0,t.Fl)((()=>x.value&&void 0!=B.value&&null!=B.value&&x.value[B.value]?x.value[B.value]:null));let I=(0,k.iH)(null);function S(e){f.value=Number(e),e>=O(I.value)?s.value="TKRS":s.value="EFECTIVO"}function H(e){f.value<O(I.value)?"TARJETA"===e&&f.value>0?T().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):s.value=e:T().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error")}async function U(e){I=(0,t.Fl)((()=>{if(A.value)for(let e=0;e<A.value.length;e++)if(A.value[e]._id==x.value[B.value].idCesta)return A.value[e];return null})),_.value=I.value.lista;const a=I.value.lista.filter((e=>e.pagado)).reduce(((e,a)=>e+a.subtotal),0);w.value=O(I.value)-a,M.value=(await D.Z.post("clientes/getClienteById",{idCliente:I.value.idCliente})).data,l.value=!0}async function j(){b.value=!0;const e=JSON.parse(JSON.stringify(I.value.lista)),a=e.some((e=>e.pagado));try{if(M.value?.albaran)await D.Z.post("albaranes/crearAlbaran",{total:O(I.value),idCesta:I.value._id,idTrabajador:E.value._id,estado:"PAGADO"}).then((async e=>{if(await D.Z.post("movimientos/nuevoMovimiento",{cantidad:O(I.value),concepto:"Albaran",idTrabajador:E.value._id,tipo:"ENTRADA_DINERO"}),!e.data)throw Error("No se ha podido registrar el albaran");await D.Z.post("cestas/borrarCesta",{idCesta:I.value._id}),T().fire({icon:"success",title:"Albaran registrada correctamente",showConfirmButton:!1,timer:1e3}),await D.Z.post("impresora/imprimirTicket",{idTicket:e.data,albaran:!0}).catch((e=>{T().fire("Oops...",e.message,"error")})),await D.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{T().fire("Oops...",e.message,"error")})),await y()})).catch((e=>{T().fire("Oops...",e.message,"error")}));else{const e=await D.Z.post("tickets/crearTicket",{total:O(I.value),idCesta:I.value._id,idTrabajador:E.value._id,tipo:s.value,tkrsData:{cantidadTkrs:f.value,formaPago:"EFECTIVO"},honei:a});if(!e.data)throw Error("No se ha podido crear el ticket");await D.Z.post("impresora/saludo").catch((e=>{T().fire("Oops...",e.message,"error")})),p.value&&"TARJETA"!=s.value&&await D.Z.post("tickets/getUltimoTicket").then((async e=>{e.data[0]?._id?await D.Z.post("impresora/imprimirTicket",{idTicket:e.data[0]?._id}).catch((e=>{T().fire("Oops...",e.message,"error")})):T().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}"PAGO SEPARADO"==I.value.modo&&await W(I.value._id),"TARJETA"===s.value&&o.dispatch("Datafono/setEstado","PENDIENTE"),F(),s.value="EFECTIVO",l.value=!1}catch(t){T().fire("Oops...",t.message,"error")}b.value=!1,$()}function F(){let e=!1;A.value.forEach((a=>{if(!e&&a.trabajador===x.value[B.value]._id&&"DEVOLUCION"!=a.modo){e=!0;let o=a._id;D.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o,idTrabajador:x.value[B.value]._id})}}))}async function V(){l.value=!1,$(),"PAGO SEPARADO"==I.value.modo&&await D.Z.post("cestas/DevolverProductosACestaSep",{cesta:o.getters["Cestas/getCestaBaseActivo"],articulos:I.value.lista}).then((e=>{W(I.value._id)}))}async function W(e){D.Z.post("cestas/fulminarCesta",{idCesta:e}).catch((e=>{T().fire({icon:"error",title:"Error al eliminar la cesta (Pago dividido)",showConfirmButton:!1,timer:500})})),await D.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:x.value[o.state.Trabajadores.indexActivo]._id}).then((e=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}function O(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return a}function P(){D.Z.get("caja/estadoCaja").then((e=>{1==e.data&&T().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=e.data&&3!=e.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&r.push("/menu/fichajes"):r.push("/abrirCaja")})).catch((e=>{T().fire("Oops...",e.message,"error")}))}function R(e){g.value+=e,C.value.push(e)}function N(){C.value.pop();let e=0;C.value.forEach((a=>{e+=a})),g.value=e}function $(){g.value=0,f.value=0,C.value=[],h=(0,t.Fl)((()=>w.value-f.value<0?0:w.value-(g.value+f.value)))}function Z(e){w.value=Number(e)}return(0,t.JJ)("setTkrs",S),a({abrirModal:U}),(0,t.bv)((()=>{P(),D.Z.post("parametros/getParametros").then((e=>{"3G"!==e.data?.tipoDatafono&&"0.0.0.0"!=e.data?.ipTefpay||(d.value=1),void 0!=e.data?.params?.SempreTicket?"Si"==e.data?.params?.SempreTicket&&(p.value=!0):p.value=!1,void 0!=e.data?.params?.prohibirTkRestaurant?"Si"==e.data?.params?.prohibirTkRestaurant&&(u.value=!0):u.value=!1,void 0!=e.data?.params?.TicketDFAuto?"Si"==e.data?.params?.TicketDFAuto&&(m.value=!0):m.value=!1}))})),{DescuentoCliente:z,cesta:I,getTotal:O,cobrar:j,formaPago:s,modalTkrsRef:c,prohibirTkRestaurant:u,setFormaPago:H,loading:b,tipoDatafono3G:d,eliminarAlPagarFnc:W,modalNumpad:n,cancelarVenta:V,modalCobro:l,abrirModal:U,sumar:R,totalRecibido:g,aPagar:w,numPadRef:i,deshacer:N,limpiar:$,setTkrs:S,cantidadTkrs:f,setAPagar:Z,cuenta:h,productos:_,TicketDFAuto:m,cliente:M}}};const Yn=(0,A.Z)(qn,[["render",Nn],["__scopeId","data-v-2af12cf4"]]);var Gn=Yn;const Jn=e=>((0,t.dD)("data-v-22b1b4e2"),e=e(),(0,t.Cn)(),e),Kn=Jn((()=>(0,t._)("div",{class:"d-inline text-center mx-auto pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"300"})],-1))),Qn=Jn((()=>(0,t._)("h2",{class:"text-center mb-3"},"Últimos Importes",-1))),Xn={key:0,class:"Resultados d-flex flex-column col-8 mx-auto"},er={class:"col-12"},ar=["onClick"],or={class:"m-0"},tr={class:"m-0"},lr={class:"m-0"},nr={class:"m-0"},rr={class:"tcodPos"},ir={class:"divMain"},sr=Jn((()=>(0,t._)("span",{class:"h3 mb-3"},"Información de PayTef",-1))),dr=Jn((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Datos de la transacción ",-1))),cr={class:"info paytef col-10 mx-auto"},ur=Jn((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Información de transacción:")],-1))),mr={class:"m-0"},pr={class:"m-0"},vr={class:"m-0"},fr={class:"m-0"},br={class:"m-0"},gr=Jn((()=>(0,t._)("hr",null,null,-1))),wr={class:"info paytef col-10 mx-auto"},Cr=Jn((()=>(0,t._)("span",{class:"info paytef"},[(0,t._)("b",null,"Datos bancarios:")],-1))),_r={class:"m-0"},yr={class:"m-0"},Mr=Jn((()=>(0,t._)("span",{class:"h3 mb-3"},"Información del ticket",-1))),hr=Jn((()=>(0,t._)("h6",{class:"bg-light p-2 border-top border-bottom"}," Productos del ticket ",-1))),kr={class:"col-12"},Dr={class:"ms-2 me-auto"},Br={class:"col-12"},Tr={class:"text-truncate"},xr={class:"ms-2"},Ar={class:"ms-2 me-auto text-truncate"},zr={key:1},Er={class:"ms-2 me-auto mb-0"},Ir={key:2},Sr={class:"ms-2 me-auto mb-0"},Hr={class:"ms-2 me-auto mb-0"};function Ur(e,a,o,l,n,r){const i=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBIcon"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal"),f=(0,t.up)("MDBBadge"),b=(0,t.up)("MDBListGroupItem"),g=(0,t.up)("MDBListGroup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalUltimosImportes,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUltimosImportes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Datos del datáfono")])),_:1})])),_:1}),l.loading?((0,t.wg)(),(0,t.j4)(c,{key:0,style:{"align-self":"center"}},{default:(0,t.w5)((()=>[Kn])),_:1})):((0,t.wg)(),(0,t.j4)(c,{key:1},{default:(0,t.w5)((()=>[Qn,(l.importeEncontrado,(0,t.wg)(),(0,t.iD)("div",Xn,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.array,((e,a)=>((0,t.wg)(),(0,t.iD)("div",er,[(0,t._)("div",{class:"d-flex justify-content-between border border-2 p-2",style:(0,d.j5)([{"margin-bottom":"2%"},e.approved?"background-color:rgb(5 213 5 / 20%)":"background-color: rgb(227 100 100 / 20%)"]),onClick:o=>l.abrirModalDetallesImpote(a,e.reference)},[(0,t._)("p",or,"#"+(0,d.zw)(a+1),1),(0,t._)("p",tr,"Fecha: "+(0,d.zw)(e.timestamp),1),(0,t._)("p",lr,"Núm Ticket: "+(0,d.zw)(e.reference),1),(0,t._)("p",nr,"Precio: "+(0,d.zw)(e.amountWithSign)+" €",1),(0,t._)("div",null,[(0,t.Wm)(u,{icon:e.approved?"check-circle":"times-circle",style:(0,d.j5)(e.approved?"color: #33bf61":"color: red;")},null,8,["icon","style"])])],12,ar)])))),256))]))])),_:1})),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t._)("p",rr,"TCod: "+(0,d.zw)(l.tcod),1),(0,t.Wm)(m,{color:"secondary",onClick:a[0]||(a[0]=e=>l.modalUltimosImportes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalDetallesImporte,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalDetallesImporte=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" Ref. Paytef #"+(0,d.zw)(l.selectedTicket.reference),1)])),_:1}),l.selectedTicket.approved?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(m,{key:0,class:"ms-auto ms-4 modalHeader",color:"danger",onClick:a[2]||(a[2]=e=>l.tarjetaTicketById(l.selectedTicket.reference))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1}))])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",ir,[(0,t._)("div",null,[sr,dr,(0,t._)("div",cr,[ur,(0,t._)("p",mr,[(0,t.Wm)(u,{icon:"server"}),(0,t._)("span",{style:(0,d.j5)(1==l.selectedTicket.approved?"color:seagreen;":"color:indianred;")},"   "+(0,d.zw)(1==l.selectedTicket.approved?"Aprobado ✓":"Denegado ✖"),5)]),(0,t._)("p",pr,[(0,t.Wm)(u,{icon:"calendar-alt"}),(0,t.Uk)("    "+(0,d.zw)(l.fechaImporte),1)]),(0,t._)("p",vr,[(0,t.Wm)(u,{icon:"question"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.typeName),1)]),(0,t._)("p",fr,[(0,t.Wm)(u,{icon:"clipboard-check"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.reference),1)]),(0,t._)("p",br,[(0,t.Wm)(u,{icon:"euro-sign"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.amountWithSign)+" € ",1)])]),gr,(0,t._)("div",wr,[Cr,(0,t._)("p",_r,[(0,t.Wm)(u,{icon:"university"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.issuerNameAndCountry),1)]),(0,t._)("p",yr,[(0,t.Wm)(u,{icon:"credit-card"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.hiddenCardNumber),1)]),(0,t._)("p",null,[(0,t.Wm)(u,{icon:"globe-europe"}),(0,t.Uk)("    "+(0,d.zw)(l.selectedTicket.country),1)])])]),(0,t._)("div",null,[Mr,hr,(0,t._)("div",kr,[(0,t.Wm)(g,{light:"",class:"productos"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.productosArray,((e,a)=>((0,t.wg)(),(0,t.j4)(b,{class:"d-flex justify-content-between align-items-center"},{default:(0,t.w5)((()=>[(0,t._)("div",Dr,[(0,t._)("div",Br,[(0,t._)("span",Tr,(0,d.zw)(e.nombre),1),(0,t._)("span",xr,"x"+(0,d.zw)(e.unidades),1)]),null!=e.arraySuplementos?((0,t.wg)(!0),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",Ar," - "+(0,d.zw)(e.nombre.replace("(","")),1)))),256)):(0,t.kq)("",!0),null!=e.promocion&&null==e.promocion?.cantidadArticuloSecundario?((0,t.wg)(),(0,t.iD)("div",zr,[(0,t._)("p",Er,(0,d.zw)(l.recortarNombreArtPrinc(e))+" x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])):(0,t.kq)("",!0),null!=e.promocion&&null!=e.promocion?.cantidadArticuloSecundario?((0,t.wg)(),(0,t.iD)("div",Ir,[(0,t._)("p",Sr," - "+(0,d.zw)(l.recortarNombreArtPrinc(e))+" x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1),(0,t._)("p",Hr," - "+(0,d.zw)(l.recortarNombreArtSec(e))+" x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloSecundario),1)])):(0,t.kq)("",!0)]),(0,t.Wm)(f,{class:"badge-primary",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.subtotal)+" €",1)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])])])])),_:1}),(0,t.Wm)(p)])),_:1},8,["modelValue"])],64)}var jr=o(36797),Fr=o.n(jr),Vr={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,MDBIcon:h.vm,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalFooter:h.ab,MDBListGroup:h.d8,MDBListGroupItem:h.FQ,MDBBadge:h.m_},setup(e,a){const o=(0,v.oR)(),l=(0,k.iH)(!1),n=(0,k.iH)(!1),r=(0,k.iH)(null),i=(0,k.iH)(null),s=(0,k.iH)(null),d=(0,k.iH)([]),c=(0,k.iH)("cargando..."),u=(0,k.iH)(null),m=(0,k.iH)([]),p=(0,t.Fl)((()=>o.state.Caja.arrayVentas)),f=(0,k.iH)(!0),b=(0,k.iH)(null);function g(e){b.value=e,l.value=!0,y()}async function w(){for(const e of m.value){let{year:a,month:o,day:t,hour:l,minute:n,second:r,millisecond:i}=e.timestamp,s=`${a}-${(o<10?"0":"")+o}-${(t<10?"0":"")+t} ${(l<10?"0":"")+l}:${(n<10?"0":"")+n}:${(r<10?"0":"")+r}.${(i<10?"0":"")+i}`;e["timestamp"]=s}}async function C(e,a){try{_.value=m.value[e],Fr().locale("es"),s.value=Fr()(new Date(_.value.timestamp)).format("LLL"),d.value=await(0,t.Fl)((()=>p.value.find((e=>e._id==a)).cesta.lista)).value,n.value=!0}catch(o){console.log(o)}}const _=(0,k.iH)(null);async function y(){await D.Z.post("paytef/getLastFive").then((async e=>{e.data&&(m.value=e.data.reverse(),await w(),f.value=!1)}))}function M(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function h(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}function B(e){D.Z.post("paytef/cobrarTicketById",{idTrabajador:b.value.idTrabajador,idTicket:e}).then((()=>{o.dispatch("Datafono/setEstado","PENDIENTE"),l.value=!1,n.value=!1})).catch((e=>{T().fire("Oops...",e.message,"error")}))}return a.expose({abrirModal:g}),(0,t.bv)((async()=>{c.value=await D.Z.post("parametros/getParametros").then((e=>e.data.payteftcod))})),{modalUltimosImportes:l,importeEncontrado:r,importe:i,tcod:c,fecha:u,array:m,productosArray:d,modalDetallesImporte:n,abrirModalDetallesImpote:C,selectedTicket:_,fechaImporte:s,loading:f,recortarNombreArtPrinc:M,recortarNombreArtSec:h,tarjetaTicketById:B,trabajadorActivo:b}}};const Wr=(0,A.Z)(Vr,[["render",Ur],["__scopeId","data-v-22b1b4e2"]]);var Or=Wr,Pr={name:"MenuDerechaComponent",components:{MDBIcon:h.vm,MDBBtn:h.$v,MDBSelect:h.R3,modalCobroViewVue:Gn,modalUltimosImportes:Or,MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab},setup(){const e=(0,k.iH)(""),a=(0,k.iH)(""),o=(0,k.iH)(""),l=(0,v.oR)(),n=(0,k.iH)(!1),r=(0,k.iH)(!1),i=(0,k.iH)(null),s=(0,ya.tv)(),d=(0,k.iH)([]),c=(0,t.Fl)((()=>l.state.Cestas.Descuento)),u=(0,t.f3)("resetGeneral"),m=(0,k.iH)(""),p=(0,k.iH)(null),f=(0,k.iH)(!1),b=(0,k.iH)(null),g=(0,k.iH)("");async function w(){try{D.Z.get("https://jsonplaceholder.typicode.com/posts/1").then((e=>e.data?m.value="🟢":m.value="🔴")).catch((e=>m.value="🔴"))}catch(e){return m.value="🔴"}}w(),setInterval(w,1e4);const C=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),_=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),y=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),M=(0,t.Fl)((()=>l.state.Datafono.estado)),h=(0,t.Fl)((()=>l.state.Datafono.procesoActual)),B=(0,t.Fl)((()=>l.state.modoActual)),x=(0,t.Fl)((()=>C.value&&void 0!=y.value&&null!=y.value&&C.value[y.value]?C.value[y.value]:null)),A=(0,t.Fl)((()=>{if(_.value)for(let e=0;e<_.value.length;e++)if(C.value&&C.value[y.value]&&_.value[e]._id==C.value[y.value].idCesta)return _.value[e];return null})),z=(0,k.iH)(!1);function E(e){l.dispatch("Trabajadores/setIndexActivo",Number(e.target.value)),U("/main")}function I(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return a}function S(){D.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");d.value=e.data})).catch((e=>{T().fire("Oops...",e.message,"error")}))}function H(){"PENDIENTE"!=M.value&&(l.dispatch("Datafono/setEstado","BUSCANDO"),D.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((e=>l.dispatch("Datafono/setEstado",e.data))).catch((e=>l.dispatch("Datafono/setEstado","OFFLINE"))))}function U(e){s.push(e)}function j(){r.value||(D.Z.post("impresora/abrirCajon"),T().fire("AVISO","elige un artículo para ir a cobrar","info"))}function F(){D.Z.post("articulos/saveTeclas"),l.dispatch("setModoActual","NORMAL")}function V(){D.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:x.value._id}).then((()=>{l.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{T().fire("Oops...",e.message,"error")}))}function W(){z.value=!1,g.value="",f.value=!1,b.value=null}function O(){null!=b.value?(A.value.modo=b.value,W(),R()):(g.value="Elige una opción",f.value=!0)}async function P(){if(A.value.idCliente)try{const e=await D.Z.get("clientes/getIdTrabajadorCliente",{params:{idCliente:A.value.idCliente}});e.data?z.value=!0:R()}catch(e){R()}else R()}async function R(){const e=JSON.parse(JSON.stringify(A.value.lista));if(A.value)if("VENTA"===A.value.modo)if(A.value.idCliente&&""!=A.value.idCliente){const e=(await D.Z.post("clientes/getClienteById",{idCliente:A.value.idCliente})).data;e?.albaran&&e?.noPagaEnTienda?D.Z.post("albaranes/crearAlbaran",{total:I(A.value),idCesta:A.value._id,idTrabajador:x.value._id,estado:"NO_PAGA_EN_TIENDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");await D.Z.post("cestas/borrarCesta",{idCesta:A.value._id}),T().fire({icon:"success",title:"Albaran registrada correctamente",showConfirmButton:!1,timer:1500}),await D.Z.post("impresora/imprimirTicket",{idTicket:e.data,albaran:!0}).catch((e=>{T().fire("Oops...",e.message,"error")})),await D.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{T().fire("Oops...",e.message,"error")})),await u()})).catch((e=>{T().fire("Oops...",e.message,"error")})):(await D.Z.post("impresora/abrirCajon"),i.value.abrirModal())}else e.every((e=>e.pagado))?D.Z.post("tickets/crearTicket",{total:I(A.value),idCesta:A.value._id,idTrabajador:x.value._id,tipo:"HONEI",tkrsData:null}):(await D.Z.post("impresora/abrirCajon"),await D.Z.post("impresora/despedida",{precioTotal:I(A.value).toFixed(2)}),i.value.abrirModal());else"DEVOLUCION"===A.value.modo?D.Z.post("devoluciones/nuevaDevolucion",{total:I(A.value),idCesta:A.value._id,idTrabajador:x.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await T().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),u()})).catch((e=>{T().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===A.value.modo&&D.Z.post("tickets/crearTicket",{total:I(A.value),idCesta:A.value._id,idTrabajador:x.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");u(),T().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{T().fire("Oops...",e.message,"error")}));else T().fire("Oops...","El modo de la cesta es incorrecto","error")}function N(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),l=e.getHours();o.value=("0"+l).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(N,1e3),(0,t.bv)((()=>{S(),H(),D.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{T().fire("Error en getVersion CATCH")})),D.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.CalaixTancat?"Si"==e.data?.params?.CalaixTancat&&(r.value=!0):r.value=!1})),D.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.tipoDatafono?"3G"==e.data?.tipoDatafono&&(n.value=!0):n.value=!1}))})),{trabajadorActivo:x,DescuentoCliente:c,estadoDatafono:M,DescuentoCliente:c,cesta:A,arrayMesas:d,getTotal:I,goTo:U,abrirCajon:j,tarjetaUltimoTicket:V,modoActual:B,handleCobro:R,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:F,datafonoDisponible:H,procesoDatafono:h,use3g:n,selectDependienta:E,modalCobroViewVueRef:i,arrayTrabajadores:C,conexionInternet:m,modalUltimosImportesRef:p,handleCobroCondicional:P,modalCobroCondicional:z,errorValidacionTipo:f,commentError:g,tipo:b,confirmarTipo:O,cerrarModalCobroCondicional:W}}};const Rr=(0,A.Z)(Pr,[["render",dn],["__scopeId","data-v-322855d2"]]);var Nr=Rr,$r=o(32066),Zr=o(4286);const Lr={class:"container"},qr={class:"h3 text-center"},Yr={key:0,class:"row mt-2 container"},Gr=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),Jr={class:"h5",style:{"text-align":"center"}},Kr={key:1,class:"row mt-2 container"},Qr={class:"h3"},Xr={key:0,class:"d-inline text-center grupoContento pt-1"},ei=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),ai=[ei],oi={key:1,class:"h5",style:{"text-align":"center",color:"red"}},ti={class:"again py-5"},li={class:"again py-5"};function ni(e,a,o,l,n,r){const i=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),u=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:l.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Lr,[(0,t._)("p",qr,(0,d.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),l.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",Yr,[Gr,(0,t._)("span",Jr,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,d.zw)(l.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),l.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",Kr,[(0,t._)("p",Qr,(0,d.zw)(e.$t("seleccione","seleccione"))+":",1),l.tryCount>0?((0,t.wg)(),(0,t.iD)("div",Xr,ai)):(0,t.kq)("",!0),l.tryCount>3?((0,t.wg)(),(0,t.iD)("span",oi,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),l.tryCount<=0?((0,t.wg)(),(0,t.j4)(i,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>l.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",ti,(0,d.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(i,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>l.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",li,(0,d.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var ri={name:"modalDatafonoConexion",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,ModalErrorDatafonoQueHacerComponent:Zr.Z},setup(e,{expose:a}){const o=(0,k.iH)(0),l=(0,k.iH)(!0),n=(0,k.iH)(0),r=(0,k.iH)(null),i=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,v.oR)(),d=(0,k.iH)(0),c=(0,k.iH)(!1),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>u.value&&void 0!=m.value&&null!=m.value&&u.value[m.value]?u.value[m.value]:null));function p(e){d.value=e,c.value=!0,b(),s.dispatch("Datafono/setEstado","OFFLINE")}async function f(){try{T().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){const e=await D.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});if(!e.data)throw Error("Error al guardar la IP del datafono.");T().fire("OK","¡El datáfono se ha apagado correctamente!","success"),c.value=!1}}))}catch(e){T().fire("Oops...",e.message,"error")}}async function b(){l.value=!0,n.value=60;let e=!1,a=!1,o=setInterval((async()=>{e||(n.value-=1,await D.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async t=>{e||"ONLINE"===t.data&&(s.dispatch("Datafono/setEstado","ONLINE"),a||(a=!0,await D.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((a=>{e||(clearInterval(o),e=!0,r.value.abrirModal(d.value,a.data),c.value=!1)})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),a=!1))})).catch((a=>{if(!e)return s.dispatch("Datafono/setEstado","OFFLINE")})),e||n.value<=0&&(clearInterval(o),e=!0,T().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),l.value=!1))}),1e3)}async function g(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),D.Z.post("paytef/comprobarDisponibilidad",{ip:null}).then((async e=>"OFFLINE"===e.data&&o.value<10?g():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await D.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((e=>{r.value.abrirModal(d.value,e.data),c.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:c,apagarDatafono:f,reconectarDatafon:g,estadoDatafono:i,tryCount:o,ModalErrorQueHacerRef:r,conexionAutomatica:l,counterAutomatico:n}}};const ii=(0,A.Z)(ri,[["render",ni]]);var si=ii,di=(o(52781),{name:"MainView",components:{MenusComponent:H,SubmenusComponent:R,TeclasComponent:ka,CestaComponent:oo,MenuIzquierdaComponent:Il,MenuDerechaComponent:Nr,modalDatafonoConexion:si,ModalErrorDatafonoVentaComponent:Zr.Z},setup(){const e=(0,ya.tv)(),a=(0,k.iH)(null),o=(0,k.iH)(null),l=(0,k.iH)(null),n=(0,k.iH)(null),r=(0,k.iH)(null);function i(e){a.value.clickTecla(e)}const s=(0,v.oR)(),d=(0,$r.io)("http://"+s.state.TocGameURL+":5051"),c=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null));function p(){o.value.resetGeneral()}function f(){l.value.actualizarPuntos()}return(0,t.JJ)("clickTecla",i),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",f),d.on("consultaPaytefRefund",(e=>{try{e.ok||n.value.abrirModal(e.id)}catch(a){}})),(0,t.bv)((()=>{D.Z.get("caja/estadoCaja").then((a=>{1==a.data&&T().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id&&e.push("/menu/fichajes"):e.push("/abrirCaja")})).catch((e=>{T().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:c,indexTrabajadorActivo:u,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:l,modalErrorConexionDatafonoRef:n,modalErrorVentaDatafonoRef:r}}});const ci=(0,A.Z)(di,[["render",s]]);var ui=ci}}]);
//# sourceMappingURL=91.931ceeaa.js.map