"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[989],{33727:function(a,e,t){t.d(e,{Z:function(){return C}});var o=t(73396),s=t(87139);const l={class:"btn-group"},r={class:"btn-group"},i={class:"btn-group"},n={class:"btn-group"},d={class:"btn-group"};function u(a,e,t,u,c,v){return(0,o.wg)(),(0,o.iD)("div",{class:(0,s.C_)(["btn-group-vertical mt-1",{disabled:t.disabled}])},[(0,o._)("div",l,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[0]||(e[0]=a=>u.addTecla("1"))}," 1 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[1]||(e[1]=a=>u.addTecla("2"))}," 2 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[2]||(e[2]=a=>u.addTecla("3"))}," 3 ")]),(0,o._)("div",r,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[3]||(e[3]=a=>u.addTecla("4"))}," 4 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[4]||(e[4]=a=>u.addTecla("5"))}," 5 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[5]||(e[5]=a=>u.addTecla("6"))}," 6 ")]),(0,o._)("div",i,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[6]||(e[6]=a=>u.addTecla("7"))}," 7 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[7]||(e[7]=a=>u.addTecla("8"))}," 8 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[8]||(e[8]=a=>u.addTecla("9"))}," 9 ")]),(0,o._)("div",n,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[9]||(e[9]=a=>u.deleteTecla())}," < "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonNumpad",onClick:e[10]||(e[10]=a=>u.addTecla("0"))}," 0 "),(0,o._)("button",{type:"button",class:"btn btn-outline-secondary botonNumpad",onClick:e[11]||(e[11]=a=>u.addTecla("."))}," , ")]),(0,o._)("div",d,[(0,o._)("button",{type:"button",class:"btn btn-outline-secondary botonComa",onClick:e[12]||(e[12]=a=>u.okValue(Number(u.cantidad)))}," OK ")])],2)}t(42492);var c=t(32066),v=t(25994),b=t(44870);const m=(0,c.io)("http://"+v.Z.state.TocGameURL+":5051");var p={props:{skipBalanza:{type:Boolean,default:!1},max3EntersDigits:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},name:"NumpadComponent",setup(a,{expose:e,emit:t}){const s=(0,b.iH)("0"),l=(0,o.f3)("okValue"),r=(0,b.iH)("5.5rem"),i=(0,b.iH)("5.5rem");(0,o.Fl)((()=>v.Z.state.Weight.lastWeight));function n(){t("activarShake")}function d(e){if(a.max3EntersDigits){let[a,t]=s.value.split("."),o=s.value.includes(".");if(a.length>=3&&!o&&"."!=e)return n();if(t&&t.length>=2)return n();if("."===e&&s.value.includes("."))return n()}"."===e&&s.value.includes(".")||(s.value+=e,"0"==s.value[0]&&(s.value=s.value.slice(1)),t("setValue",s.value))}function u(){s.value=s.value.slice(0,-1),""===s.value&&(s.value="0")}function c(a){s.value=Number(a).toString(),t("setValue",s.value)}return m.on("setBalanzaValue",(e=>{e&&!a.skipBalanza&&c(e)})),e({cantidad:s,setValor:c}),(0,o.bv)((async()=>{a.skipBalanza||c((await(0,o.Fl)((()=>v.Z.state.Weight.lastWeight))).value)})),{okValue:l,cantidad:s,addTecla:d,deleteTecla:u,setValor:c,anchoTecla:r,altoTecla:i}}},y=t(40089);const f=(0,y.Z)(p,[["render",u],["__scopeId","data-v-2468ee80"]]);var C=f},10984:function(a,e,t){t.r(e),t.d(e,{default:function(){return ta}});var o=t(73396),s=t(87139);const l={key:0,class:"row mt-2 overflow-auto sizeGeneral"},r={key:0},i={key:1},n={key:0,style:{"font-size":"1.2rem"}},d={class:"overflow-auto text-truncate listaCesta"},u={class:"list-group"},c={class:"d-inline-block text-truncate",style:{"max-width":"12rem"}},v={class:"ms-1",style:{"vertical-align":"top"}},b={class:"trabajadores"},m={key:1,class:"row sizeGeneral m-0 mt-1"},p={key:2,class:"position-absolute bottom-0 start-0"};function y(a,e,t,y,f,C){const g=(0,o.up)("MDBCardTitle"),w=(0,o.up)("MDBCardText"),M=(0,o.up)("MDBBtn"),k=(0,o.up)("MDBCardBody"),_=(0,o.up)("MDBBadge"),h=(0,o.up)("MDBCard"),D=(0,o.up)("MesasComponent"),B=(0,o.up)("CobroSeparadoMesas");return(0,o.wg)(),(0,o.iD)(o.HY,null,[!y.vistaMesas&&y.arrayTrabajadores&&y.arrayCestas&&null!=y.indexActivoTrabajador&&void 0!=y.indexActivoTrabajador?((0,o.wg)(),(0,o.iD)("div",l,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(y.totalRows,((a,e)=>((0,o.wg)(),(0,o.iD)("div",{class:"row",key:e},[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(4,((a,t)=>((0,o.wg)(),(0,o.iD)(o.HY,{key:t},[4*e+t+1<=y.arrayCestas.length&&(null!=y.arrayCestas[4*e+t].indexMesa||y.arrayCestas[4*e+t].trabajador===y.arrayTrabajadores[y.indexActivoTrabajador]._id)||"DEVOLUCION"==y.arrayCestas[4*e+t]?.modo?((0,o.wg)(),(0,o.j4)(h,{key:0,onClick:a=>y.seleccionar(y.arrayCestas[4*e+t]),class:(0,s.C_)(["cesta mb-3 ms-2 me-1",{cestaActiva:y.arrayCestas[4*e+t]._id===y.idCestaSeleccionada}]),size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(y.arrayCestas[4*e+t].modo)+" ",1),null===y.arrayCestas[4*e+t].indexMesa?((0,o.wg)(),(0,o.iD)("a",r,[(0,o.Uk)(" de "),(0,o._)("i",null,(0,s.zw)(y.getNombreByID(y.arrayCestas[4*e+t].trabajador)),1)])):(0,o.kq)("",!0),y.arrayMesas[4*e+t]&&null!=y.arrayCestas[4*e+t].indexMesa?((0,o.wg)(),(0,o.iD)("span",i,"Mesa: "+(0,s.zw)(y.arrayMesas[y.arrayCestas[4*e+t].indexMesa].nombre),1)):(0,o.kq)("",!0)])),_:2},1024),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>["VENTA"===y.arrayCestas[4*e+t].modo?((0,o.wg)(),(0,o.iD)("span",n,"Total: "+(0,s.zw)(y.getTotal(y.arrayCestas[4*e+t]).toFixed(2))+" €",1)):(0,o.kq)("",!0),(0,o._)("div",d,[(0,o._)("ul",u,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(y.arrayCestas[4*e+t].lista,((a,e)=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:"list-group-item"},[(0,o._)("span",c,(0,s.zw)(a.nombre),1),(0,o._)("span",v,"x"+(0,s.zw)(a.unidades),1)])))),128))])])])),_:2},1024),y.arrayMesas[4*e+t]&&null!=y.arrayCestas[4*e+t].indexMesa&&(y.arrayCestas[4*e+t].lista.length>1||y.arrayCestas[4*e+t].lista[0]?.unidades>1)?((0,o.wg)(),(0,o.j4)(M,{key:0,onClick:a=>y.PagarSeparado(y.arrayCestas[4*e+t],4*e+t),style:{"font-size":"16px"},color:"secondary d-inline-block"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Pagar por separado ")])),_:2},1032,["onClick"])):(0,o.kq)("",!0)])),_:2},1024),(0,o._)("div",b,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(y.arrayCestas[4*e+t].trabajadores,((a,e)=>((0,o.wg)(),(0,o.j4)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{color:"info",class:"text-dark",pill:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(y.arrayTrabajadoresID[a]),1)])),_:2},1024)])),_:2},1024)))),256))])])),_:2},1032,["onClick","class"])):(0,o.kq)("",!0)],64)))),64))])))),128))])):(0,o.kq)("",!0),y.vistaMesas?((0,o.wg)(),(0,o.iD)("div",m,[(0,o.Wm)(D)])):(0,o.kq)("",!0),y.vistaMesas?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("button",{onClick:e[0]||(e[0]=a=>y.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("volver","VOLVER")),1)])),(0,o.Wm)(B,{ref:"CobroSeparadoRef"},null,512)],64)}var f=t(44870),C=t(20065),g=t(74313),w=t(6411),M=t(91076),k=t(42492),_=t.n(k);const h=["onClick"],D={class:"nombreMesa"},B={key:0,class:"trabajadores"},x={class:"position-relative footer"},T={class:"position-absolute bottom-0 start-0"},z={class:"position-absolute bottom-0 end-0"},j={key:5,style:{"font-size":"1.7rem","font-weight":"bold"},class:"me-2"};function N(a,e,t,l,r,i){const n=(0,o.up)("MDBBadge"),d=(0,o.up)("MDBInput"),u=(0,o.up)("MDBModalBody"),c=(0,o.up)("MDBBtn"),v=(0,o.up)("MDBModalFooter"),b=(0,o.up)("MDBModal"),m=(0,o.up)("MDBIcon"),p=(0,o.up)("CobroSeparadoMesas");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l.arrayMesas.length>0?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},(0,o.Ko)(5,((a,e)=>(0,o._)("div",{class:"row p-0",key:e},[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(10,((a,t)=>(0,o._)("div",{class:(0,s.C_)(["mesa ms-3",[0===t?"ms-5":"",t+10*e===l.indexMesaActiva&&l.modoEdicion?"border border-4 border-dark":"",l.cestaSeleccionada===l.arrayMesas[t+10*e].idCesta?"seleccionada":"",l.tieneCosas(l.arrayMesas[t+10*e].idCesta)?"tieneCosas":"",l.arrayMesas[t+10*e].nombre?"habilitada":"deshabilitada",l.cestasHonei.includes(t+10*e)?"honei":""]]),key:t,onClick:a=>l.handleClick(t+10*e)},[(0,o._)("span",D,(0,s.zw)(l.arrayMesas[t+10*e].nombre),1),l.arrayMesas[t+10*e].nombre?((0,o.wg)(),(0,o.iD)("div",B,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.getCestaById(l.arrayMesas[t+10*e].idCesta)?.trabajadores,((a,e)=>((0,o.wg)(),(0,o.j4)(n,{color:"info",class:"text-dark trabajador",pill:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(l.getNombreTrabajadorById(a)),1)])),_:2},1024)))),256))])):(0,o.kq)("",!0)],10,h))),64))]))),64)):(0,o.kq)("",!0),(0,o._)("div",x,[(0,o._)("div",T,[(0,o._)("button",{onClick:e[0]||(e[0]=a=>l.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("volver","Volver")),1)]),(0,o._)("div",z,[l.arrayMesas&&null!=l.indexMesaActiva&&void 0!=l.indexMesaActiva&&l.arrayMesas[l.indexMesaActiva]&&l.arrayMesas[l.indexMesaActiva].nombre&&l.modoEdicion?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:e[1]||(e[1]=a=>l.desactivarMesa()),class:"btn btn-danger ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("eliminar_cesta","Eliminar cesta")),1)):(0,o.kq)("",!0),l.arrayMesas&&null!=l.indexMesaActiva&&void 0!=l.indexMesaActiva&&l.arrayMesas[l.indexMesaActiva]&&l.arrayMesas[l.indexMesaActiva].nombre&&l.modoEdicion?((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:e[2]||(e[2]=a=>l.toggleModotransferir()),class:"btn btn-secondary ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("transferir_articulos","Transferir articulos")),1)):(0,o.kq)("",!0),l.arrayMesas&&null!=l.indexMesaActiva&&void 0!=l.indexMesaActiva&&l.arrayMesas[l.indexMesaActiva]&&l.arrayMesas[l.indexMesaActiva].nombre&&l.modoEdicion?((0,o.wg)(),(0,o.iD)("button",{key:2,onClick:e[3]||(e[3]=a=>l.modalNombreMesa=!0),class:"btn btn-info ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("cambiar_nombre","Cambiar nombre")),1)):l.modoEdicion?((0,o.wg)(),(0,o.iD)("button",{key:3,onClick:e[4]||(e[4]=a=>l.activarMesa()),class:"btn btn-success ms-2",style:{"font-size":"27px"}},(0,s.zw)(a.$t("activar_cesta","Activar cesta")),1)):l.modoEdicion||l.modoImprimir?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("button",{key:4,onClick:e[5]||(e[5]=a=>l.pagarPorSeparado()),class:(0,s.C_)(["btn",l.pagarNoJunto?"btn-warning":"btn-success","ms-2"]),style:{"font-size":"27px"}},(0,s.zw)(a.$t("pagar_por_separado","Pagar por separado")),3)),l.modoImprimir?((0,o.wg)(),(0,o.iD)("span",j,(0,s.zw)(a.$t("selecciona_una_mesa","Selecciona una mesa"))+" "+(0,s.zw)(a.$t("para_imprimir_la_nota","para imprimir la nota")),1)):(0,o.kq)("",!0)])]),(0,o.Wm)(b,{id:"modalNombreMesa",tabindex:"-1",modelValue:l.modalNombreMesa,"onUpdate:modelValue":e[9]||(e[9]=a=>l.modalNombreMesa=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{label:"Introduce el nombre de la mesa",size:"lg",modelValue:l.inputNombre,"onUpdate:modelValue":e[6]||(e[6]=a=>l.inputNombre=a)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{color:"secondary",size:"lg",onClick:e[7]||(e[7]=a=>l.modalNombreMesa=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.$t("cerrar","Cerrar")),1)])),_:1}),(0,o.Wm)(c,{color:"primary",size:"lg",onClick:e[8]||(e[8]=a=>l.cambiarNombre())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.$t("guardar_cambios","Guardar cambios")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),l.modoImprimir?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:1,color:"dark",floating:"",id:"editBtn",onClick:e[10]||(e[10]=a=>l.toggleEdicion())},{default:(0,o.w5)((()=>[l.modoEdicion?((0,o.wg)(),(0,o.j4)(m,{key:1,icon:"check"})):((0,o.wg)(),(0,o.j4)(m,{key:0,icon:"edit"}))])),_:1})),l.modoImprimir||l.modoEdicion?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:2,color:"dark",floating:"",id:"userBtn",onClick:e[11]||(e[11]=a=>l.handleClick("",!0))},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{icon:"user"})])),_:1})),l.arrayMesas&&null!=l.indexMesaActiva&&void 0!=l.indexMesaActiva&&l.arrayMesas[l.indexMesaActiva]&&l.arrayMesas[l.indexMesaActiva].nombre&&!l.modoEdicion?((0,o.wg)(),(0,o.j4)(c,{key:3,color:"dark",floating:"",id:"printBtn",onClick:e[12]||(e[12]=a=>l.toggleImprimir())},{default:(0,o.w5)((()=>[l.modoImprimir?((0,o.wg)(),(0,o.j4)(m,{key:1,icon:"times"})):((0,o.wg)(),(0,o.j4)(m,{key:0,icon:"print"}))])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(p,{ref:"CobroSeparadoRef"},null,512)],64)}const H=a=>((0,o.dD)("data-v-47afe112"),a=a(),(0,o.Cn)(),a),A={class:"row"},S=["onClick"],F=H((()=>(0,o._)("br",null,null,-1))),E=["onClick"],I=H((()=>(0,o._)("br",null,null,-1))),V={class:"row"},Z={key:0,class:"table-responsive divCesta reverso"},P={class:"table colorFuente"},W={class:"tableBody"},O=["onClick"],q={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}};function U(a,e,t,l,r,i){const n=(0,o.up)("MDBModalTitle"),d=(0,o.up)("MDBModalHeader"),u=(0,o.up)("MDBBtn"),c=(0,o.up)("MDBModalBody"),v=(0,o.up)("MDBModalFooter"),b=(0,o.up)("MDBModal"),m=(0,o.up)("modalCobroViewVue");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(b,{id:"modalCobroSeparado",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalCobroSeparado,"onUpdate:modelValue":e[3]||(e[3]=a=>l.modalCobroSeparado=a),staticBackdrop:"",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(n,{id:"staticBackdropLabel"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Selecciona los articulos a pagar "+(0,s.zw)(l.totalPrice.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,o.Wm)(c,{class:"modal-body"},{default:(0,o.w5)((()=>[(0,o._)("div",A,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.arrayArticulosMesa,((a,e)=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"col mb-3"},[a?.gramos&&a?.gramos>0?((0,o.wg)(),(0,o.iD)("button",{key:0,class:"btn w-100 h-100 colorIvan1 btnSuplemento",onClick:t=>l.addArticulo(a,e)},[(0,o.Uk)((0,s.zw)(a.nombre)+" ",1),F,(0,o.Uk)(" "+(0,s.zw)(a.subtotal.toFixed(2))+" € ",1)],8,S)):((0,o.wg)(),(0,o.iD)("button",{key:1,class:"btn w-100 h-100 colorIvan1 btnSuplemento",onClick:t=>l.addArticulo(a,e)},[(0,o.Uk)((0,s.zw)(a.nombre)+" ",1),I,(0,o.Uk)(" "+(0,s.zw)((a.subtotal/a.unidades).toFixed(2))+" € ",1)],8,E))])))),128))]),(0,o._)("div",V,[l.articulosAPagar?((0,o.wg)(),(0,o.iD)("div",Z,[(0,o._)("table",P,[(0,o._)("tbody",W,[a.item?.pagado?(0,o.kq)("",!0):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:0},(0,o.Ko)(l.articulosAPagar,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,class:(0,s.C_)(["itemCesta",{seleccionado:l.itemSeleccionado===e}]),onClick:a=>l.setIndex(e)},[(0,o._)("td",null,[(0,o._)("span",q,(0,s.zw)(a.nombre),1)]),(0,o._)("td",null,(0,s.zw)((a.subtotal/a.unidades).toFixed(2))+" €",1)],10,O)))),128))])])])):(0,o.kq)("",!0),l.deleteBtn?((0,o.wg)(),(0,o.j4)(u,{key:1,onClick:e[0]||(e[0]=a=>l.delArticulo()),color:"danger",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.$t("eliminar","Eliminar")),1)])),_:1})):(0,o.kq)("",!0)])])),_:1}),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{color:"secondary",onClick:e[1]||(e[1]=a=>l.modalCobroSeparado=!1),size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.$t("cancelar","Cancelar")),1)])),_:1}),(0,o.Wm)(u,{color:"success",size:"lg",onClick:e[2]||(e[2]=a=>l.Pago())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.$t("Pagar","Pagar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(m,{class:"p-0",ref:"modalCobroViewVueRef"},null,512)],64)}t(57658);var $=t(22483),Y=t(52755),R={name:"modalCobroSeparadoComponent",components:{MDBModal:g.j3,MDBModalHeader:g.ol,MDBModalTitle:g.wo,MDBModalBody:g.Yz,MDBModalFooter:g.ab,MDBBtn:g.$v,modalCobroViewVue:Y.Z},setup(a,{expose:e}){const t=(0,f.iH)(!1),s=(0,f.iH)(null),l=(0,f.iH)([]);let r=(0,o.Fl)((()=>n.state.Cestas.arrayCestas));const i=(0,f.iH)([]),n=(0,C.oR)(),d=(0,$.tv)(),u=(0,o.Fl)((()=>n.state.Trabajadores.indexActivo)),c=(0,o.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),v=(0,o.Fl)((()=>n.state.Trabajadores.indexActivo)),b=(0,o.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null)),m=(0,f.iH)([]);let p=0;const y=(0,f.iH)(!1),g=(0,f.iH)(0),w=(0,f.iH)(null);async function k(a){i.value.push(a)}async function h(a){for(let e=0;e<a.lista.length;e++)for(let t=0;t<a.lista[e].unidades;t++)a.lista[e].pagado||k(a.lista[e])}async function D(a,e){i.value.splice(e,1),g.value+=a.subtotal/a.unidades,l.value.push(a)}async function B(){let a=s.value;i.value.push(l.value[a]),g.value-=l.value[a].subtotal/l.value[a].unidades,l.value.splice(a,1),y.value=!1,s.value=-1}function x(a){s.value==a?(s.value=-1,y.value=!1):(s.value=a,y.value=!0)}async function T(a){m.value=a,p=a._id,l.value=[],i.value=[],t.value=!0,g.value=0,y.value=!1,h(a)}async function z(){let a,e=m;n.dispatch("Cestas/setCestaBaseAction",e.value._id),e.value.lista=l.value;for(let t=0;t<e.value.lista.length;t++)e.value.lista[t].subtotal=e.value.lista[t].subtotal/e.value.lista[t].unidades,e.value.lista[t].unidades=1;M.Z.post("cestas/PagarPorSeparado",{articulos:e.value.lista}).then((async e=>{e.data&&await M.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:c.value[v.value]._id}).then((async s=>{if(r=(0,o.Fl)((()=>n.state.Cestas.arrayCestas)),a=await(0,o.Fl)((()=>{if(r.value)for(let a=0;a<r.value.length;a++)if(r.value[a]._id==e.data)return r.value[a]})),"PAGO SEPARADO"===a.value.modo)if(a.value.idCliente&&""!=a.value.idCliente){const e=(await M.Z.post("clientes/getClienteById",{idCliente:a.value.idCliente})).data;!0===e?.albaran&&!0===e?.noPagaEnTienda?M.Z.post("tickets/crearTicket",{total:g.value,idCesta:a.value._id,idTrabajador:b.value._id,tipo:"DEUDA",tkrsData:null}).then((a=>{if(!a.data)throw Error("No se ha podido registrar la venta en modo deuda");_().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:2e3})})).catch((a=>{_().fire("Oops...",a.message,"error")})):(await M.Z.post("impresora/despedida",{precioTotal:g.value.toFixed(2)}),await d.push("/cobro").then((()=>{})))}else await M.Z.post("impresora/despedida",{precioTotal:g.value.toFixed(2)}),w.value.abrirModal(),t.value=!1}))})),await M.Z.post("cestas/borrarUnicoItemCesta",{idCesta:e.value._id,articulos:l.value}).then((a=>{if(!a.data)throw Error("No se ha podido eliminar el artículo de la cesta")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}return e({abrirModal:T}),{articulosAPagar:l,arrayArticulosMesa:i,modalCobroSeparado:t,itemSeleccionado:s,setIndex:x,deleteBtn:y,addArticulo:D,delArticulo:B,totalPrice:g,Pago:z,modalCobroViewVueRef:w}}},J=t(40089);const K=(0,J.Z)(R,[["render",U],["__scopeId","data-v-47afe112"]]);var L=K,G={name:"MesasComponent",components:{MDBModal:g.j3,MDBModalBody:g.Yz,MDBModalFooter:g.ab,MDBBtn:g.$v,MDBInput:g.u2,MDBIcon:g.vm,MDBBadge:g.m_,CobroSeparadoMesas:L},setup(){const a=(0,f.iH)([]),e=(0,f.iH)(0),t=(0,f.iH)(null),s=(0,f.iH)(""),l=(0,f.iH)(!1),r=(0,f.iH)(!1),i=(0,f.iH)(!1),n=(0,f.iH)(!1),d=(0,f.iH)(null),u=(0,C.oR)();let c=(0,o.Fl)((()=>u.state.Cestas.arrayCestas));const v=(0,o.Fl)((()=>u.state.Trabajadores.arrayTrabajadores)),b=(0,o.Fl)((()=>u.state.Trabajadores.indexActivo)),m=a=>{const e=c.value.find((e=>e._id===a));return e},p=a=>{const e=v.value.find((e=>e._id==a));return e?.nombre},y=()=>{n.value=!n.value},g=async(a,e)=>{try{const t=await M.Z.post("/cestas/transferirItemsCesta",{idCestaOrigen:a.idCesta,idCestaDestino:e.idCesta});if(!t.data)throw Error("No se han podido transferir los articulos")}catch(t){_().fire("Oops...",t.message,"error")}};async function k(t,o=!1){if(l.value)e.value=t;else if(r.value)h(a.value[t]);else{if(u.dispatch("Cestas/deleteCestaHonei",t),i.value){const o=await _().fire({icon:"question",title:`¿Quieres transferir los articulos de ${a.value[e.value].nombre} a ${a.value[t].nombre}?`,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"});if(!o.isConfirmed)return;await g(a.value[e.value],a.value[t])}if(n.value)d.value.abrirModal(m(a.value[t].idCesta));else{if(o)E(V);else{if(!a.value[t].idCesta)return;E(a.value[t].idCesta)}w.Z.back()}}}const h=a=>{if(!a.idCesta)return _().fire("Oops...","Mesa inactiva. No se puede imprimir","error");const e=v.value[b.value]._id;M.Z.post("cestas/imprimirNotaMesa",{idCesta:a.idCesta,idTrabajador:e}).then((a=>{if(!a.data)throw Error("No se ha podido imprimir la cesta")})).catch((a=>{_().fire("Oops...",a.message,"error")}))},D=()=>{i.value=!0,x()},B=document.querySelector("body");B.style.backgroundColor=l.value?"#FFFF00":"#fff5e9";const x=()=>{l.value=!l.value,B.style.backgroundColor=l.value?"#FFFF00":"#fff5e9"},T=()=>{r.value=!r.value,B.style.backgroundColor=r.value?"#FFFF00":"#fff5e9"};async function z(e){try{const t=(await M.Z.post("cestas/onlyCrearCestaParaMesa",{indexMesa:e})).data;if(!t)throw Error("No se ha podido crear la cesta para la nueva mesa");a.value[e].idCesta=t,A()}catch(t){_().fire("Oops...",t.message,"error")}}function j(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(a.value[e.value]={nombre:"Mesa "+(e.value+1)},z(e.value))}function N(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(M.Z.post("cestas/fulminarCesta",{idCesta:a.value[e.value].idCesta}).then((a=>{if(!a.data)throw Error("No se ha podido eliminar la cesta de la mesa")})).catch((a=>{_().fire("Oops...",a.message,"error")})),a.value[e.value]={nombre:null,idCesta:null},A())}function H(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(a.value[e.value].nombre=s.value,t.value=!1,A())}function A(){M.Z.post("mesas/guardarCambios",{arrayMesas:a.value}).then((a=>{if(!a.data)throw Error("No se han podido guardar los cambios")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}const S=a=>{if(null===a||void 0===a)return!1;const e=m(a);return e.lista.length>0},F=(0,o.f3)("volver"),E=(0,o.f3)("seleccionar"),I=(0,o.f3)("cestaSeleccionada"),V=(0,o.f3)("cestaParticular"),Z=((0,o.f3)("PagarSeparado"),u.getters["Cestas/getCestasHonei"]);return(0,o.bv)((()=>{M.Z.get("mesas/getMesas").then((t=>{if(!t.data||50!==t.data.length)throw Error("Error al obtener la configuración de mesas");a.value=t.data,e.value=a.value.find((a=>a.idCesta==I.value))?._id??0})).catch((a=>{_().fire("Oops...",a.message,"error")}))})),{arrayMesas:a,indexMesaActiva:e,handleClick:k,volver:F,activarMesa:j,desactivarMesa:N,cambiarNombre:H,modalNombreMesa:t,inputNombre:s,modoEdicion:l,toggleEdicion:x,cestaSeleccionada:I,getCestaById:m,getNombreTrabajadorById:p,toggleModotransferir:D,tieneCosas:S,pagarPorSeparado:y,pagarNoJunto:n,CobroSeparadoRef:d,cestasHonei:Z,modoImprimir:r,toggleImprimir:T}}};const Q=(0,J.Z)(G,[["render",N],["__scopeId","data-v-f295f750"]]);var X=Q,aa={name:"CestasView",components:{MDBCard:g.Yl,MDBCardBody:g.H7,MDBCardTitle:g.QM,MDBCardText:g.Pp,MDBBadge:g.m_,MDBBtn:g.$v,MesasComponent:X,CobroSeparadoMesas:L},setup(){const a=(0,C.oR)(),e=(0,f.iH)(!0),t=(0,f.iH)(null);(0,o.Fl)((()=>a.state.Configuracion.parametros));let s=(0,o.Fl)((()=>a.state.Cestas.arrayCestas));const l=(0,f.iH)([]),r=(0,f.iH)({}),i=(0,o.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),n=(0,o.Fl)((()=>a.state.Trabajadores.indexActivo)),d=(0,f.iH)(null),u=(0,f.iH)(!1);function c(){const a=document.querySelector("body");a.style.backgroundColor="#fff5e9",w.Z.back()}function v(a){i.value&&void 0!=n.value&&null!=n.value&&i.value[n.value]&&null!=a.indexMesa&&t.value.abrirModal(a)}function b(a){let e="undefined";for(let t=0;t<i.value.length;t++)i.value[t].idTrabajador==a&&(e=i.value[t].nombre);return e}function m(a){const e=a.detalleIva,t=Object.keys(e).filter((a=>a.startsWith("importe"))).reduce(((a,t)=>a+e[t]),0);return Math.round(100*t)/100}const p=(0,o.Fl)((()=>{const a=s.value.length;let e=Math.trunc(a/4);return a%4>0&&(e+=1),e}));function y(){void 0!=n.value&&null!=n.value&&i.value&&M.Z.post("cestas/crearCesta",{idTrabajador:i.value[n.value]._id}).then((a=>{if(!a.data)throw Error("No se ha podido crear una nueva cesta, ¡Comprueba que no tengas una ya!")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}function g(){if(d.value){for(let a=0;a<s.value.length;a++)if(s.value[a]._id===d.value&&null!=s.value[a].indexMesa&&void 0!=s.value[a].indexMesa)return _().fire("Oops...","No puedes eliminar una cesta de tipo MESA","error"),!1;M.Z.post("cestas/fulminarCesta",{idCesta:d.value}).then((a=>{if(!a.data)throw Error("No se ha podido borrar la cesta")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}}function k(a){i.value&&void 0!=n.value&&null!=n.value&&i.value[n.value]?(d.value=a,M.Z.post("cestas/cambiarCestaTrabajador",{idCesta:a,idTrabajador:i.value[n.value]._id})):_().fire("Oops...","Error, no se ha podido seleccionar la cesta para el trabajador","error")}function h(){M.Z.get("mesas/getMesas").then((a=>{if(!a.data||50!==a.data.length)throw Error("Error al obtener la configuración de mesas");l.value=a.data})).catch((a=>{_().fire("Oops...",a.message,"error")}))}let D;return s.value.forEach((a=>{a.trabajador===i.value[n.value]._id&&"DEVOLUCION"!=a.modo&&(D=a._id)})),(0,o.JJ)("volver",c),(0,o.JJ)("seleccionar",k),(0,o.JJ)("cestaSeleccionada",d),(0,o.JJ)("cestaParticular",D),(0,o.JJ)("PagarSeparado",v),(0,o.bv)((()=>{if(i.value.forEach((a=>{let e=a.idTrabajador,t=a.nombre;r.value[e]=t})),null==n.value)return _().fire("Oops...","Debes fichar para usar las cestas","error");d.value=i.value[n.value].idCesta,h(),M.Z.post("parametros/getParametros").then((a=>{void 0!=a.data?.params?.mesas?"Si"==a.data?.params?.mesas&&(u.value=!0):u.value=!1}))})),{vistaMesas:e,PagarSeparado:v,arrayCestas:s,arrayTrabajadores:i,indexActivoTrabajador:n,volver:c,getTotal:m,seleccionar:k,totalRows:p,nuevaCesta:y,borrarCesta:g,arrayMesas:l,idCestaSeleccionada:d,SiMesas:u,arrayTrabajadoresID:r,CobroSeparadoRef:t,getNombreByID:b}}};const ea=(0,J.Z)(aa,[["render",y],["__scopeId","data-v-7f01a565"]]);var ta=ea}}]);
//# sourceMappingURL=989.61bb3836.js.map