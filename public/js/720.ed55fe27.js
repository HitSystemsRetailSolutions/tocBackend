"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[720],{32374:function(a,e,t){t.d(e,{Z:function(){return u}});var o=t(73396),l=t(87139);const i={class:"input-group position-absolute bottom-0 start-0"};function r(a,e,t,r,s,n){return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("button",{onClick:e[0]||(e[0]=a=>r.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px"}},(0,l.zw)(a.$t("volver","VOLVER")),1)])}var s=t(16797),n={name:"VolverComponent",setup(){function a(){s.Z.back()}return{volver:a}}},d=t(40089);const c=(0,d.Z)(n,[["render",r]]);var u=c},79066:function(a,e,t){t.d(e,{Z:function(){return D}});var o=t(73396),l=t(87139);const i={class:"row mt-2"},r={class:"col-md-3"},s={key:0,class:"sizeLetrasCambio"},n={class:"sizeLetrasCambio"},d={key:1,class:"estiloFalta sizeLetrasCambio"},c={key:2,class:"estiloPerfecto sizeLetrasCambio"},u={key:3,class:"estiloSobra sizeLetrasCambio"},m={class:"col-md-9"},v={class:"row"},p={class:"col text-end"},g={class:"row mt-2"},f={class:"col text-end"};function b(a,e,t,b,k,C){const w=(0,o.up)("MDBCardTitle"),_=(0,o.up)("MDBCardText"),T=(0,o.up)("MDBBtn"),D=(0,o.up)("MDBCardBody"),h=(0,o.up)("MDBCard");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("div",r,[(0,o.Wm)(h,{class:"cardInfoCambio"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("informacion_cambio","Información cambio")),1)])),_:1}),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[null!=b.cantidadTkrs&&void 0!=b.cantidadTkrs?((0,o.wg)(),(0,o.iD)("li",s,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(b.totalRecibido+b.cantidadTkrs).toFixed(2))+" € ",1)):(0,o.kq)("",!0),(0,o._)("li",n,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*b.aPagar)/100).toFixed(2))+" € ",1),null!=b.cuenta&&void 0!=b.cuenta&&b.cuenta>0?((0,o.wg)(),(0,o.iD)("li",d,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*b.cuenta)/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=b.cuenta&&void 0!=b.cuenta&&0==b.cuenta?((0,o.wg)(),(0,o.iD)("li",c,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,o.kq)("",!0),null!=b.cuenta&&void 0!=b.cuenta&&b.cuenta<0?((0,o.wg)(),(0,o.iD)("li",u,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(b.aPagar-b.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(T,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>b.deshacer()),class:"sizeBotones"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,o.Wm)(T,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>b.limpiar())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])),_:1})])),_:1})]),(0,o._)("div",m,[(0,o._)("div",v,[(0,o._)("div",p,[(0,o._)("img",{src:"/img/1cts.png",class:"sizeMonedas",onClick:e[2]||(e[2]=a=>b.sumar(.01))}),(0,o._)("img",{src:"/img/2cts.png",class:"sizeMonedas",onClick:e[3]||(e[3]=a=>b.sumar(.02))}),(0,o._)("img",{src:"/img/5cts.png",class:"sizeMonedas",onClick:e[4]||(e[4]=a=>b.sumar(.05))}),(0,o._)("img",{src:"/img/10cts.png",class:"sizeMonedas",onClick:e[5]||(e[5]=a=>b.sumar(.1))}),(0,o._)("img",{src:"/img/20cts.png",class:"sizeMonedas",onClick:e[6]||(e[6]=a=>b.sumar(.2))}),(0,o._)("img",{src:"/img/50cts.png",class:"sizeMonedas",onClick:e[7]||(e[7]=a=>b.sumar(.5))}),(0,o._)("img",{src:"/img/uneuro.png",class:"sizeMonedas",onClick:e[8]||(e[8]=a=>b.sumar(1))}),(0,o._)("img",{src:"/img/doseuros.png",class:"sizeMonedas",onClick:e[9]||(e[9]=a=>b.sumar(2))})])]),(0,o._)("div",g,[(0,o._)("div",f,[(0,o._)("img",{src:"/img/5euros.png",class:"sizeBilletes",onClick:e[10]||(e[10]=a=>b.sumar(5))}),(0,o._)("img",{src:"/img/10euros.png",class:"sizeBilletes",onClick:e[11]||(e[11]=a=>b.sumar(10))}),(0,o._)("img",{src:"/img/20euros.png",class:"sizeBilletes",onClick:e[12]||(e[12]=a=>b.sumar(20))}),(0,o._)("img",{src:"/img/50euros.png",class:"sizeBilletes",onClick:e[13]||(e[13]=a=>b.sumar(50))}),(0,o._)("img",{src:"/img/100euros.png",class:"sizeBilletes",onClick:e[14]||(e[14]=a=>b.sumar(100))}),(0,o._)("img",{src:"/img/200euros.png",class:"sizeBilletes",onClick:e[15]||(e[15]=a=>b.sumar(200))}),(0,o._)("img",{src:"/img/500euros.png",class:"sizeBilletes",onClick:e[16]||(e[16]=a=>b.sumar(500))})])])])])}t(57658);var k=t(44870),C=t(74313),w={name:"CambioComponent",components:{MDBCard:C.Yl,MDBCardBody:C.H7,MDBCardTitle:C.QM,MDBCardText:C.Pp,MDBBtn:C.$v},setup(a,{expose:e}){const t=(0,k.iH)(0),l=(0,o.f3)("total"),i=(0,k.iH)(l),r=(0,k.iH)([]),s=(0,k.iH)(0),n=(0,o.Fl)((()=>i.value-s.value<0?0:i.value-(t.value+s.value)));function d(a){t.value+=a,r.value.push(a)}function c(){r.value.pop();let a=0;r.value.forEach((e=>{a+=e})),t.value=a}function u(){t.value=0,r.value=[]}function m(a){s.value=Number(a)}return e({setTkrs:m}),{sumar:d,totalRecibido:t,aPagar:i,deshacer:c,limpiar:u,cantidadTkrs:s,cuenta:n}}},_=t(40089);const T=(0,_.Z)(w,[["render",b],["__scopeId","data-v-0e9fd9d8"]]);var D=T},38020:function(a,e,t){t.d(e,{Z:function(){return f}});var o=t(73396),l=t(87139);const i={class:"row"},r={key:0,class:"cantidad text-center"},s={class:"row mt-2"},n={class:"col text-center"};function d(a,e,t,d,c,u){const m=(0,o.up)("MDBModalTitle"),v=(0,o.up)("MDBModalHeader"),p=(0,o.up)("NumpadComponent"),g=(0,o.up)("MDBModalBody"),f=(0,o.up)("MDBBtn"),b=(0,o.up)("MDBModalFooter"),k=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(k,{id:"modalTkrs",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:d.modalTkrs,"onUpdate:modelValue":e[1]||(e[1]=a=>d.modalTkrs=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{id:"modalTkrsLabel"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("introduce_la_cantidad_del_tiquet_restaurante","Introduce la cantidad del tiquet restaurante")),1)])),_:1})])),_:1}),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o._)("div",i,[d.numPadRef?((0,o.wg)(),(0,o.iD)("span",r,(0,l.zw)(d.numPadRef.cantidad),1)):(0,o.kq)("",!0)]),(0,o._)("div",s,[(0,o._)("div",n,[(0,o.Wm)(p,{ref:"numPadRef"},null,512)])])])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{color:"danger",size:"lg",onClick:e[0]||(e[0]=a=>d.modalTkrs=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var c=t(74313),u=t(61837),m=t(44870),v={name:"ModalTkrsComponent",components:{MDBModal:c.j3,MDBModalHeader:c.ol,MDBModalTitle:c.wo,MDBModalBody:c.Yz,MDBModalFooter:c.ab,MDBBtn:c.$v,NumpadComponent:u.Z},setup(a,{expose:e}){const t=(0,m.iH)(!1),l=(0,m.iH)(null),i=(0,o.f3)("setTkrs");function r(){t.value=!0}function s(){t.value=!1,i(l.value.cantidad)}return(0,o.JJ)("okValue",s),e({abrirModal:r}),{modalTkrs:t,numPadRef:l,okValue:s}}},p=t(40089);const g=(0,p.Z)(v,[["render",d],["__scopeId","data-v-b796d518"]]);var f=g},97720:function(a,e,t){t.d(e,{Z:function(){return ca}});var o=t(73396),l=t(87139);const i=a=>((0,o.dD)("data-v-1183cb3d"),a=a(),(0,o.Cn)(),a),r={class:"row"},s={class:"row mt-2"},n={class:"col-md-3"},d={class:"text-center"},c={class:"mt-4"},u={id:"detalleTicket"},m={class:"contencionTicket"},v={class:"table"},p={class:"titulosTicket"},g={class:"titulosTicket"},f={class:"titulosTicket"},b=i((()=>(0,o._)("hr",null,null,-1))),k={class:"sizeLetrasCambio"},C={key:0,class:"sizeLetrasCambio"},w={key:1,class:"estiloFalta sizeLetrasCambio"},_={key:2,class:"estiloPerfecto sizeLetrasCambio"},T={key:3,class:"estiloSobra sizeLetrasCambio"},D={class:"col-md-9",style:{"padding-left":"4vmin"}},h={class:"row"},z={class:"col text-end",style:{"margin-top":"2vmin"}},M=["src","onClick"],B={class:"row mt-2"},y={class:"col text-end",style:{"margin-top":"2vmin"}},E=["src","onClick"],F={class:"row"},A={class:"col mt-4"},P={class:"divBotones"},j=["disabled"],V=["disabled"],O=["disabled"],R=["disabled"],x={class:"row"},I={class:"cantidad text-center"},Z={class:"row mt-2"},H={class:"col text-center"},N={key:0,class:"estadoPaytef"},$=i((()=>(0,o._)("h3",null,"Estado:",-1))),W={style:{"margin-top":"1vm","font-weight":"300",color:"orangered","font-size":"1.3em"}},S={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function L(a,e,t,i,L,q){const U=(0,o.up)("MDBCardTitle"),J=(0,o.up)("MDBCardText"),G=(0,o.up)("MDBBtn"),Y=(0,o.up)("MDBCardBody"),K=(0,o.up)("MDBCard"),Q=(0,o.up)("ModalTkrsComponent"),X=(0,o.up)("NumpadComponent"),aa=(0,o.up)("MDBModalBody"),ea=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(ea,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:i.modalCobro,"onUpdate:modelValue":e[9]||(e[9]=a=>i.modalCobro=a),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,o.w5)((()=>[(0,o.Wm)(aa,{style:{"background-color":"#fff5e9"}},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",s,[(0,o._)("div",n,[(0,o.Wm)(K,{class:"cardInfoCambio",style:{height:"80vmin"}},{default:(0,o.w5)((()=>[(0,o.Wm)(Y,{style:{display:"flex","flex-direction":"column","justify-content":"space-evenly"}},{default:(0,o.w5)((()=>[(0,o.Wm)(U,null,{default:(0,o.w5)((()=>[(0,o._)("h2",d,(0,l.zw)(a.$t("ticket","Ticket"))+":",1)])),_:1}),(0,o._)("div",c,[(0,o._)("div",u,[(0,o._)("div",m,[(0,o._)("table",v,[(0,o._)("tr",null,[(0,o._)("th",p,(0,l.zw)(a.$t("producto","Producto")),1),(0,o._)("th",g,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",f,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.productos,((a,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e,style:(0,l.j5)(a.pagado?"text-decoration: line-through":"")},[(0,o._)("td",null,(0,l.zw)(a.nombre),1),(0,o._)("td",null,(0,l.zw)((a.subtotal-a.subtotal*i.DescuentoCliente).toFixed(2))+" € ",1),(0,o._)("td",null,(0,l.zw)(a.unidades),1)],4)))),128))])]),b])]),(0,o.Wm)(J,null,{default:(0,o.w5)((()=>[(0,o._)("li",k,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*(i.aPagar+i.dejaCuenta))/100).toFixed(2))+" € ",1),null!=i.cantidadTkrs&&void 0!=i.cantidadTkrs?((0,o.wg)(),(0,o.iD)("li",C,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(i.totalRecibido+i.cantidadTkrs+i.dejaCuenta).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta>0?((0,o.wg)(),(0,o.iD)("li",w,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*i.cuenta)/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&0==i.cuenta?((0,o.wg)(),(0,o.iD)("li",_,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,o.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0?((0,o.wg)(),(0,o.iD)("li",T,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(i.aPagar-i.totalRecibido))/100).toFixed(2))+" € ",1)):(0,o.kq)("",!0)])),_:1}),(0,o._)("div",null,[(0,o.Wm)(G,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>i.deshacer()),class:"sizeBotones"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,o.Wm)(G,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>i.limpiar())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])])),_:1})])),_:1})]),(0,o._)("div",D,[(0,o._)("div",h,[(0,o._)("div",z,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([.01,.02,.05,.1,.2,.5,1,2],(a=>(0,o._)("img",{src:"/img/"+(a<1?100*a+"cts":1==a?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:e=>i.sumar(a)},null,8,M))),64))])]),(0,o._)("div",B,[(0,o._)("div",y,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([5,10,20,50,100,200,500],(a=>(0,o._)("img",{src:"/img/"+a+"euros.png",class:"sizeBilletes",onClick:e=>i.sumar(a)},null,8,E))),64))])]),(0,o._)("div",F,[(0,o._)("div",A,[(0,o._)("div",P,[(0,o._)("img",{disabled:i.loading,src:"img/img-efectivo.png",onClick:e[2]||(e[2]=a=>i.setFormaPago("EFECTIVO")),style:(0,l.j5)("EFECTIVO"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,12,j),i.modalTkrsRef&&!i.prohibirTkRestaurant?((0,o.wg)(),(0,o.iD)("img",{key:0,disabled:i.loading,src:"img/img-tkrs.png",onClick:e[3]||(e[3]=a=>i.loading?null:i.modalTkrsRef.abrirModal()),style:(0,l.j5)("TKRS"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,12,V)):(0,o.kq)("",!0),0===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:1,disabled:i.loading,src:"img/img-tarjetas.png",onClick:e[4]||(e[4]=a=>i.setFormaPago("TARJETA")),style:(0,l.j5)("TARJETA"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,12,O)):(0,o.kq)("",!0),1===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("img",{key:2,disabled:i.loading,src:"img/img-3g.png",onClick:e[5]||(e[5]=a=>i.setFormaPago("DATAFONO_3G")),style:(0,l.j5)("DATAFONO_3G"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,12,R)):(0,o.kq)("",!0)])])])])])]),(0,o.Wm)(Q,{ref:"modalTkrsRef"},null,512),(0,o.Wm)(ea,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:i.modalNumpad,"onUpdate:modelValue":e[6]||(e[6]=a=>i.modalNumpad=a)},{default:(0,o.w5)((()=>[(0,o.Wm)(aa,null,{default:(0,o.w5)((()=>[(0,o._)("div",x,[(0,o._)("span",I,(0,l.zw)(),1)]),(0,o._)("div",Z,[(0,o._)("div",H,[(0,o.Wm)(X,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(G,{class:"ms-2 botoncicos-abajo",disabled:i.loading,color:"warning",onClick:e[7]||(e[7]=a=>i.cancelarVenta())},{default:(0,o.w5)((()=>[(0,o.Uk)((0,l.zw)(a.$t("volver","VOLVER")),1)])),_:1},8,["disabled"]),i.loading?((0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("div",null,[$,(0,o._)("span",W,(0,l.zw)(i.procesoDatafono),1)])])):(0,o.kq)("",!0),(0,o.Wm)(G,{class:"botonCobrar botoncicos-abajo",color:"primary",disabled:i.loading,onClick:e[8]||(e[8]=a=>i.cobrar()),style:{right:"4vmin"}},{default:(0,o.w5)((()=>[i.loading?((0,o.wg)(),(0,o.iD)("span",S)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,l.zw)(a.$t("pagar","Pagar")),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue"])}t(57658);var q=t(44870),U=t(79066),J=t(32374),G=t(38020),Y=t(42492),K=t.n(Y),Q=t(61837),X=t(91076),aa=t(74313),ea=t(20065),ta=t(22483),oa=t(92136);function la(a,e,t,o,l){oa.socket.emit("logFrontend",a,e,t,o,l)}let ia={Debug:function(a,e,t,o){la("Debug",a,e,t,o)},Trace:function(a,e,t,o){la("Trace",a,e,t,o)},Info:function(a,e,t,o){la("Info",a,e,t,o)},Warn:function(a,e,t,o){la("Warn",a,e,t,o)},Error:function(a,e,t,o){la("Error",a,e,t,o)},Fatal:function(a,e,t,o){la("Fatal",a,e,t,o)},Log:function(a,e,t,o,l){la(a,e,t,o,l)}};var ra=ia,sa={name:"CobroView",components:{CambioComponent:U.Z,MDBCard:aa.Yl,MDBBtn:aa.$v,MDBCardBody:aa.H7,MDBCardText:aa.Pp,NumpadComponent:Q.Z,VolverComponent:J.Z,ModalTkrsComponent:G.Z,MDBIcon:aa.vm,MDBModal:aa.j3,MDBModalBody:aa.Yz},setup(a,{expose:e}){const t=(0,ea.oR)(),l=(0,q.iH)(!1),i=(0,q.iH)(!1),r=(0,ta.tv)(),s=(0,o.Fl)((()=>t.state.Datafono.procesoActual)),n=(0,q.iH)(null),d=(0,q.iH)("EFECTIVO"),c=(0,q.iH)(0),u=(0,q.iH)(null),m=(0,q.iH)(!1),v=(0,q.iH)(!1),p=(0,q.iH)(!1),g=(0,q.iH)(0),f=(0,q.iH)(!1),b=(0,q.iH)(0),k=(0,q.iH)(0),C=(0,q.iH)([]),w=(0,o.Fl)((()=>A.value?.lista)),_=((0,o.f3)("resetGeneral"),(0,q.iH)(null));let T=(0,o.Fl)((()=>k.value-g.value<0?0:k.value-(b.value+g.value)));const D=(0,o.Fl)((()=>t.state.Trabajadores.indexActivo)),h=(0,o.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),z=(0,o.Fl)((()=>t.state.Cestas.arrayCestas)),M=(0,o.Fl)((()=>{const a=t.state.Cestas.Descuento;return void 0===a||isNaN(a)?0:a})),B=(0,o.Fl)((()=>h.value&&void 0!=D.value&&null!=D.value&&h.value[D.value]?h.value[D.value]:null)),y=(0,o.Fl)((()=>t.state.Deudas.deudasSeleccionadas)),E=(0,o.Fl)((()=>t.state.Encargos.encargoSeleccionado)),F=(0,o.Fl)((()=>{if(y.value.length>0){let a=0;for(const e of y.value)e.dejaCuenta&&(a+=e.dejaCuenta);return a}return E.value&&E.value.dejaCuenta||0}));let A=(0,q.iH)(null);function P(a){g.value=Number(a),a>=S(A.value)?d.value="TKRS":d.value="EFECTIVO"}function j(a){f.value||(g.value<S(A.value)&&g.value>=0?"TARJETA"===a&&g.value>0?K().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):d.value=a:K().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error"))}async function V(a){A=(0,o.Fl)((()=>{if(z.value)for(let a=0;a<z.value.length;a++)if(z.value[a]._id==h.value[D.value].idCesta)return z.value[a];return null}));const e=A.value?A.value.lista.filter((a=>a.pagado)).reduce(((a,e)=>a+e.subtotal),0):0;k.value=A.value?S(A.value)-e:0,l.value=!0}async function O(){f.value?ra.Warn(`cobrar loading.value: ${f.value}`,"modalCobroView.vue"):(f.value=!0,ra.Info("cobrar inicio","modalCobroView.vue"),"PAGO DEUDA"==A.value.modo?await R():await x())}async function R(){try{let a;if(a="TARJETA"==d.value?await X.Z.post("deudas/crearPagoDeudaPaytef",{total:S(A.value),idCesta:A.value._id,idTrabajador:B.value._id,tipo:d.value,tkrsData:{cantidadTkrs:g.value,formaPago:"EFECTIVO"},arrayDeudas:y.value}):await X.Z.post("deudas/crearPagoDeuda",{total:S(A.value),idCesta:A.value._id,idTrabajador:B.value._id,tipo:d.value,tkrsData:{cantidadTkrs:g.value,formaPago:"EFECTIVO"},arrayDeudas:y.value}),!a.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el pago de deuda")}K().fire({icon:"success",title:"Pago deuda registrada correctamente",showConfirmButton:!1,timer:500}),await X.Z.post("impresora/saludo").catch((a=>{K().fire("Oops...",a.message,"error")})),Z(),await W(A.value._id),d.value="EFECTIVO",$(!0)}catch(a){K().fire("Oops...",a.message,"error")}f.value=!1,G()}async function x(){try{const a=JSON.parse(JSON.stringify(A.value.lista)),e=a.some((a=>a.pagado));let o;const l="PAGO SEPARADO"==A.value.modo,i="RECOGER ENCARGO"==A.value.modo;if("TARJETA"==d.value?(t.dispatch("Datafono/setEstado","PENDIENTE"),o=await X.Z.post("tickets/crearTicketPaytef",{total:S(A.value),idCesta:A.value._id,idTrabajador:B.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*g.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:F.value})):o=await X.Z.post("tickets/crearTicket",{total:S(A.value),idCesta:A.value._id,idTrabajador:B.value._id,tipo:d.value,tkrsData:{cantidadTkrs:Number((Math.round(100*g.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:F.value}),!o.data){if("TARJETA"==d.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el ticket")}F.value>0&&i&&(console.log("entra"),X.Z.post("movimientos/nuevoMovimiento",{cantidad:F.value,concepto:"dejaACuenta",idTrabajador:B.value._id,tipo:"SALIDA"}).then((a=>{if(!a.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((a=>{K().fire("Oops...",a.message,"error")}))),K().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),await X.Z.post("impresora/saludo").catch((a=>{K().fire("Oops...",a.message,"error")})),p.value&&"TARJETA"!=d.value&&await X.Z.post("tickets/getUltimoTicket").then((async a=>{a.data[0]?._id?await X.Z.post("impresora/imprimirTicket",{idTicket:a.data[0]?._id}).catch((a=>{K().fire("Oops...",a.message,"error")})):K().fire("AVISO","Crea un ticket en esta caja abierta","info")})),(l||i)&&await W(A.value._id),i&&(X.Z.post("encargos/setEntregado",{id:E.value._id}),H()),I(),d.value="EFECTIVO",$(!0)}catch(a){K().fire("Oops...",a.message,"error")}f.value=!1,G(),ra.Info("cobrar fin","modalCobroView.vue")}function I(){let a=!1;z.value.forEach((e=>{if(!a&&e.trabajador===h.value[D.value]._id&&"DEVOLUCION"!=e.modo){a=!0;let t=e._id;X.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t,idTrabajador:h.value[D.value]._id})}}))}function Z(){t.dispatch("Deudas/deleteDeudasSeleccionadas")}function H(){t.dispatch("Encargos/deleteEncargoSeleccionado")}async function N(){ra.Info(`cancelarVenta loading:${f.value}`,"modalCobroView.vue"),$(),G(),"PAGO DEUDA"==A.value.modo?(Z(),await W(A.value._id)):"PAGO SEPARADO"==A.value.modo&&await X.Z.post("cestas/DevolverProductosACestaSep",{cesta:t.getters["Cestas/getCestaBaseActivo"],articulos:A.value.lista}).then((async a=>{await W(A.value._id)}))}function $(a=!1){const e=r.currentRoute.value.path;t.dispatch("ModalCobroView/cerrarModalCobroView"),"/cestas"===e&&a&&r.push("/main"),l.value=!1}async function W(a){X.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((a=>{K().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await X.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t.getters["Cestas/getCestaBaseActivo"],idTrabajador:h.value[t.state.Trabajadores.indexActivo]._id}).then((a=>{t.dispatch("Cestas/setCestaBaseAction",null)}))}function S(a){let e=a.detalleIva.importe1+a.detalleIva.importe2+a.detalleIva.importe3+a.detalleIva.importe4+a.detalleIva.importe5;return e-=F.value,e=Math.round(100*e)/100,e}function L(){X.Z.get("caja/estadoCaja").then((a=>{1==a.data&&K().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==t.getters["Trabajadores/getTrabajadorActivo"]?._id&&r.push("/menu/fichajes"):r.push("/abrirCaja")})).catch((a=>{K().fire("Oops...",a.message,"error")}))}function U(a){b.value+=a,C.value.push(a)}function J(){C.value.pop();let a=0;C.value.forEach((e=>{a+=e})),b.value=a}function G(){b.value=0,g.value=0,C.value=[],T=(0,o.Fl)((()=>k.value-g.value<0?0:k.value-(b.value+g.value)))}function Y(a){k.value=Number(a)}return(0,o.JJ)("setTkrs",P),e({abrirModal:V}),(0,o.bv)((()=>{L(),X.Z.post("parametros/getParametros").then((a=>{"3G"!==a.data?.tipoDatafono&&"0.0.0.0"!=a.data?.ipTefpay||(c.value=1),void 0!=a.data?.params?.SempreTicket?"Si"==a.data?.params?.SempreTicket&&(p.value=!0):p.value=!1,void 0!=a.data?.params?.prohibirTkRestaurant?"Si"==a.data?.params?.prohibirTkRestaurant&&(m.value=!0):m.value=!1,void 0!=a.data?.params?.TicketDFAuto?"Si"==a.data?.params?.TicketDFAuto&&(v.value=!0):v.value=!1}))})),{DescuentoCliente:M,cesta:A,getTotal:S,cobrar:O,formaPago:d,modalTkrsRef:u,prohibirTkRestaurant:m,setFormaPago:j,loading:f,tipoDatafono3G:c,eliminarAlPagarFnc:W,modalNumpad:i,cancelarVenta:N,modalCobro:l,abrirModal:V,sumar:U,totalRecibido:b,aPagar:k,numPadRef:n,deshacer:J,limpiar:G,procesoDatafono:s,setTkrs:P,cantidadTkrs:g,setAPagar:Y,cuenta:T,productos:w,TicketDFAuto:v,cliente:_,dejaCuenta:F}}},na=t(40089);const da=(0,na.Z)(sa,[["render",L],["__scopeId","data-v-1183cb3d"]]);var ca=da}}]);
//# sourceMappingURL=720.ed55fe27.js.map