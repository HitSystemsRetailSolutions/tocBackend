"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[932],{78400:function(e,a,o){o.d(a,{Z:function(){return v}});var l=o(73396),t=o(87139);const n=["onClick"],r={class:"botonTecladoSpaceDiv"};function c(e,a,o,c,i,d){const u=(0,l.up)("MDBInput"),s=(0,l.up)("MDBModalHeader"),m=(0,l.up)("MDBModalBody"),v=(0,l.up)("MDBModal");return(0,l.wg)(),(0,l.j4)(v,{frame:"",position:"bottom",id:"keyBoardModal",tabindex:"-1",labelledby:"keyBoardModal",modelValue:c.keyBoardModal,"onUpdate:modelValue":a[5]||(a[5]=e=>c.keyBoardModal=e)},{default:(0,l.w5)((()=>[c.showInput?((0,l.wg)(),(0,l.j4)(s,{key:0},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{style:{width:"80rem !important"},label:"Texto introducido",modelValue:c.text,"onUpdate:modelValue":a[0]||(a[0]=e=>c.text=e)},null,8,["modelValue"])])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(m,{class:"mainDiv"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.chars.length,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.chars[e-1],((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"btn-group-vertical mt-1 divTecla",key:a},[(0,l._)("button",{type:"button",style:(0,t.j5)([{"text-transform":"none"},c.keyStyle(e)]),class:"btn btn-outline-secondary py-3 botonTeclado",onClick:a=>c.processTecla(e)},(0,t.zw)(e),13,n)])))),128))])))),128)),(0,l._)("div",r,[(0,l._)("button",{style:(0,t.j5)([{"font-size":"1.8rem"},c.keyStyle("✎")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:a[1]||(a[1]=e=>c.processTecla("✎"))}," ✎ ",4),(0,l._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonTecladoSpace",onClick:a[2]||(a[2]=e=>c.processTecla(" "))}," ␣ "),(0,l._)("button",{style:{"font-size":"1.8rem"},type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:a[3]||(a[3]=e=>c.processTecla("@"))}," @ "),(0,l._)("button",{style:(0,t.j5)([{"font-size":"1.8rem"},c.keyStyle("#")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:a[4]||(a[4]=e=>c.processTecla("#"))}," Ⅳ ",4)])])),_:1})])),_:1},8,["modelValue"])}var i=o(44870),d=o(74313),u={name:"KeyBoardComponent",components:{MDBIcon:d.vm,MDBModalBody:d.Yz,MDBModal:d.j3,MDBBtn:d.$v,MDBModalHeader:d.ol,MDBModalTitle:d.wo,MDBInput:d.u2,MDBModalFooter:d.ab},props:{value:String,text:String},setup(e,{expose:a}){const o=(0,i.iH)(e.value||""),t=(0,i.iH)(!1),n=(0,i.iH)(!1),r=(0,i.iH)(!1);let c=!1;const d=(0,i.iH)(!1),u=[["q","w","e","r","t","y","u","i","o","p","←"],["a","s","d","f","g","h","j","k","l","ñ","↵"],["z","x","c","v","b","n","m",",",".","-","⇪"]],s=(0,i.iH)([]);function m(e){switch(e){case"←":g();break;case"↵":t.value=!1;break;case"⇪":c=!c,o.value.length>0&&(n.value=!n.value),_();break;case"#":r.value=!r.value,_();break;case"✎":d.value=!d.value;break;default:p(e);break}}function v(e){let a=o.value.length<=0&&!c||n.value,l="background-color: #606060 !important; color: white !important;";return r.value&&"#"==e||d.value&&"✎"==e||"⇪"==e&&a?l:a?"text-transform: uppercase":"text-transform: none;"}function p(e){let a=o.value.length<=0&&!c||n.value;c=!1,a&&(e=e.toUpperCase()),o.value+=e}function g(){o.value.length>0&&(o.value=o.value.slice(0,-1))}function _(){let e=u;const a=["á","é","í","ó","ú","ü","¡","¿"];if(r.value){let a=[["1","2","3","4","5","6","7","8","9","0","ç"]];a=a.concat(u),e=a}s.value=e.map((e=>e.map((e=>a.includes(e)?[e,e.toUpperCase()]:e))))}function b(e=""){void 0===o.value&&(o.value=""),o.value=e,t.value=!0}function f(){return[o.value,t.value]}return a({getValue:f,abrirModal:b}),(0,l.bv)((()=>{_()})),{text:o,addTecla:p,deleteTecla:g,keyBoardModal:t,processTecla:m,upperCase:n,keyStyle:v,buildKeyboard:_,abrirModal:b,showInput:d,chars:s}}},s=o(40089);const m=(0,s.Z)(u,[["render",c],["__scopeId","data-v-407fd075"]]);var v=m},51363:function(e,a,o){o.r(a),o.d(a,{default:function(){return de}});var l=o(73396),t=o(87139),n=o(49242);const r=e=>((0,l.dD)("data-v-de8601a6"),e=e(),(0,l.Cn)(),e),c={id:"main"},i={id:"vueMenuEncargo"},d={class:"encargos"},u={class:""},s={class:"row"},m=r((()=>(0,l._)("div",{class:"col"},null,-1))),v={class:"col"},p={key:0},g={class:"btnEncargo lgEncargo float-right"},_=r((()=>(0,l._)("hr",null,null,-1))),b={class:"productos"},f={key:0,style:{"overflow-y":"scroll",height:"28vh"}},y={class:"d-flex flex-column juatify-content-center"},k={style:{"max-width":"270px"}},C=["onUpdate:modelValue","onClick"],D=r((()=>(0,l._)("br",null,null,-1))),h={key:1},M=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),w={class:"recogida"},T={class:"opciones-recogida"},B={class:"fechas-recogida"},H={key:0},x={key:1},j={key:2},R=["id","onUpdate:modelValue","onClick"],E=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),I={class:"encargos-footer"},A=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),z={class:"mb-0 mt-2"},V={class:"d-flex"},N={class:"input-deja-a-cuenta"},S=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Deja a cuenta:",-1))),$={class:"btnTotal"},q=["disabled"],U={class:""},W=["disabled"],P={class:"row"},K={class:"col"},Y={class:"input-group input-group-lg"},F={class:"row"},Z={class:"col text-center"};function O(e,a,o,r,O,L){const J=(0,l.up)("MDBModalTitle"),Q=(0,l.up)("MDBModalHeader"),G=(0,l.up)("NumpadComponent"),X=(0,l.up)("MDBModalBody"),ee=(0,l.up)("MDBBtn"),ae=(0,l.up)("MDBModalFooter"),oe=(0,l.up)("MDBModal"),le=(0,l.up)("ModalClientesComponent"),te=(0,l.up)("KeyBoardComponent");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",c,[(0,l._)("div",i,[(0,l._)("div",null,[(0,l._)("div",d,[(0,l._)("div",u,[(0,l._)("div",s,[m,(0,l._)("div",v,[r.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",p,[(0,l._)("button",g,(0,t.zw)(r.clienteData.nombreCliente),1)])):(0,l.kq)("",!0)])]),_,(0,l._)("div",b,[r.productos.length?((0,l.wg)(),(0,l.iD)("div",f,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.productos,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,l._)("div",y,[(0,l._)("span",k,"- "+(0,t.zw)(e.nombre),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,((e,a)=>((0,l.wg)(),(0,l.iD)("span",{key:a},(0,t.zw)(e.nombre),1)))),128))]),(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":a=>e.comentario=a,readonly:"",onClick:e=>r.openKeyboard(a)},null,8,C),[[n.nr,e.comentario]])])))),128)),D])):((0,l.wg)(),(0,l.iD)("div",h,(0,t.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),M,(0,l._)("div",w,[(0,l._)("div",T,[(0,l._)("button",{onClick:a[0]||(a[0]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"1",class:(0,t.C_)({active:1===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_hoy","Hoy")),3),(0,l._)("button",{onClick:a[1]||(a[1]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"2",class:(0,t.C_)({active:2===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_otro_dia","Otro día")),3),(0,l._)("button",{onClick:a[2]||(a[2]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"3",class:(0,t.C_)({active:3===r.refEncargoRecogida})},(0,t.zw)(e.$t("toc_game_encargos_cada","Cada...")),3)]),(0,l._)("div",B,[1===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",H,[(0,l._)("button",{onClick:a[3]||(a[3]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"am",class:(0,t.C_)({active:"am"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_manana","Turno de la mañana")),3),(0,l._)("button",{onClick:a[4]||(a[4]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"pm",class:(0,t.C_)({active:"pm"===r.refAmPm})},(0,t.zw)(e.$t("toc_game_encargos_por_la_tarde","Turno de la tarde")),3)])):(0,l.kq)("",!0),2===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",x,[(0,l.wy)((0,l._)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[5]||(a[5]=e=>r.fechaInput=e)},null,512),[[n.nr,r.fechaInput]]),(0,l.wy)((0,l._)("input",{type:"time",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>r.horaInput=e)},null,512),[[n.nr,r.horaInput]])])):(0,l.kq)("",!0),3===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",j,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.dias,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.wy)((0,l._)("input",{type:"button",id:e.dia,"onUpdate:modelValue":a=>e.dia=a,onClick:a=>r.clickDia(e),class:(0,t.C_)({active:r.refDia===e.nDia})},null,10,R),[[n.nr,e.dia]])])))),128))])):(0,l.kq)("",!0)])]),E,(0,l._)("div",I,[(0,l._)("div",null,[A,(0,l._)("p",z,(0,t.zw)(r.precioTotal)+"€",1)]),(0,l._)("div",V,[(0,l._)("div",N,[S,(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",id:"cuenta",name:"dejaACuenta",placeholder:"0",min:"0","onUpdate:modelValue":a[7]||(a[7]=e=>r.dejaACuenta=e),onClick:a[8]||(a[8]=(...e)=>r.openTecladoNum&&r.openTecladoNum(...e)),readonly:""},null,512),[[n.nr,r.dejaACuenta]])]),(0,l._)("div",$,[(0,l._)("input",{type:"button",value:"APLICAR TOTAL",class:"btn btn-secondary",onClick:a[9]||(a[9]=(...e)=>r.aplicarTotalImporte&&r.aplicarTotalImporte(...e)),disabled:r.botonBloqueado},null,8,q)])]),(0,l._)("div",U,[(0,l._)("input",{type:"button",value:"Crear encargo",class:"btn btn-primary btn-lg",onClick:a[10]||(a[10]=(...e)=>r.crearEncargo&&r.crearEncargo(...e)),disabled:r.botonBloqueado},null,8,W)])])])])])])]),(0,l.Wm)(oe,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:r.modalTecladoNum,"onUpdate:modelValue":a[14]||(a[14]=e=>r.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(J,{id:"modalTecladoNumLabel"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("deja_a_cuenta","Deja a cuenta")),1)])),_:1})])),_:1}),(0,l.Wm)(X,null,{default:(0,l.w5)((()=>[(0,l._)("div",P,[(0,l._)("div",K,[(0,l._)("div",Y,[r.numpadRef?(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[11]||(a[11]=e=>r.numpadRef.cantidad=e)},null,512)),[[n.nr,r.numpadRef.cantidad]]):(0,l.kq)("",!0)])])]),(0,l._)("div",F,[(0,l._)("div",Z,[(0,l.Wm)(G,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,l.Wm)(ae,null,{default:(0,l.w5)((()=>[(0,l.Wm)(ee,{color:"danger",onClick:a[12]||(a[12]=e=>r.closeTecladoNum()),size:"lg"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Cerrar ")])),_:1}),(0,l.Wm)(ee,{color:"success",size:"lg",onClick:a[13]||(a[13]=e=>r.finishTecladoNum())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,t.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(le,{ref:"refModalClientes"},null,512),(0,l.Wm)(te,{ref:"keyboardRef"},null,512)],64)}o(57658);var L=o(44870),J=o(74313),Q=o(20065),G=o(59072),X=o(33727),ee=o(42492),ae=o.n(ee),oe=o(87853),le=o(91076),te=o(44918),ne=o(78400),re={name:"EncargosComponent",components:{ModalClientesComponent:G.Z,NumpadComponent:X.Z,MDBCard:J.Yl,MDBCardBody:J.H7,MDBCardTitle:J.QM,MDBCardText:J.Pp,MDBBtn:J.$v,MDBCheckbox:J.IH,MDBModal:J.j3,MDBModalHeader:J.ol,MDBModalTitle:J.wo,MDBModalBody:J.Yz,MDBModalFooter:J.ab,MDBIcon:J.vm,MDBLoading:J.J$,KeyBoardComponent:ne.Z},setup(){const e=(0,L.iH)(!1),a=(0,L.iH)(null),o=(0,Q.oR)(),{t:t}=(0,oe.QT)(),n=o.getters["Cestas/getCestaActiva"],r=(o.getters["Cestas/getCestaActivaIndex"],(0,l.Fl)((()=>o.state.Trabajadores.arrayTrabajadores))),c=(0,l.Fl)((()=>o.state.Trabajadores.indexActivo)),i=(0,l.Fl)((()=>r.value&&null!=c.value&&void 0!=c.value&&r.value[c.value]?r.value[c.value]:null)),d=(0,L.iH)(null),u=(0,L.iH)(null),s=(0,L.iH)(null),m=(0,L.iH)("09:00"),v=(0,L.iH)([{dia:"Lunes",nDia:0,checked:!1},{dia:"Martes",nDia:1,checked:!1},{dia:"Miércoles",nDia:2,checked:!1},{dia:"Jueves",nDia:3,checked:!1},{dia:"Viernes",nDia:4,checked:!1},{dia:"Sábado",nDia:5,checked:!1},{dia:"Domingo",nDia:6,checked:!1}]),p=(0,L.iH)(null),g=(0,L.iH)(0),_={idCliente:n.idCliente,nombreCliente:n.nombreCliente},b=(0,L.iH)(null),f=(0,L.iH)(null),y=(0,L.iH)(n.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion,descuentoTienda:e?.descuentoTienda||0,articulosMenu:e.articulosMenu||null})))),k=(0,L.iH)(null),C=(0,L.iH)(null),D=e=>{d.value=parseInt(e.target.value)},h=e=>{u.value=e.target.value},M=e=>{p.value=e.nDia;for(let a=0;a<v.value.length;a++)v.value[a].nDia==p.value?v.value[a].checked=!0:v.value[a].checked=!1},w=()=>v.value.filter((e=>e.checked)),T=()=>{const e=n.detalleIva,a=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((a,o)=>a+e[o]),0);return Math.round(100*a)/100},B=()=>{g.value=k.value},H=()=>{if(e.value=!0,!_.idCliente)return x(t("toc_game_encargos_error_no_cliente","Tienes que seleccionar un cliente para crear el encargo."),"error"),void(e.value=!1);if(!y.value.length)return x(t("toc_game_encargos_error_no_productos","Tienes que haber al menos un producto para crear el encargo."),"error"),void(e.value=!1);if(!d.value)return x(t("toc_game_encargos_error_no_recogida","Tienes que elegir una opción de recogida (hoy, otro día o cada...)"),"error"),void(e.value=!1);if(1===d.value&&!u.value)return x(t("toc_game_encargos_error_no_am_pm","Tienes que elegir por la mañana o por la tarde"),"error"),void(e.value=!1);if(2===d.value&&(!s.value||!m.value))return x(t("toc_game_encargos_error_fecha_hora","Tienes que elegir la fecha y la hora del encargo"),"error"),void(e.value=!1);if(3===d.value&&!w().length)return x(t("toc_game_encargos_error_dias_seleccionados","Tienes que elegir al menos un día"),"error"),void(e.value=!1);if(1===d.value){const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();s.value=`${a}-${o.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")}`}if(3===d.value){let e=new Date,a=e.getDay(),o=w()[0].nDia+1,l=(o-a+7)%7,t=new Date(e.getTime()+24*l*60*60*1e3);const n=t.getFullYear(),r=t.getMonth()+1,c=t.getDate();s.value=`${n}-${r.toString().padStart(2,"0")}-${c.toString().padStart(2,"0")}`}const a={idCliente:_.idCliente,nombreCliente:_.nombreCliente,opcionRecogida:d.value,amPm:u.value,fecha:s.value,hora:m.value,dias:w(),dejaCuenta:g.value||0,total:T(),productos:y.value,cesta:n,idTrabajador:i.value._id,nombreDependienta:i.value.nombre};le.Z.post("encargos/setEncargo",a).then((({data:a})=>a&&a.msg?a.error?(x(a.msg,"error"),void(e.value=!1)):(g.value>0&&le.Z.post("movimientos/nuevoMovimiento",{cantidad:g.value,concepto:"dejaACuentaEncargo",idTrabajador:i.value._id,tipo:"ENTRADA_DINERO",nombreCliente:_.nombreCliente}).then((a=>{if(!a.data)throw e.value=!1,Error("No se ha podido realizar la entrada de dinero")})).catch((a=>{e.value=!1,ae().fire("Oops...",a.message,"error")})),e.value=!1,void x(t("toc_game_encargos_ok","Encargo creado!"),"success",j)):(x(t("toc_game_encargos_error_general","Error general"),"error"),void(e.value=!1)))).catch((a=>{e.value=!1,x(t("toc_game_encargos_error_general","Error general"),"error")}))},x=(e,a,o=(()=>{}))=>{ae().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>o()))},j=async()=>{o.dispatch("EstadoDinamico/reset"),A("/main")},R=()=>{f.value=!0},E=()=>{f.value=!1},I=()=>{let e=Number(b.value.cantidad);g.value=Number(e.toFixed(2)),E()},A=e=>te.Z.push(e);let z;async function V(e){try{const a=y.value[e];C.value.abrirModal(a.comentario),z=setInterval((()=>{const e=C.value.getValue()[0];e!==a.comentario&&(a.comentario=e),C.value.getValue()[1]||clearInterval(z)}),100)}catch(a){console.log(a),z=void 0}}return(0,l.bv)((()=>{k.value=T()})),(0,l.JJ)("okValue",(()=>f.value?I():R())),{refModalClientes:a,cestaActiva:n,clienteData:_,productos:y,refEncargoRecogida:d,refAmPm:u,dias:v,fechaInput:s,horaInput:m,dejaACuenta:g,onClickRecogida:D,onClickAmPm:h,clickDia:M,crearEncargo:H,precioTotal:k,refDia:p,botonBloqueado:e,numpadRef:b,modalTecladoNum:f,openTecladoNum:R,closeTecladoNum:E,finishTecladoNum:I,aplicarTotalImporte:B,keyboardRef:C,openKeyboard:V}}},ce=o(40089);const ie=(0,ce.Z)(re,[["render",O],["__scopeId","data-v-de8601a6"]]);var de=ie}}]);
//# sourceMappingURL=932.2f24855e.js.map