"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[567],{97567:function(e,a,t){t.r(a),t.d(a,{default:function(){return P}});var s=t(73396),l=t(87139);const i=e=>((0,s.dD)("data-v-2d084fc1"),e=e(),(0,s.Cn)(),e),r={id:"main"},n={id:"vueMenuEncargo"},o={class:"encargos"},c={class:""},d={class:"row"},u=i((()=>(0,s._)("div",{class:"col"},null,-1))),v={class:"col"},p={key:0},_={class:"btnEncargo lgEncargo float-right"},m={key:1,class:"btnEncargo float-right"},g=i((()=>(0,s._)("i",{class:"fas fa-search"},null,-1))),C=i((()=>(0,s._)("hr",null,null,-1))),f={class:"productos"},b={key:0},D={class:"d-flex flex-column py-1"},h={class:"d-flex flex-column justify-content-center"},w={class:""},k={key:1},y={class:"encargos-footer"},T=i((()=>(0,s._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),E={class:"mb-0 mt-2"},x={class:""};function A(e,a,t,i,A,I){return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",n,[(0,s._)("div",null,[(0,s._)("div",o,[(0,s._)("div",c,[(0,s._)("div",d,[u,(0,s._)("div",v,[i.clienteData.idCliente?((0,s.wg)(),(0,s.iD)("h1",p,[(0,s._)("button",_,(0,l.zw)(i.clienteData.nombreCliente),1)])):((0,s.wg)(),(0,s.iD)("button",m,[g,(0,s.Uk)(" Abrir modal cliente ")]))])]),C,(0,s._)("div",f,[i.cestaActiva.lista.length?((0,s.wg)(),(0,s.iD)("div",b,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.cestaActiva.lista,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,s._)("div",D,[(0,s._)("span",null,"- "+(0,l.zw)(e.nombre),1),(0,s._)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.arraySuplementos,((e,a)=>((0,s.wg)(),(0,s.iD)("span",{class:"ms-3",key:a},(0,l.zw)(e.nombre),1)))),128))])]),(0,s._)("div",null,[(0,s._)("span",w,(0,l.zw)(e.unidades)+" unidad(es)",1)])])))),128))])):((0,s.wg)(),(0,s.iD)("div",k,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),(0,s._)("div",y,[(0,s._)("div",null,[T,(0,s._)("p",E,(0,l.zw)(i.precioTotal)+"€",1)]),(0,s._)("div",x,[(0,s._)("input",{type:"button",value:"Crear deuda",class:"btn btn-primary btn-lg",onClick:a[0]||(a[0]=(...e)=>i.crearDeuda&&i.crearDeuda(...e))})])])])])])])])}t(57658);var I=t(44870),F=t(20065),j=t(42492),Z=t.n(j),z=t(87853),O=t(44161),H=t(54455),N={name:"DeudasComponent",setup(){const e=(0,F.oR)(),{t:a}=(0,z.QT)(),t=(0,I.iH)(0),l=(0,s.Fl)((()=>e.state.Cestas.arrayCestas)),i=e.getters["Cestas/getCestaActiva"],r=e.getters["Cestas/getCestaActivaIndex"],n=(0,s.Fl)((()=>e.state.Trabajadores.arrayTrabajadores)),o=(0,s.Fl)((()=>e.state.Trabajadores.indexActivo)),c=(0,s.Fl)((()=>n.value&&null!=o.value&&void 0!=o.value&&n.value[o.value]?n.value[o.value]:null)),d=(0,s.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(l.value[e]._id==n.value[o.value].idCesta)return l.value[e];return null})),u=(0,s.Fl)((()=>e.state.Cestas.Descuento)),v=(0,I.iH)(null),p={idCliente:i.idCliente,nombreCliente:i.nombreCliente};function _(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5,t=Math.round(100*a)/100;return parseFloat(t)}const m=async()=>{try{const e=(await O.Z.post("clientes/getClienteById",{idCliente:d.value.idCliente})).data;if(e?.albaran)g();else{const e=await O.Z.post("tickets/crearTicket",{total:_(d.value),idCesta:d.value._id,idTrabajador:c.value._id,tipo:"DEUDA",tkrsData:{cantidadTkrs:t.value,formaPago:"EFECTIVO"},concepto:"DEUDA"});if(!e.data)throw Error("No se ha podido crear el ticket");f(a("toc_game_encargos_ok","Deuda creada!"),"success",C)}}catch(e){Z().fire("Oops...",e.message,"error")}};function g(){O.Z.post("albaranes/crearAlbaran",{total:_(d.value),idCesta:d.value._id,idTrabajador:c.value._id,estado:"DEUDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");await O.Z.post("cestas/borrarCesta",{idCesta:d.value._id}),await O.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{Z().fire("Oops...",e.message,"error")})),f(a("toc_game_encargos_ok","Deuda albaran creada!"),"success",C)})).catch((e=>{Z().fire("Oops...",e.message,"error")}))}const C=async()=>(await e.dispatch("Cestas/setModoCesta",{index:r,modo:"VENTA"}),e.dispatch("Cestas/setClienteCesta",{index:r,idCliente:null,nombreCliente:null}),e.dispatch("EstadoDinamico/reset"),e.dispatch("Cestas/deleteLista",i._id),b("/main"),Promise.resolve()),f=(e,a,t=(()=>{}))=>{Z().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>t()))},b=e=>H.Z.push(e);return(0,s.bv)((()=>{v.value=_(d.value)})),{crearDeuda:m,cestaActiva:i,clienteData:p,precioTotal:v,cantidadTkrs:t,cesta:d,arrayCestas:l,getTotal:_,DescuentoCliente:u}}},U=t(40089);const M=(0,U.Z)(N,[["render",A],["__scopeId","data-v-2d084fc1"]]);var P=M}}]);
//# sourceMappingURL=567.45044289.js.map