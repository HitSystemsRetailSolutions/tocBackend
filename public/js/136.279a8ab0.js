"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[136],{61562:function(a,e,o){o.d(e,{Z:function(){return m}});var t=o(73396),l=o(87139);const i=["onClick"],n={class:"botonTecladoSpaceDiv"};function r(a,e,o,r,c,s){const u=(0,t.up)("MDBInput"),d=(0,t.up)("MDBModalHeader"),v=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{frame:"",position:"bottom",id:"keyBoardModal",tabindex:"-1",labelledby:"keyBoardModal",modelValue:r.keyBoardModal,"onUpdate:modelValue":e[4]||(e[4]=a=>r.keyBoardModal=a)},{default:(0,t.w5)((()=>[r.showInput?((0,t.wg)(),(0,t.j4)(d,{key:0},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{style:{width:"80rem !important"},label:"Texto introducido",modelValue:r.text,"onUpdate:modelValue":e[0]||(e[0]=a=>r.text=a)},null,8,["modelValue"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(v,{class:"mainDiv"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.chars.length,((a,e)=>((0,t.wg)(),(0,t.iD)("div",{key:e},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.chars[a-1],((a,e)=>((0,t.wg)(),(0,t.iD)("div",{class:"btn-group-vertical mt-1 divTecla",key:e},[(0,t._)("button",{type:"button",style:(0,l.j5)([{"text-transform":"none"},r.keyStyle(a)]),class:"btn btn-outline-secondary py-3 botonTeclado",onClick:e=>r.processTecla(a)},(0,l.zw)(a),13,i)])))),128))])))),128)),(0,t._)("div",n,[(0,t._)("button",{style:(0,l.j5)([{"font-size":"1.8rem"},r.keyStyle("✎")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:e[1]||(e[1]=a=>r.processTecla("✎"))}," ✎ ",4),(0,t._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonTecladoSpace",onClick:e[2]||(e[2]=a=>r.processTecla(" "))}," ␣ "),(0,t._)("button",{style:(0,l.j5)([{"font-size":"1.8rem"},r.keyStyle("#")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:e[3]||(e[3]=a=>r.processTecla("#"))}," Ⅳ ",4)])])),_:1})])),_:1},8,["modelValue"])}var c=o(44870),s=o(74313),u={name:"KeyBoardComponent",components:{MDBIcon:s.vm,MDBModalBody:s.Yz,MDBModal:s.j3,MDBBtn:s.$v,MDBModalHeader:s.ol,MDBModalTitle:s.wo,MDBInput:s.u2,MDBModalFooter:s.ab},props:{value:String,text:String},setup(a,{expose:e}){const o=(0,c.iH)(a.value||""),l=(0,c.iH)(!1),i=(0,c.iH)(!1),n=(0,c.iH)(!1);let r=!1;const s=(0,c.iH)(!1),u=[["q","w","e","r","t","y","u","i","o","p","←"],["a","s","d","f","g","h","j","k","l","ñ","↵"],["z","x","c","v","b","n","m",",",".","-","⇪"]],d=(0,c.iH)([]);function v(a){switch(a){case"←":k();break;case"↵":l.value=!1;break;case"⇪":r=!r,o.value.length>0&&(i.value=!i.value),f();break;case"#":n.value=!n.value,f();break;case"✎":s.value=!s.value;break;default:p(a);break}}function m(a){let e=o.value.length<=0&&!r||i.value,t="background-color: #606060 !important; color: white !important;";return n.value&&"#"==a||s.value&&"✎"==a||"⇪"==a&&e?t:e?"text-transform: uppercase":"text-transform: none;"}function p(a){let e=o.value.length<=0&&!r||i.value;r=!1,e&&(a=a.toUpperCase()),o.value+=a}function k(){o.value.length>0&&(o.value=o.value.slice(0,-1))}function f(){let a=u;const e=["á","é","í","ó","ú","ü","¡","¿"];if(n.value){let e=[["1","2","3","4","5","6","7","8","9","0","ç"]];e=e.concat(u),a=e}d.value=a.map((a=>a.map((a=>e.includes(a)?[a,a.toUpperCase()]:a))))}function _(a=""){void 0===o.value&&(o.value=""),o.value=a,l.value=!0}function T(){return[o.value,l.value]}return e({getValue:T,abrirModal:_}),(0,t.bv)((()=>{f()})),{text:o,addTecla:p,deleteTecla:k,keyBoardModal:l,processTecla:v,upperCase:i,keyStyle:m,buildKeyboard:f,abrirModal:_,showInput:s,chars:d}}},d=o(40089);const v=(0,d.Z)(u,[["render",r],["__scopeId","data-v-c19133e2"]]);var m=v},48466:function(a,e,o){o.d(e,{Z:function(){return h}});var t=o(73396),l=o(87139);const i={class:"container"},n={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},c={key:2,class:"h3 text-center"},s={class:"row mt-2 container botonesCaja"},u={class:"again py-5"},d={class:"again py-5"},v={class:"again py-5"},m={class:"again py-5"};function p(a,e,o,p,k,f){const _=(0,t.up)("MDBBtn"),T=(0,t.up)("MDBModalBody"),g=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(g,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":e[4]||(e[4]=a=>p.ModalErrorDatafonoQueHacerComponent=a),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,null,{default:(0,t.w5)((()=>[(0,t._)("div",i,[1==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",n," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",c," Ultimo pago fallido ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",s,[1==p.ticketExist?((0,t.wg)(),(0,t.j4)(_,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:e[0]||(e[0]=a=>p.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,l.zw)(a.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(_,{key:1,color:"warning  ",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":a.disabled,onClick:e[1]||(e[1]=a=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",d,(0,l.zw)(a.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(_,{key:2,color:"primary  ",class:"botonEstado my-3 botones",onClick:e[2]||(e[2]=a=>p.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",v,(0,l.zw)(a.$t("pago en efectivo","Pago en efectivo o 3G")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>2?((0,t.wg)(),(0,t.j4)(_,{key:3,color:"danger ",class:"botonEstado my-3 botones",onClick:e[3]||(e[3]=a=>p.esborrarTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,l.zw)(a.$t("anular","Anular ticket")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}o(57658);var k=o(20065),f=o(91076),_=o(74313),T=o(42492),g=o.n(T),w=o(44870),y={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:_.j3,MDBModalBody:_.Yz,MDBBtn:_.$v},setup(a,{expose:e}){const o=(0,w.iH)(null),l=(0,w.iH)(0),i=(0,w.iH)(!1),n=(0,k.oR)(),r=(0,w.iH)(!1),c=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores));let s=(0,w.iH)(!1);const u=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),d=(0,t.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null));function v(a,e){if(4==e)return g().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=a,l.value=e,r.value=!0}async function m(){await f.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,n.dispatch("Datafono/setEstado","APROBADA")})).catch((a=>{r.value=!0,g().fire("Oops...",a.message,"error")})),g().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}async function p(){null!=o.value&&(await T()?f.Z.post("tickets/anularTicket",{ticketId:o.value}).then((a=>{r.value=!1,a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo)?(i.value&&_(),g().fire({icon:"success",title:"Ticket anulado"+(i.value?" - imprimiendo ticket...":""),showConfirmButton:!1,timer:1200})):a.data.res?router.push("/main"):g().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{g().fire(a.message)})):g().fire("No se ha anulado el ticket.","El ticket sigue activo.","info"))}function _(){f.Z.post("impresora/imprimirTicket",{idTicket:arrayTickets.value[indexTicket.value]._id}).catch((a=>{g().fire("Oops...",a.message,"error")}))}async function T(){return await g().fire({title:"¿Desea realmente anular el ticket? ",html:"Esta opción dejara el ticket anulado.",showCancelButton:!0,confirmButtonText:"Anular",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning"}).then((async a=>!!a.isConfirmed))}function y(){s.value=!0,f.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{r.value=!1,s.value=!1,n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((a=>{s.value=!1,r.value=!0,g().fire("Oops...",a.message,"error")})),s.value=!1,g().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function b(){g().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),r.value=!1}return e({abrirModal:v}),(0,t.bv)((async()=>{const{data:a}=await f.Z.post("parametros/getParametros");i.value="Si"==a.params?.TicketAlAnular})),{store:n,darComoValido:m,ModalErrorDatafonoQueHacerComponent:r,tarjetaUltimoTicket:y,esperandoConexion:s,TicketAlAnular:i,arrayTrabajadores:c,indexTrabajadorActivo:u,esborrarTicket:p,idSeleccionado:o,pagoDependienta:b,ticketExist:l}}},b=o(40089);const A=(0,b.Z)(y,[["render",p],["__scopeId","data-v-266e01f8"]]);var h=A},13987:function(a,e,o){o.r(e),o.d(e,{default:function(){return ka}});var t=o(73396),l=o(87139);const i=a=>((0,t.dD)("data-v-308fbb76"),a=a(),(0,t.Cn)(),a),n={class:"col-md-7 listaTickets"},r={class:"th-sm"},c={class:"th-sm"},s={class:"th-sm"},u={class:"th-sm"},d=["onClick"],v={key:0,class:"col-md-5"},m={id:"detalleTicket"},p={class:"text-center"},k={class:"text-center"},f=i((()=>(0,t._)("br",null,null,-1))),_=i((()=>(0,t._)("hr",null,null,-1))),T={class:"contencionTicket"},g={class:"table"},w={class:"titulosTicket"},y={class:"titulosTicket"},b={class:"titulosTicket"},A=i((()=>(0,t._)("hr",null,null,-1))),h={class:"text-center"};function C(a,e,o,i,C,D){const M=(0,t.up)("MDBTable"),B=(0,t.up)("MDBIcon"),x=(0,t.up)("MDBBtn"),E=(0,t.up)("CashlogyAnulacionView"),H=(0,t.up)("ModalAnulacionTicket");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",n,[(0,t.Wm)(M,{hover:""},{default:(0,t.w5)((()=>[(0,t._)("thead",null,[(0,t._)("tr",null,[(0,t._)("th",r,(0,l.zw)(a.$t("numero_ticket","Número ticket")),1),(0,t._)("th",c,(0,l.zw)(a.$t("hora","Hora")),1),(0,t._)("th",s,(0,l.zw)(a.$t("tipo_pago","Tipo pago")),1),(0,t._)("th",u,(0,l.zw)(a.$t("total","Total")),1)])]),(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.arrayTickets,((a,e)=>((0,t.wg)(),(0,t.iD)("tr",{key:e,class:(0,l.C_)({"table-active":a._id===i.idActivo}),onClick:o=>i.setActivo(a,e)},[(0,t._)("td",null,(0,l.zw)(a._id),1),(0,t._)("td",null,(0,l.zw)(i.getTiempo(a.timestamp)),1),(0,t._)("td",null,(0,l.zw)(a.tipoPago),1),(0,t._)("td",null,(0,l.zw)(a.total.toFixed(2))+" €",1)],10,d)))),128))])])),_:1})]),null!=i.indexTicket?((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("div",m,[(0,t._)("h2",p,(0,l.zw)(a.$t("ticket","Ticket"))+" "+(0,l.zw)(i.arrayTickets[i.indexTicket]._id),1),(0,t._)("h6",k,(0,l.zw)(i.getTiempo(i.arrayTickets[i.indexTicket].timestamp)),1),f,_,(0,t._)("div",T,[(0,t._)("table",g,[(0,t._)("tr",null,[(0,t._)("th",w,(0,l.zw)(a.$t("producto","Producto")),1),(0,t._)("th",y,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,t._)("th",b,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.arrayTickets[i.indexTicket]?.cesta?.lista,((a,e)=>((0,t.wg)(),(0,t.iD)("tr",{key:e},[(0,t._)("td",null,(0,l.zw)(a.nombre),1),(0,t._)("td",null,(0,l.zw)(a.subtotal.toFixed(2))+" €",1),(0,t._)("td",null,(0,l.zw)(a.unidades),1)])))),128))])]),A,(0,t._)("h1",h,(0,l.zw)(a.$t("total","Total"))+": "+(0,l.zw)(i.arrayTickets[i.indexTicket].total.toFixed(2)),1),(0,t.Wm)(x,{onClick:e[0]||(e[0]=a=>i.imprimirTicket()),color:"success",class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Wm)(B,{icon:"print",size:"3x"})])),_:1}),"DATAFONO_3G"!==i.arrayTickets[i.indexTicket].tipoPago&&"TARJETA"===i.arrayTickets[i.indexTicket].tipoPago||"DEVUELTO"===i.arrayTickets[i.indexTicket].tipoPago||"DEV_DATAFONO_PAYTEF"===i.arrayTickets[i.indexTicket].tipoPago?((0,t.wg)(),(0,t.j4)(x,{key:0,onClick:e[1]||(e[1]=a=>i.imprimirTicketPaytef()),color:"info",class:"w-100 mt-3"},{default:(0,t.w5)((()=>[(0,t.Wm)(B,{icon:"file-invoice-dollar",size:"3x"})])),_:1})):(0,t.kq)("",!0),"EFECTIVO"===i.arrayTickets[i.indexTicket].tipoPago?((0,t.wg)(),(0,t.j4)(x,{key:1,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[2]||(e[2]=a=>i.cambiarTipoPago(i.arrayTickets[i.indexTicket]._id))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("pagar_con_tarjeta","Pagar con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),"DATAFONO_3G"===i.arrayTickets[i.indexTicket].tipoPago?((0,t.wg)(),(0,t.j4)(x,{key:2,color:"primary",class:"w-100 mt-4",size:"lg",onClick:e[3]||(e[3]=a=>i.pagarEfectivo(i.arrayTickets[i.indexTicket]._id))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("pagar_con_efectivo","Pagar con efectivo")),1)])),_:1})):(0,t.kq)("",!0),i.prohibirAnularTicket||"DATAFONO_3G"===i.arrayTickets[i.indexTicket].tipoPago&&i.prohibirAnular3g||"ANULADO"==i.arrayTickets[i.indexTicket].tipoPago||"DEVUELTO"==i.arrayTickets[i.indexTicket].tipoPago||!i.mostrarPorAlbaran?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(x,{key:3,onClick:e[4]||(e[4]=a=>i.openModalAnulacion(i.arrayTickets[i.indexTicket]._id)),disabled:i.anulando,color:"danger",class:"w-100 mt-4",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("devolucion_con_tarjeta_efectivo","Devolución con tarjeta/efectivo")),1)])),_:1},8,["disabled"]))])])):(0,t.kq)("",!0),(0,t.Wm)(E,{ref:"CashlogyAnulacionViewRef"},null,512),(0,t.Wm)(H,{ref:"modalAnulacionTicketRef",onAnularTicket:i.esborrarTicket},null,8,["onAnularTicket"])],64)}o(57658);var D=o(74834),M=o(74313),B=o(44870),x=o(20065),E=o(36797),H=o.n(E),O=o(91076),P=o(42492),U=o.n(P),I=o(92136),R=o(6411),V=o(48466),z=o(12195),N=o(74025),j=o(17799),S=o(13150),Z=o(16683),L=o(34730),W=o(88807);const $={key:0,class:"frame-Cashlogy flex-column"},F={class:"d-flex flex-column",style:{gap:"2px"}},q={key:1,class:"frame-Cashlogy flex-column"},Y={class:"d-flex flex-column",style:{gap:"2px"}},G=(0,t._)("span",null,"Falta cambios para la devolución",-1),K={key:2,class:"frame-Cashlogy flex-column"},Q={class:"d-flex flex-column",style:{gap:"2px"}},J={key:3,class:"frame-Cashlogy flex-column"},X=(0,t._)("br",null,null,-1);var aa={__name:"CashlogyAnulacionView",setup(a,{expose:e}){const o=(0,B.iH)(null),i=(0,B.iH)(null),n=(0,B.iH)(""),r=(0,B.iH)(""),c=(0,B.iH)(""),s=(0,B.iH)(!1),u=(0,B.iH)(!1);async function d(){return S.Z.activado()}const v=(0,B.iH)({}),m=new Z.JQ((a=>{n.value=(0,Z.vg)(a.importe_a_devolver,!0),f.value="PANTALLA_SELECCIONAR_TIPO"})),p=new Z.JQ((a=>{n.value=(0,Z.vg)(a.importe_falta_devolver,!0),u.value=a.opcion_cancelar,f.value="PANTALLA_FALTA_CAMBIO_DEVOLUCION"}));function k(){s.value=!0,S.Z.boton_pulsar("BOT_ACEPTAR")}const f=(0,B.iH)(null);function _(a){I.socket[a]("Cashlogy.update",T)}function T(a){switch(f.value=a.proceso,a.proceso){case"AÑADIR_CAMBIOS":v.value=(0,Z.c)(a),r.value=(0,Z.vg)(a.importe_entrado,!0),c.value=(0,Z.vg)(a.importe_recicladores,!0);break;case"SOLO_DISPENSAR":n.value=(0,Z.vg)(a.importe_a_devolver,!0);break}}let g=!1;async function w(a){let e;if(g=!0,f.value=null,W.Z.Info({importe_a_devolver:a},"CashlogyAnulacionView","run-in"),await(0,Z.R_)(o),o.value.texto_botones_para_abort("DEVOLVER MANUALMENTE","CANCELAR DEVOLUCIÓN"),e=await o.value.start(),e)return W.Z.Info(e,"CashlogyAnulacionView","run-out"),g=!1,e;_("on");try{let[t,l]=await o.value.startPantalla_withReset(m,{importe_a_devolver:a});if(l)e=l;else if("CASHLOGY"==t&&0==a&&(t="MANUAL"),"CASHLOGY"==t){f.value=null,await S.Z.saveGrupoProcesos("ANULACION",{importe_a_devolver:a});let t=await S.Z.solo_dispensar(a);e=await(o.value?.informacionAbort_y_cancel(t));let l=t.importe_falta_devolver??0,n=0,r=t.error_en_la_devolucion;while(!e){if(f.value="ERROR_DEVOLUCION",await(0,Z.R_)(i),await i.value.run({error_en_la_devolucion:r}),0==l){e={importe_falta_devolver:0,importe_anadido_en_cambios:n};break}let[t,c]=await o.value.startPantalla_withReset(p,{importe_falta_devolver:l,opcion_cancelar:l==a});if(c)e=c;else if("AÑADIR"==t){f.value=null,s.value=!1;let a=await S.Z.anadir_cambios_y_devolver(l);e=await(o.value?.informacionAbort_y_cancel(a)),e?e.importe_falta_devolver=l:(r=a.error_en_la_devolucion,l=a.importe_falta_devolver,n+=a.importe_anadido_en_cambios,await S.Z.saveGrupoProcesos(null,{importe_anadido_en_cambios:n}))}else e="CANCELAR"==t?{cancelado:!0,importe_falta_devolver:l,importe_anadido_en_cambios:n}:{manual:!0,importe_falta_devolver:l,importe_anadido_en_cambios:n}}}else e="CANCELAR"==t?{cancelado:!0}:{manual:!0};e.abort_id||(await S.Z.saveGrupoProcesos(null),await(0,L.i_)(e.importe_anadido_en_cambios,"Añadir Cambios","ENTRADA_DINERO"))}catch(t){console.log(t),e={cancelado:!0}}return _("off"),o.value?.end(),W.Z.Info(e,"CashlogyAnulacionView","run-out"),g=!1,e}return(0,t.Ah)((()=>{g&&S.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),e({run:w,activado:d}),(a,e)=>((0,t.wg)(),(0,t.j4)(j.Z,{enProceso:null!=f.value,ref_key:"CashlogyPantalla_ref",ref:o},{default:(0,t.w5)((()=>["PANTALLA_SELECCIONAR_TIPO"==f.value?((0,t.wg)(),(0,t.iD)("div",$,[(0,t._)("div",F,[(0,t.Wm)((0,B.SU)(M.$v),{onClick:e[0]||(e[0]=a=>(0,B.SU)(m).R("CASHLOGY")),color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Devolución con Cashlogy ")])),_:1}),(0,t.Wm)((0,B.SU)(M.$v),{onClick:e[1]||(e[1]=a=>(0,B.SU)(m).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" devolucion manual ")])),_:1}),(0,t.Wm)((0,B.SU)(M.$v),{onClick:e[2]||(e[2]=a=>(0,B.SU)(m).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" cancelar ")])),_:1})])])):(0,t.kq)("",!0),"PANTALLA_FALTA_CAMBIO_DEVOLUCION"==f.value?((0,t.wg)(),(0,t.iD)("div",q,[(0,t._)("div",Y,[G,(0,t._)("span",null,"Importe falta devolver: "+(0,l.zw)(n.value),1),(0,t.Wm)((0,B.SU)(M.$v),{onClick:e[3]||(e[3]=a=>(0,B.SU)(p).R("AÑADIR")),color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" añadir cambios ")])),_:1}),(0,t.Wm)((0,B.SU)(M.$v),{onClick:e[4]||(e[4]=a=>(0,B.SU)(p).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" devolucion manual ")])),_:1}),u.value?((0,t.wg)(),(0,t.j4)((0,B.SU)(M.$v),{key:0,onClick:e[5]||(e[5]=a=>(0,B.SU)(p).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" cancelar ")])),_:1})):(0,t.kq)("",!0)])])):(0,t.kq)("",!0),"AÑADIR_CAMBIOS"==f.value?((0,t.wg)(),(0,t.iD)("div",K,[(0,t.Wm)(z.Z,{tabla:v.value,style:{flex:"0 0 75%"}},null,8,["tabla"]),(0,t._)("div",Q,[(0,t._)("span",null,"Importe introducido : "+(0,l.zw)(r.value),1),(0,t._)("span",null,"Importe total: "+(0,l.zw)(c.value),1),(0,t._)("span",null,"Importe falta devolver: "+(0,l.zw)(n.value),1),(0,t.Wm)((0,B.SU)(M.$v),{disabled:s.value,onClick:k,color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Aceptar ")])),_:1},8,["disabled"])])])):(0,t.kq)("",!0),"SOLO_DISPENSAR"==f.value?((0,t.wg)(),(0,t.iD)("div",J,[(0,t._)("div",null,[(0,t.Uk)(" Dispensando"),X,(0,t.Uk)(" Importe a devolver: "+(0,l.zw)(n.value),1)])])):(0,t.kq)("",!0),"ERROR_DEVOLUCION"==f.value?((0,t.wg)(),(0,t.j4)(N.Z,{key:4,ref_key:"CashlogyErrorDevolucion_ref",ref:i},null,512)):(0,t.kq)("",!0)])),_:1},8,["enProceso"]))}};const ea=aa;var oa=ea,ta=o(49242);const la={class:"mb-0 mt-2"},ia=(0,t._)("p",{class:"mb-0 mt-2"},"Motivo de anulación (opcional):",-1),na={key:0,class:"text-danger mt-2"};function ra(a,e,o,i,n,r){const c=(0,t.up)("MDBIcon"),s=(0,t.up)("MDBModalTitle"),u=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBModalBody"),v=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal"),k=(0,t.up)("KeyBoardComponentVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{id:"modalAnulacionTicket",tabindex:"-1",labelledby:"tituloModalAnulacionTicket",modelValue:i.modalAnulacionTicket,"onUpdate:modelValue":e[2]||(e[2]=a=>i.modalAnulacionTicket=a),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{onClose:a=>!1},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{fas:"",icon:"exclamation-circle",class:"text-warning me-2"}),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Anulación de ticket")])),_:1})])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("p",la,"Ticket: "+(0,l.zw)(i.idTicket),1),ia,(0,t.wy)((0,t._)("textarea",{"onUpdate:modelValue":e[0]||(e[0]=a=>i.reason=a),class:"form-control",rows:"3",placeholder:"...",onClick:e[1]||(e[1]=a=>{i.showValidationMessage=!1,i.openKeyboard()}),readonly:""},null,512),[[ta.nr,i.reason]]),i.showValidationMessage?((0,t.wg)(),(0,t.iD)("p",na," Debes escribir un motivo de anulación ")):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{color:"secondary",onClick:i.onCancel},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cancelar ")])),_:1},8,["onClick"]),(0,t.Wm)(v,{color:"primary",onClick:i.onConfirm,disabled:i.isLoading},{default:(0,t.w5)((()=>[(0,t.Uk)(" Confirmar ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(k,{ref:"keyboardRef"},null,512)],64)}var ca=o(61562),sa={name:"modalAnulacionTicketComponent",components:{MDBModal:M.j3,MDBModalHeader:M.ol,MDBModalTitle:M.wo,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBBtn:M.$v,KeyBoardComponentVue:ca.Z,MDBIcon:M.vm},setup(a,{expose:e,emit:o}){const t=(0,B.iH)(!1),l=(0,B.iH)(null),i=(0,B.iH)(""),n=(0,B.iH)(!1),r=(0,B.iH)(!1),c=(0,B.iH)(null);function s(a=null){t.value=!0,l.value=a}const u=()=>{v()},d=()=>{r.value=!0,o("anularTicket",l.value,i.value),setTimeout((()=>{r.value=!1}),1500),v()},v=()=>{t.value=!1,i.value=""};let m;const p=async()=>{try{c.value.abrirModal(i.value),m=setInterval((()=>{i.value=c.value.getValue()[0],c.value.getValue()[1]||clearInterval(m)}),100)}catch(a){console.log(a),m=void 0}};return e({openModal:s}),{modalAnulacionTicket:t,idTicket:l,reason:i,showValidationMessage:n,isLoading:r,keyboardRef:c,openKeyboard:p,onCancel:u,onConfirm:d,closeModal:v}}},ua=o(40089);const da=(0,ua.Z)(sa,[["render",ra]]);var va=da,ma={name:"TicketsComponent",components:{MDBTable:M.re,MDBBtn:M.$v,MDBIcon:M.vm,ModalErrorDatafonoComponent:V.Z,CashlogyAnulacionView:oa,ModalAnulacionTicket:va},setup(a){const e=(0,x.oR)(),o=(0,B.iH)(null),l=(0,B.iH)(!1),i=(0,B.iH)(!1),n=(0,B.iH)(null),r=(0,B.iH)(!0),c=(0,B.iH)(!1),s=(0,B.iH)(!1),u=(e.getters["Configuracion/parametros"],(0,t.Fl)((()=>e.state.Trabajadores.arrayTrabajadores))),d=(0,t.Fl)((()=>e.state.Trabajadores.indexActivo)),v=(0,t.Fl)((()=>u.value&&void 0!=d.value&&null!=d.value&&u.value[d.value]?u.value[d.value]:null)),m=(0,t.Fl)((()=>e.state.Caja.arrayVentas));(0,t.YP)(m,((a,e)=>{let t=null;for(let l=0;l<a.length;l++)if(a[l]._id===o.value){t=l;break}n.value=t}));const p=(0,B.iH)(null),k=(0,B.iH)(null),f=(0,B.iH)(!1),_=(0,B.iH)(null);function T(a){const e=new Date(a);return H()(e).format("HH:mm:ss DD/MM/YYYY")}function g(a=null){const e=a||m.value[n.value]._id;O.Z.post("impresora/imprimirTicket",{idTicket:e}).catch((a=>{U().fire("Oops...",a.message,"error")}))}function w(){O.Z.post("impresora/imprimirTicketPaytef",{idTicket:m.value[n.value]._id}).catch((a=>{U().fire("Oops...",a.message,"error")}))}function y(a,e){o.value=a._id,n.value=e,b(a?.cesta?.idCliente)}const b=a=>{s.value?O.Z.post("/clientes/getClienteById",{idCliente:a}).then((a=>{r.value=!a.data?.albaran})).catch((a=>{console.log(a)})):r.value=!0};function A(a){O.Z.post("/movimientos/PayWithCash",{idTicket:a}).then((a=>{o.value=null,n.value=null,R.Z.push("/main")})).catch((a=>{console.log(a)}))}async function h(a){function t(){O.Z.post("/movimientos/PayWith3G",{idTicket:a}).then((a=>{})).catch((a=>{console.log(a)}))}function l(){e.dispatch("Datafono/setEstado","PENDIENTE"),I.socket.emit("iniciarTransaccion",{idTicket:a,idTrabajador:v.value._id})}await O.Z.post("parametros/getParametros").then((a=>{"3G"===a.data?.tipoDatafono||"0.0.0.0"==a.data?.ipTefpay?t():l()})),o.value=null,n.value=null,R.Z.push("/main")}function C(a){a&&_.value.openModal(a)}async function M(a,e=null){if(null!=n.value)if("DEUDA"!=m.value[n.value].tipoPago){f.value=!0;let t=!1,l=a;if(await k.value.activado())try{if((await O.Z.post("tickets/isTicketAnulable",{ticketId:l})).data){let a=await k.value.run(m.value[n.value].total);a.cancelado&&(t=!0)}}catch(o){U().fire(o.message)}t?f.value=!1:O.Z.post("tickets/anularTicket",{ticketId:l,reason:e},{headers:{"Content-Type":"application/json"}}).then((a=>{if(a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipo))g(a.data.idTicket),U().fire({icon:"success",title:"Ticket anulado",showConfirmButton:!1,timer:1200});else if(a.data.res)R.Z.push("/main");else{let e="Ya esta anulado";"TARJETA"==a.data.tipo&&(e=a.data.msg),U().fire({icon:"error",title:e,showConfirmButton:!1,timer:1400})}})).catch((a=>{U().fire("Error al anular ticket")})).finally((()=>{f.value=!1}))}else O.Z.post("deudas/getDeudaByIdTicket",{idTicket:m.value[n.value]._id,timestamp:m.value[n.value].timestamp}).then((a=>{let e=0;m.value[n.value].movimientos.length>0&&(e=m.value[n.value].movimientos.length-1),a&&(""==a.data&&"DEUDA"==m.value[n.value].movimientos[e].tipo||"SIN_PAGAR"==a.data.estado)?U().fire({icon:"info",title:"No se puede anular la deuda desde tickets",showConfirmButton:!0}):a&&""==a.data?U().fire({icon:"info",title:"Deuda ya saldada",showConfirmButton:!0}):a.data&&""!=a.data&&"ANULADO"==a.data.estado?U().fire({icon:"info",title:"Este ticket ya se ha anulado en deudas",showConfirmButton:!0}):"PAGADO"==a.data.estado&&U().fire({icon:"info",title:"Este ticket ya se ha pagado, Num ticket: "+a.data.idTicket,showConfirmButton:!0})})).catch((a=>{U().fire(a.message)}));else U().fire("Primero selecciona el ticket")}function E(a){R.Z.push(a)}return(0,t.bv)((async()=>{D.W.cargarVentas();const{data:a}=await O.Z.post("parametros/getParametros");l.value="Si"==a.params?.ProhibirAnulacioTicket,i.value="Si"==a.params?.prohibirAnular3g,s.value="Si"==a.params?.prohibirAnularTkAlbaran,c.value="Si"==a.params?.TicketAlAnular,m.value&&m.value.length>0&&y(m.value[0],0)})),{modalErrorDatafonoRef:p,arrayTickets:m,getTiempo:T,setActivo:y,idActivo:o,cambiarTipoPago:h,imprimirTicket:g,esborrarTicket:M,prohibirAnularTicket:l,goTo:E,pagarEfectivo:A,prohibirAnular3g:i,indexTicket:n,imprimirTicketPaytef:w,mostrarPorAlbaran:r,CashlogyAnulacionViewRef:k,anulando:f,modalAnulacionTicketRef:_,openModalAnulacion:C}}};const pa=(0,ua.Z)(ma,[["render",C],["__scopeId","data-v-308fbb76"]]);var ka=pa}}]);
//# sourceMappingURL=136.279a8ab0.js.map