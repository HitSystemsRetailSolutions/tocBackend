"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[755],{46799:function(e,a,o){o.r(a),o.d(a,{default:function(){return te}});var l=o(73396),n=o(87139),t=o(49242);const r=e=>((0,l.dD)("data-v-084ec143"),e=e(),(0,l.Cn)(),e),i={id:"main"},c={id:"vueMenuEncargo"},d={class:"encargos"},u={class:""},s={class:"row"},m=r((()=>(0,l._)("div",{class:"col"},null,-1))),g={class:"col"},v={key:0},_={class:"btnEncargo lgEncargo float-right"},p=r((()=>(0,l._)("hr",null,null,-1))),C={class:"productos"},f={key:0,style:{"overflow-y":"scroll",height:"28vh"}},D={class:"d-flex flex-column juatify-content-center"},h={style:{"max-width":"270px"}},k=["onUpdate:modelValue"],b=r((()=>(0,l._)("br",null,null,-1))),w={key:1},y=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),M={class:"recogida"},T={class:"opciones-recogida"},B={class:"fechas-recogida"},E={key:0},H={key:1},R={key:2},A=["id","onUpdate:modelValue","onClick"],N=r((()=>(0,l._)("hr",{class:"hrEncargo"},null,-1))),x={class:"encargos-footer"},j=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),z={class:"mb-0 mt-2"},I={class:"input-deja-a-cuenta"},$=r((()=>(0,l._)("small",{id:"emailHelp",class:"form-text text-muted"},"Deja a cuenta:",-1))),q={class:""},V=["disabled"],S={class:"row"},U={class:"col"},P={class:"input-group input-group-lg"},W={class:"row"},F={class:"col text-center"};function Y(e,a,o,r,Y,Z){const O=(0,l.up)("MDBModalTitle"),J=(0,l.up)("MDBModalHeader"),L=(0,l.up)("NumpadComponent"),K=(0,l.up)("MDBModalBody"),Q=(0,l.up)("MDBBtn"),G=(0,l.up)("MDBModalFooter"),X=(0,l.up)("MDBModal"),ee=(0,l.up)("ModalClientesComponent");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",i,[(0,l._)("div",c,[(0,l._)("div",null,[(0,l._)("div",d,[(0,l._)("div",u,[(0,l._)("div",s,[m,(0,l._)("div",g,[r.clienteData.idCliente?((0,l.wg)(),(0,l.iD)("h1",v,[(0,l._)("button",_,(0,n.zw)(r.clienteData.nombreCliente),1)])):(0,l.kq)("",!0)])]),p,(0,l._)("div",C,[r.productos.length?((0,l.wg)(),(0,l.iD)("div",f,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.productos,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,l._)("div",D,[(0,l._)("span",h,"- "+(0,n.zw)(e.nombre),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.arraySuplementos,((e,a)=>((0,l.wg)(),(0,l.iD)("span",{key:a},(0,n.zw)(e.nombre),1)))),128))]),(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":a=>e.comentario=a},null,8,k),[[t.nr,e.comentario]])])))),128)),b])):((0,l.wg)(),(0,l.iD)("div",w,(0,n.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),y,(0,l._)("div",M,[(0,l._)("div",T,[(0,l._)("button",{onClick:a[0]||(a[0]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"1",class:(0,n.C_)({active:1===r.refEncargoRecogida})},(0,n.zw)(e.$t("toc_game_encargos_hoy","Hoy")),3),(0,l._)("button",{onClick:a[1]||(a[1]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"2",class:(0,n.C_)({active:2===r.refEncargoRecogida})},(0,n.zw)(e.$t("toc_game_encargos_otro_dia","Otro día")),3),(0,l._)("button",{onClick:a[2]||(a[2]=(...e)=>r.onClickRecogida&&r.onClickRecogida(...e)),value:"3",class:(0,n.C_)({active:3===r.refEncargoRecogida})},(0,n.zw)(e.$t("toc_game_encargos_cada","Cada...")),3)]),(0,l._)("div",B,[1===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",E,[(0,l._)("button",{onClick:a[3]||(a[3]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"am",class:(0,n.C_)({active:"am"===r.refAmPm})},(0,n.zw)(e.$t("toc_game_encargos_por_la_manana","Turno de la mañana")),3),(0,l._)("button",{onClick:a[4]||(a[4]=(...e)=>r.onClickAmPm&&r.onClickAmPm(...e)),value:"pm",class:(0,n.C_)({active:"pm"===r.refAmPm})},(0,n.zw)(e.$t("toc_game_encargos_por_la_tarde","Turno de la tarde")),3)])):(0,l.kq)("",!0),2===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",H,[(0,l.wy)((0,l._)("input",{type:"date",class:"form-control","onUpdate:modelValue":a[5]||(a[5]=e=>r.fechaInput=e)},null,512),[[t.nr,r.fechaInput]]),(0,l.wy)((0,l._)("input",{type:"time",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>r.horaInput=e)},null,512),[[t.nr,r.horaInput]])])):(0,l.kq)("",!0),3===r.refEncargoRecogida?((0,l.wg)(),(0,l.iD)("div",R,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.dias,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.wy)((0,l._)("input",{type:"button",id:e.dia,"onUpdate:modelValue":a=>e.dia=a,onClick:a=>r.clickDia(e),class:(0,n.C_)({active:r.refDia===e.nDia})},null,10,A),[[t.nr,e.dia]])])))),128))])):(0,l.kq)("",!0)])]),N,(0,l._)("div",x,[(0,l._)("div",null,[j,(0,l._)("p",z,(0,n.zw)(r.precioTotal)+"€",1)]),(0,l._)("div",I,[$,(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",id:"cuenta",name:"dejaACuenta",placeholder:"0",min:"0","onUpdate:modelValue":a[7]||(a[7]=e=>r.dejaACuenta=e),onClick:a[8]||(a[8]=(...e)=>r.openTecladoNum&&r.openTecladoNum(...e)),readonly:""},null,512),[[t.nr,r.dejaACuenta]])]),(0,l._)("div",q,[(0,l._)("input",{type:"button",value:"Crear encargo",class:"btn btn-primary btn-lg",onClick:a[9]||(a[9]=(...e)=>r.crearEncargo&&r.crearEncargo(...e)),disabled:r.botonBloqueado},null,8,V)])])])])])])]),(0,l.Wm)(X,{id:"modalTecladoNum",tabindex:"-1",labelledby:"modalTecladoNumLabel",modelValue:r.modalTecladoNum,"onUpdate:modelValue":a[13]||(a[13]=e=>r.modalTecladoNum=e),"data-backdrop":"false"},{default:(0,l.w5)((()=>[(0,l.Wm)(J,null,{default:(0,l.w5)((()=>[(0,l.Wm)(O,{id:"modalTecladoNumLabel"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("deja_a_cuenta","Deja a cuenta")),1)])),_:1})])),_:1}),(0,l.Wm)(K,null,{default:(0,l.w5)((()=>[(0,l._)("div",S,[(0,l._)("div",U,[(0,l._)("div",P,[r.numpadRef?(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>r.numpadRef.cantidad=e)},null,512)),[[t.nr,r.numpadRef.cantidad]]):(0,l.kq)("",!0)])])]),(0,l._)("div",W,[(0,l._)("div",F,[(0,l.Wm)(L,{skipBalanza:!0,ref:"numpadRef"},null,512)])])])),_:1}),(0,l.Wm)(G,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{color:"danger",onClick:a[11]||(a[11]=e=>r.closeTecladoNum()),size:"lg"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Cerrar ")])),_:1}),(0,l.Wm)(Q,{color:"success",size:"lg",onClick:a[12]||(a[12]=e=>r.finishTecladoNum())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(ee,{ref:"refModalClientes"},null,512)],64)}o(57658);var Z=o(44870),O=o(74313),J=o(20065),L=o(62189),K=o(86619),Q=o(42492),G=o.n(Q),X=o(87853),ee=o(91076),ae=o(16797),oe={name:"EncargosComponent",components:{ModalClientesComponent:L.Z,NumpadComponent:K.Z,MDBCard:O.Yl,MDBCardBody:O.H7,MDBCardTitle:O.QM,MDBCardText:O.Pp,MDBBtn:O.$v,MDBCheckbox:O.IH,MDBModal:O.j3,MDBModalHeader:O.ol,MDBModalTitle:O.wo,MDBModalBody:O.Yz,MDBModalFooter:O.ab,MDBIcon:O.vm,MDBLoading:O.J$},setup(){const e=(0,Z.iH)(!1),a=(0,Z.iH)(null),o=(0,J.oR)(),{t:n}=(0,X.QT)(),t=o.getters["Cestas/getCestaActiva"],r=(o.getters["Cestas/getCestaActivaIndex"],(0,l.Fl)((()=>o.state.Trabajadores.arrayTrabajadores))),i=(0,l.Fl)((()=>o.state.Trabajadores.indexActivo)),c=(0,l.Fl)((()=>r.value&&null!=i.value&&void 0!=i.value&&r.value[i.value]?r.value[i.value]:null)),d=(0,Z.iH)(null),u=(0,Z.iH)(null),s=(0,Z.iH)(null),m=(0,Z.iH)(null),g=(0,Z.iH)([{dia:"Lunes",nDia:0,checked:!1},{dia:"Martes",nDia:1,checked:!1},{dia:"Miércoles",nDia:2,checked:!1},{dia:"Jueves",nDia:3,checked:!1},{dia:"Viernes",nDia:4,checked:!1},{dia:"Sábado",nDia:5,checked:!1},{dia:"Domingo",nDia:6,checked:!1}]),v=(0,Z.iH)(null),_=(0,Z.iH)(0),p={idCliente:t.idCliente,nombreCliente:t.nombreCliente},C=(0,Z.iH)(null),f=(0,Z.iH)(null),D=(0,Z.iH)(t.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),h=(0,Z.iH)(null),k=e=>{d.value=parseInt(e.target.value)},b=e=>{u.value=e.target.value},w=e=>{v.value=e.nDia;for(let a=0;a<g.value.length;a++)g.value[a].nDia==v.value?g.value[a].checked=!0:g.value[a].checked=!1},y=()=>g.value.filter((e=>e.checked)),M=()=>{let e=t.detalleIva.importe1+t.detalleIva.importe2+t.detalleIva.importe3+t.detalleIva.importe4+t.detalleIva.importe5;return e=Math.round(100*e)/100,e},T=()=>{if(e.value=!0,!p.idCliente)return B(n("toc_game_encargos_error_no_cliente","Tienes que seleccionar un cliente para crear el encargo."),"error"),void(e.value=!1);if(!D.value.length)return B(n("toc_game_encargos_error_no_productos","Tienes que haber al menos un producto para crear el encargo."),"error"),void(e.value=!1);if(!d.value)return B(n("toc_game_encargos_error_no_recogida","Tienes que elegir una opción de recogida (hoy, otro día o cada...)"),"error"),void(e.value=!1);if(1===d.value&&!u.value)return B(n("toc_game_encargos_error_no_am_pm","Tienes que elegir por la mañana o por la tarde"),"error"),void(e.value=!1);if(2===d.value&&(!s.value||!m.value))return B(n("toc_game_encargos_error_fecha_hora","Tienes que elegir la fecha y la hora del encargo"),"error"),void(e.value=!1);if(3===d.value&&!y().length)return B(n("toc_game_encargos_error_dias_seleccionados","Tienes que elegir al menos un día"),"error"),void(e.value=!1);if(1===d.value){const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();s.value=`${a}-${o.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")}`}if(3===d.value){let e=new Date,a=e.getDay(),o=y()[0].nDia+1,l=(o-a+7)%7,n=new Date(e.getTime()+24*l*60*60*1e3);const t=n.getFullYear(),r=n.getMonth()+1,i=n.getDate();s.value=`${t}-${r.toString().padStart(2,"0")}-${i.toString().padStart(2,"0")}`}const a={idCliente:p.idCliente,nombreCliente:p.nombreCliente,opcionRecogida:d.value,amPm:u.value,fecha:s.value,hora:m.value,dias:y(),dejaCuenta:_.value||0,total:M(),productos:D.value,cesta:t,idTrabajador:c.value._id,nombreDependienta:c.value.nombre};ee.Z.post("encargos/setEncargo",a).then((({data:a})=>a&&a.msg?a.error?(B(a.msg,"error"),void(e.value=!1)):(_.value>0&&ee.Z.post("movimientos/nuevoMovimiento",{cantidad:_.value,concepto:"dejaACuentaEncargo",idTrabajador:c.value._id,tipo:"ENTRADA_DINERO",nombreCliente:p.nombreCliente}).then((a=>{if(!a.data)throw e.value=!1,Error("No se ha podido realizar la entrada de dinero")})).catch((a=>{e.value=!1,G().fire("Oops...",a.message,"error")})),e.value=!1,void B(n("toc_game_encargos_ok","Encargo creado!"),"success",E)):(B(n("toc_game_encargos_error_general","Error general"),"error"),void(e.value=!1)))).catch((a=>{e.value=!1,B(n("toc_game_encargos_error_general","Error general"),"error")}))},B=(e,a,o=(()=>{}))=>{G().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>o()))},E=async()=>{o.dispatch("EstadoDinamico/reset"),N("/main")},H=()=>{f.value=!0},R=()=>{f.value=!1},A=()=>{let e=Number(C.value.cantidad);_.value=Number(e.toFixed(2)),R()},N=e=>ae.Z.push(e);return(0,l.bv)((()=>{h.value=M()})),(0,l.JJ)("okValue",(()=>f.value?A():H())),{refModalClientes:a,cestaActiva:t,clienteData:p,productos:D,refEncargoRecogida:d,refAmPm:u,dias:g,fechaInput:s,horaInput:m,dejaACuenta:_,onClickRecogida:k,onClickAmPm:b,clickDia:w,crearEncargo:T,precioTotal:h,refDia:v,botonBloqueado:e,numpadRef:C,modalTecladoNum:f,openTecladoNum:H,closeTecladoNum:R,finishTecladoNum:A}}},le=o(40089);const ne=(0,le.Z)(oe,[["render",Y],["__scopeId","data-v-084ec143"]]);var te=ne}}]);
//# sourceMappingURL=755.3b997fe7.js.map