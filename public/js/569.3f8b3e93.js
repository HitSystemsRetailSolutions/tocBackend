"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[569],{9631:function(e,a,o){o.d(a,{Z:function(){return H}});var t=o(3396),l=o(7139),n=o(9242);const i={class:"row"},r={class:"d-inline-block text-center"},s={class:"row mt-1 p-4"},d={class:"col-md-8"},c={class:"col-md-4"},u={key:0,class:"row"},m={class:"col"},p={class:"table-responsive w-100",style:{height:"400px"}},v={class:"table table-striped mt-1"},f={class:"textoNombre d-inline-block text-truncate"},b={key:1,class:"row"},C={class:"sinResultados position-relative"},g={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function w(e,a,o,w,_,M){const y=(0,t.up)("MDBBtn"),h=(0,t.up)("MDBModalBody"),D=(0,t.up)("MDBModal"),k=(0,t.up)("ModalNuevoCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(D,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:w.modalClientes,"onUpdate:modelValue":a[7]||(a[7]=e=>w.modalClientes=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t._)("div",i,[(0,t._)("div",r,[(0,t.Wm)(y,{color:"warning",class:"sizeBotones",onClick:a[0]||(a[0]=e=>w.clickClienteAtajo("CliBoti_000_{A83B364B-252F-464B-B0C3-AA89DA258F64}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("Glovo")])),_:1}),(0,t.Wm)(y,{color:"dark",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>w.clickClienteAtajo("CliBoti_000_{2713C1E3-06C0-4099-851D-33018FD4851C}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("Uber")])),_:1}),(0,t.Wm)(y,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>w.clickClienteAtajo("CliBoti_000_{7A6EA7B0-3229-4A94-81EA-232F4666A7BE}"))},{default:(0,t.w5)((()=>[(0,t.Uk)("To Go")])),_:1}),(0,t.Wm)(y,{color:"success",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>w.modalNuevoClienteRef.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("nuevo","Nuevo")),1)])),_:1}),(0,t.Wm)(y,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>w.modalClientes=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("salir","Salir")),1)])),_:1})])]),(0,t._)("div",s,[(0,t._)("div",d,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":a[5]||(a[5]=e=>w.inputBusqueda=e)},null,512),[[n.nr,w.inputBusqueda]])]),(0,t._)("div",c,[(0,t.Wm)(y,{color:"secondary",class:"botonBusqueda w-100",onClick:a[6]||(a[6]=e=>w.buscar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("buscar","Buscar")),1)])),_:1})])]),w.arrayClientes?.length>0?((0,t.wg)(),(0,t.iD)("div",u,[(0,t._)("div",m,[(0,t._)("div",p,[(0,t._)("table",v,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(w.arrayClientes,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",f,(0,l.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(y,{color:"primary",size:"lg",onClick:e=>w.selectCliente(a.id,a.nombre),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):((0,t.wg)(),(0,t.iD)("div",b,[(0,t._)("div",C,[(0,t._)("span",g,(0,l.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(k,{ref:"modalNuevoClienteRef"},null,512)],64)}var _=o(4161),M=o(4313),y=o(2492),h=o.n(y),D=o(4870),k=o(65);const B={class:"row"},x={class:"col w-50"},A={class:"col w-50 datos"};function T(e,a,o,n,i,r){const s=(0,t.up)("MDBModalHeader"),d=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:n.modalFichaCliente,"onUpdate:modelValue":a[9]||(a[9]=e=>n.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,l.zw)(n.nombre),1)])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",B,[(0,t._)("div",x,[(0,t.Wm)(d,{label:"Nombre",modelValue:n.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>n.nombre=e),style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(d,{label:"Telefono",modelValue:n.telefono,"onUpdate:modelValue":a[1]||(a[1]=e=>n.telefono=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(d,{label:"email",modelValue:n.email,"onUpdate:modelValue":a[2]||(a[2]=e=>n.email=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(d,{label:"direccion",modelValue:n.direccion,"onUpdate:modelValue":a[3]||(a[3]=e=>n.direccion=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])]),(0,t._)("div",A,[(0,t.Wm)(d,{label:"Tarjeta Cliente",modelValue:n.tarjeta,"onUpdate:modelValue":a[4]||(a[4]=e=>n.tarjeta=e),class:"datos",style:{"margin-top":"10px"},"aria-required":"true"},null,8,["modelValue"]),(0,t.Wm)(d,{label:"Nif",modelValue:n.nif,"onUpdate:modelValue":a[5]||(a[5]=e=>n.nif=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(d,{label:"descuento",modelValue:n.descuento,"onUpdate:modelValue":a[6]||(a[6]=e=>n.descuento=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"primary",onClick:a[7]||(a[7]=e=>n.guardarCliente())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Guardar ")])),_:1}),(0,t.Wm)(u,{color:"danger",onClick:a[8]||(a[8]=e=>n.modalFichaCliente=!1),ref:"salirBoton"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},512)])),_:1})])),_:1},8,["modelValue"])}var z={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:M.$v,MDBInput:M.u2,MDBModal:M.j3,MDBModalBody:M.Yz,MDBModalFooter:M.ab,MDBModalHeader:M.ol},setup(e,a){const o=(0,D.iH)(!1),l=e=>{n.value="",i.value="",r.value="",s.value="",d.value="",c.value="",u.value="",o.value=!0};a.expose({abrirModal:l});const n=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(""),s=(0,D.iH)(""),d=(0,D.iH)(""),c=(0,D.iH)(""),u=(0,D.iH)("0"),m=((0,D.iH)(null),(0,D.iH)(null)),p=(0,t.f3)("cambiosCliente"),v=()=>{""!=n.value&&""!=d.value?isNaN(Number(u.value))?h().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):_.Z.post("clientes/crearNuevoCliente",{nombre:n.value,telefono:i.value,email:r.value,direccion:s.value,tarjetaCliente:d.value,nif:c.value,descuento:u.value}).then((()=>{h().fire({title:"Cliente creado",icon:"success",confirmButtonText:"Aceptar"}),o.value=!1})):h().fire({title:"Vaya...",text:"El campo de nombre y de tarjeta son obligatorios",icon:"error",confirmButtonText:"Aceptar"})};return{modalFichaCliente:o,guardarCliente:v,nombre:n,telefono:i,email:r,direccion:s,tarjeta:d,nif:c,descuento:u,salirBoton:m,cambiosCliente:p}}},E=o(89);const I=(0,E.Z)(z,[["render",T]]);var U=I,V={name:"ModalClientesComponent",components:{MDBModal:M.j3,MDBModalBody:M.Yz,MDBBtn:M.$v,ModalNuevoCliente:U},setup(e,a){const o=(0,k.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(0),i=(0,D.iH)(""),r=(0,D.iH)(),s=(0,D.iH)(null),d=(0,t.f3)("actualizarPuntos"),c=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null)),p=(0,t.Fl)((()=>o.state.Cestas.arrayCestas));function v(){l.value=!0}function f(){n.value++}function b(e){_.Z.post("clientes/getClienteById",{idCliente:e}).then((a=>{if(!a.data)throw Error("No se ha podido obtener la información del cliente. backend");C(e,a.data.nombre)})).catch((e=>{h().fire("Oops...",e.message,"error")}))}function C(e,a){if(p.value)for(let t=0;t<p.value.length;t++)if(m.value.idCesta===p.value[t]._id){o.dispatch("Cestas/setClienteCesta",{index:t,idCliente:e,nombreCliente:a}),o.dispatch("EstadoDinamico/setVistaCliente",!0),d(),l.value=!1;break}}function g(){_.Z.post("clientes/buscar",{busqueda:i.value}).then((e=>{r.value=e.data})).catch((e=>{h().fire("Oops...",e.message,"error")}))}return(0,t.YP)(i,(()=>{g()})),a.expose({abrirModal:v,datoBorrar:n,selectCliente:C}),{test:f,datoBorrar:n,modalClientes:l,inputBusqueda:i,arrayClientes:r,selectCliente:C,buscar:g,modalNuevoClienteRef:s,clickClienteAtajo:b}}};const S=(0,E.Z)(V,[["render",w],["__scopeId","data-v-7b36cf97"]]);var H=S},4286:function(e,a,o){o.d(a,{Z:function(){return h}});var t=o(3396),l=o(7139);const n={class:"container"},i={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},s={key:2,class:"h3 text-center"},d={class:"row mt-2 container botonesCaja"},c={class:"again py-5"},u={class:"again py-5"},m={class:"again py-5"};function p(e,a,o,p,v,f){const b=(0,t.up)("MDBBtn"),C=(0,t.up)("MDBModalBody"),g=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(g,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:p.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":a[3]||(a[3]=e=>p.ModalErrorDatafonoQueHacerComponent=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t._)("div",n,[1==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",i," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,t.kq)("",!0),2==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,t.kq)("",!0),3==p.ticketExist?((0,t.wg)(),(0,t.iD)("p",s," Ultimo pago cancelado, que hacemos? ¿Que hacemos? ")):(0,t.kq)("",!0)]),(0,t._)("div",d,[1==p.ticketExist?((0,t.wg)(),(0,t.j4)(b,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:a[0]||(a[0]=e=>p.darComoValido())},{default:(0,t.w5)((()=>[(0,t._)("span",c,(0,l.zw)(e.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:1,color:"warning  ",size:"lg",class:"botonEstado my-3 botones",disabled:p.esperandoConexion?"":e.disabled,onClick:a[1]||(a[1]=e=>{p.tarjetaUltimoTicket(),p.esperandoConexion=!0})},{default:(0,t.w5)((()=>[(0,t._)("span",u,(0,l.zw)(e.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,t.kq)("",!0),p.ticketExist>1?((0,t.wg)(),(0,t.j4)(b,{key:2,color:"primary  ",size:"lg",class:"botonEstado my-3 botones",onClick:a[2]||(a[2]=e=>p.pagoDependienta())},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,l.zw)(e.$t("pago en efectivo","PAGO EN EFECTIVO O EN 3G")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}var v=o(65),f=o(4161),b=o(4313),C=o(2492),g=o.n(C),w=o(4870),_={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:b.j3,MDBModalBody:b.Yz,MDBBtn:b.$v},setup(e,{expose:a}){const o=(0,w.iH)(null),l=(0,w.iH)(0),n=(0,v.oR)(),i=(0,w.iH)(!1),r=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores));let s=(0,w.iH)(!1);const d=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>r.value&&void 0!=d.value&&null!=d.value&&r.value[d.value]?r.value[d.value]:null));function u(e,a){if(4==a)return g().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});o.value=e,l.value=a,i.value=!0}async function m(){await f.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:c.value._id}).then((()=>{i.value=!1,n.dispatch("Datafono/setEstado","APROBADA")})).catch((e=>{i.value=!0,g().fire("Oops...",e.message,"error")})),g().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}function p(){s.value=!0,f.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:c.value._id}).then((()=>{i.value=!1,s.value=!1,n.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{s.value=!1,i.value=!0,g().fire("Oops...",e.message,"error")})),s.value=!1,g().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function b(){g().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),i.value=!1}return a({abrirModal:u}),(0,t.bv)((()=>{})),{store:n,darComoValido:m,ModalErrorDatafonoQueHacerComponent:i,tarjetaUltimoTicket:p,esperandoConexion:s,arrayTrabajadores:r,indexTrabajadorActivo:d,idSeleccionado:o,pagoDependienta:b,ticketExist:l}}},M=o(89);const y=(0,M.Z)(_,[["render",p],["__scopeId","data-v-1ca4de76"]]);var h=y},874:function(e,a,o){o.r(a),o.d(a,{default:function(){return _n}});var t=o(3396);const l={class:"row mt-1"},n={class:"col-md-3"},i={class:"col-md-6"},r={class:"col-md-3"};function s(e,a,o,s,d,c){const u=(0,t.up)("MenusComponent"),m=(0,t.up)("SubmenusComponent"),p=(0,t.up)("TeclasComponent"),v=(0,t.up)("MenuIzquierdaComponent"),f=(0,t.up)("CestaComponent"),b=(0,t.up)("MenuDerechaComponent"),C=(0,t.up)("ModalErrorDatafonoVentaComponent"),g=(0,t.up)("modalDatafonoConexion");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(u),(0,t.Wm)(m),(0,t.Wm)(p,{ref:"refTeclasComponent"},null,512),(0,t._)("div",l,[(0,t._)("div",n,[(0,t.Wm)(v,{ref:"refMenuIzquierda"},null,512)]),(0,t._)("div",i,[(0,t.Wm)(f,{ref:"cestaRef"},null,512)]),(0,t._)("div",r,[(0,t.Wm)(b)])]),(0,t.Wm)(C,{ref:"modalErrorVentaDatafonoRef"},null,512),(0,t.Wm)(g,{ref:"modalErrorConexionDatafonoRef"},null,512)],64)}o(7658);var d=o(7139);const c={class:"row",id:"menu",style:{"margin-top":"1px"}},u={class:"btn-group shadow-none",role:"group"},m=["onClick"];function p(e,a,o,l,n,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",c,[(0,t._)("div",u,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(null)),class:"newMenu btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"}," + Nuevo ")):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado,((e,a)=>((0,t.wg)(),(0,t.iD)("button",{key:a,class:(0,d.C_)([{activo:a==l.indexMenuActivo},"btn btn-secondary border border-1 rounded botonesMenu menusColorIvan"]),onClick:e=>l.setActivo(a)},(0,d.zw)(e.nombre),11,m)))),128))])]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var v=o(65),f=o(9242);const b=e=>((0,t.dD)("data-v-253a87f6"),e=e(),(0,t.Cn)(),e),C={class:"row"},g={key:0},w=b((()=>(0,t._)("br",null,null,-1))),_={key:1};function M(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalCrearMenus",tabindex:"-1",labelledby:"modalCrearMenus",modelValue:l.modalCrearMenus,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalCrearMenus=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",C,[l.isSubmenu?((0,t.wg)(),(0,t.iD)("label",g,[(0,t.Uk)("Nombre del menu "),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreMenu=e)},null,4),[[f.nr,l.nombreMenu]])])):(0,t.kq)("",!0),w,l.haveSubmenu?((0,t.wg)(),(0,t.iD)("label",_,[(0,t.Uk)("Nombre del submenu para "+(0,d.zw)(l.nombreMenu)+" ",1),(0,t.wy)((0,t._)("input",{style:(0,d.j5)(l.createProductCheckFields&&""==l.nombreSubMenu?"background-color: #ff000026;":""),type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>l.nombreSubMenu=e)},null,4),[[f.nr,l.nombreSubMenu]])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.crearMenu())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear menu")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var y=o(4834),h=o(4313),D=o(4870),k=o(4161),B=o(2492),x=o.n(B),A={name:"ModalCrearProductoMenus",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){(0,v.oR)();const o=(0,D.iH)(!1),l=(0,D.iH)(""),n=(0,D.iH)(""),i=(0,D.iH)(!1),r=(0,D.iH)(!1),s=(0,D.iH)(!1);async function d(e){r.value=null==e,l.value=null==e?"":e,o.value=!0}async function c(){if(""==l.value||""==n.value&&s.value)return i.value=!0,void x().fire("Oops...","Algún campo está vacío o es incorrecto.","error");let e=l.value;s.value&&(e=`${l.value} - ${n.value}`),k.Z.post("articulos/anadirProducto",{nombreArticulo:"Producto por defecto",precioConIva:0,esSumable:!1,precioBase:0,tipoIva:0,menus:e,posicion:0,articuloExistente:!1}).then((e=>{x().fire("Menú creado","Se ha creado el menú correctamente","success"),y.W.cargarTeclado(),o.value=!1}))}return a({abrirModal:d}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.DosNivells?"Si"==e.data?.DosNivells&&(s.value=!0):s.value=!1}))})),{modalCrearMenus:o,nombreMenu:l,nombreSubMenu:n,abrirModal:d,createProductCheckFields:i,crearMenu:c,isSubmenu:r,haveSubmenu:s}}},T=o(89);const z=(0,T.Z)(A,[["render",M],["__scopeId","data-v-253a87f6"]]);var E=z,I={name:"MenusComponent",components:{ModalCrearProductoMenus:E},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),n=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),i=(0,t.Fl)((()=>o.state.modoActual)),r=(0,D.iH)(null);function s(e){o.dispatch("Teclado/setIndexMenuActivo",e)}return(0,t.bv)((()=>{s(0)})),a({indexMenuActivo:n}),{teclado:l,indexMenuActivo:n,setActivo:s,modoActual:i,ModalCrearMenusRef:r}}};const U=(0,T.Z)(I,[["render",p],["__scopeId","data-v-4ecd1738"]]);var V=U;const S={class:"row",id:"submenu",style:{"margin-top":"1px","margin-right":"0px"}},H={key:0,class:"btn-group shadow-none",role:"group"},F={key:0},j=["onClick"];function W(e,a,o,l,n,i){const r=(0,t.up)("ModalCrearProductoMenus");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",S,[l.teclado&&l.teclado[l.indexMenuActivo]&&l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?((0,t.wg)(),(0,t.iD)("div",H,["MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.iD)("div",F,[(0,t._)("button",{onClick:a[0]||(a[0]=e=>l.ModalCrearMenusRef.abrirModal(l.teclado[l.indexMenuActivo].nombre)),class:"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100 newSubMenu"}," + Nuevo ")])):(0,t.kq)("",!0),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.teclado[l.indexMenuActivo].arraySubmenus,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a},[(0,t._)("button",{class:(0,d.C_)([{activo:a==l.indexSubmenuActivo},"btn btn-secondary border border-1 rounded botonesSubmenus menusColorIvan w-100"]),onClick:e=>l.setIndexSubmenu(a)},(0,d.zw)(e.nombre),11,j)])))),128))])):(0,t.kq)("",!0)]),(0,t.Wm)(r,{ref:"ModalCrearMenusRef"},null,512)],64)}var O={name:"SubmenusComponent",components:{ModalCrearProductoMenus:E},setup(){const e=(0,v.oR)(),a=(0,t.Fl)((()=>e.state.Teclado.objTeclado)),o=(0,t.Fl)((()=>e.state.Teclado.indexMenuActivo)),l=(0,D.iH)(null),n=(0,t.Fl)((()=>e.state.Teclado.indexSubmenuActivo)),i=(0,t.Fl)((()=>e.state.modoActual));function r(a){e.dispatch("Teclado/setIndexSubmenuActivo",a)}return{teclado:a,indexMenuActivo:o,indexSubmenuActivo:n,setIndexSubmenu:r,modoActual:i,ModalCrearMenusRef:l}}};const N=(0,T.Z)(O,[["render",W],["__scopeId","data-v-b03f5f4e"]]);var P=N;const R={key:0},$=["onClick"];function Z(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("PesoComponent"),c=(0,t.up)("SuplementosComponent"),u=(0,t.up)("ModalEditarProducto"),m=(0,t.up)("ModalCrearProducto"),p=(0,t.up)("ModalAlergenosVue"),v=(0,t.up)("ModalVaris");return(0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[l.arrayTeclas&&l.arrayTeclas.length>0?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["row",{"mt-1":0==o}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(6,((a,n)=>(0,t._)("div",{class:(0,d.C_)(["col",[l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?"colJuntitasConSubmenus":"colJuntitas"]]),key:n},[l.arrayTeclas[n+6*o].idArticle?((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:e=>l.clickTecla(l.arrayTeclas[n+6*o],e),onContextmenu:e=>l.abrirFicha(l.arrayTeclas[n+6*o].idArticle),class:(0,d.C_)(["btn btn-primary w-100 d-inline-block esconderTexto textCancelPadding",[l.teclado[l.indexMenuActivo].arraySubmenus&&l.teclado[l.indexMenuActivo].arraySubmenus.length>0?"teclasConSubmenu":"teclas"]]),style:(0,d.j5)({"background-color":"#"+l.arrayTeclas[n+6*o].color.toString(16),color:l.getTextColor("#"+l.arrayTeclas[n+6*o].color.toString(16))})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(l.arrayTeclas[n+6*o].nombreArticulo)+" ",1),l.precioTecla?((0,t.wg)(),(0,t.iD)("p",R,(0,d.zw)(l.arrayTeclas[n+6*o].precioConIva.toFixed(2))+"€ ",1)):(0,t.kq)("",!0)])),_:2},1032,["onClick","onContextmenu","class","style"])):((0,t.wg)(),(0,t.iD)("button",{key:1,class:(0,d.C_)(["btn btn-primary w-100",[{editarArticulos:"MOVER_ARTICULO"==l.isEditarArticulos(!1)},{invisible:"MOVER_ARTICULO"!==l.isEditarArticulos(!1)&&"MODIFICAR_ARTICULO"!==l.isEditarArticulos(!1)},null==l.teclado[l.indexMenuActivo].arraySubmenus?"teclas":"teclasConSubmenu"]]),onClick:e=>l.editarArticulo(l.arrayTeclas[n+6*o].pos)},(0,d.zw)(e.$t("vacio","Vacío"))+" "+(0,d.zw)(l.isEditarArticulos(!0)),11,$))],2))),64))],2)):(0,t.kq)("",!0)],64)))),64)),(0,t.Wm)(s,{ref:"modalPesoRef"},null,512),(0,t.Wm)(c,{ref:"modalSuplementosRef"},null,512),(0,t.Wm)(u,{ref:"modalEditarProdRef"},null,512),(0,t.Wm)(m,{ref:"modalCrearProdRef"},null,512),(0,t.Wm)(p,{ref:"modalAlergenosRef"},null,512),(0,t.Wm)(v,{ref:"modalVarisRef"},null,512)],64)}const q={class:"row"},L={class:"row"};function Y(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBInput"),u=(0,t.up)("NumpadComponent"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBBtn"),v=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(f,{id:"modalPeso",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalPeso,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalPeso=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("introduce_los_gramos","Introduce los gramos")),1)])),_:1})])),_:1}),(0,t.Wm)(m,{class:"mx-auto"},{default:(0,t.w5)((()=>[(0,t._)("div",q,[l.numpadRef&&l.numpadRef.cantidad?((0,t.wg)(),(0,t.j4)(c,{key:0,modelValue:l.numpadRef.cantidad,"onUpdate:modelValue":a[0]||(a[0]=e=>l.numpadRef.cantidad=e)},null,8,["modelValue"])):(0,t.kq)("",!0)]),(0,t._)("div",L,[(0,t.Wm)(u,{ref:"numpadRef"},null,512)])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(p,{color:"danger",onClick:a[1]||(a[1]=e=>l.modalPeso=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cerrar ")])),_:1}),(0,t.Wm)(p,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo(l.numpadRef.cantidad))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var G=o(3645),J={name:"PesoComponent",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v,MDBInput:h.u2,NumpadComponent:G.Z},setup(e,{expose:a}){const o=(0,D.iH)(!1),l=(0,D.iH)(null),n=(0,D.iH)({idArticulo:null,idCesta:null});function i(e,a){n.value.idArticulo=e,n.value.idCesta=a,o.value=!0}function r(e){k.Z.post("teclado/clickTeclaArticulo",{idArticulo:n.value.idArticulo,gramos:e,idCesta:n.value.idCesta,unidades:1,arraySuplementos:null}).then((e=>{if(!e.data)throw Error("No se ha podido insertar el artículo a peso");n.value.idArticulo=null,n.value.idCesta=null,o.value=!1})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function s(){}return a({abrirModal:i}),(0,t.JJ)("okValue",r),{modalPeso:o,numpadRef:l,infoArticulo:n,test:s,insertarArticulo:r}}};const K=(0,T.Z)(J,[["render",Y]]);var Q=K;const X=e=>((0,t.dD)("data-v-356d6521"),e=e(),(0,t.Cn)(),e),ee={class:"row"},ae=["onClick"],oe=X((()=>(0,t._)("br",null,null,-1))),te={class:"row"},le={key:0,class:"table-responsive divCesta reverso"},ne={class:"table colorFuente"},ie={class:"tableBody"},re=["onClick"],se={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}};function de(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalSuplementos",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:l.modalSuplementos,"onUpdate:modelValue":a[3]||(a[3]=e=>l.modalSuplementos=e),staticBackdrop:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("selecciona_los_suplementos","Selecciona los suplementos"))+" "+(0,d.zw)(l.totalSuplementos.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(c,{class:"mx-auto modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",ee,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayCompletoSuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"col mb-3"},[(0,t._)("button",{class:(0,d.C_)(["btn w-100 h-100 colorIvan1 btnSuplemento",[{suplementoActivo:l.checkSuplementoActivo(e._id)}]]),onClick:a=>l.addSuplemento(e)},[(0,t.Uk)((0,d.zw)(e.nombre)+" ",1),oe,(0,t.Uk)(" "+(0,d.zw)(e.precioConIva)+" € ",1)],10,ae)])))),128))]),(0,t._)("div",te,[l.suplementosSeleccionados?((0,t.wg)(),(0,t.iD)("div",le,[(0,t._)("table",ne,[(0,t._)("tbody",ie,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.suplementosSeleccionados,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{seleccionado:l.itemSeleccionado===a}]),onClick:e=>l.setIndex(a)},[(0,t._)("td",null,[(0,t._)("span",se,(0,d.zw)(e.nombre),1)]),(0,t._)("td",null,(0,d.zw)(e.precioConIva.toFixed(2))+" €",1)],10,re)))),128))])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"danger",onClick:a[0]||(a[0]=e=>l.eliminarActivo()),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1}),(0,t.Wm)(u,{color:"secondary",onClick:a[1]||(a[1]=e=>l.modalSuplementos=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[2]||(a[2]=e=>l.insertarArticulo())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var ce={name:"SuplementosComponent",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(null),i=(0,D.iH)(null),r={idArticulo:null,idCesta:null,cliente:null,suplementos:null},s=(0,D.iH)([]),d=(0,D.iH)([]);let c=0;const u=(0,t.Fl)((()=>{if(s.value&&s.value.length>0){let e=0;for(let a=0;a<s.value.length;a++)e+=s.value[a].precioConIva;return e}return 0}));async function m(e,a,t,n,i){r.idArticulo=e,r.idCesta=a,r.cliente=t,c=i;const s=await k.Z.post("articulos/getSuplementos",{arrayIdSuplementos:n});if(!s)throw Error("No se ha podido obtener la lista de suplementos");d.value=s.data,o.dispatch("Unidades/setUnidades",1),l.value=!0}function p(e){try{s.value.push(e)}catch(a){x().fire("Oops...",a.message,"error")}}function f(e){const a=s.value.findIndex((a=>a.suplemento===e));return-1!==a}function b(e){i.value=e}function C(){s.value.splice(i.value,1)}async function g(){try{let e;for(let a=0;a<c;a++)e=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:r.idArticulo,gramos:0,idCesta:r.idCesta,unidades:1,arraySuplementos:s.value});if(r.idArticulo=null,r.idCesta=null,s.value=[],!e.data)throw Error("No se ha podido insertar el artículo con suplementos");l.value=!1}catch(e){x().fire("Oops...",e.message,"error")}}function w(){}return a({abrirModal:m}),(0,t.JJ)("okValue",g),{modalSuplementos:l,addSuplemento:p,checkSuplementoActivo:f,numpadRef:n,arrayCompletoSuplementos:d,suplementosSeleccionados:s,itemSeleccionado:i,insertarArticulo:g,setIndex:b,eliminarActivo:C,totalSuplementos:u,test:w}}};const ue=(0,T.Z)(ce,[["render",de],["__scopeId","data-v-356d6521"]]);var me=ue;const pe=e=>((0,t.dD)("data-v-9c9d6e02"),e=e(),(0,t.Cn)(),e),ve={class:"row"},fe={for:"nombre"},be=pe((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),Ce=pe((()=>(0,t._)("option",{value:"4"},"0%",-1))),ge=pe((()=>(0,t._)("option",{value:"1"},"4%",-1))),we=pe((()=>(0,t._)("option",{value:"5"},"5%",-1))),_e=pe((()=>(0,t._)("option",{value:"2"},"10%",-1))),Me=pe((()=>(0,t._)("option",{value:"3"},"21%",-1))),ye=[Ce,ge,we,_e,Me],he=pe((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),De=pe((()=>(0,t._)("option",{value:"true"},"Si",-1))),ke=pe((()=>(0,t._)("option",{value:"false"},"No",-1))),Be=[De,ke],xe={for:"precioIva"};function Ae(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalEditarProd",tabindex:"-1",labelledby:"modalEditarProd",modelValue:l.modalEditarProd,"onUpdate:modelValue":a[8]||(a[8]=e=>l.modalEditarProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",ve,[(0,t._)("label",fe,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,512),[[f.nr,l.nombre]])]),be,(0,t.wy)((0,t._)("select",{name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[1]||(a[1]=e=>l.tipoIva=e),class:"form-control"},ye,512),[[f.bM,l.tipoIva]]),he,(0,t.wy)((0,t._)("select",{name:"esSumable",id:"esSumable","onUpdate:modelValue":a[2]||(a[2]=e=>l.esSumable=e),class:"form-control"},Be,512),[[f.bM,l.esSumable]]),(0,t._)("label",xe,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA ",1),(0,t.wy)((0,t._)("input",{id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>l.precioConIva=e)},null,512),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[4]||(a[4]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Guardar")])),_:1}),(0,t.Wm)(u,{color:"warning",size:"lg",onClick:a[5]||(a[5]=e=>l.cambiarPosicion())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cambiar posición")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[6]||(a[6]=e=>l.EliminarTecla())},{default:(0,t.w5)((()=>[(0,t.Uk)("Elminar producto")])),_:1}),(0,t.Wm)(u,{color:"secondary",size:"lg",onClick:a[7]||(a[7]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin guardar")])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Te={name:"ModalEditarProducto",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(0),n=(0,D.iH)(!1),i=(0,D.iH)(0),r=(0,D.iH)(0),s=[4,10,21,0,5],d=(0,D.iH)(""),c=(0,D.iH)(-1),u=(0,D.iH)(""),m=(0,D.iH)(!0);async function p(){await k.Z.post("articulos/editarArticulo",{idArticulo:c.value,nombre:d.value,precioBase:parseFloat(i.value)/parseFloat(r.value),precioConIva:parseFloat(i.value),tipoIva:r.value,essumable:JSON.parse(m.value)}).then((e=>{n.value=!1,x().fire("Producto guardado","Producto guardado correctamente","success"),y.W.cargarTeclado()}))}function f(){n.value=!1}function b(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function C(e,a){await k.Z.post("articulos/moverArticulo",{id:c.value,posicion:e,menu:a}).then((a=>{x().fire("Producto establecido","Se ha movido el producto "+d.value+" correctamente a la celda "+e,"success"),y.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO")}async function g(){confirm("¿Estas segur@ que desea eliminar el producto?")&&(await k.Z.post("articulos/eliminarArticulo",{id:c.value}).then((e=>{x().fire("Producto eliminado","Se eliminado el producto "+d.value+" correctamente a la celda","success"),y.W.cargarTeclado()})),o.dispatch("setModoActual","MODIFICAR_ARTICULO"),n.value=!1)}async function w(e,a,o,t,l,s){d.value=e,i.value=a,c.value=o,r.value=t,m.value=l,n.value=!0,u.value=s}return(0,t.bv)((()=>{})),a({abrirModal:w,botonVacio:C}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:d,precioBase:l,precioConIva:i,id:c,modalEditarProd:n,tipoIva:r,confirmar:p,menus:u,cambiarPosicion:b,esSumable:m,tiposIva:s,salirSinGuardar:f,EliminarTecla:g}}};const ze=(0,T.Z)(Te,[["render",Ae],["__scopeId","data-v-9c9d6e02"]]);var Ee=ze;const Ie=e=>((0,t.dD)("data-v-f0d6b9ac"),e=e(),(0,t.Cn)(),e),Ue={class:"row"},Ve={for:"nombre"},Se=["disabled"],He=Ie((()=>(0,t._)("label",{for:"nombre"},[(0,t.Uk)("Nombre articulo "),(0,t._)("br")],-1))),Fe={style:{display:"flex"}},je=Ie((()=>(0,t._)("label",{for:"tipoIva"},"Tipo de IVA",-1))),We=["disabled"],Oe=Ie((()=>(0,t._)("option",{value:"4"},"0%",-1))),Ne=Ie((()=>(0,t._)("option",{value:"1"},"4%",-1))),Pe=Ie((()=>(0,t._)("option",{value:"5"},"5%",-1))),Re=Ie((()=>(0,t._)("option",{value:"2"},"10%",-1))),$e=Ie((()=>(0,t._)("option",{value:"3"},"21%",-1))),Ze=[Oe,Ne,Pe,Re,$e],qe=Ie((()=>(0,t._)("label",{for:"esSumable"},"¿Se vende a unidades?",-1))),Le=["disabled"],Ye=Ie((()=>(0,t._)("option",{value:"true"},"Si",-1))),Ge=Ie((()=>(0,t._)("option",{value:"false"},"No",-1))),Je=[Ye,Ge],Ke={for:"precioIva"},Qe=["disabled"],Xe={class:"row"},ea={for:"nombre"},aa={key:0,class:"row"},oa={class:"col"},ta={class:"table-responsive w-100",style:{height:"400px"}},la={class:"table table-striped mt-1"},na={class:"textoNombre d-inline-block text-truncate"};function ia(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBIcon"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalBody"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(v,{id:"modalCrearProd",tabindex:"-1",labelledby:"modalCrearProd",modelValue:l.modalCrearProd,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalCrearProd=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ue,[(0,t._)("label",Ve,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e)},null,8,Se),[[f.nr,l.nombre]])]),He,(0,t._)("div",Fe,[null==l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>l.nombre=e)},null,512)),[[f.nr,l.nombre]]):(0,t.kq)("",!0),null!=l.articuloSeleccionado?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:1,disabled:"",id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>l.articuloSeleccionado.nombre=e)},null,512)),[[f.nr,l.articuloSeleccionado.nombre]]):(0,t.kq)("",!0),(0,t.Wm)(u,{onClick:a[3]||(a[3]=e=>l.articuloModal=!0),color:"secondary",floating:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{icon:"search",size:"0.5x"})])),_:1})]),je,(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"tipoIva",id:"tipoIva","onUpdate:modelValue":a[4]||(a[4]=e=>l.tipoIva=e),class:"form-control"},Ze,8,We),[[f.bM,l.tipoIva]]),qe,(0,t.wy)((0,t._)("select",{disabled:null!=l.articuloSeleccionado,name:"esSumable",id:"esSumable","onUpdate:modelValue":a[5]||(a[5]=e=>l.esSumable=e),class:"form-control"},Je,8,Le),[[f.bM,l.esSumable]]),(0,t._)("label",Ke,[(0,t.Uk)("Precio con "+(0,d.zw)(parseInt(l.tiposIva[l.tipoIva-1]))+"% de IVA incluido ",1),(0,t.wy)((0,t._)("input",{disabled:null!=l.articuloSeleccionado,id:"precioIva",type:"number",class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>l.precioConIva=e)},null,8,Qe),[[f.nr,l.precioConIva]])])])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"success",size:"lg",onClick:a[7]||(a[7]=e=>l.confirmar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Crear producto")])),_:1}),(0,t.Wm)(u,{color:"danger",size:"lg",onClick:a[8]||(a[8]=e=>l.salirSinGuardar())},{default:(0,t.w5)((()=>[(0,t.Uk)("Cerrar sin crear")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(v,{id:"articuloModal",tabindex:"-1",labelledby:"articuloModal",modelValue:l.articuloModal,"onUpdate:modelValue":a[12]||(a[12]=e=>l.articuloModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Datos del producto ")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t._)("div",Xe,[(0,t._)("label",ea,[(0,t.Uk)("Nombre producto "),(0,t.wy)((0,t._)("input",{id:"nombre",type:"text",class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>l.inputBusqueda=e)},null,512),[[f.nr,l.inputBusqueda]])]),l.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",aa,[(0,t._)("div",oa,[(0,t._)("div",ta,[(0,t._)("table",la,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",na,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(u,{color:"primary",size:"lg",onClick:e=>l.selectArticulo({articulo:a}),class:"w-100"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{onClick:a[11]||(a[11]=e=>l.deleteArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)("Borrar selección")])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var ra={name:"modalCrearProducto",components:{MDBModal:h.j3,MDBModalHeader:h.ol,MDBModalTitle:h.wo,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBBtn:h.$v,MDBIcon:h.vm},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(0),n=(0,D.iH)(!1),i=(0,D.iH)(!1),r=(0,D.iH)(0),s=(0,D.iH)(0),d=(0,D.iH)(0),c=[4,10,21,0,5],u=(0,D.iH)(""),m=(0,D.iH)(""),p=(0,D.iH)(-1),f=(0,D.iH)(""),b=(0,D.iH)(!0),C=(0,D.iH)(),g=(0,D.iH)(""),w=(0,D.iH)(null);function _(){k.Z.post("articulos/buscar",{busqueda:g.value}).then((e=>{C.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function M(e){s.value=1,r.value=0,u.value="Nombre",b.value=!1,w.value=null,i.value=!1}async function h(e){s.value=e.articulo.tipoIva,r.value=e.articulo.precioConIva,u.value=e.articulo.nombre,b.value=e.articulo.esSumable,w.value=e.articulo,i.value=!1}async function B(){k.Z.post("articulos/anadirProducto",{nombreArticulo:u.value,precioConIva:parseFloat(r.value),esSumable:JSON.parse(b.value),precioBase:parseFloat(r.value)/parseFloat(s.value),tipoIva:parseFloat(s.value),menus:f.value,posicion:d.value,articuloExistente:null!=w.value,idArticulo:w.value?._id}).then((e=>{m.value="",l.value=0,r.value=0,s.value=3,b.value=!1,n.value=!1,x().fire("Producto creado","Producto creado correctamente","success"),y.W.cargarTeclado()}))}function A(){n.value=!1}function T(){n.value=!1,o.dispatch("setModoActual","MOVER_ARTICULO")}async function z(e,a){d.value=e,u.value="Nombre",r.value="0.0",s.value="3",b.value=!0,n.value=!0,f.value=a}return(0,t.YP)(g,(()=>{_()})),(0,t.bv)((()=>{})),a({abrirModal:z}),(0,t.YP)((()=>o.getters["ModalEditarProducto/getNombre"]),(()=>{})),{nombre:u,precioBase:l,precioConIva:r,id:p,modalCrearProd:n,tipoIva:s,confirmar:B,menus:f,inputBusqueda:g,arrayArticulos:C,cambiarPosicion:T,esSumable:b,tiposIva:c,salirSinGuardar:A,articuloModal:i,selectArticulo:h,articuloSeleccionado:w,deleteArticulo:M}}};const sa=(0,T.Z)(ra,[["render",ia],["__scopeId","data-v-f0d6b9ac"]]);var da=sa;const ca=["src"];function ua(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalFooter"),c=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(c,{id:"modalAlergenos",tabindex:"-1",labelledby:"modalAlergenosLabel",modelValue:l.modalAlergenos,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalAlergenos=e),fullscreen:""},{default:(0,t.w5)((()=>[(0,t._)("iframe",{src:l.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,ca),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{color:"danger",size:"lg",onClick:a[0]||(a[0]=e=>l.modalAlergenos=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var ma={name:"ModalAlergenosComponent",components:{MDBModal:h.j3,MDBModalFooter:h.ab,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,D.iH)(!1),t=(0,D.iH)(""),l=(0,v.oR)(),n=l.getters["Configuracion/parametros"];function i(e){r(e),o.value=!0}function r(e){t.value=`http://silema.hiterp.com/Facturacion/ElForn/gestion/FichaTecnicaHtml.asp?codi=${e}&Llic=${n?.licencia}`}return a({abrirModal:i}),{modalAlergenos:o,abrirModal:i,url:t}}};const pa=(0,T.Z)(ma,[["render",ua]]);var va=pa;function fa(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("MDBInput"),u=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBBtn"),p=(0,t.up)("MDBModalFooter"),v=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(v,{id:"modalVaris",tabindex:"-1",labelledby:"tituloModalVaris",modelValue:l.modalVarisActivo,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalVarisActivo=e),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"tituloModalVaris"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("inserta_el_nombre","Inserta el nombre del articulo")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:l.nombreArticulo,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombreArticulo=e),"aria-placeholder":"{{ $t('nombre', 'Nombre') }}",type:"text",ref:"inputRef"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{color:"success",onClick:l.handleSubmit},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("aceptar","Aceptar")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"])}var ba={name:"ModalVaris",components:{MDBBtn:h.$v,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalHeader:h.ol,MDBModalFooter:h.ab,MDBInput:h.u2},setup(e,{expose:a}){const o=(0,D.iH)(!1),t=(0,D.iH)({idArticle:"",gramos:0,idCesta:"",unidades:0,arraySuplementos:null}),l=e=>{o.value=!0,t.value=e},n=(0,D.iH)(""),i=(0,D.iH)(null);a({abrirModal:l,nombreArticulo:n});const r=(0,v.oR)(),s=()=>{const e=n.value;0!==e.length?(async function(){const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:t.value.idArticle,gramos:0,idCesta:t.value.idCesta,unidades:t.value.unidades,arraySuplementos:null,nombre:e});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");r.dispatch("Unidades/setUnidades",1)}(),n.value="",o.value=!1):x().fire({icon:"error",title:"Oops...",text:"El nombre no puede estar vacio"})},d=()=>{i.value.focus()};return{modalVarisActivo:o,nombreArticulo:n,handleSubmit:s,inputRef:i,getFocus:d}}};const Ca=(0,T.Z)(ba,[["render",fa]]);var ga=Ca,wa=o(2483),_a={name:"TeclasComponent",components:{PesoComponent:Q,MDBBtn:h.$v,SuplementosComponent:me,ModalEditarProducto:Ee,ModalCrearProducto:da,ModalAlergenosVue:va,ModalVaris:ga},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,wa.tv)(),n=(0,t.Fl)((()=>o.state.modoActual)),i=(0,t.Fl)((()=>o.state.Configuracion.parametros)),r=(0,t.Fl)((()=>o.state.Teclado.objTeclado)),s=(0,t.Fl)((()=>o.state.Teclado.indexMenuActivo)),d=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),c=(0,D.iH)(null),u=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),p=(0,t.Fl)((()=>o.state.Teclado.indexSubmenuActivo)),f=(0,D.iH)(null),b=(0,D.iH)(!1),C=(0,D.iH)(null),g=(0,D.iH)(null),w=(0,D.iH)(null),_=(0,D.iH)(null),M=(0,t.Fl)((()=>o.state.Unidades.unidades)),y=(0,D.iH)(!1),h=(0,t.Fl)((()=>{if(d.value)for(let e=0;e<d.value.length;e++)if(d.value[e]._id==u.value[m.value].idCesta)return d.value[e];return null}));function B(e){_.value.abrirModal(e)}function A(){let e=[];for(let a=0;a<36;a++)e[a]={idArticle:null,nombreArticulo:null,pos:a,color:null,esSumable:null};return e}async function T(e,a=undefined){const t=null!=e.nombreArticulo.match(/(Varis|Varios)/i);if(void 0!=a&&-1==a.pointerId)return;let l=e.idArticle,r=d.value[0].idCliente;try{if("MODIFICAR_ARTICULO"===n.value||"MOVER_ARTICULO"===n.value)return"MOVER_ARTICULO"===n.value?void x().fire({icon:"error",title:"Ya hay un producto en esta parcela",showConfirmButton:!1,timer:1e3}):void k.Z.post("articulos/getArticulo",{idArticulo:l,idCliente:r}).then((({data:a})=>{if(!a)throw Error("Error al editar el producto");g.value.abrirModal(a.nombre,a.precioConIva,e.idArticle,a.tipoIva,a.esSumable)})).catch((e=>{throw Error(e)}));if(!h.value)throw Error("Es necesario una cesta activa para añadir un artículo");if(JSON.parse(e.esSumable))if("Si"!=i?.value?.prohibirSuplementos&&e.suplementos?.length>0)C.value.abrirModal(e.idArticle,h.value._id,h.value.idCliente,e.suplementos,M.value);else if(t)c.value.abrirModal({idArticle:e.idArticle,gramos:0,idCesta:h.value._id,unidades:M.value,arraySuplementos:null});else{const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticle,gramos:0,idCesta:h.value._id,unidades:M.value,arraySuplementos:null,nombre:""});if(!a.data)throw Error("No se ha podido añadir el artículo a la cesta");o.dispatch("Unidades/setUnidades",1)}else f.value.abrirModal(e.idArticle,h.value._id)}catch(s){x().fire("Oops...",s.message,"error")}}const z=(0,t.Fl)((()=>{let e=A();if(r.value&&r.value[s.value]&&r.value[s.value].arraySubmenus&&r.value[s.value].arraySubmenus[p.value])for(let a=0;a<r.value[s.value].arraySubmenus[p.value].arrayTeclas.length;a++)e[r.value[s.value].arraySubmenus[p.value].arrayTeclas[a].pos]=r.value[s.value].arraySubmenus[p.value].arrayTeclas[a];else if(r.value&&r.value[s.value]&&r.value[s.value].arrayTeclas)for(let a=0;a<r.value[s.value].arrayTeclas.length;a++)e[r.value[s.value].arrayTeclas[a].pos]=r.value[s.value].arrayTeclas[a];return e}));function E(e){return parseInt(e,16)||e}function I(e){return E(e)/255<=.03928?E(e)/255/12.92:Math.pow((E(e)/255+.055)/1.055,2.4)}function U(e){return.2126*I(e.substr(1,2))+.7152*I(e.substr(3,2))+.0722*I(e.substr(-2))}function V(e,a){const o=U(e),t=U(a);return(Math.max(o,t)+.05)/(Math.min(o,t)+.05)}function S(e){const a=V(e,"#ffffff"),o=V(e,"#000000");return a>o?"#ffffff":"#000000"}function H(e){}function F(e){return e?"MOVER_ARTICULO"==n.value?"Mover aqui":"Vacío":n.value}function j(e){let a=r.value[s.value],o="",t=`${a.nombre}`;if(null!=a.arraySubmenus&&(o=a.arraySubmenus[p.value].nombre,t=`[${a.nombre}] ${o}`),"MOVER_ARTICULO"==n.value)return g.value.botonVacio(e,t);w.value.abrirModal(e,t)}return(0,t.JJ)("addItem",H),(0,t.bv)((()=>{u.value&&0!==u.value?.length||l.push("menu/fichajes"),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirSuplementos?"Si"==e.data?.params?.prohibirSuplementos&&(y.value=!0):y.value=!1})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.BotonsPreu?"Si"==e.data?.params?.BotonsPreu&&(b.value=!0):b.value=!1}))})),a({clickTecla:T}),{teclado:r,precioTecla:b,indexMenuActivo:s,arrayTeclas:z,getTextColor:S,modalPesoRef:f,modalSuplementosRef:C,modalAlergenosRef:_,modalEditarProdRef:g,modalCrearProdRef:w,abrirFicha:B,clickTecla:T,NoSuplementos:y,isEditarArticulos:F,editarArticulo:j,modalVarisRef:c}}};const Ma=(0,T.Z)(_a,[["render",Z],["__scopeId","data-v-1dd339e8"]]);var ya=Ma;const ha={key:0,class:"table-responsive divCesta reverso"},Da={class:"table colorFuente"},ka={class:"tableBody"},Ba=["onClick"],xa={class:"cantidad"},Aa={class:"d-inline-block text-truncate xUnidades",style:{"max-width":"14rem","min-width":"14rem"}},Ta={class:"xUnidades d-inline",style:{width:"fit-content",margin:"0 0.07rem"}},za={key:2,class:"col-12"},Ea={"d-flex":"","justify-content-around":"",style:{"max-width":"10rem","min-width":"10rem"}},Ia={class:"ms-2 d-inline"},Ua={class:"ms-2 d-inline"},Va={class:"xUnidades ms-2 d-inline"},Sa={key:3,class:"d-flex row col-12"},Ha={class:"col-12"},Fa={"d-flex":"","justify-content-around":""},ja={style:{"max-width":"10rem","min-width":"10rem"}},Wa={class:"pe-1"},Oa={class:"xUnidades ms-2 d-inline"},Na={class:"col-12"},Pa={"d-flex":"","justify-content-around":""},Ra={style:{"max-width":"10rem","min-width":"10rem"}},$a={class:"pe-1"},Za={class:"xUnidades ms-2 d-inline"},qa={key:0,style:{"max-width":"6rem","min-width":"10rem","vertical-align":"middle",padding:"0.5rem 1.4rem"}},La={key:1},Ya={key:0,class:"fw-bold"};function Ga(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBCardTitle"),c=(0,t.up)("MDBCardText"),u=(0,t.up)("MDBCardBody"),m=(0,t.up)("MDBCard");return l.cesta&&l.cesta.lista?((0,t.wg)(),(0,t.iD)("div",ha,[(0,t._)("table",Da,[(0,t._)("tbody",ka,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cesta.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:(0,d.C_)(["itemCesta",{estiloPromo:e.promocion,seleccionado:l.indexItemCestaActivo===a,sePuedeRegalar:l.sePuedeRegalar(e),regalado:e.regalo}]),onClick:e=>l.clickItem(a)},[(0,t._)("td",xa,[(0,t._)("span",Aa,(0,d.zw)(e.nombre),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:a=>l.restar(e),color:"primary",floating:"",class:"cambiarUnidades"},{default:(0,t.w5)((()=>[(0,t.Uk)(" - ")])),_:2},1032,["onClick"])),(0,t._)("span",Ta," x"+(0,d.zw)(0!=e.gramos&&e.gramos?(e.gramos/1e3).toFixed(3)+"kg":e.unidades),1),e.gramos?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:1,onClick:a=>l.sumar(e),color:"primary",floating:"",class:"cambiarUnidades"},{default:(0,t.w5)((()=>[(0,t.Uk)(" + ")])),_:2},1032,["onClick"])),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,a)=>((0,t.wg)(),(0,t.iD)("li",{key:a},(0,d.zw)(e.nombre),1)))),128)),null==e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("li",za,[(0,t._)("span",Ea,[(0,t._)("td",Ia,(0,d.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",Ua,(0,d.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",Va," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])])):null!=e?.promocion?.cantidadArticuloSecundario&&e?.promocion?((0,t.wg)(),(0,t.iD)("tr",Sa,[(0,t._)("li",Ha,[(0,t._)("span",Fa,[(0,t._)("td",ja,(0,d.zw)(l.recortarNombreArtPrinc(e)),1),(0,t._)("td",Wa,(0,d.zw)(e.promocion.precioRealArticuloPrincipal)+" € ",1),(0,t._)("td",Oa," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloPrincipal),1)])]),(0,t._)("li",Na,[(0,t._)("span",Pa,[(0,t._)("td",Ra,(0,d.zw)(l.recortarNombreArtSec(e)),1),(0,t._)("td",$a,(0,d.zw)(e.promocion.precioRealArticuloSecundario)+" € ",1),(0,t._)("td",Za," x"+(0,d.zw)(e.unidades*e.promocion.cantidadArticuloSecundario),1)])])])):(0,t.kq)("",!0)]),"CONSUMO_PERSONAL"!==l.cesta.modo&&"DEVOLUCION"!==l.cesta.modo?((0,t.wg)(),(0,t.iD)("td",qa,(0,d.zw)(e.subtotal.toFixed(2))+" € ",1)):(0,t.kq)("",!0)],10,Ba)))),128))])])])):((0,t.wg)(),(0,t.iD)("div",La,[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("cesta_no_inicializada","Cesta no inicializada")),1)])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("en_este_momento_no_hay_ninguna_cesta_seleccionada","En este momento no hay ninguna cesta seleccionada"))+" ",1),l.arrayTrabajadores&&l.arrayTrabajadores[l.indexTrabajadorActivo]?((0,t.wg)(),(0,t.iD)("span",Ya,(0,d.zw)(l.arrayTrabajadores[l.indexTrabajadorActivo].nombre),1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(r,{color:"primary",onClick:a[0]||(a[0]=e=>l.BuscarCestas())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ir a mi cesta","Ir a la cesta"))+" "+(0,d.zw)(l.BuscarCestas()),1)])),_:1})])),_:1})])),_:1})]))}var Ja={name:"CestaComponent",components:{MDBCard:h.Yl,MDBCardBody:h.H7,MDBCardTitle:h.QM,MDBCardText:h.Pp,MDBBtn:h.$v},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),n=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),i=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),r=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),s=(0,t.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(i.value&&i.value[r.value]&&l.value[e]._id==i.value[r.value].idCesta)return o.dispatch("Cestas/setCestaActivaAction",l.value[e]),o.dispatch("Cestas/setCestaActivaIndexAction",e),l.value[e];return null})),d=(0,D.iH)(0);function c(){s.value?.idCliente?k.Z.post("clientes/consultarPuntos",{idCliente:s.value?.idCliente}).then((e=>{"number"===typeof e.data?d.value=e.data:d.value=0})).catch((e=>{x().fire("Oops...",e.message,"error"),d.value=0})):d.value=0}const u=async e=>{const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:s.value._id,unidades:1,arraySuplementos:e.arraySuplementos});a.data&&o.dispatch("Unidades/setUnidades",1)},m=async e=>{if(1==e.unidades)return;const a=await k.Z.post("teclado/clickTeclaArticulo",{idArticulo:e.idArticulo,gramos:e.gramos||0,idCesta:s.value._id,unidades:-1,arraySuplementos:e.arraySuplementos});a.data&&o.dispatch("Unidades/setUnidades",-1)};function p(){if(i.value&&void 0!=r.value&&null!=r.value&&i.value[r.value]){let e=!0;if(void 0!=s.value&&"DEVOLUCION"==s?.value?.modo)return;for(let a=0;a<l.value.length;a++)if(l.value[a].trabajador==i.value[r.value].idTrabajador){k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:l.value[a]._id,idTrabajador:i.value[r.value]._id}),e=!1;break}if(!e)return;f(),e=!1}else i.value&&void 0!=r.value&&null!=r.value?x().fire("Oops...","Error desconocido #123","error"):x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}async function f(){i.value&&void 0!=r.value&&null!=r.value&&i.value[r.value]?await k.Z.post("cestas/crearCesta",{idTrabajador:i.value[r.value]._id}).then((e=>{if(!e.data)throw Error("No se ha podido inicializar la nueva cesta")})).catch((e=>{x().fire("Oops...",e.message,"error")})):i.value&&void 0!=r.value&&null!=r.value||x().fire("Oops...","Necesitas seleccionar un trabajador para poder atender.","error")}function b(e){return Math.trunc(.03*e*.02)}function C(e){const a=[8641,8654,8640,8675,99,315,314,312,5603];if(null==s.value.idCliente||void 0==s.value.idCliente||""==s.value.idCliente)return!1;for(let o=0;o<a.length;o++)if(a[o]===e.idArticulo&&b(d.value)>=e.subtotal&&!e.regalo)return!0;return!1}function g(e){k.Z.post("cestas/regalarProducto",{idCesta:s.value._id,indexLista:e}).then((e=>{e.data?x().fire({icon:"success",title:"¡Regalo aplicado!",showConfirmButton:!1,timer:1500}):x().fire("Oops...","No se ha podido regalar el producto","error")}))}function w(e){C(s.value.lista[e])?x().fire({title:"¿Regalar este artículo?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, regalar",denyButtonText:"No",icon:"question",customClass:{actions:"my-actions",cancelButton:"order-1 right-gap",confirmButton:"order-2",denyButton:"order-3"}}).then((a=>{a.isConfirmed?g(e):a.isDenied&&o.dispatch("Cestas/setActivoAction",e)})):o.dispatch("Cestas/setActivoAction",e)}function _(e){return null==e.promocion.cantidadArticuloSecundario?e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.length):e.nombre.substring(e.nombre.indexOf(".")+2,e.nombre.indexOf("+")-1)}function M(e){return e.nombre.substring(e.nombre.indexOf("+")+2,e.nombre.length)}return a({actualizarPuntos:c,BuscarCestas:p}),(0,t.bv)((()=>{c()})),{cesta:s,arrayTrabajadores:i,indexTrabajadorActivo:r,indexItemCestaActivo:n,clickItem:w,inicializarCesta:f,BuscarCestas:p,sePuedeRegalar:C,puntos:d,recortarNombreArtPrinc:_,recortarNombreArtSec:M,sumar:u,restar:m}}};const Ka=(0,T.Z)(Ja,[["render",Ga],["__scopeId","data-v-2667369a"]]);var Qa=Ka;const Xa={class:"modoVenta d-block text-center"},eo={key:0,class:"d-block textoNombreCliente text-center"},ao={class:"text-truncate",style:{"max-width":"10rem"}},oo={key:1,class:"d-block text-center textoNombreCliente"};function to(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),c=(0,t.up)("MDBBtnGroup"),u=(0,t.up)("ModalClientesSeleccionadoComponent"),m=(0,t.up)("ModalClientesComponent"),p=(0,t.up)("ModalArticulosComponent"),v=(0,t.up)("ModalUnidadesComponent"),f=(0,t.up)("tarjetaClienteNumero");return(0,t.wg)(),(0,t.iD)(t.HY,null,[l.vistaEspecial&&l.cesta?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,d.C_)(["divInfoModo mb-2",{fondoDevolucion:"DEVOLUCION"==l.cesta.modo,fondoCliente:l.cesta.idCliente}])},[(0,t._)("div",null,[(0,t._)("span",Xa,(0,d.zw)(l.cesta.modo),1),l.cesta.idCliente?((0,t.wg)(),(0,t.iD)("div",eo,[(0,t._)("span",ao,(0,d.zw)(l.cesta.nombreCliente),1),(0,t.Wm)(r,{onClick:a[0]||(a[0]=e=>l.consultarPuntos(l.cesta.idCliente)),class:"d-block mx-auto w-100",size:"lg",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("consultar_puntos","Consultar puntos")),1)])),_:1})])):((0,t.wg)(),(0,t.iD)("span",oo,(0,d.zw)(e.$t("sin_cliente_asignado","Sin cliente asignado")),1))])],2)):(0,t.kq)("",!0),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(c,{key:1,class:"shadow-0"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{outline:"secondary",class:"botones",onClick:a[1]||(a[1]=e=>l.goTo("/menu/caja/tickets"))},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"bars",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[2]||(a[2]=e=>l.refModalArticulos.abrirModal()),outline:"secondary",class:(0,d.C_)(["botones ms-1",{oculto:l.NoBuscarProducte}])},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"search",size:"4x"})])),_:1},8,["class"]),l.cesta?.idCliente?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones ms-1",style:{"background-color":"#285192"},onClick:a[3]||(a[3]=e=>l.refModalClientesSeleccionado.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x",style:{color:"#fff5e9"}})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones ms-1",onClick:a[4]||(a[4]=e=>l.refModalClientes.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"users",size:"4x"})])),_:1}))])),_:1})),l.vistaEspecial?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(c,{key:2,class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{onClick:a[5]||(a[5]=e=>l.imprimirUltimoTicket()),outline:"secondary",class:"botones"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"print",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[6]||(a[6]=e=>l.refModalUnidades.abrirModal()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"calculator",size:"4x"})])),_:1}),(0,t.Wm)(r,{onClick:a[7]||(a[7]=e=>l.goTo("/cestas")),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"shopping-cart",size:"4x"})])),_:1})])),_:1})),(0,t.Wm)(c,{class:"shadow-0 mt-1"},{default:(0,t.w5)((()=>[void 0==l.indexActivoCesta||null==l.indexActivoCesta?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"secondary",class:"botones",onClick:a[8]||(a[8]=e=>l.borrarLista())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"eraser",size:"4x"})])),_:1})):((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"secondary",class:"botones",onClick:a[9]||(a[9]=e=>l.borrarItem())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"times",size:"4x"})])),_:1})),(0,t.Wm)(r,{onClick:a[10]||(a[10]=e=>l.resetGeneral()),outline:"secondary",class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"undo",size:"4x"})])),_:1}),(0,t.Wm)(r,{outline:"secondary",onClick:a[11]||(a[11]=e=>l.changeVistaCliente()),class:"botones ms-1"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"star",size:"4x"})])),_:1})])),_:1}),(0,t.Wm)(u,{ref:"refModalClientesSeleccionado"},null,512),(0,t.Wm)(m,{ref:"refModalClientes"},null,512),(0,t.Wm)(p,{ref:"refModalArticulos"},null,512),(0,t.Wm)(v,{ref:"refModalUnidades"},null,512),(0,t.Wm)(f,{ref:"tarjetaNum"},null,512)],64)}var lo=o(6109),no=o(9631);const io={class:"row mt-1 p-4"},ro={class:"col-md-8"},so={class:"col-md-4"},co={key:0,class:"row"},uo={class:"col"},mo={class:"table-responsive w-100",style:{height:"400px"}},po={class:"table table-striped mt-1"},vo={class:"textoNombre d-inline-block text-truncate"},fo={key:1,class:"row"},bo={class:"sinResultados position-relative"},Co={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function go(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(c,{id:"modalArticulos",tabindex:"-1",labelledby:"tituloModalArticulos",modelValue:l.modalArticulos,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalArticulos=e),size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",io,[(0,t._)("div",ro,[(0,t.wy)((0,t._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre de artículo","aria-label":".form-control-lg example","onUpdate:modelValue":a[0]||(a[0]=e=>l.inputBusqueda=e)},null,512),[[f.nr,l.inputBusqueda]])]),(0,t._)("div",so,[(0,t.Wm)(r,{color:"secondary",class:"botonBusqueda w-100",onClick:a[1]||(a[1]=e=>l.buscar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("buscar","Buscar")),1)])),_:1})])]),l.arrayArticulos?.length>0?((0,t.wg)(),(0,t.iD)("div",co,[(0,t._)("div",uo,[(0,t._)("div",mo,[(0,t._)("table",po,[(0,t._)("tbody",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayArticulos,((a,o)=>((0,t.wg)(),(0,t.iD)("tr",{key:o},[(0,t._)("td",null,[(0,t._)("span",vo,(0,d.zw)(a.nombre),1)]),(0,t._)("td",null,[(0,t.Wm)(r,{color:"primary",size:"lg",onClick:e=>l.selectArticulo({idArticle:a._id,esSumable:a.esSumable}),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("elegir","Elegir")),1)])),_:2},1032,["onClick"])])])))),128))])])])])])):((0,t.wg)(),(0,t.iD)("div",fo,[(0,t._)("div",bo,[(0,t._)("span",Co,(0,d.zw)(e.$t("sin_resultados","Sin resultados")),1)])]))])),_:1})])),_:1},8,["modelValue"])}var wo={name:"ModalArticulosComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v},setup(e,a){const o=(0,D.iH)(!1),l=(0,D.iH)(0),n=(0,D.iH)(""),i=(0,D.iH)(),r=(0,t.f3)("clickTecla");function s(e){r(e),o.value=!1}function d(){o.value=!0}function c(){l.value++}function u(){k.Z.post("articulos/buscar",{busqueda:n.value}).then((e=>{i.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}return(0,t.YP)(n,(()=>{u()})),a.expose({abrirModal:d,datoBorrar:l}),{test:c,datoBorrar:l,modalArticulos:o,inputBusqueda:n,arrayArticulos:i,buscar:u,selectArticulo:s}}};const _o=(0,T.Z)(wo,[["render",go],["__scopeId","data-v-1b7d2910"]]);var Mo=_o;const yo={class:"row"},ho={class:"row"},Do={class:"text-center"};function ko(e,a,o,l,n,i){const r=(0,t.up)("MDBModalTitle"),s=(0,t.up)("MDBModalHeader"),c=(0,t.up)("NumpadComponent"),u=(0,t.up)("MDBModalBody"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalUnidades",tabindex:"-1",labelledby:"modalUnidadesLabel",modelValue:l.modalUnidades,"onUpdate:modelValue":a[1]||(a[1]=e=>l.modalUnidades=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{id:"modalUnidadesLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("introduce","Introduce"))+" "+(0,d.zw)(e.$t("las_unidades","las unidades"))+" "+(0,d.zw)(e.$t("y_marca","y marca"))+" "+(0,d.zw)(e.$t("un_articulo","un artículo")),1)])),_:1})])),_:1}),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",yo,[l.refUnidadesComponent?(0,t.wy)(((0,t.wg)(),(0,t.iD)("input",{key:0,type:"text",class:"form-control sizeUnidades",disabled:"","onUpdate:modelValue":a[0]||(a[0]=e=>l.refUnidadesComponent.cantidad=e)},null,512)),[[f.nr,l.refUnidadesComponent.cantidad]]):(0,t.kq)("",!0)]),(0,t._)("div",ho,[(0,t._)("div",Do,[(0,t.Wm)(c,{ref:"refUnidadesComponent"},null,512)])])])),_:1})])),_:1},8,["modelValue"])}var Bo={name:"UnidadesComponent",components:{NumpadComponent:G.Z,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalHeader:h.ol,MDBModalTitle:h.wo},setup(){const e=(0,D.iH)(null),a=(0,D.iH)(null),o=(0,v.oR)();function l(){a.value=!0}function n(e){o.dispatch("Unidades/setUnidades",e),a.value=!1}return(0,t.JJ)("okValue",n),{refUnidadesComponent:e,modalUnidades:a,abrirModal:l}}};const xo=(0,T.Z)(Bo,[["render",ko],["__scopeId","data-v-37288cef"]]);var Ao=xo;const To={class:"text-center col-12 p3"},zo={class:"text-center h2"},Eo={class:"row"},Io={class:"d-inline-block text-center"},Uo={class:"d-inline-block text-center"},Vo={id:"salir",class:"text-center"};function So(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),u=(0,t.up)("ModalEncargosComponent"),m=(0,t.up)("ModalDeudasComponent"),p=(0,t.up)("ModalFichaCliente");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalClientesSeleccionado,"onUpdate:modelValue":a[5]||(a[5]=e=>l.modalClientesSeleccionado=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",To,[(0,t._)("span",zo,(0,d.zw)(e.$t("cliente_actual","Cliente actual: "))+" "+(0,d.zw)(l.cesta.nombreCliente),1)]),(0,t._)("div",Eo,[(0,t._)("div",Io,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.resetGeneral())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("deseleccionar","Deseleccionar")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[1]||(a[1]=e=>l.refModalEncargos.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("encargos","Encargos")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[2]||(a[2]=e=>l.refModalDeudas.abrirModal())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("Deudas","deudas")),1)])),_:1})]),(0,t._)("div",Uo,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[3]||(a[3]=e=>l.ficha())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("ficha","Ficha")),1)])),_:1})]),(0,t._)("div",Vo,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones",onClick:a[4]||(a[4]=e=>l.modalClientesSeleccionado=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"refModalEncargos"},null,512),(0,t.Wm)(m,{ref:"refModalDeudas"},null,512),(0,t.Wm)(p,{ref:"refModalFichaCliente",callback:l.cambiosCliente},null,8,["callback"])],64)}const Ho=e=>((0,t.dD)("data-v-23d4467c"),e=e(),(0,t.Cn)(),e),Fo={class:"row"},jo={class:"d-inline-block text-center"},Wo={class:"p-0"},Oo={class:"text-center"},No=Ho((()=>(0,t._)("option",{value:"1",selected:""},"todo",-1))),Po=Ho((()=>(0,t._)("option",{value:"2"},"hoy",-1))),Ro=[No,Po],$o={id:"lista"},Zo=["onClick"],qo={class:"d-flex m-0 p-0 justify-content-between"},Lo={key:0,class:"p-0"},Yo={key:0},Go={key:1},Jo={key:1,class:"p-0",type:"button"},Ko={key:2,class:"p-0",type:"button"},Qo={class:"d-flex justify-content-between px-0 py-2 m-0"},Xo={class:"productos"},et={class:"col-12"},at={class:"col-3"},ot={class:"col-1"},tt={class:"col-1"},lt={class:"col-2"},nt={class:"col-2"},it={class:"col-3"},rt={class:"d-flex flex-column justify-content-center"},st={key:0},dt={key:1},ct={id:"salir"},ut={class:"leyendaHT d-flex align-items-center justify-content-center col-4"},mt=Ho((()=>(0,t._)("div",{class:"redondaHoraTarde mx-2"},null,-1))),pt={class:"leyendaDT d-flex align-items-center justify-content-center col-4"},vt=Ho((()=>(0,t._)("div",{class:"redondaDiaTarde mx-2"},null,-1)));function ft(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(c,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalEncargos,"onUpdate:modelValue":a[4]||(a[4]=e=>l.modalEncargos=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",Fo,[(0,t._)("div",jo,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/encargos")),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nuevo_encargo","Nuevo encargo")),1)])),_:1},8,["disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.recoger,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("recoger","Recoger")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.anular,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("anular","Anular")),1)])),_:1},8,["onClick","disabled"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.imprimir,disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick","disabled"])]),(0,t._)("div",Wo,[(0,t._)("h3",Oo,[(0,t.Uk)(" Listado de "),(0,t.wy)((0,t._)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>l.listado=e),id:"encargo",onChange:a[2]||(a[2]=e=>l.mostrar())},Ro,544),[[f.bM,l.listado]]),(0,t.Uk)(": ")]),(0,t._)("div",$o,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.encargos,((a,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"encargos",key:o},[(0,t._)("div",{type:"button",onClick:e=>l.onClickEncargo(o),class:(0,d.C_)({active:l.seleccionado===o,horaTarde:1==l.horaTarde(a),diaTarde:1==l.diaTarde(a)})},[(0,t._)("div",qo,[1==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Lo,["am"==a?.amPm?((0,t.wg)(),(0,t.iD)("p",Yo,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_manana","Turno mañana")),1)):((0,t.wg)(),(0,t.iD)("p",Go,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(e.$t("turno_tarde","Turno_tarde")),1))])):(0,t.kq)("",!0),2==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Jo,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(a?.fecha)+" "+(0,d.zw)(a?.hora),1)])):(0,t.kq)("",!0),3==a?.opcionRecogida?((0,t.wg)(),(0,t.iD)("div",Ko,[(0,t._)("p",null,(0,d.zw)(e.$t("fecha_recogida","Fecha recogida"))+": "+(0,d.zw)(e.$t("cada","Cada"))+" "+(0,d.zw)(a.dias[0].dia)+" - "+(0,d.zw)(a.dias[0].dia)+" "+(0,d.zw)(e.$t("proximo","Próximo"))+" "+(0,d.zw)(a?.fecha),1)])):(0,t.kq)("",!0),(0,t._)("p",null,"Cliente: "+(0,d.zw)(a?.nombreCliente),1)]),(0,t._)("div",Qo,[(0,t._)("p",null,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar"))+": "+(0,d.zw)(a?.total)+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido"))+": "+(0,d.zw)(a?.dejaCuenta)+"€ ",1),(0,t._)("p",null,(0,d.zw)(e.$t("faltan","Faltan"))+": "+(0,d.zw)(l.redondearDecimales(a?.total-a?.dejaCuenta,2))+"€ ",1)]),(0,t._)("p",null,(0,d.zw)(e.$t("productos","Productos"))+": "+(0,d.zw)(a?.productos?.length),1),(0,t._)("div",Xo,[(0,t._)("table",et,[(0,t._)("tr",null,[(0,t._)("th",at,(0,d.zw)(e.$t("nombre","Nombre")),1),(0,t._)("th",ot,(0,d.zw)(e.$t("precio","Precio")),1),(0,t._)("th",tt,(0,d.zw)(e.$t("unidades","Unidades")),1),(0,t._)("th",lt,(0,d.zw)(e.$t("total","Total")),1),(0,t._)("th",nt,(0,d.zw)(e.$t("suplementos","Suplementos")),1),(0,t._)("th",it,(0,d.zw)(e.$t("comentario","Comentario")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a?.productos,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.total,2))+"€",1),(0,t._)("td",rt,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",st,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",dt,"Ninguno"))]),(0,t._)("td",null,(0,d.zw)(e?.comentario),1)])))),128))])])],10,Zo)])))),128))])]),(0,t._)("div",ct,[(0,t._)("div",ut,[mt,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_hora_pasada","Encargo con hora pasada")),1)]),(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[3]||(a[3]=e=>{l.seleccionado=-1,l.modalEncargos=!1}),disabled:l.botonBloqueado},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1},8,["disabled"]),(0,t._)("div",pt,[vt,(0,t._)("span",null,(0,d.zw)(e.$t("Encargo_con_fecha_atrasada","Encargo con fecha atrasada")),1)])])])])),_:1})])),_:1},8,["modelValue"])}var bt={name:"modalEncargosComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v},setup(e,a){const o=(0,D.iH)(!1),l=(0,v.oR)(),n=(0,wa.tv)(),i=(0,D.iH)(null),r=((0,D.iH)(0),(0,D.iH)()),s=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),d=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>s.value&&void 0!=d.value&&null!=d.value&&s.value[d.value]?s.value[d.value]:null)),u=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),m=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(s.value&&s.value[d.value]&&u.value[e]._id==s.value[d.value].idCesta)return u.value[e];return null})),p=new Date,f=(0,D.iH)(-1),b=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0);b.setDate(b.getDate()+1);let C="1";const g=(0,D.iH)(null),w=(0,D.iH)(null);function _(){i.value=!0,M()}function M(){k.Z.post("/encargos/getEncargos").then((e=>{g.value=e.data,h()}))}function y(e){n.push(e)}function h(){f.value=-1;let e=document.getElementById("encargo");w.value=e&&1!=e?.value?B():g.value,w.value.sort(((e,a)=>{const o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`),t=new Date(`${a.fecha}T${a.hora?a.hora:"00:00:00"}`);return o<t?-1:o>t?1:0}))}function B(){const e=(0,D.iH)([]);for(let a=0;a<g.value.length;a++){const o=g.value[a];1==o.opcionRecogida&&"am"==o.amPm?o.hora="14:59":(1==o.opcionRecogida&&"pm"==o.amPm||3==o.opcionRecogida)&&(o.hora="23:59");const t=new Date(`${o.fecha}T${o.hora}`);t.getDate()>=p.getDate()&&t.getDate()<b.getDate()&&e.value.push(o)}return e.value}function A(e){if(3==e.opcionRecogida)return!1;let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);var t=a.getHours(),l=a.getMinutes(),n=o.getHours(),i=o.getMinutes();return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getDate()==o.getDate()&&a.getDate()==o.getDate()&&(n<t||n==t&&i<=l)}function T(e){let a=new Date,o=new Date(`${e.fecha}T${e.hora?e.hora:"00:00:00"}`);return a.setHours(0,0,0,0),o.setHours(0,0,0,0),a.getMonth()>o.getMonth()||a.getMonth()===o.getMonth()&&a.getDate()>o.getDate()}function z(e){f.value=e}function E(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}async function I(){o.value=!0,-1!=f.value?await x().fire({title:"Precio por pagar: "+E(w.value[f.value].total-w.value[f.value].dejaCuenta,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar compra",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed)try{const e=await k.Z.post("tickets/crearTicketEncargo",{idEncargo:w.value[f.value]._id,total:w.value[f.value].total,dejaCuenta:w.value[f.value].dejaCuenta,tipo:"EFECTIVO",idTrabajador:c.value._id});if(!e.data)throw Error("No se ha podido crear el ticket");w.value.splice(f.value,1),f.value=-1,M(),x().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),n.push("/main")}catch(a){x().fire("Oops...",a.message,"error")}finally{o.value=!1}else o.value=!1})):(x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"}),o.value=!1)}function U(){-1!=f.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular encargo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((e=>{e.isConfirmed&&(w.value[f.value].dejaCuenta>0&&k.Z.post("movimientos/nuevoMovimiento",{cantidad:w.value[f.value].dejaCuenta,concepto:"Entrega Diària",idTrabajador:c.value._id,tipo:"SALIDA"}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((e=>{x().fire("Oops...",e.message,"error")})),k.Z.post("/encargos/anularEncargo",{id:w.value[f.value]._id}).then((e=>{e?.data?(w.value.splice(f.value,1),f.value=-1,M(),x().fire("Perfecto","Encargo anulado correctamente","success")):x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")})))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona un encargo"})}function V(){x().fire({title:"Imprimir encargos de hoy",text:"orden de la lista:",icon:"info",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Producto",denyButtonText:"Cliente",denyButtonColor:"green",confirmButtonColor:"green",customClass:{actions:"my-actions",cancelButton:"order-3 right-gap",confirmButton:"order-1",denyButton:"order-2"}}).then((e=>{if(!e.isDismissed){let a;const o=(0,D.iH)([]);o.value=B(),e.isConfirmed?(a="Producto",x().fire("Saved!","","success")):e.isDenied&&(a="Cliente",x().fire("Changes are not saved","","info")),k.Z.post("/encargos/imprimirEncargosHoy",{orden:a,array:o.value}).then((e=>{e?.data?x().fire("Perfecto","imprimiendo encargos","success"):x().fire("Oops...","Encargo no anulado","error")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}}))}return a.expose({abrirModal:_}),{modalEncargos:i,arrayClientes:r,cesta:m,goTo:y,encargos:w,mostrar:h,listado:C,seleccionado:f,onClickEncargo:z,recoger:I,anular:U,redondearDecimales:E,diaTarde:T,horaTarde:A,cargarEncargos:M,imprimir:V,botonBloqueado:o}}};const Ct=(0,T.Z)(bt,[["render",ft],["__scopeId","data-v-23d4467c"]]);var gt=Ct;const wt=e=>((0,t.dD)("data-v-48a23327"),e=e(),(0,t.Cn)(),e),_t={class:"row"},Mt={class:"d-inline-block text-center"},yt={class:"p-0"},ht={id:"lista"},Dt=["onClick"],kt={class:"d-flex m-0 p-0 justify-content-between"},Bt={class:"productos"},xt={class:"col-12"},At=wt((()=>(0,t._)("tr",null,[(0,t._)("th",{class:"col-3"},"Nombre"),(0,t._)("th",{class:"col-2"},"Precio"),(0,t._)("th",{class:"col-2"},"Unidades"),(0,t._)("th",{class:"col-2"},"Total"),(0,t._)("th",{class:"col-3"},"Suplementos")],-1))),Tt={class:"d-flex flex-column justify-content-center"},zt={key:0},Et={key:1},It={id:"salir"};function Ut(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(c,{id:"modalClientes",tabindex:"-1",labelledby:"tituloModalClientes",modelValue:l.modalDeudas,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalDeudas=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",_t,[(0,t._)("div",Mt,[(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:a[0]||(a[0]=e=>l.goTo("/menu/deudas"))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("nueva_deuda","Nueva deuda")),1)])),_:1}),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.pagar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.eliminar},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("eliminar","Eliminar")),1)])),_:1},8,["onClick"]),(0,t.Wm)(r,{color:"primary",class:"ms-2 sizeBotones",onClick:l.imprimir},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("imprimir","Imprimir")),1)])),_:1},8,["onClick"])]),(0,t._)("div",yt,[(0,t._)("div",ht,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayDeudas,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{class:"deudas",key:a},[(0,t._)("div",{type:"button",onClick:e=>l.onClickDeuda(a),class:(0,d.C_)({active:l.seleccionado===a})},[(0,t._)("div",kt,[(0,t._)("p",null,"Fecha deuda: "+(0,d.zw)(l.getFecha(e?.timestamp)),1),(0,t._)("p",null,"Cliente: "+(0,d.zw)(e?.nombreCliente),1),(0,t._)("p",null,"Dinero a pagar: "+(0,d.zw)(e?.total)+"€",1)]),(0,t._)("p",null,"Productos: "+(0,d.zw)(e?.cesta?.lista?.length),1),(0,t._)("div",Bt,[(0,t._)("table",xt,[At,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e?.cesta?.lista,((e,a)=>((0,t.wg)(),(0,t.iD)("tr",{key:a,class:"p-1 producto"},[(0,t._)("td",null,(0,d.zw)(e?.nombre),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal/e?.unidades,2))+"€ ",1),(0,t._)("td",null,(0,d.zw)(e?.unidades),1),(0,t._)("td",null,(0,d.zw)(l.redondearDecimales(e?.subtotal,2))+"€",1),(0,t._)("td",Tt,[e?.arraySuplementos?((0,t.wg)(),(0,t.iD)("div",zt,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},(0,d.zw)(e.nombre),1)))),128))])):((0,t.wg)(),(0,t.iD)("span",Et,"Ninguno"))])])))),128))])])],10,Dt)])))),128))])]),(0,t._)("div",It,[(0,t.Wm)(r,{color:"danger",class:"ms-2 sizeBotones col-4",onClick:a[1]||(a[1]=e=>{l.seleccionado=-1,l.modalDeudas=!1})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("salir","Salir")),1)])),_:1})])])])),_:1})])),_:1},8,["modelValue"])}var Vt={name:"modaldeudasComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v},setup(e,a){const o=(0,D.iH)(null),t=(0,wa.tv)(),l=(0,D.iH)(null),n=(0,D.iH)(-1);function i(){o.value=!0,r()}function r(){k.Z.post("/deudas/getDeudas").then((e=>{l.value=e.data}))}function s(e,a){let o=new RegExp("\\d\\.(\\d){"+a+",}");return o.test(e)?Number(e.toFixed(a)):0===Number(e.toFixed(a))?0:e}function d(e){n.value=e}function c(e){var a=new Date(e),o=a.getFullYear(),t=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2),n=("0"+a.getHours()).slice(-2),i=("0"+a.getMinutes()).slice(-2),r=("0"+a.getSeconds()).slice(-2),s=(("00"+a.getMilliseconds()).slice(-3),o+"-"+t+"-"+l+" "+n+":"+i+":"+r);return s}function u(){k.Z.post("impresora/abrirCajon")}async function m(){-1!=n.value?(u(),await x().fire({title:"Precio por pagar: "+s(l.value[n.value].total,2)+"€",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Confirmar compra en efectivo",confirmButtonColor:"green",cancelButtonColor:"red"}).then((async e=>{if(e.isConfirmed)try{const e=await k.Z.post("deudas/ticketPagado",{idDeuda:l.value[n.value]._id});if(e.data.error)throw Error("No se ha podido pagar la deuda");l.value.splice(n.value,1),n.value=-1,r(),x().fire({icon:"success",title:"Deuda pagada correctamente",showConfirmButton:!1,timer:500}),t.push("/main")}catch(a){x().fire("Oops...",a.message,"error")}}))):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function p(){-1!=n.value?x().fire({title:"Estas seguro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Anular deuda",confirmButtonColor:"green",cancelButtonColor:"red"}).then((e=>{e.isConfirmed&&k.Z.post("/deudas/eliminarDeuda",{idDeuda:l.value[n.value]._id}).then((e=>{e?.data?(l.value.splice(n.value,1),n.value=-1,r(),x().fire("Perfecto","Deuda eliminada correctamente","success")):x().fire("Oops...","Deuda no eliminada","error")})).catch((e=>{x().fire("Oops...",e.message,"error")}))})):x().fire({icon:"info",title:"Oops...",text:"Selecciona una deuda"})}function v(){x().fire({title:"Selecciona un intervalo de fechas",html:'<div id="fechas my-input-class"><label for="fecha-inicial">Fecha inicial:</label>\n            <input id="fecha-inicial" type="date" class="swal2-input">\n          </div>\n          <div id="fechas my-input-class"><label for="fecha-final">Fecha final:</label>\n            <input id="fecha-final" type="date" class="swal2-input">\n          </div>',showCancelButton:!0,preConfirm:()=>{const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;return e&&a||x().showValidationMessage("Por favor, ingresa ambas fechas"),a<e&&(x().showValidationMessage("La fecha final no puede ser anterior a la fecha inicial"),a=e),{fechaInicial:e,fechaFinal:a}}}).then((e=>{if(e.isConfirmed){const{fechaInicial:a,fechaFinal:o}=e.value;k.Z.post("impresora/imprimirIntervaloDeuda",{fechaInicial:a,fechaFinal:o}).then((e=>{e.data.error&&x().fire({title:"Oops...",text:e.data.msg,icon:"error",button:"Aceptar"})}))}}));const e=function(){const e=document.getElementById("fecha-inicial").value,a=document.getElementById("fecha-final").value;a<e&&(document.getElementById("fecha-final").value=e),document.getElementById("fecha-final").setAttribute("min",e)};document.getElementById("fecha-inicial").addEventListener("change",e),document.getElementById("fecha-final").addEventListener("change",e)}function f(e){t.push(e)}return a.expose({abrirModal:i}),{modalDeudas:o,goTo:f,cargarDeudas:r,redondearDecimales:s,arrayDeudas:l,onClickDeuda:d,seleccionado:n,pagar:m,getFecha:c,eliminar:p,imprimir:v}}};const St=(0,T.Z)(Vt,[["render",Ut],["__scopeId","data-v-48a23327"]]);var Ht=St;const Ft={class:"row"},jt={class:"col w-50"},Wt={class:"col w-50 datos"};function Ot(e,a,o,l,n,i){const r=(0,t.up)("MDBModalHeader"),s=(0,t.up)("MDBInput"),c=(0,t.up)("MDBModalBody"),u=(0,t.up)("MDBBtn"),m=(0,t.up)("MDBModalFooter"),p=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(p,{id:"modalFichaCliente",tabindex:"-1",labelledby:"tituloModalFichaCliente",modelValue:l.modalFichaCliente,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalFichaCliente=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t._)("h2",null,"Ficha de "+(0,d.zw)(l.nombre),1)])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t._)("div",Ft,[(0,t._)("div",jt,[(0,t.Wm)(s,{label:"Nombre",modelValue:l.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>l.nombre=e),style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Telefono",modelValue:l.telefono,"onUpdate:modelValue":a[1]||(a[1]=e=>l.telefono=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"email",modelValue:l.email,"onUpdate:modelValue":a[2]||(a[2]=e=>l.email=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"direccion",modelValue:l.direccion,"onUpdate:modelValue":a[3]||(a[3]=e=>l.direccion=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])]),(0,t._)("div",Wt,[(0,t.Wm)(s,{label:"Tarjeta Cliente",modelValue:l.tarjeta,"onUpdate:modelValue":a[4]||(a[4]=e=>l.tarjeta=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"Nif",modelValue:l.nif,"onUpdate:modelValue":a[5]||(a[5]=e=>l.nif=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"]),(0,t.Wm)(s,{label:"descuento",modelValue:l.descuento,"onUpdate:modelValue":a[6]||(a[6]=e=>l.descuento=e),class:"datos",style:{"margin-top":"10px"}},null,8,["modelValue"])])])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"primary",onClick:a[7]||(a[7]=e=>l.guardarCliente())},{default:(0,t.w5)((()=>[(0,t.Uk)(" Guardar ")])),_:1}),(0,t.Wm)(u,{color:"danger",onClick:a[8]||(a[8]=e=>l.modalFichaCliente=!1),ref:"salirBoton"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Salir ")])),_:1},512)])),_:1})])),_:1},8,["modelValue"])}var Nt={name:"ModalFichaClienteComponent",props:["callback"],components:{MDBBtn:h.$v,MDBInput:h.u2,MDBModal:h.j3,MDBModalBody:h.Yz,MDBModalFooter:h.ab,MDBModalHeader:h.ol},setup(e,a){const o=(0,D.iH)(!1),l=e=>{o.value=!0,b(e)};a.expose({abrirModal:l});const n=(0,D.iH)(""),i=(0,D.iH)(""),r=(0,D.iH)(""),s=(0,D.iH)(""),d=(0,D.iH)(""),c=(0,D.iH)(""),u=(0,D.iH)(""),m=(0,D.iH)(null),p=(0,D.iH)(null),v=(0,t.f3)("cambiosCliente"),f=()=>{""!=n.value&&""!=i.value&&""!=r.value&&""!=s.value&&""!=d.value&&""!=c.value&&""!=u.value?isNaN(Number(u.value))?x().fire({title:"Vaya...",text:"El descuento tiene que ser un número",icon:"error",confirmButtonText:"Aceptar"}):k.Z.post("clientes/actualizarCliente",{idCliente:m.value,nombre:n.value,telefono:i.value,email:r.value,direccion:s.value,tarjetaCliente:d.value,nif:c.value,descuento:u.value}).then((()=>{x().fire({title:"Cliente actualizado",icon:"success",confirmButtonText:"Aceptar"}),o.value=!1})).finally((()=>{e.callback({nombre:n.value,descuento:u.value})})):x().fire({title:"Vaya...",text:"No se puede dejar ningún campo vacío",icon:"error",confirmButtonText:"Aceptar"})},b=async e=>{const{data:a}=await k.Z.post("/clientes/getClienteById",{idCliente:e});if(!a)throw new Error("No se ha podido cargar el cliente");n.value=a.nombre,i.value=a.telefono,r.value=a.email,s.value=a.direccion,d.value=a.tarjetaCliente,c.value=a.nif,u.value=a.descuento,m.value=a.id};return{modalFichaCliente:o,guardarCliente:f,nombre:n,telefono:i,email:r,direccion:s,tarjeta:d,nif:c,descuento:u,salirBoton:p,cambiosCliente:v}}};const Pt=(0,T.Z)(Nt,[["render",Ot]]);var Rt=Pt,$t={name:"ModalClientesSeleccionadoComponent",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,ModalEncargosComponent:gt,ModalDeudasComponent:Ht,ModalFichaCliente:Rt},setup(e,a){const o=(0,v.oR)(),l=(0,D.iH)(null),n=((0,D.iH)(0),(0,D.iH)()),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),c=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),u=((0,t.Fl)((()=>d.value&&void 0!=c.value&&null!=c.value&&d.value[c.value]?d.value[c.value]:null)),(0,t.Fl)((()=>o.state.Cestas.arrayCestas))),m=(0,t.Fl)((()=>{if(u.value)for(let e=0;e<u.value.length;e++)if(d.value&&d.value[c.value]&&u.value[e]._id==d.value[c.value].idCesta)return u.value[e];return null}));function p(){l.value=!0}async function f(){if(u.value&&m.value)for(let e=0;e<u.value.length;e++)if(u.value[e]._id===m.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}l.value=!1}a.expose({abrirModal:p});const b=()=>{s.value.abrirModal(m.value.idCliente)};function C({nombre:e,descuento:a}){m.value.nombreCliente=e,o.dispatch("Cestas/setDescuentoAction",Number(a/100))}return(0,t.JJ)("cambiosClientes",C),{modalClientesSeleccionado:l,arrayClientes:n,cesta:m,resetGeneral:f,refModalEncargos:i,refModalDeudas:r,ficha:b,refModalFichaCliente:s,cambiosCliente:C}}};const Zt=(0,T.Z)($t,[["render",So],["__scopeId","data-v-2812fcbe"]]);var qt=Zt,Lt={name:"MenuIzquierdaComponent",components:{MDBBtnGroup:h.Ff,MDBBtn:h.$v,MDBIcon:h.vm,ModalClientesComponent:no.Z,ModalArticulosComponent:Mo,ModalUnidadesComponent:Ao,CestaComponentVue:Qa,ModalClientesSeleccionadoComponent:qt},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,t.Fl)((()=>o.state.Configuracion.parametros)),n=(0,D.iH)(null),i=(0,D.iH)(null),r=(0,D.iH)(null),s=(0,D.iH)(null),d=(0,D.iH)(null),c=(0,D.iH)(null),u=(0,t.Fl)((()=>o.state.EstadoDinamico.vistaEspecial)),m=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),p=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),f=(0,t.Fl)((()=>o.state.Cestas.indexItemActivo)),b=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo));let C="";const g=(0,D.iH)(!1),w=(0,t.Fl)((()=>{if(m.value)for(let e=0;e<m.value.length;e++)if(p.value&&p.value[b.value]&&m.value[e]._id==p.value[b.value].idCesta)return m.value[e];return null}));function _(){null!=f.value&&void 0!=f.value&&w.value&&o.dispatch("Cestas/deleteIndex",{index:f.value,idCesta:w.value._id})}async function M(){w.value&&(o.dispatch("Cestas/deleteLista",w.value._id),await k.Z.post("impresora/saludo").catch((e=>{x().fire("Oops...",e.message,"error")})))}function y(){u.value?o.dispatch("EstadoDinamico/setVistaCliente",!1):o.dispatch("EstadoDinamico/setVistaCliente",!0)}function h(e){lo.Z.push(e)}function B(e){k.Z.post("clientes/consultarPuntos",{idCliente:e}).then((e=>{if("number"!==typeof e.data)throw Error("No se ha podido obtener la información del cliente");x().fire(`Puntos: ${e.data}`,"","info")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function A(){if(m.value&&w.value)for(let e=0;e<m.value.length;e++)if(m.value[e]._id===w.value._id){if(o.dispatch("Unidades/setUnidades",1),"DEVOLUCION"==w.value.modo)k.Z.post("cestas/fulminarCesta",{idCesta:w.value._id}).then((e=>{if(!e.data)throw Error("No se ha podido eliminar la cesta en el servidor")})).catch((e=>{x().fire("Oops...",e.message,"error")}));else if(m.value&&w.value)for(let e=0;e<m.value.length;e++)if(m.value[e]._id===w.value._id){o.dispatch("Unidades/setUnidades",1),await o.dispatch("Cestas/setModoCesta",{index:e,modo:"VENTA"}),o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}o.dispatch("Cestas/setClienteCesta",{index:e,idCliente:null,nombreCliente:null}),o.dispatch("EstadoDinamico/reset");break}}function T(e){k.Z.post("clientes/getClienteByNumber",{idTarjeta:e}).then((e=>{e.data?n.value.selectCliente(e.data.id,e.data.nombre):x().fire({icon:"error",title:"No lo hemos podido leer correctamente, reintentalo de nuevo.",showConfirmButton:!1,timer:1500})})).catch((e=>{}))}function z(e){return"Shift"==e?null:"Enter"==e?(T(C),void(C="")):void(C+=e)}function E(){k.Z.post("tickets/getUltimoTicket").then((e=>{e.data[0]?._id?(c.value=e.data[0]._id,k.Z.post("impresora/imprimirTicket",{idTicket:c.value}).catch((e=>{x().fire("Oops...",e.message,"error")}))):x().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}return a({resetGeneral:A}),(0,t.bv)((()=>{w.value&&(w.value.idCliente||"VENTA"!=w.value.modo)&&o.dispatch("EstadoDinamico/setVistaCliente",!0),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirBuscarArticulos?"Si"==e.data?.params?.prohibirBuscarArticulos&&(g.value=!0):g.value=!1}))})),{indexActivoCesta:f,borrarItem:_,borrarLista:M,vistaEspecial:u,changeVistaCliente:y,cesta:w,goTo:h,refModalClientes:n,refModalArticulos:i,refModalUnidades:r,CestaComponent:s,resetGeneral:A,consultarPuntos:B,parametros:l,NoBuscarProducte:g,imprimirUltimoTicket:E,idTicket:c,getTarjetaCliente:z,tarjetaClienteNumero:C,refModalClientesSeleccionado:d}},methods:{onKeydown(e){if("Shift"==e.key)return null;this.getTarjetaCliente(e.key)}},mounted(){document.addEventListener("keydown",this.onKeydown)}};const Yt=(0,T.Z)(Lt,[["render",to],["__scopeId","data-v-46586458"]]);var Gt=Yt;const Jt=e=>((0,t.dD)("data-v-53a59afe"),e=e(),(0,t.Cn)(),e),Kt={class:"row"},Qt={class:"nombreMesa d-inline-block text-truncate"},Xt={key:0},el={key:1},al=["selected","value"],ol={class:"row"},tl={class:"disponible"},ll={class:"nodisponible"},nl={class:"again"},il={class:"esperandoVenta"},rl={key:4,class:"d-inline text-center grupoContento pt-1"},sl=Jt((()=>(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"100",height:"35"},null,-1))),dl=[sl],cl={key:5,class:"d-inline text-center caritasContentas grupoContento pt-1"},ul={key:6,class:"d-inline text-center caritasTristes grupoTriste pt-1"},ml={class:"row mt-1"},pl=Jt((()=>(0,t._)("span",{class:"letraTotal ms-3 mt-2"},null,-1))),vl={class:"letraTotal ms-3 mt-2"},fl={class:"text-start fst-italic informacion"},bl={class:"nomTienda"};function Cl(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBIcon"),c=(0,t.up)("modalCobroViewVue");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",Kt,[(0,t._)("div",Qt,[l.cesta&&l.cesta.indexMesa>=0&&l.arrayMesas[l.cesta.indexMesa]?((0,t.wg)(),(0,t.iD)("span",Xt,(0,d.zw)(l.arrayMesas[l.cesta?.indexMesa].nombre),1)):(0,t.kq)("",!0),(l.cesta||l.cesta?.indexMesa||l.arrayMesas)&&l.arrayMesas[l.cesta?.indexMesa]?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",el,(0,d.zw)(e.$t("en_tu_cesta","En tu cesta")),1))]),(0,t._)("select",{class:"nombreTrabajador selecTrabajador",onChange:a[0]||(a[0]=e=>l.selectDependienta(e))},[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.arrayTrabajadores,((e,a)=>((0,t.wg)(),(0,t.iD)("option",{dropdownDirection:"up",selected:l.arrayTrabajadores[a]==l.trabajadorActivo,value:a},(0,d.zw)(l.arrayTrabajadores[a].nombre),9,al)))),256))],32)]),(0,t._)("div",ol,["ONLINE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:0,onClick:a[1]||(a[1]=e=>l.datafonoDisponible()),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",tl,(0,d.zw)(e.$t("datafono_disponible","Datáfono disponible")),1)])),_:1})),"OFFLINE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:1,onClick:a[2]||(a[2]=e=>l.datafonoDisponible()),outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",ll,(0,d.zw)(e.$t("datafono_disponible","Datáfono no disponible")),1)])),_:1})),"AGAIN"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:2,outline:"warning",class:"botonEstado",onClick:a[3]||(a[3]=e=>l.tarjetaUltimoTicket())},{default:(0,t.w5)((()=>[(0,t._)("span",nl,(0,d.zw)(e.$t("reintentar_pago","Reintentar pago")),1)])),_:1})),"PENDIENTE"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonEstado"},{default:(0,t.w5)((()=>[(0,t._)("span",il,(0,d.zw)(l.procesoDatafono),1)])),_:1})),"BUSCANDO"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",rl,dl)),"APROBADA"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",cl,[(0,t.Wm)(s,{class:"d-inline",icon:"grin-alt",iconStyle:"far",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"2x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"grin-alt",iconStyle:"far",size:"2x"})])),"DENEGADA"!==l.estadoDatafono||l.use3g?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",ul,[(0,t.Wm)(s,{class:"d-inline",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"}),(0,t.Wm)(s,{class:"d-inline ms-2",icon:"frown",iconStyle:"far",size:"3x"})]))]),(0,t._)("div",ml,[l.cesta&&l.getTotal(l.cesta)>0&&"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&("CONSUMO_PERSONAL"===l.cesta.modo||"DEVOLUCION"===l.cesta.modo)?((0,t.wg)(),(0,t.j4)(r,{key:0,outline:"primary",class:"botonPagar",onClick:a[4]||(a[4]=e=>l.handleCobro())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),pl])),_:1})):l.cesta&&l.getTotal(l.cesta)>0&&"CONSUMO_PERSONAL"!==l.cesta.modo?((0,t.wg)(),(0,t.j4)(r,{key:1,outline:"primary",class:"botonPagar",onClick:a[5]||(a[5]=e=>l.handleCobro())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"}),(0,t._)("span",vl,(0,d.zw)(l.getTotal(l.cesta).toFixed(2))+" € ",1)])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"==l.modoActual?((0,t.wg)(),(0,t.j4)(r,{key:2,onClick:a[6]||(a[6]=e=>l.finalizarEdicion()),outline:"primary",class:"botonPagar"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{size:"5x",far:"",icon:"thumbs-up"})])),_:1})):(0,t.kq)("",!0),"MODIFICAR_ARTICULO"!=l.modoActual&&"MOVER_ARTICULO"!=l.modoActual&&l.cesta&&0===l.getTotal(l.cesta)?((0,t.wg)(),(0,t.j4)(r,{key:3,outline:"primary",class:"botonPagar",onClick:a[7]||(a[7]=e=>l.abrirCajon())},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{icon:"hand-holding-usd",size:"5x"})])),_:1})):(0,t.kq)("",!0),(0,t._)("span",fl,[(0,t.Uk)("("+(0,d.zw)(l.conexionInternet)+")(v"+(0,d.zw)(l.tocVersion)+") (",1),(0,t._)("a",bl,(0,d.zw)(l.nombreTienda),1),(0,t.Uk)(") "+(0,d.zw)(l.getClock),1)])]),(0,t.Wm)(c,{ref:"modalCobroViewVueRef"},null,512)],64)}const gl={class:"row"},wl={class:"row mt-2"},_l={class:"col-md-3"},Ml={key:0,class:"sizeLetrasCambio"},yl={class:"sizeLetrasCambio"},hl={key:1,class:"estiloFalta sizeLetrasCambio"},Dl={key:2,class:"estiloPerfecto sizeLetrasCambio"},kl={key:3,class:"estiloSobra sizeLetrasCambio"},Bl={class:"col-md-9"},xl={class:"row"},Al={class:"col text-end"},Tl=["src","onClick"],zl={class:"row mt-2"},El={class:"col text-end"},Il=["src","onClick"],Ul={class:"row mt-4"},Vl={class:"divBotones"},Sl={class:"row"},Hl={class:"cantidad text-center"},Fl={class:"row mt-2"},jl={class:"col text-center"},Wl={class:"input-group position-absolute bottom-0 start-0"},Ol={class:"position-absolute bottom-0 end-0"},Nl={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Pl(e,a,o,l,n,i){const r=(0,t.up)("MDBCardTitle"),s=(0,t.up)("MDBCardText"),c=(0,t.up)("MDBBtn"),u=(0,t.up)("MDBCardBody"),m=(0,t.up)("MDBCard"),p=(0,t.up)("ModalTkrsComponent"),v=(0,t.up)("NumpadComponent"),f=(0,t.up)("MDBModalBody"),b=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(b,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:l.modalCobro,"onUpdate:modelValue":a[9]||(a[9]=e=>l.modalCobro=e),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{style:{"background-color":"#fff5e9"}},{default:(0,t.w5)((()=>[(0,t._)("div",gl,[(0,t._)("div",wl,[(0,t._)("div",_l,[(0,t.Wm)(m,{class:"cardInfoCambio"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("informacion_cambio","Información cambio")),1)])),_:1}),(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[null!=l.cantidadTkrs&&void 0!=l.cantidadTkrs?((0,t.wg)(),(0,t.iD)("li",Ml,(0,d.zw)(e.$t("dinero_recibido","Dinero recibido:"))+" "+(0,d.zw)(Number(l.totalRecibido+l.cantidadTkrs).toFixed(2))+" € ",1)):(0,t.kq)("",!0),(0,t._)("li",yl,(0,d.zw)(e.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,d.zw)((Math.round(100*l.aPagar)/100).toFixed(2))+" € ",1),null!=l.cuenta&&void 0!=l.cuenta&&l.cuenta>0?((0,t.wg)(),(0,t.iD)("li",hl,(0,d.zw)(e.$t("faltan","Faltan"))+" "+(0,d.zw)((Math.round(100*l.cuenta)/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0),null!=l.cuenta&&void 0!=l.cuenta&&0==l.cuenta?((0,t.wg)(),(0,t.iD)("li",Dl,(0,d.zw)(e.$t("cambio_perfecto","Cambio perfecto")),1)):(0,t.kq)("",!0),null!=l.cuenta&&void 0!=l.cuenta&&l.cuenta<0?((0,t.wg)(),(0,t.iD)("li",kl,(0,d.zw)(e.$t("sobran","Sobran"))+" "+(0,d.zw)((Math.round(100*(l.aPagar-l.totalRecibido))/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(c,{size:"lg",color:"warning",onClick:a[0]||(a[0]=e=>l.deshacer()),class:"sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("desahcer","Deshacer")),1)])),_:1}),(0,t.Wm)(c,{size:"lg",color:"danger",class:"sizeBotones",onClick:a[1]||(a[1]=e=>l.limpiar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)(e.$t("limpiar","Limpiar")),1)])),_:1})])),_:1})])),_:1})]),(0,t._)("div",Bl,[(0,t._)("div",xl,[(0,t._)("div",Al,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)([.01,.02,.05,.1,.2,.5,1,2],(e=>((0,t.wg)(),(0,t.iD)("img",{src:"/img/"+(e<1?100*e+"cts":1==e?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:a=>l.sumar(e)},null,8,Tl)))),256))])]),(0,t._)("div",zl,[(0,t._)("div",El,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([5,10,20,50,100,200,500],(e=>(0,t._)("img",{src:"/img/"+e+"euros.png",class:"sizeBilletes",onClick:a=>l.sumar(e)},null,8,Il))),64))])])])])]),(0,t._)("div",Ul,[(0,t._)("div",Vl,[(0,t._)("img",{src:"img/img-efectivo.png",onClick:a[2]||(a[2]=e=>l.setFormaPago("EFECTIVO")),style:(0,d.j5)("EFECTIVO"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,4),l.modalTkrsRef&&!l.prohibirTkRestaurant?((0,t.wg)(),(0,t.iD)("img",{key:0,src:"img/img-tkrs.png",onClick:a[3]||(a[3]=e=>l.modalTkrsRef.abrirModal()),style:(0,d.j5)("TKRS"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,4)):(0,t.kq)("",!0),0===l.tipoDatafono3G?((0,t.wg)(),(0,t.iD)("img",{key:1,src:"img/img-tarjetas.png",onClick:a[4]||(a[4]=e=>l.setFormaPago("TARJETA")),style:(0,d.j5)("TARJETA"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,4)):(0,t.kq)("",!0),1===l.tipoDatafono3G?((0,t.wg)(),(0,t.iD)("img",{key:2,src:"img/img-3g.png",onClick:a[5]||(a[5]=e=>l.setFormaPago("DATAFONO_3G")),style:(0,d.j5)("DATAFONO_3G"===l.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,4)):(0,t.kq)("",!0)])]),(0,t.Wm)(p,{ref:"modalTkrsRef"},null,512),(0,t.Wm)(b,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:l.modalNumpad,"onUpdate:modelValue":a[6]||(a[6]=e=>l.modalNumpad=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t._)("div",Sl,[(0,t._)("span",Hl,(0,d.zw)(),1)]),(0,t._)("div",Fl,[(0,t._)("div",jl,[(0,t.Wm)(v,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,t._)("div",Wl,[(0,t._)("button",{class:"btn btn-warning ms-2",style:{"font-size":"27px"},onClick:a[7]||(a[7]=e=>l.cancelarVenta())},(0,d.zw)(e.$t("volver","VOLVER")),1)]),(0,t._)("div",Ol,[(0,t.Wm)(c,{class:(0,d.C_)(["botonCobrar",{disabled:l.loading}]),color:"primary",onClick:a[8]||(a[8]=e=>l.cobrar())},{default:(0,t.w5)((()=>[l.loading?((0,t.wg)(),(0,t.iD)("span",Nl)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,d.zw)(e.$t("pagar","Pagar")),1)])),_:1},8,["class"])])])),_:1})])),_:1},8,["modelValue"])}var Rl=o(9066),$l=o(2374),Zl=o(8020),ql={name:"CobroView",components:{CambioComponent:Rl.Z,MDBCard:h.Yl,MDBBtn:h.$v,MDBCardBody:h.H7,MDBCardText:h.Pp,NumpadComponent:G.Z,VolverComponent:$l.Z,ModalTkrsComponent:Zl.Z,MDBIcon:h.vm,MDBModal:h.j3,MDBModalBody:h.Yz},setup(e,{expose:a}){const o=(0,v.oR)(),l=(0,D.iH)(!1),n=(0,D.iH)(!1),i=((0,wa.tv)(),(0,D.iH)(null)),r=(0,D.iH)("EFECTIVO"),s=(0,D.iH)(0),d=(0,D.iH)(null),c=(0,D.iH)(!1),u=(0,D.iH)(!1),m=(0,D.iH)(0),p=(0,D.iH)(!1),f=(0,D.iH)(0),b=(0,D.iH)(0),C=(0,D.iH)([]),g=(0,D.iH)(null);let w=(0,t.Fl)((()=>b.value-m.value<0?0:b.value-(f.value+m.value)));const _=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),M=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),y=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),h=(0,t.Fl)((()=>o.state.Cestas.Descuento)),B=(0,t.Fl)((()=>M.value&&void 0!=_.value&&null!=_.value&&M.value[_.value]?M.value[_.value]:null));let A=(0,D.iH)(null);function T(e){m.value=Number(e),e>=S(A.value)?r.value="TKRS":r.value="EFECTIVO"}function z(e){m.value<S(A.value)?"TARJETA"===e&&m.value>0?x().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):r.value=e:x().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error")}async function E(e){A=(0,t.Fl)((()=>{if(y.value)for(let e=0;e<y.value.length;e++)if(y.value[e]._id==M.value[_.value].idCesta)return y.value[e];return null})),b.value=S(A.value),g.value=(await k.Z.post("clientes/getClienteById",{idCliente:A.value.idCliente})).data,l.value=!0}async function I(){p.value=!0;try{const e=await k.Z.post("tickets/crearTicket",{total:S(A.value),idCesta:A.value._id,idTrabajador:B.value._id,tipo:r.value,tkrsData:{cantidadTkrs:m.value,formaPago:"EFECTIVO"}});if(!e.data)throw Error("No se ha podido crear el ticket");await k.Z.post("impresora/saludo").catch((e=>{x().fire("Oops...",e.message,"error")})),g.value?.albaran&&(await k.Z.post("impresora/imprimirTicket",{idTicket:e.data}).catch((e=>{x().fire("Oops...",e.message,"error")})),await k.Z.post("impresora/firma",{idTicket:e.data}).catch((e=>{x().fire("Oops...",e.message,"error")}))),u.value&&await k.Z.post("tickets/getUltimoTicket").then((async e=>{e.data[0]?._id?await k.Z.post("impresora/imprimirTicket",{idTicket:e.data[0]?._id}).catch((e=>{x().fire("Oops...",e.message,"error")})):x().fire("AVISO","Crea un ticket en esta caja abierta","info")})),"PAGO SEPARADO"==A.value.modo&&await V(A.value._id),"TARJETA"===r.value&&o.dispatch("Datafono/setEstado","PENDIENTE"),l.value=!1}catch(e){x().fire("Oops...",e.message,"error")}p.value=!1,j()}async function U(){l.value=!1,j(),"PAGO SEPARADO"==A.value.modo&&await k.Z.post("cestas/DevolverProductosACestaSep",{cesta:o.getters["Cestas/getCestaBaseActivo"],articulos:A.value.lista}).then((e=>{V(A.value._id)}))}async function V(e){k.Z.post("cestas/fulminarCesta",{idCesta:e}).catch((e=>{x().fire({icon:"error",title:"Error al eliminar la cesta (Pago dividido)",showConfirmButton:!1,timer:500})})),await k.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:M.value[o.state.Trabajadores.indexActivo]._id}).then((e=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}function S(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return a-a*h.value}function H(e){f.value+=e,C.value.push(e)}function F(){C.value.pop();let e=0;C.value.forEach((a=>{e+=a})),f.value=e}function j(){f.value=0,m.value=0,C.value=[],w=(0,t.Fl)((()=>b.value-m.value<0?0:b.value-(f.value+m.value)))}function W(e){b.value=Number(e)}return(0,t.JJ)("setTkrs",T),a({abrirModal:E}),(0,t.bv)((()=>{k.Z.post("parametros/getParametros").then((e=>{"3G"!==e.data?.tipoDatafono&&"0.0.0.0"!=e.data?.ipTefpay||(s.value=1)})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.SempreTicket?"Si"==e.data?.params?.SempreTicket&&(u.value=!0):u.value=!1})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.prohibirTkRestaurant?"Si"==e.data?.params?.prohibirTkRestaurant&&(c.value=!0):c.value=!1}))})),{DescuentoCliente:h,cesta:A,getTotal:S,cobrar:I,formaPago:r,modalTkrsRef:d,prohibirTkRestaurant:c,setFormaPago:z,loading:p,tipoDatafono3G:s,eliminarAlPagarFnc:V,modalNumpad:n,cancelarVenta:U,modalCobro:l,abrirModal:E,sumar:H,totalRecibido:f,aPagar:b,numPadRef:i,deshacer:F,limpiar:j,setTkrs:T,cantidadTkrs:m,setAPagar:W,cuenta:w}}};const Ll=(0,T.Z)(ql,[["render",Pl],["__scopeId","data-v-35b7c1f3"]]);var Yl=Ll,Gl={name:"MenuDerechaComponent",components:{MDBIcon:h.vm,MDBBtn:h.$v,MDBSelect:h.R3,modalCobroViewVue:Yl},setup(){const e=(0,D.iH)(""),a=(0,D.iH)(""),o=(0,D.iH)(""),l=(0,v.oR)(),n=(0,D.iH)(!1),i=(0,D.iH)(!1),r=(0,D.iH)(null),s=(0,wa.tv)(),d=(0,D.iH)([]),c=(0,t.Fl)((()=>l.state.Cestas.Descuento)),u=(0,t.f3)("resetGeneral"),m=(0,D.iH)("");async function p(){k.Z.get("https://santaana2-elb.nubehit.com:3001",{timeout:5e3}).then((()=>{m.value="🟢"})).catch((()=>{m.value="🔴"}))}p(),setInterval(p,1e4);const f=(0,t.Fl)((()=>l.state.Trabajadores.arrayTrabajadores)),b=(0,t.Fl)((()=>l.state.Cestas.arrayCestas)),C=(0,t.Fl)((()=>l.state.Trabajadores.indexActivo)),g=(0,t.Fl)((()=>l.state.Datafono.estado)),w=(0,t.Fl)((()=>l.state.Datafono.procesoActual)),_=(0,t.Fl)((()=>l.state.modoActual)),M=(0,t.Fl)((()=>f.value&&void 0!=C.value&&null!=C.value&&f.value[C.value]?f.value[C.value]:null)),y=(0,t.Fl)((()=>{if(b.value)for(let e=0;e<b.value.length;e++)if(f.value&&f.value[C.value]&&b.value[e]._id==f.value[C.value].idCesta)return b.value[e];return null}));function h(e){l.dispatch("Trabajadores/setIndexActivo",Number(e.target.value)),E("/main")}function B(e){A();let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5;return Number(a-a*c.value)}async function A(){if(!y?.value?.idCliente)return l.dispatch("Cestas/setDescuentoAction",0);await k.Z.post("clientes/isClienteDescuento",{idCliente:y.value.idCliente}).then((e=>e.data?l.dispatch("Cestas/setDescuentoAction",Number(e.data/100)):l.dispatch("Cestas/setDescuentoAction",0)))}function T(){k.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");d.value=e.data})).catch((e=>{x().fire("Oops...",e.message,"error")}))}function z(){"PENDIENTE"!=g.value&&(l.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad").then((e=>l.dispatch("Datafono/setEstado",e.data))).catch((e=>l.dispatch("Datafono/setEstado","OFFLINE"))))}function E(e){s.push(e)}function I(){i.value||(k.Z.post("impresora/abrirCajon"),x().fire("AVISO","elige un artículo para ir a cobrar","info"))}function U(){l.dispatch("setModoActual","NORMAL")}function V(){k.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:M.value._id}).then((()=>{l.dispatch("Datafono/setEstado","PENDIENTE")})).catch((e=>{x().fire("Oops...",e.message,"error")}))}async function S(){if(y.value)if("VENTA"===y.value.modo)if(y.value.idCliente&&""!=y.value.idCliente){const e=(await k.Z.post("clientes/getClienteById",{idCliente:y.value.idCliente})).data;e?.albaran&&e?.noPagaEnTienda?k.Z.post("tickets/crearTicket",{total:B(y.value),idCesta:y.value._id,idTrabajador:M.value._id,tipo:"DEUDA",tkrsData:null}).then((e=>{if(!e.data)throw Error("No se ha podido registrar la venta en modo deuda");x().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:2e3})})).catch((e=>{x().fire("Oops...",e.message,"error")})):r.value.abrirModal()}else await k.Z.post("impresora/despedida",{precioTotal:B(y.value).toFixed(2)}),r.value.abrirModal();else"DEVOLUCION"===y.value.modo?k.Z.post("devoluciones/nuevaDevolucion",{total:B(y.value),idCesta:y.value._id,idTrabajador:M.value._id}).then((async e=>{if(!e.data)throw Error("No se ha podido crear la devolución");await x().fire({icon:"success",title:"Devolución creada correctamente",showConfirmButton:!1,timer:2e3}),u()})).catch((e=>{x().fire("Oops...",e.message,"error")})):"CONSUMO_PERSONAL"===y.value.modo&&k.Z.post("tickets/crearTicket",{total:B(y.value),idCesta:y.value._id,idTrabajador:M.value._id,tipo:"CONSUMO_PERSONAL"}).then((e=>{if(!e.data)throw Error("No se ha podido crear el ticket de consumo personal");u(),x().fire({icon:"success",title:"Consumo personal registrado",showConfirmButton:!1,timer:1200})})).catch((e=>{x().fire("Oops...",e.message,"error")}));else x().fire("Oops...","El modo de la cesta es incorrecto","error")}function H(){const e=new Date,a=e.getSeconds(),t=e.getMinutes(),l=e.getHours();o.value=("0"+l).substr(-2)+":"+("0"+t).substr(-2)+":"+("0"+a).substr(-2)}return setInterval(H,1e3),(0,t.bv)((()=>{T(),z(),k.Z.get("getInfo/tocGame").then((o=>{void 0!=o.data&&null!=o.data&&(e.value=o.data.version,a.value=o.data.nombreTienda)})).catch((e=>{x().fire("Error en getVersion CATCH")})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.params?.CalaixTancat?"Si"==e.data?.params?.CalaixTancat&&(i.value=!0):i.value=!1})),k.Z.post("parametros/getParametros").then((e=>{void 0!=e.data?.tipoDatafono?"3G"==e.data?.tipoDatafono&&(n.value=!0):n.value=!1}))})),A(),{trabajadorActivo:M,DescuentoCliente:c,estadoDatafono:g,DescuentoCliente:c,cesta:y,arrayMesas:d,getTotal:B,goTo:E,abrirCajon:I,tarjetaUltimoTicket:V,modoActual:_,handleCobro:S,tocVersion:e,nombreTienda:a,getClock:o,finalizarEdicion:U,datafonoDisponible:z,procesoDatafono:w,isDescuento:A,use3g:n,selectDependienta:h,modalCobroViewVueRef:r,arrayTrabajadores:f,conexionInternet:m}}};const Jl=(0,T.Z)(Gl,[["render",Cl],["__scopeId","data-v-53a59afe"]]);var Kl=Jl,Ql=o(2066),Xl=o(4286);const en={class:"container"},an={class:"h3 text-center"},on={key:0,class:"row mt-2 container"},tn=(0,t._)("div",{class:"d-inline text-center grupoContento pt-1"},[(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"600"})],-1),ln={class:"h5",style:{"text-align":"center"}},nn={key:1,class:"row mt-2 container"},rn={class:"h3"},sn={key:0,class:"d-inline text-center grupoContento pt-1"},dn=(0,t._)("img",{src:"pay-loading.svg",alt:"Buscando Datáfono",width:"200",height:"60"},null,-1),cn=[dn],un={key:1,class:"h5",style:{"text-align":"center",color:"red"}},mn={class:"again py-5"},pn={class:"again py-5"};function vn(e,a,o,l,n,i){const r=(0,t.up)("MDBBtn"),s=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBModal"),u=(0,t.up)("ModalErrorDatafonoQueHacerComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(c,{id:"modalDatafonoConexion",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:l.modalDatafonoConexion,"onUpdate:modelValue":a[2]||(a[2]=e=>l.modalDatafonoConexion=e),staticBackdrop:"",size:"xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t._)("div",en,[(0,t._)("p",an,(0,d.zw)(e.$t("error_conexion_datafono","Error con la conexión del datafono")),1)]),l.conexionAutomatica?((0,t.wg)(),(0,t.iD)("div",on,[tn,(0,t._)("span",ln,"Estamos intentando reconectarnos al datáfono automáticamente: "+(0,d.zw)(l.counterAutomatico)+" segundos restantes...",1)])):(0,t.kq)("",!0),l.conexionAutomatica?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",nn,[(0,t._)("p",rn,(0,d.zw)(e.$t("seleccione","seleccione"))+":",1),l.tryCount>0?((0,t.wg)(),(0,t.iD)("div",sn,cn)):(0,t.kq)("",!0),l.tryCount>3?((0,t.wg)(),(0,t.iD)("span",un,"Imposible conectarse con el datáfono")):(0,t.kq)("",!0),l.tryCount<=0?((0,t.wg)(),(0,t.j4)(r,{key:2,color:"warning",size:"lg",class:"botonEstado my-3",onClick:a[0]||(a[0]=e=>l.reconectarDatafon())},{default:(0,t.w5)((()=>[(0,t._)("span",mn,(0,d.zw)(e.$t("esperar_datafono","Reconectar datáfono")),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(r,{color:"danger",size:"lg",class:"botonEstado my-3",onClick:a[1]||(a[1]=e=>l.apagarDatafono())},{default:(0,t.w5)((()=>[(0,t._)("span",pn,(0,d.zw)(e.$t("apagar_datafono","Apagar datáfono")),1)])),_:1})]))])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{ref:"ModalErrorQueHacerRef"},null,512)],64)}var fn={name:"modalDatafonoConexion",components:{MDBModal:h.j3,MDBModalBody:h.Yz,MDBBtn:h.$v,ModalErrorDatafonoQueHacerComponent:Xl.Z},setup(e,{expose:a}){const o=(0,D.iH)(0),l=(0,D.iH)(!0),n=(0,D.iH)(0),i=(0,D.iH)(null),r=(0,t.Fl)((()=>s.state.Datafono.estado)),s=(0,v.oR)(),d=(0,D.iH)(0),c=(0,D.iH)(!1),u=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),m=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo));(0,t.Fl)((()=>u.value&&void 0!=m.value&&null!=m.value&&u.value[m.value]?u.value[m.value]:null));function p(e){d.value=e,c.value=!0,b(),s.dispatch("Datafono/setEstado","OFFLINE")}async function f(){try{x().fire({title:"¿Quieres desactivar el datáfono?",text:"¡Esto desactivará el pago con datáfono!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"green",confirmButtonText:"Desactivar",cancelButtonText:"Cancelar",backdrop:'\n            rgba(255,0,0,0.2)\n            url("/images/nyan-cat.gif")\n            left top\n            no-repeat'}).then((async e=>{if(e.isConfirmed){const e=await k.Z.post("parametros/setIpPaytef",{ip:"0.0.0.0"});if(!e.data)throw Error("Error al guardar la IP del datafono.");x().fire("OK","¡El datáfono se ha apagado correctamente!","success"),c.value=!1}}))}catch(e){x().fire("Oops...",e.message,"error")}}async function b(){n.value=60;let e=setInterval((async()=>{n.value-=1,await k.Z.post("paytef/comprobarDisponibilidad").then((async a=>{"ONLINE"===a.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((a=>{clearInterval(e),i.value.abrirModal(d.value,a.data),c.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE"))))})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE"))),n.value<=0&&(clearInterval(e),x().fire("Oops...","¡No nos hemos podido conectar al datáfono!","error"),l.value=!1)}),1e3)}async function C(){o.value+=1,s.dispatch("Datafono/setEstado","BUSCANDO"),k.Z.post("paytef/comprobarDisponibilidad").then((async e=>"OFFLINE"===e.data&&o.value<10?C():(o.value=0,"ONLINE"===e.data&&(s.dispatch("Datafono/setEstado","ONLINE"),await k.Z.post("paytef/comprobarUltimoTicket",{idticket:d.value}).then((e=>{i.value.abrirModal(d.value,e.data),c.value=!1})).catch((e=>s.dispatch("Datafono/setEstado","OFFLINE")))),s.dispatch("Datafono/setEstado","OFFLINE")))).catch((e=>(o.value+=1,s.dispatch("Datafono/setEstado","OFFLINE"))))}return(0,t.bv)((()=>{})),a({abrirModal:p}),{store:s,abrirModal:p,modalDatafonoConexion:c,apagarDatafono:f,reconectarDatafon:C,estadoDatafono:r,tryCount:o,ModalErrorQueHacerRef:i,conexionAutomatica:l,counterAutomatico:n}}};const bn=(0,T.Z)(fn,[["render",vn]]);var Cn=bn,gn=(o(2781),{name:"MainView",components:{MenusComponent:V,SubmenusComponent:P,TeclasComponent:ya,CestaComponent:Qa,MenuIzquierdaComponent:Gt,MenuDerechaComponent:Kl,modalDatafonoConexion:Cn,ModalErrorDatafonoVentaComponent:Xl.Z},setup(){const e=(0,wa.tv)(),a=(0,D.iH)(null),o=(0,D.iH)(null),l=(0,D.iH)(null),n=(0,D.iH)(null),i=(0,D.iH)(null);function r(e){a.value.clickTecla(e)}const s=(0,v.oR)(),d=(0,Ql.io)("http://"+s.state.TocGameURL+":5051"),c=(0,t.Fl)((()=>s.state.Trabajadores.arrayTrabajadores)),u=(0,t.Fl)((()=>s.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null));function p(){o.value.resetGeneral()}function f(){l.value.actualizarPuntos()}return(0,t.JJ)("clickTecla",r),(0,t.JJ)("resetGeneral",p),(0,t.JJ)("actualizarPuntos",f),d.on("consultaPaytefRefund",(e=>{try{e.ok||n.value.abrirModal(e.id)}catch(a){}})),(0,t.bv)((()=>{k.Z.get("caja/estadoCaja").then((a=>{1==a.data&&x().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==s.getters["Trabajadores/getTrabajadorActivo"]?._id&&e.push("/menu/fichajes"):e.push("/abrirCaja")})).catch((e=>{x().fire("Oops...",e.message,"error")}))})),{arrayTrabajadores:c,indexTrabajadorActivo:u,trabajadorActivo:m,refTeclasComponent:a,refMenuIzquierda:o,cestaRef:l,modalErrorConexionDatafonoRef:n,modalErrorVentaDatafonoRef:i}}});const wn=(0,T.Z)(gn,[["render",s]]);var _n=wn}}]);
//# sourceMappingURL=569.3f8b3e93.js.map