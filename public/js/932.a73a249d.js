"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[932],{34658:function(e,o,t){t.r(o),t.d(o,{default:function(){return O}});var a=t(73396),l=t(87139),r=t(49242);const n=e=>((0,a.dD)("data-v-0952efee"),e=e(),(0,a.Cn)(),e),d={id:"main"},i={id:"vueMenuPedido"},s={class:"pedidos"},u={class:"text-center m-auto pt-3 h5"},c={class:""},p=n((()=>(0,a._)("hr",{class:"hrPedido"},null,-1))),m={class:"productos"},v={key:0,style:{"overflow-y":"scroll",height:"28vh"}},_={class:"ms-5 h6"},g={class:"d-flex flex-column juatify-content-center"},C={style:{"max-width":"270px"}},h=["onUpdate:modelValue"],b=n((()=>(0,a._)("br",null,null,-1))),D={key:1},M=n((()=>(0,a._)("hr",{class:"hrPedido"},null,-1))),f={class:"pedidos-footer mx-5"},w=n((()=>(0,a._)("h2",{id:"emailHelp",class:"h6"},"Precio total:",-1))),y={class:"mb-0 mt-2"},B={class:""},x=["disabled"];function H(e,o,t,n,H,P){const k=(0,a.up)("ModalClientesComponent");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",d,[(0,a._)("div",i,[(0,a._)("div",null,[(0,a._)("div",s,[(0,a._)("h1",u,(0,l.zw)(e.$t("pedido_nuevo","Pedido nuevo")),1),(0,a._)("div",c,[p,(0,a._)("div",m,[n.productos.length?((0,a.wg)(),(0,a.iD)("div",v,[(0,a._)("h2",_,(0,l.zw)(e.$t("productos","Productos"))+":",1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.productos,((e,o)=>((0,a.wg)(),(0,a.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:o},[(0,a._)("div",g,[(0,a._)("span",C,"- "+(0,l.zw)(e.nombre),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.arraySuplementos,((e,o)=>((0,a.wg)(),(0,a.iD)("span",{key:o},(0,l.zw)(e.nombre),1)))),128))]),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":o=>e.comentario=o},null,8,h),[[r.nr,e.comentario]])])))),128)),b])):((0,a.wg)(),(0,a.iD)("div",D,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),M,(0,a._)("div",f,[(0,a._)("div",null,[w,(0,a._)("p",y,(0,l.zw)(n.precioTotal)+"€",1)]),(0,a._)("div",B,[(0,a._)("input",{type:"button",value:"Crear pedido",class:"btn btn-primary btn-lg",onClick:o[0]||(o[0]=(...e)=>n.crearPedido&&n.crearPedido(...e)),disabled:n.botonBloqueado},null,8,x)])])])])])])]),(0,a.Wm)(k,{ref:"refModalClientes"},null,512)],64)}t(57658);var P=t(44870),k=t(74313),T=t(20065),j=t(46626),S=t(11424),z=t(42492),$=t.n(z),A=t(87853),I=t(91076),Z=t(6411),E={name:"PedidosComponent",components:{ModalClientesComponent:j.Z,NumpadComponent:S.Z,MDBCard:k.Yl,MDBCardBody:k.H7,MDBCardTitle:k.QM,MDBCardText:k.Pp,MDBBtn:k.$v,MDBCheckbox:k.IH,MDBModal:k.j3,MDBModalHeader:k.ol,MDBModalTitle:k.wo,MDBModalBody:k.Yz,MDBModalFooter:k.ab,MDBIcon:k.vm,MDBLoading:k.J$},setup(){const e=(0,P.iH)(!1),o=(0,P.iH)(null),t=(0,T.oR)(),{t:l}=(0,A.QT)(),r=t.getters["Cestas/getCestaActiva"],n=t.getters["Cestas/getCestaActivaIndex"],d=(0,a.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),i=(0,a.Fl)((()=>t.state.Trabajadores.indexActivo)),s=(0,a.Fl)((()=>d.value&&null!=i.value&&void 0!=i.value&&d.value[i.value]?d.value[i.value]:null)),u=(0,P.iH)(null),c={idCliente:r.idCliente,nombreCliente:r.nombreCliente},p=(0,P.iH)(null),m=(0,P.iH)(r.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),v=(0,P.iH)(null),_=()=>{const e=r.detalleIva,o=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((o,t)=>o+e[t]),0);return Math.round(100*o)/100},g=()=>{if(e.value=!0,!m.value.length)return C(l("toc_game_pedidos_error_no_productos","Tienes que haber al menos un producto para crear el pedido."),"error"),void(e.value=!1);const o=new Date,t=new Date(o);t.setDate(o.getDate()+1);let a=t.getHours(),n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,d=a>=12?"pm":"am";const i={idCliente:u.value.id,nombreCliente:u.value.nombre,opcionRecogida:2,amPm:d,fecha:t.toISOString().slice(0,10),hora:n,dias:[],dejaCuenta:0,total:_(),productos:m.value,cesta:r,idTrabajador:s.value._id,nombreDependienta:s.value.nombre,pedido:!0};I.Z.post("encargos/setEncargo",i).then((({data:o})=>o&&o.msg?o.error?(C(o.msg,"error"),void(e.value=!1)):(e.value=!1,void C(l("toc_game_pedidos_ok","pedido creado!"),"success",h)):(C(l("toc_game_pedidos_error_general","Error general"),"error"),void(e.value=!1)))).catch((o=>{e.value=!1,C(l("toc_game_pedidos_error_general","Error general"),"error")}))},C=(e,o,t=(()=>{}))=>{$().fire("error"===o?"Oops...":"Ok!!",e,o).then((()=>t()))},h=async()=>(await t.dispatch("Cestas/setModoCesta",{index:n,modo:"VENTA"}),t.dispatch("Cestas/setClienteCesta",{index:n,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),t.dispatch("EstadoDinamico/reset"),t.dispatch("Cestas/deleteLista",r._id),b("/main"),Promise.resolve()),b=e=>Z.Z.push(e);return(0,a.bv)((()=>{I.Z.get("clientes/getClientePedidosTienda").then((e=>{u.value=e.data})).catch((e=>{u.value=!1})),v.value=_()})),{refModalClientes:o,cestaActiva:r,clienteData:c,productos:m,crearPedido:g,precioTotal:v,botonBloqueado:e,numpadRef:p}}},Y=t(40089);const F=(0,Y.Z)(E,[["render",H],["__scopeId","data-v-0952efee"]]);var O=F}}]);
//# sourceMappingURL=932.a73a249d.js.map