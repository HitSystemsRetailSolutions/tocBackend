"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[262],{81262:function(e,a,t){t.r(a),t.d(a,{default:function(){return S}});var s=t(73396),l=t(87139);const i=e=>((0,s.dD)("data-v-ae3f0f44"),e=e(),(0,s.Cn)(),e),n={id:"main"},r={id:"vueMenuEncargo"},o={class:"encargos"},c={class:""},d={class:"row"},u=i((()=>(0,s._)("div",{class:"col"},null,-1))),v={class:"col"},p={key:0},m={class:"btnEncargo lgEncargo float-right"},g={key:1,class:"btnEncargo float-right"},_=i((()=>(0,s._)("i",{class:"fas fa-search"},null,-1))),f=i((()=>(0,s._)("hr",null,null,-1))),C={class:"productos"},D={key:0},b={class:"d-flex flex-column py-1"},w={class:"d-flex flex-column justify-content-center"},h={class:""},y={key:1},k={class:"encargos-footer"},T=i((()=>(0,s._)("small",{id:"emailHelp",class:"form-text text-muted"},"Precio total:",-1))),x={class:"mb-0 mt-2"},E={class:""},A={key:0,class:"spinner"},I={key:1,class:"m-0"};function j(e,a,t,i,j,F){const Z=(0,s.up)("MDBBtn");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",r,[(0,s._)("div",null,[(0,s._)("div",o,[(0,s._)("div",c,[(0,s._)("div",d,[u,(0,s._)("div",v,[i.clienteData.idCliente?((0,s.wg)(),(0,s.iD)("h1",p,[(0,s._)("button",m,(0,l.zw)(i.clienteData.nombreCliente),1)])):((0,s.wg)(),(0,s.iD)("button",g,[_,(0,s.Uk)(" Abrir modal cliente ")]))])]),f,(0,s._)("div",C,[i.cestaActiva.lista.length?((0,s.wg)(),(0,s.iD)("div",D,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.cestaActiva.lista,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:a},[(0,s._)("div",b,[(0,s._)("span",null,"- "+(0,l.zw)(e.nombre),1),(0,s._)("div",w,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.arraySuplementos,((e,a)=>((0,s.wg)(),(0,s.iD)("span",{class:"ms-3",key:a},(0,l.zw)(e.nombre),1)))),128))])]),(0,s._)("div",null,[(0,s._)("span",h,(0,l.zw)(e.unidades)+" unidad(es)",1)])])))),128))])):((0,s.wg)(),(0,s.iD)("div",y,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),(0,s._)("div",k,[(0,s._)("div",null,[T,(0,s._)("p",x,(0,l.zw)(i.precioTotal)+"€",1)]),(0,s._)("div",E,[(0,s.Wm)(Z,{color:"primary",onClick:a[0]||(a[0]=e=>i.crearDeuda()),disabled:i.loading,class:"btnSpinner d-flex align-items-center justify-content-center"},{default:(0,s.w5)((()=>[i.loading?((0,s.wg)(),(0,s.iD)("span",A)):((0,s.wg)(),(0,s.iD)("p",I,"Crear deuda"))])),_:1},8,["disabled"])])])])])])])])}t(57658);var F=t(44870),Z=t(74313),z=t(20065),H=t(42492),O=t.n(H),B=t(87853),M=t(44161),N=t(54455),U={name:"DeudasComponent",components:{MDBBtn:Z.$v},setup(){const e=(0,z.oR)(),{t:a}=(0,B.QT)(),t=(0,F.iH)(0),l=(0,s.Fl)((()=>e.state.Cestas.arrayCestas)),i=e.getters["Cestas/getCestaActiva"],n=e.getters["Cestas/getCestaActivaIndex"],r=(0,s.Fl)((()=>e.state.Trabajadores.arrayTrabajadores)),o=(0,s.Fl)((()=>e.state.Trabajadores.indexActivo)),c=(0,s.Fl)((()=>r.value&&null!=o.value&&void 0!=o.value&&r.value[o.value]?r.value[o.value]:null)),d=(0,s.Fl)((()=>{if(l.value)for(let e=0;e<l.value.length;e++)if(l.value[e]._id==r.value[o.value].idCesta)return l.value[e];return null})),u=(0,s.Fl)((()=>e.state.Cestas.Descuento)),v=(0,F.iH)(null),p={idCliente:i.idCliente,nombreCliente:i.nombreCliente},m=(0,F.iH)(!1);function g(e){let a=e.detalleIva.importe1+e.detalleIva.importe2+e.detalleIva.importe3+e.detalleIva.importe4+e.detalleIva.importe5,t=Math.round(100*a)/100;return t}const _=async()=>{try{m.value=!0;const e=(await M.Z.post("clientes/getClienteById",{idCliente:d.value.idCliente})).data;if(e?.albaran)f();else{const e=await M.Z.post("tickets/crearTicket",{total:g(d.value),idCesta:d.value._id,idTrabajador:c.value._id,tipo:"DEUDA",tkrsData:{cantidadTkrs:t.value,formaPago:"EFECTIVO"},concepto:"DEUDA"});if(!e.data)throw Error("No se ha podido crear el ticket");D(a("toc_game_encargos_ok","Deuda creada!"),"success",C)}}catch(e){O().fire("Oops...",e.message,"error")}finally{m.value=!1}};function f(){M.Z.post("albaranes/crearAlbaran",{total:g(d.value),idCesta:d.value._id,idTrabajador:c.value._id,estado:"DEUDA"}).then((async e=>{if(!e.data)throw Error("No se ha podido registrar el albaran");await M.Z.post("cestas/borrarCesta",{idCesta:d.value._id}),await M.Z.post("impresora/firma",{idTicket:e.data,albaran:!0}).catch((e=>{O().fire("Oops...",e.message,"error")})),D(a("toc_game_encargos_ok","Deuda albaran creada!"),"success",C)})).catch((e=>{O().fire("Oops...",e.message,"error")})).finally((()=>{m.value=!1}))}const C=async()=>(await e.dispatch("Cestas/setModoCesta",{index:n,modo:"VENTA"}),e.dispatch("Cestas/setClienteCesta",{index:n,idCliente:null,nombreCliente:null}),e.dispatch("EstadoDinamico/reset"),e.dispatch("Cestas/deleteLista",i._id),b("/main"),Promise.resolve()),D=(e,a,t=(()=>{}))=>{O().fire("error"===a?"Oops...":"Ok!!",e,a).then((()=>t()))},b=e=>N.Z.push(e);return(0,s.bv)((()=>{v.value=g(d.value)})),{crearDeuda:_,cestaActiva:i,clienteData:p,precioTotal:v,cantidadTkrs:t,cesta:d,arrayCestas:l,getTotal:g,DescuentoCliente:u,loading:m}}},P=t(40089);const K=(0,P.Z)(U,[["render",j],["__scopeId","data-v-ae3f0f44"]]);var S=K}}]);
//# sourceMappingURL=262.13a1ff8a.js.map