"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[497],{69568:function(a,e,t){t.r(e),t.d(e,{default:function(){return O}});var o=t(73396),r=t(87139);const i=a=>((0,o.dD)("data-v-69edae98"),a=a(),(0,o.Cn)(),a),l={class:"row"},s={class:"row mt-4"},n={class:"col"},c=i((()=>(0,o._)("img",{src:"img/img-efectivo.png",width:"300",alt:"Seleccionar efectivo"},null,-1))),u={key:0,class:"col"},d=i((()=>(0,o._)("img",{src:"img/img-tkrs.png",width:"300",alt:"Seleccionar pago con ticket restaurante"},null,-1))),m={key:1,class:"col"},p=i((()=>(0,o._)("img",{src:"img/img-tarjetas.png",width:"300",alt:"Seleccionar pago con tarjeta"},null,-1))),v={key:2,class:"col mt-1"},f=i((()=>(0,o._)("img",{src:"img/img-3g.png",width:"300",alt:"Seleccionar pago con datatfono3G"},null,-1))),g={class:"position-absolute bottom-0 end-0"},k={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function T(a,e,t,i,T,C){const w=(0,o.up)("CambioComponent"),_=(0,o.up)("MDBIcon"),b=(0,o.up)("MDBCardText"),h=(0,o.up)("MDBCardBody"),D=(0,o.up)("MDBCard"),A=(0,o.up)("ModalTkrsComponent"),E=(0,o.up)("VolverComponent"),R=(0,o.up)("MDBBtn");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",l,[(0,o.Wm)(w,{ref:"cambioRef"},null,512)]),(0,o._)("div",s,[(0,o._)("div",n,[(0,o.Wm)(D,{class:"cardTicketRestaurante text-center",onClick:e[0]||(e[0]=a=>i.setFormaPago("EFECTIVO"))},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[c,"EFECTIVO"===i.formaPago?((0,o.wg)(),(0,o.j4)(_,{key:0,class:"mt-4",icon:"hand-pointer",size:"5x"})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1})]),i.modalTkrsRef&&!i.prohibirTkRestaurant?((0,o.wg)(),(0,o.iD)("div",u,[(0,o.Wm)(D,{class:"cardTicketRestaurante text-center",onClick:e[1]||(e[1]=a=>i.modalTkrsRef.abrirModal())},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[d,"TKRS"===i.formaPago?((0,o.wg)(),(0,o.j4)(_,{key:0,class:"mt-4",icon:"hand-pointer",size:"5x"})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1})])):(0,o.kq)("",!0),0===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("div",m,[(0,o.Wm)(D,{class:"cardTicketRestaurante text-center",onClick:e[2]||(e[2]=a=>i.setFormaPago("TARJETA"))},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[p,"TARJETA"===i.formaPago?((0,o.wg)(),(0,o.j4)(_,{key:0,class:"mt-4",icon:"hand-pointer",size:"5x"})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1})])):(0,o.kq)("",!0),1===i.tipoDatafono3G?((0,o.wg)(),(0,o.iD)("div",v,[(0,o.Wm)(D,{class:"cardTicketRestaurante text-center",onClick:e[3]||(e[3]=a=>i.setFormaPago("DATAFONO_3G"))},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[f,"DATAFONO_3G"===i.formaPago?((0,o.wg)(),(0,o.j4)(_,{key:0,class:"mt-4",icon:"hand-pointer",size:"5x"})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1})])):(0,o.kq)("",!0)]),(0,o.Wm)(A,{ref:"modalTkrsRef"},null,512),(0,o.Wm)(E,{onClick:e[4]||(e[4]=a=>i.cancelarVenta())}),(0,o._)("div",g,[(0,o.Wm)(R,{class:(0,r.C_)(["botonCobrar",{disabled:i.loading}]),color:"primary",onClick:e[5]||(e[5]=a=>i.cobrar())},{default:(0,o.w5)((()=>[i.loading?((0,o.wg)(),(0,o.iD)("span",k)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,r.zw)(a.$t("pagar","Pagar")),1)])),_:1},8,["class"])])],64)}t(57658);var C=t(44870),w=t(79066),_=t(32374),b=t(38020),h=t(42492),D=t.n(h),A=t(44161),E=t(74313),R=t(20065),P=t(22483),y={name:"CobroView",components:{CambioComponent:w.Z,MDBCard:E.Yl,MDBBtn:E.$v,MDBCardBody:E.H7,MDBCardText:E.Pp,VolverComponent:_.Z,ModalTkrsComponent:b.Z,MDBIcon:E.vm},setup(a,{expose:e}){const t=(0,R.oR)(),r=(0,P.tv)(),i=(0,C.iH)("EFECTIVO"),l=(0,C.iH)(0),s=(0,C.iH)(null),n=(0,C.iH)(!1),c=(0,C.iH)(null),u=(0,C.iH)(!1),d=(0,C.iH)(0),m=(0,C.iH)(!1),p=(0,o.Fl)((()=>t.state.Trabajadores.indexActivo)),v=(0,o.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),f=(0,o.Fl)((()=>t.state.Cestas.arrayCestas)),g=(0,o.Fl)((()=>t.state.Cestas.Descuento)),k=(0,o.Fl)((()=>v.value&&void 0!=p.value&&null!=p.value&&v.value[p.value]?v.value[p.value]:null));let T=(0,o.Fl)((()=>{if(f.value)for(let a=0;a<f.value.length;a++)if(f.value[a]._id==v.value[p.value].idCesta)return f.value[a];return null}));function w(a){d.value=Number(a),c.value.setTkrs(a),a>=y(T.value)?i.value="TKRS":i.value="EFECTIVO"}function _(a){d.value<y(T.value)?"TARJETA"===a&&d.value>0?D().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):i.value=a:D().fire("Â¡Eo!","El ticket resturant ya cubre el total de la venta","error")}async function b(){m.value=!0;try{const a=await A.Z.post("tickets/crearTicket",{total:y(T.value),idCesta:T.value._id,idTrabajador:k.value._id,tipo:i.value,tkrsData:{cantidadTkrs:d.value,formaPago:"EFECTIVO"}});if(!a.data)throw Error("No se ha podido crear el ticket");await A.Z.post("impresora/saludo").catch((a=>{D().fire("Oops...",a.message,"error")})),D().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),u.value&&await A.Z.post("tickets/getUltimoTicket").then((async a=>{a.data[0]?._id?await A.Z.post("impresora/imprimirTicket",{idTicket:a.data[0]?._id}).catch((a=>{D().fire("Oops...",a.message,"error")})):D().fire("AVISO","Crea un ticket en esta caja abierta","info")})),"PAGO SEPARADO"==T.value.modo&&await E(T.value._id),"TARJETA"===i.value&&t.dispatch("Datafono/setEstado","PENDIENTE"),r.push("/main")}catch(a){D().fire("Oops...",a.message,"error")}m.value=!1}async function h(){"PAGO SEPARADO"==T.value.modo&&await A.Z.post("cestas/DevolverProductosACestaSep",{cesta:t.getters["Cestas/getCestaBaseActivo"],articulos:T.value.lista}).then((a=>{E(T.value._id)}))}async function E(a){A.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((a=>{D().fire({icon:"error",title:"Error al eliminar la cesta (Pago dividido)",showConfirmButton:!1,timer:500})})),await A.Z.post("cestas/cambiarCestaTrabajador",{idCesta:t.getters["Cestas/getCestaBaseActivo"],idTrabajador:v.value[t.state.Trabajadores.indexActivo]._id}).then((a=>{t.dispatch("Cestas/setCestaBaseAction",null)}))}function y(a){let e=a.detalleIva.importe1+a.detalleIva.importe2+a.detalleIva.importe3+a.detalleIva.importe4+a.detalleIva.importe5;return e-e*g.value}return e({}),(0,o.bv)((()=>{A.Z.post("parametros/getParametros").then((a=>{"3G"!==a.data?.tipoDatafono&&"0.0.0.0"!=a.data?.ipTefpay||(l.value=1)})),A.Z.post("parametros/getParametros").then((a=>{void 0!=a.data?.params?.SempreTicket?"Si"==a.data?.params?.SempreTicket&&(u.value=!0):u.value=!1})),A.Z.post("parametros/getParametros").then((a=>{void 0!=a.data?.params?.prohibirTkRestaurant?"Si"==a.data?.params?.prohibirTkRestaurant&&(n.value=!0):n.value=!1}))})),(0,o.JJ)("total",y(T.value)),(0,o.JJ)("setTkrs",w),{DescuentoCliente:g,cesta:T,getTotal:y,cobrar:b,formaPago:i,modalTkrsRef:s,prohibirTkRestaurant:n,cambioRef:c,setFormaPago:_,loading:m,tipoDatafono3G:l,eliminarAlPagarFnc:E,cancelarVenta:h}}},B=t(40089);const F=(0,B.Z)(y,[["render",T],["__scopeId","data-v-69edae98"]]);var O=F}}]);
//# sourceMappingURL=497.8a28c14c.js.map