"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[535],{37345:function(e,o,a){a.r(o),a.d(o,{default:function(){return F}});var t=a(73396),l=a(87139),d=a(49242);const r=e=>((0,t.dD)("data-v-5905e681"),e=e(),(0,t.Cn)(),e),n={id:"main"},i={id:"vueMenuPedido"},s={class:"pedidos"},u={class:"text-center m-auto pt-3 h5"},c={class:""},p=r((()=>(0,t._)("hr",{class:"hrPedido"},null,-1))),m={class:"productos"},v={key:0,style:{"overflow-y":"scroll",height:"28vh"}},_={class:"ms-5 h6"},g={class:"d-flex flex-column juatify-content-center"},C={style:{"max-width":"270px"}},h=["onUpdate:modelValue"],b=r((()=>(0,t._)("br",null,null,-1))),D={key:1},M=r((()=>(0,t._)("hr",{class:"hrPedido"},null,-1))),f={class:"pedidos-footer mx-5"},w=r((()=>(0,t._)("h2",{id:"emailHelp",class:"h6"},"Precio total:",-1))),y={class:"mb-0 mt-2"},B={class:""},T=["disabled"];function H(e,o,a,r,H,x){const P=(0,t.up)("ModalClientesComponent");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",n,[(0,t._)("div",i,[(0,t._)("div",null,[(0,t._)("div",s,[(0,t._)("h1",u,(0,l.zw)(e.$t("pedido_nuevo","Pedido nuevo")),1),(0,t._)("div",c,[p,(0,t._)("div",m,[r.productos.length?((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("h2",_,(0,l.zw)(e.$t("productos","Productos"))+":",1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.productos,((e,o)=>((0,t.wg)(),(0,t.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:o},[(0,t._)("div",g,[(0,t._)("span",C,"- "+(0,l.zw)(e.nombre),1),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.arraySuplementos,((e,o)=>((0,t.wg)(),(0,t.iD)("span",{key:o},(0,l.zw)(e.nombre),1)))),128))]),(0,t.wy)((0,t._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":o=>e.comentario=o},null,8,h),[[d.nr,e.comentario]])])))),128)),b])):((0,t.wg)(),(0,t.iD)("div",D,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),M,(0,t._)("div",f,[(0,t._)("div",null,[w,(0,t._)("p",y,(0,l.zw)(r.precioTotal)+"€",1)]),(0,t._)("div",B,[(0,t._)("input",{type:"button",value:"Crear pedido",class:"btn btn-primary btn-lg",onClick:o[0]||(o[0]=(...e)=>r.crearPedido&&r.crearPedido(...e)),disabled:r.botonBloqueado},null,8,T)])])])])])])]),(0,t.Wm)(P,{ref:"refModalClientes"},null,512)],64)}a(57658);var x=a(44870),P=a(74313),k=a(20065),N=a(10923),j=a(61837),I=a(42492),A=a.n(I),S=a(87853),z=a(91076),E=a(16797),$={name:"PedidosComponent",components:{ModalClientesComponent:N.Z,NumpadComponent:j.Z,MDBCard:P.Yl,MDBCardBody:P.H7,MDBCardTitle:P.QM,MDBCardText:P.Pp,MDBBtn:P.$v,MDBCheckbox:P.IH,MDBModal:P.j3,MDBModalHeader:P.ol,MDBModalTitle:P.wo,MDBModalBody:P.Yz,MDBModalFooter:P.ab,MDBIcon:P.vm,MDBLoading:P.J$},setup(){const e=(0,x.iH)(!1),o=(0,x.iH)(null),a=(0,k.oR)(),{t:l}=(0,S.QT)(),d=a.getters["Cestas/getCestaActiva"],r=a.getters["Cestas/getCestaActivaIndex"],n=(0,t.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),i=(0,t.Fl)((()=>a.state.Trabajadores.indexActivo)),s=(0,t.Fl)((()=>n.value&&null!=i.value&&void 0!=i.value&&n.value[i.value]?n.value[i.value]:null)),u=(0,x.iH)(null),c=(0,x.iH)(0),p={idCliente:d.idCliente,nombreCliente:d.nombreCliente},m=(0,x.iH)(null),v=(0,x.iH)(null),_=(0,x.iH)(d.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),g=(0,x.iH)(null),C=()=>{let e=d.detalleIva.importe1+d.detalleIva.importe2+d.detalleIva.importe3+d.detalleIva.importe4+d.detalleIva.importe5;return e=Math.round(100*e)/100,e},h=()=>{if(e.value=!0,!_.value.length)return b(l("toc_game_pedidos_error_no_productos","Tienes que haber al menos un producto para crear el pedido."),"error"),void(e.value=!1);const o=new Date,a=new Date(o);a.setDate(o.getDate()+1);let t=a.getHours(),r=`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,n=t>=12?"pm":"am";const i={idCliente:null,nombreCliente:null,opcionRecogida:2,amPm:n,fecha:a.toISOString().slice(0,10),hora:r,dias:[],dejaCuenta:0,total:C(),productos:_.value,cesta:d,idTrabajador:s.value._id,nombreDependienta:s.value.nombre,pedido:!0};z.Z.post("encargos/setEncargo",i).then((({data:o})=>o&&o.msg?o.error?(b(o.msg,"error"),void(e.value=!1)):(c.value>0&&z.Z.post("movimientos/nuevoMovimiento",{cantidad:c.value,concepto:"dejaACuentaPedido",idTrabajador:s.value._id,tipo:"ENTRADA_DINERO",nombreCliente:p.nombreCliente}).then((o=>{if(!o.data)throw e.value=!1,Error("No se ha podido realizar la entrada de dinero")})).catch((o=>{e.value=!1,A().fire("Oops...",o.message,"error")})),e.value=!1,void b(l("toc_game_pedidos_ok","pedido creado!"),"success",D)):(b(l("toc_game_pedidos_error_general","Error general"),"error"),void(e.value=!1)))).catch((o=>{e.value=!1,b(l("toc_game_pedidos_error_general","Error general"),"error")}))},b=(e,o,a=(()=>{}))=>{A().fire("error"===o?"Oops...":"Ok!!",e,o).then((()=>a()))},D=async()=>(await a.dispatch("Cestas/setModoCesta",{index:r,modo:"VENTA"}),a.dispatch("Cestas/setClienteCesta",{index:r,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),a.dispatch("EstadoDinamico/reset"),a.dispatch("Cestas/deleteLista",d._id),y("/main"),Promise.resolve()),M=()=>{v.value=!0},f=()=>{v.value=!1},w=()=>{let e=Number(m.value.cantidad);c.value=Number(e.toFixed(2)),f()},y=e=>E.Z.push(e);return(0,t.bv)((()=>{g.value=C()})),(0,t.JJ)("okValue",(()=>v.value?w():M())),{refModalClientes:o,cestaActiva:d,clienteData:p,productos:_,refPedidoRecogida:u,dejaACuenta:c,crearPedido:h,precioTotal:g,botonBloqueado:e,numpadRef:m,modalTecladoNum:v,openTecladoNum:M,closeTecladoNum:f,finishTecladoNum:w}}},R=a(40089);const Z=(0,R.Z)($,[["render",H],["__scopeId","data-v-5905e681"]]);var F=Z}}]);
//# sourceMappingURL=535.734beaa5.js.map