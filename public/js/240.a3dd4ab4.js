"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[240],{9240:function(a,e,o){o.r(e),o.d(e,{default:function(){return O}});var r=o(3396),n=o(7139);const t={class:"row mt-2"},l={class:"row mt-4 divInferior"},s={class:"col anchoCajaConsumoPersonal"},i={key:0,class:"col tablaDescansando table-responsive d-inline",style:{"background-color":"white"}},c={class:"table"},d={class:"tituloDescanso"},u=["onClick"],m={class:"textoNombre d-inline-block text-truncate"};function f(a,e,o,f,p,b){const v=(0,r.up)("MDBCardTitle"),h=(0,r.up)("MDBIcon"),w=(0,r.up)("MDBCardBody"),_=(0,r.up)("MDBCard"),g=(0,r.up)("MDBBtn"),M=(0,r.up)("ModalLeerQR"),C=(0,r.up)("FichajesModal");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",t,[(0,r.Wm)(_,{onClick:e[0]||(e[0]=a=>f.modalFichajes.abrirModal()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("iniciar_turno","Iniciar turno")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"play",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(_,{onClick:e[1]||(e[1]=a=>f.iniciarDescanso()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("iniciar_descanso","Iniciar descanso")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"pause",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(_,{onClick:e[2]||(e[2]=a=>f.preguntarFinalizarTurno()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("finalizar_turno","Finalizar turno")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"stop",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),f.esFac_Tena?((0,r.wg)(),(0,r.j4)(_,{key:0,onClick:e[3]||(e[3]=a=>f.ModalLeerQRRef.abrirModal()),class:"estiloCardQR ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("iframe_iterum","Leer QR")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"qrcode",iconStyle:"fas",size:"5x"})])),_:1})])),_:1})):(0,r.kq)("",!0)]),(0,r._)("div",l,[(0,r._)("div",s,[f.trabajadorActivo?((0,r.wg)(),(0,r.j4)(g,{key:0,onClick:e[4]||(e[4]=a=>f.activarConsumoPersonal()),color:"primary",class:"w-100 botonConsumoPersonal"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("consumo_personal","Consumo personal")),1)])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(g,{onClick:e[5]||(e[5]=a=>f.apagar_equipo()),color:"danger",class:"w-100 botonConsumoPersonal mt-4"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("apagar_equipo","Apagar equipo")),1)])),_:1}),null!=f.idActivoDescanso?((0,r.wg)(),(0,r.j4)(g,{key:1,onClick:e[6]||(e[6]=a=>f.preguntarFinalDescanso()),color:"primary",class:"w-100 botonConsumoPersonal mt-4"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("finalizar_descanso","Finalizar descanso")),1)])),_:1})):(0,r.kq)("",!0)]),f.arrayTrabajadoresDescanso&&f.arrayTrabajadoresDescanso.length>0?((0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("table",c,[(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",d,(0,n.zw)(a.$t("trabajadores_en_descanso_activo","Trabajadores en descanso activo")),1)])]),(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(f.arrayTrabajadoresDescanso,((a,e)=>((0,r.wg)(),(0,r.iD)("tr",{key:e,class:(0,n.C_)({activoTabla:a._id===f.idActivoDescanso}),onClick:e=>f.setActivo(a._id)},[(0,r._)("td",null,[(0,r._)("span",m,(0,n.zw)(a.nombre),1)])],10,u)))),128))])])])):(0,r.kq)("",!0)]),(0,r.Wm)(M,{ref:"ModalLeerQRRef"},null,512),(0,r.Wm)(C,{ref:"modalFichajes"},null,512)],64)}o(7658);var p=o(4834),b=o(4161);const v=["src"];function h(a,e,o,t,l,s){const i=(0,r.up)("MDBBtn"),c=(0,r.up)("MDBModalFooter"),d=(0,r.up)("MDBModal");return(0,r.wg)(),(0,r.j4)(d,{id:"ModalLeerQR",tabindex:"-1",labelledby:"ModalLeerQRLabel",modelValue:t.ModalLeerQR,"onUpdate:modelValue":e[1]||(e[1]=a=>t.ModalLeerQR=a),fullscreen:""},{default:(0,r.w5)((()=>[(0,r._)("iframe",{src:t.url,style:{position:"absolute",height:"90%",width:"90%",border:"none"}},null,8,v),(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i,{color:"danger",size:"lg",onClick:e[0]||(e[0]=a=>t.ModalLeerQR=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var w=o(4870),_=o(4313),g={name:"ModalLeerQRComponent",components:{MDBModal:_.j3,MDBModalFooter:_.ab,MDBBtn:_.$v},setup(a,{expose:e}){const o=(0,w.iH)(!1),r=(0,w.iH)("");function n(a){t(),o.value=!0}function t(){r.value="https://silema.web.app/validarQR-trabajador"}return e({abrirModal:n}),{ModalLeerQR:o,abrirModal:n,url:r}}},M=o(89);const C=(0,M.Z)(g,[["render",h]]);var B=C,D=o(2492),j=o.n(D),k=o(65),y=o(9242);const T={class:"row"},F={key:0,class:"row mt-2"},z={class:"table table-striped"},W={class:"textoNombre d-inline-block text-truncate"},x={key:1,class:"row"},R={class:"sinResultados position-relative"},q={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function $(a,e,o,t,l,s){const i=(0,r.up)("MDBModalTitle"),c=(0,r.up)("MDBModalHeader"),d=(0,r.up)("MDBBtn"),u=(0,r.up)("MDBModalBody"),m=(0,r.up)("MDBModalFooter"),f=(0,r.up)("MDBModal");return(0,r.wg)(),(0,r.j4)(f,{id:"modalFichajes",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:t.modalFichajes,"onUpdate:modelValue":e[2]||(e[2]=a=>t.modalFichajes=a),size:"xl",modalFichajes:""},{default:(0,r.w5)((()=>[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i,{id:"staticBackdropLabel"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("fichar","Fichar")),1)])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r._)("div",T,[(0,r.wy)((0,r._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":e[0]||(e[0]=a=>t.inputBusqueda=a)},null,512),[[y.nr,t.inputBusqueda]])]),t.arrayTrabajadores&&t.arrayTrabajadores.length>0?((0,r.wg)(),(0,r.iD)("div",F,[(0,r._)("table",z,[(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.arrayTrabajadores,((e,o)=>((0,r.wg)(),(0,r.iD)("tr",{key:o},[(0,r._)("td",null,[(0,r._)("span",W,(0,n.zw)(e.nombre),1)]),(0,r._)("td",null,[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:a=>t.fichar(e._id),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("fichar","Fichar")),1)])),_:2},1032,["onClick"])])])))),128))])])])):((0,r.wg)(),(0,r.iD)("div",x,[(0,r._)("div",R,[(0,r._)("span",q,(0,n.zw)(a.$t("sin_resultados","Sin resultados")),1)])]))])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:e[1]||(e[1]=a=>t.modalFichajes=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var L={name:"FichajesModal",components:{MDBModal:_.j3,MDBModalHeader:_.ol,MDBModalTitle:_.wo,MDBModalBody:_.Yz,MDBModalFooter:_.ab,MDBBtn:_.$v},setup(){const a=(0,w.iH)(null),e=(0,w.iH)([]),o=(0,w.iH)("");function n(){a.value=!0}function t(){b.Z.post("trabajadores/buscar",{busqueda:o.value}).then((a=>{e.value=a.data})).catch((a=>{j().fire("Oops...",a.message,"error")}))}function l(e){b.Z.post("trabajadores/fichar",{idTrabajador:e}).then((e=>{if(!e.data)throw Error("Error, no se ha podido fichar");p.W.cargarTrabajadoresFichados(),a.value=!1})).catch((a=>{j().fire("Oops...",a.message,"error")}))}return(0,r.YP)(o,(()=>{t()})),{modalFichajes:a,abrirModal:n,arrayTrabajadores:e,inputBusqueda:o,fichar:l}}};const H=(0,M.Z)(L,[["render",$],["__scopeId","data-v-6f9e5052"]]);var Q=H,U=o(250),A={name:"fichajesView",components:{MDBIcon:_.vm,FichajesModal:Q,MDBCard:_.Yl,MDBCardBody:_.H7,MDBCardTitle:_.QM,MDBBtn:_.$v,ModalLeerQR:B},setup(){const a=(0,k.oR)(),e=a.getters["Configuracion/parametros"],o=(0,w.iH)(null),n=(0,w.iH)(!1),t=(0,w.iH)(null),l=(0,w.iH)([]),s=(0,w.iH)(null),i=(0,r.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),c=(0,r.Fl)((()=>a.state.Trabajadores.indexActivo)),d=(0,r.Fl)((()=>i.value&&void 0!=c.value&&null!=c.value&&i.value[c.value]?i.value[c.value]:null)),u=(0,r.Fl)((()=>a.state.Cestas.arrayCestas)),m=(0,r.Fl)((()=>{if(u.value)for(let a=0;a<u.value.length;a++)if(u.value[a]._id==i.value[c.value].idCesta)return u.value[a];return null}));function f(a){s.value=a}function v(){s.value=null}function h(){b.Z.post("trabajadores/desfichar",{idTrabajador:d.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido registrar el fin de turno (backend)");p.W.cargarTrabajadoresFichados(),j().fire("OK","Fin de turno registrado correctamente","success")})).catch((a=>{j().fire("Oops...",a.message,"error")}))}function _(a){for(let e=0;e<l.value.length;e++)if(a===l.value[e]._id)return l.value[e];return null}function g(){if(s.value){const a=_(s.value);a&&j().fire({title:"Por favor, confirma el descanso para: ",html:`${a.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&D(s.value)}))}}function M(){j().fire({title:"¿Desea realmente apagar el equipo? ",html:"¡Esta funcion apagará instantaneamente su equipo!",showCancelButton:!0,confirmButtonText:"Apagar",cancelButtonText:"Cancelar",confirmButtonColor:"red",cancelButtonColor:"green",iconColor:"red",icon:"warning",backdrop:"rgba(255,0,0,0.4)"}).then((a=>{a.isConfirmed&&b.Z.post("controlTpv/ApagarOrdenador",{}).then((a=>{a.data?j().fire("¡Apagando!","Su equipo se apagará en unos instantes...","success"):j().fire("¡No hemos podido apagar el equipo!","Si el error se mantiene, pruebe a forzar un apagado!","error")})).catch((a=>{j().fire("¡No hemos podido apagar el equipo!","Si el error se mantiene, pruebe a forzar un apagado!"+a,"error")}))}))}async function C(){if(u.value&&m.value)for(let e=0;e<u.value.length;e++)if(u.value[e]._id===m.value._id){await a.dispatch("Cestas/setModoCesta",{modo:"CONSUMO_PERSONAL",index:e}),U.Z.push("/main");break}}function B(){d.value&&j().fire({title:"Confirma. Fin de turno para: ",html:`${d.value.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&h()}))}function D(a){b.Z.post("trabajadores/finDescanso",{idTrabajador:a}).then((a=>{if(!a.data)throw Error("Error, no se  ha podido iniciar el descanso");p.W.cargarTrabajadoresFichados(),v(),T(),j().fire("Descanso finalizado","","success")})).catch((a=>{j().fire("Oops...",a.message,"error")}))}function y(){d.value._id?b.Z.post("trabajadores/inicioDescanso",{idTrabajador:d.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido iniciar el descanso");T(),p.W.cargarTrabajadoresFichados(),j().fire("OK","Descanso iniciado correctamente","success")})).catch((a=>{j().fire("Oops...",a.message,"error")})):j().fire("Importante....","Es necesario un trabajador activo para realizar esta acción","warning")}function T(){b.Z.get("trabajadores/descansando").then((a=>{if(!a.data)throw Error("Error, no se han podido obtener los trabajadores en descanso");l.value=a.data})).catch((a=>{j().fire("Oops...",a.message,"error")}))}return(0,r.bv)((()=>{T(),"Tena"==e.nombreEmpresa&&(n.value=!0)})),{modalFichajes:o,arrayTrabajadoresDescanso:l,idActivoDescanso:s,esFac_Tena:n,setActivo:f,trabajadorActivo:d,finDeTurno:h,iniciarDescanso:y,preguntarFinalDescanso:g,resetidActivoDescansando:v,preguntarFinalizarTurno:B,activarConsumoPersonal:C,apagar_equipo:M,ModalLeerQRRef:t}}};const E=(0,M.Z)(A,[["render",f],["__scopeId","data-v-1e95b3e2"]]);var O=E}}]);
//# sourceMappingURL=240.a3dd4ab4.js.map