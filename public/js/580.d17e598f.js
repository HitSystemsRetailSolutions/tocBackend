"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[580],{18763:function(a,e,o){o.d(e,{Z:function(){return c}});var t=o(73396),l=o(87139);const i={class:"input-group position-absolute bottom-0 start-0"};function r(a,e,o,r,s,n){return(0,t.wg)(),(0,t.iD)("div",i,[(0,t._)("button",{onClick:e[0]||(e[0]=a=>r.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px","margin-bottom":"0.5rem"}},(0,l.zw)(a.$t("volver","VOLVER")),1)])}var s=o(6411),n={name:"VolverComponent",setup(){function a(){s.Z.back()}return{volver:a}}},u=o(40089);const d=(0,u.Z)(n,[["render",r]]);var c=d},66720:function(a,e,o){o.d(e,{Z:function(){return v}});var t=o(73396),l=o(44870),i=o(87139),r=o(74313),s=o(16683);const n={style:{display:"grid","grid-template-columns":"repeat(4,1fr)","grid-template-rows":"repeat(4,1fr)"}};var u={__name:"CashlogyTecladoNumerico",props:{tipo_importe:Boolean},emits:["click-key"],setup(a,{emit:e}){const o=a;let u=(0,s.vg)(1.23).charAt(1);const d=[[7,8,9,{value:"C",style:"grid-row:1/5;grid-column:4"}],[4,5,6],[1,2,3],[{value:0,style:"grid-row:4;grid-column:1/4"}]],c=[[7,8,9,{value:"C",style:"grid-row:1/5;grid-column:4"}],[4,5,6],[1,2,3],[{value:0,style:"grid-row:4;grid-column:1/3"},u]];function v(a){e("click-key",a)}return(a,e)=>((0,t.wg)(),(0,t.iD)("div",n,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(o.tipo_importe?c:d,(a=>((0,t.wg)(),(0,t.iD)(t.HY,null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a,(a=>((0,t.wg)(),(0,t.j4)((0,l.SU)(r.$v),{onClick:()=>v("object"==typeof a?a.value:a),style:(0,i.j5)(["object"==typeof a?a.style:"",{margin:"1px"}]),color:"info",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,i.zw)("object"==typeof a?a.value:a),1)])),_:2},1032,["onClick","style"])))),256))],64)))),256))]))}},d=o(40089);const c=(0,d.Z)(u,[["__scopeId","data-v-1845037f"]]);var v=c},79066:function(a,e,o){o.d(e,{Z:function(){return h}});var t=o(73396),l=o(87139);const i={class:"row mt-2"},r={class:"col-md-3"},s={key:0,class:"sizeLetrasCambio"},n={class:"sizeLetrasCambio"},u={key:1,class:"estiloFalta sizeLetrasCambio"},d={key:2,class:"estiloPerfecto sizeLetrasCambio"},c={key:3,class:"estiloSobra sizeLetrasCambio"},v={class:"col-md-9"},m={class:"row"},p={class:"col text-end"},g={class:"row mt-2"},_={class:"col text-end"};function f(a,e,o,f,C,w){const b=(0,t.up)("MDBCardTitle"),k=(0,t.up)("MDBCardText"),D=(0,t.up)("MDBBtn"),h=(0,t.up)("MDBCardBody"),y=(0,t.up)("MDBCard");return(0,t.wg)(),(0,t.iD)("div",i,[(0,t._)("div",r,[(0,t.Wm)(y,{class:"cardInfoCambio"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("informacion_cambio","Información cambio")),1)])),_:1}),(0,t.Wm)(k,null,{default:(0,t.w5)((()=>[null!=f.cantidadTkrs&&void 0!=f.cantidadTkrs?((0,t.wg)(),(0,t.iD)("li",s,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(f.totalRecibido+f.cantidadTkrs).toFixed(2))+" € ",1)):(0,t.kq)("",!0),(0,t._)("li",n,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*f.aPagar)/100).toFixed(2))+" € ",1),null!=f.cuenta&&void 0!=f.cuenta&&f.cuenta>0?((0,t.wg)(),(0,t.iD)("li",u,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*f.cuenta)/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0),null!=f.cuenta&&void 0!=f.cuenta&&0==f.cuenta?((0,t.wg)(),(0,t.iD)("li",d,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,t.kq)("",!0),null!=f.cuenta&&void 0!=f.cuenta&&f.cuenta<0?((0,t.wg)(),(0,t.iD)("li",c,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)((Math.round(100*(f.aPagar-f.totalRecibido))/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(D,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>f.deshacer()),class:"sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,t.Wm)(D,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>f.limpiar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])),_:1})])),_:1})]),(0,t._)("div",v,[(0,t._)("div",m,[(0,t._)("div",p,[(0,t._)("img",{src:"/img/1cts.png",class:"sizeMonedas",onClick:e[2]||(e[2]=a=>f.sumar(.01))}),(0,t._)("img",{src:"/img/2cts.png",class:"sizeMonedas",onClick:e[3]||(e[3]=a=>f.sumar(.02))}),(0,t._)("img",{src:"/img/5cts.png",class:"sizeMonedas",onClick:e[4]||(e[4]=a=>f.sumar(.05))}),(0,t._)("img",{src:"/img/10cts.png",class:"sizeMonedas",onClick:e[5]||(e[5]=a=>f.sumar(.1))}),(0,t._)("img",{src:"/img/20cts.png",class:"sizeMonedas",onClick:e[6]||(e[6]=a=>f.sumar(.2))}),(0,t._)("img",{src:"/img/50cts.png",class:"sizeMonedas",onClick:e[7]||(e[7]=a=>f.sumar(.5))}),(0,t._)("img",{src:"/img/uneuro.png",class:"sizeMonedas",onClick:e[8]||(e[8]=a=>f.sumar(1))}),(0,t._)("img",{src:"/img/doseuros.png",class:"sizeMonedas",onClick:e[9]||(e[9]=a=>f.sumar(2))})])]),(0,t._)("div",g,[(0,t._)("div",_,[(0,t._)("img",{src:"/img/5euros.png",class:"sizeBilletes",onClick:e[10]||(e[10]=a=>f.sumar(5))}),(0,t._)("img",{src:"/img/10euros.png",class:"sizeBilletes",onClick:e[11]||(e[11]=a=>f.sumar(10))}),(0,t._)("img",{src:"/img/20euros.png",class:"sizeBilletes",onClick:e[12]||(e[12]=a=>f.sumar(20))}),(0,t._)("img",{src:"/img/50euros.png",class:"sizeBilletes",onClick:e[13]||(e[13]=a=>f.sumar(50))}),(0,t._)("img",{src:"/img/100euros.png",class:"sizeBilletes",onClick:e[14]||(e[14]=a=>f.sumar(100))}),(0,t._)("img",{src:"/img/200euros.png",class:"sizeBilletes",onClick:e[15]||(e[15]=a=>f.sumar(200))}),(0,t._)("img",{src:"/img/500euros.png",class:"sizeBilletes",onClick:e[16]||(e[16]=a=>f.sumar(500))})])])])])}o(57658);var C=o(44870),w=o(74313),b={name:"CambioComponent",components:{MDBCard:w.Yl,MDBCardBody:w.H7,MDBCardTitle:w.QM,MDBCardText:w.Pp,MDBBtn:w.$v},setup(a,{expose:e}){const o=(0,C.iH)(0),l=(0,t.f3)("total"),i=(0,C.iH)(l),r=(0,C.iH)([]),s=(0,C.iH)(0),n=(0,t.Fl)((()=>i.value-s.value<0?0:i.value-(o.value+s.value)));function u(a){o.value+=a,r.value.push(a)}function d(){r.value.pop();let a=0;r.value.forEach((e=>{a+=e})),o.value=a}function c(){o.value=0,r.value=[]}function v(a){s.value=Number(a)}return e({setTkrs:v}),{sumar:u,totalRecibido:o,aPagar:i,deshacer:d,limpiar:c,cantidadTkrs:s,cuenta:n}}},k=o(40089);const D=(0,k.Z)(b,[["render",f],["__scopeId","data-v-0e9fd9d8"]]);var h=D},29665:function(a,e,o){o.d(e,{Z:function(){return g}});var t=o(73396),l=o(87139);const i={key:0,class:"cantidad text-center"},r={class:"row mt-2"},s={class:"col text-center"};function n(a,e,o,n,u,d){const c=(0,t.up)("MDBModalTitle"),v=(0,t.up)("MDBModalHeader"),m=(0,t.up)("NumpadComponent"),p=(0,t.up)("MDBModalBody"),g=(0,t.up)("MDBBtn"),_=(0,t.up)("MDBModalFooter"),f=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(f,{id:"modalTkrs",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:n.modalTkrs,"onUpdate:modelValue":e[1]||(e[1]=a=>n.modalTkrs=a)},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{id:"modalTkrsLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("introduce_la_cantidad_del_tiquet_restaurante","Introduce la cantidad del tiquet restaurante")),1)])),_:1})])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,l.C_)(["row",{shake:n.activarShake}])},[n.numPadRef?((0,t.wg)(),(0,t.iD)("span",i,(0,l.zw)(n.numPadRef.cantidad),1)):(0,t.kq)("",!0)],2),(0,t._)("div",r,[(0,t._)("div",s,[(0,t.Wm)(m,{max3EntersDigits:!0,onActivarShake:n.handleShake,ref:"numPadRef"},null,8,["onActivarShake"])])])])),_:1}),(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(g,{color:"danger",size:"lg",onClick:e[0]||(e[0]=a=>n.modalTkrs=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var u=o(74313),d=o(33727),c=o(44870),v={name:"ModalTkrsComponent",components:{MDBModal:u.j3,MDBModalHeader:u.ol,MDBModalTitle:u.wo,MDBModalBody:u.Yz,MDBModalFooter:u.ab,MDBBtn:u.$v,NumpadComponent:d.Z},setup(a,{expose:e}){const o=(0,c.iH)(!1),l=(0,c.iH)(null),i=(0,t.f3)("setTkrs"),r=(0,c.iH)(!1);function s(){o.value=!0}function n(){o.value=!1,i(l.value.cantidad)}function u(){r.value=!0,setTimeout((()=>{r.value=!1}),500)}return(0,t.JJ)("okValue",n),e({abrirModal:s}),{modalTkrs:o,numPadRef:l,okValue:n,activarShake:r,handleShake:u}}},m=o(40089);const p=(0,m.Z)(v,[["render",n],["__scopeId","data-v-36c7c8c6"]]);var g=p},48580:function(a,e,o){o.d(e,{Z:function(){return le}});var t=o(73396),l=o(87139);const i=a=>((0,t.dD)("data-v-1cb56c8b"),a=a(),(0,t.Cn)(),a),r={class:"row"},s={class:"row mt-2"},n={class:"col-md-3"},u={class:"text-center"},d={class:"mt-3"},c={id:"detalleTicket"},v={class:"contencionTicket"},m={key:0,class:"table"},p={class:"titulosTicket"},g={class:"titulosTicket"},_={class:"titulosTicket"},f={key:1},C={class:"text-center"},w={class:"table mt-3"},b={class:"titulosTicket"},k={class:"titulosTicket"},D={class:"titulosTicket"},h=i((()=>(0,t._)("hr",null,null,-1))),y={class:"sizeLetrasCambio"},A={key:0,class:"sizeLetrasCambio"},T={key:1,class:"estiloParcial sizeLetrasCambio"},E={key:2,class:"estiloFalta sizeLetrasCambio"},z={key:3,class:"estiloPerfecto sizeLetrasCambio"},O={key:4,class:"estiloSobra sizeLetrasCambio"},M={key:5,class:"estiloSobra sizeLetrasCambio"},B={key:6,class:"estiloPendiente sizeLetrasCambio"},R={class:"col-md-9",style:{"padding-left":"4vmin"}},P={class:"row"},I={class:"col text-end",style:{"margin-top":"2vmin"}},x=["src","onClick"],N={class:"row mt-2"},j={class:"col text-end",style:{"margin-top":"2vmin"}},F=["src","onClick"],S={class:"row"},Z={class:"col mt-4"},U={class:"divBotones"},V=["disabled"],H=["disabled"],L=["disabled"],$=["disabled"],q={class:"row"},W={class:"cantidad text-center"},G={class:"row mt-2"},J={class:"col text-center"},Y={key:0,class:"estadoPaytef"},K=i((()=>(0,t._)("h3",null,"Estado:",-1))),Q={style:{"margin-top":"1vm","font-weight":"300",color:"orangered","font-size":"1.3em"}},X={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function aa(a,e,o,i,aa,ea){const oa=(0,t.up)("MDBCardTitle"),ta=(0,t.up)("MDBCardText"),la=(0,t.up)("MDBBtn"),ia=(0,t.up)("MDBCardBody"),ra=(0,t.up)("MDBCard"),sa=(0,t.up)("ModalTkrsComponent"),na=(0,t.up)("NumpadComponent"),ua=(0,t.up)("MDBModalBody"),da=(0,t.up)("MDBModal"),ca=(0,t.up)("MDBIcon"),va=(0,t.up)("CashlogyCobroView");return(0,t.wg)(),(0,t.j4)(da,{id:"modalCobro",tabindex:"-1",labelledby:"modalCobro",modelValue:i.modalCobro,"onUpdate:modelValue":e[9]||(e[9]=a=>i.modalCobro=a),staticBackdrop:!0,animation:!1,fullscreen:""},{default:(0,t.w5)((()=>[(0,t.Wm)(ua,{style:{"background-color":"#fff5e9"}},{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t._)("div",s,[(0,t._)("div",n,[(0,t.Wm)(ra,{class:"cardInfoCambio",style:{height:"80vmin"}},{default:(0,t.w5)((()=>[(0,t.Wm)(ia,{style:{display:"flex","flex-direction":"column","justify-content":"space-evenly"}},{default:(0,t.w5)((()=>["PAGO DEUDA"!=i.modoCesta?((0,t.wg)(),(0,t.j4)(oa,{key:0},{default:(0,t.w5)((()=>[(0,t._)("h2",u,(0,l.zw)(a.$t("ticket","Ticket"))+":",1)])),_:1})):(0,t.kq)("",!0),(0,t._)("div",d,[(0,t._)("div",c,[(0,t._)("div",v,["PAGO DEUDA"!=i.modoCesta?((0,t.wg)(),(0,t.iD)("table",m,[(0,t._)("tr",null,[(0,t._)("th",p,(0,l.zw)(a.$t("producto","Producto")),1),(0,t._)("th",g,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,t._)("th",_,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.productos,((a,e)=>((0,t.wg)(),(0,t.iD)("tr",{key:e,style:(0,l.j5)(a.pagado?"text-decoration: line-through":"")},[(0,t._)("td",null,(0,l.zw)(a.nombre),1),(0,t._)("td",null,(0,l.zw)((a.subtotal-a.subtotal*i.DescuentoCliente).toFixed(2))+" € ",1),(0,t._)("td",null,(0,l.zw)(a.unidades),1)],4)))),128))])):(0,t.kq)("",!0),i.mostrarListaDeudas?((0,t.wg)(),(0,t.iD)("div",f,[(0,t._)("h2",C,(0,l.zw)(a.$t("deuda","Deuda"))+"/s: ",1),(0,t._)("table",w,[(0,t._)("tr",null,[(0,t._)("th",b,(0,l.zw)(a.$t("producto","Producto")),1),(0,t._)("th",k,(0,l.zw)(a.$t("subtotal","Subtotal")),1),(0,t._)("th",D,(0,l.zw)(a.$t("unidades","Unidades")),1)]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.productosDeuda,((a,e)=>((0,t.wg)(),(0,t.iD)("tr",{key:e,style:(0,l.j5)(a.pagado?"text-decoration: line-through":"")},[(0,t._)("td",null,(0,l.zw)(a.nombre),1),(0,t._)("td",null,(0,l.zw)(a.subtotal.toFixed(2))+" € ",1),(0,t._)("td",null,(0,l.zw)(a.unidades),1)],4)))),128))])])):(0,t.kq)("",!0)]),h])]),(0,t.Wm)(ta,null,{default:(0,t.w5)((()=>[(0,t._)("li",y,(0,l.zw)(a.$t("dinero_a_pagar","Dinero a pagar:"))+" "+(0,l.zw)((Math.round(100*i.aPagar)/100).toFixed(2))+" € ",1),null!=i.cantidadTkrs&&void 0!=i.cantidadTkrs?((0,t.wg)(),(0,t.iD)("li",A,(0,l.zw)(a.$t("dinero_recibido","Dinero recibido:"))+" "+(0,l.zw)(Number(i.totalRecibido+i.cantidadTkrs+i.dejaCuenta).toFixed(2))+" € ",1)):(0,t.kq)("",!0),i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,t.wg)(),(0,t.iD)("li",T,(0,l.zw)(a.$t("pago_parcial","Pago parcial"))+": "+(0,l.zw)(i.montoDeuda)+"€ ",1)):(0,t.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta>0?((0,t.wg)(),(0,t.iD)("li",E,(0,l.zw)(a.$t("faltan","Faltan"))+" "+(0,l.zw)((Math.round(100*i.cuenta)/100).toFixed(2))+" € ",1)):(0,t.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&0==i.cuenta?((0,t.wg)(),(0,t.iD)("li",z,(0,l.zw)(a.$t("cambio_perfecto","Cambio perfecto")),1)):(0,t.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0&&!(i.deudasSeleccionadas.length>0&&i.montoDeuda>0)?((0,t.wg)(),(0,t.iD)("li",O,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)(i.valorSobra())+" € ",1)):(0,t.kq)("",!0),null!=i.cuenta&&void 0!=i.cuenta&&i.cuenta<0&&i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,t.wg)(),(0,t.iD)("li",M,(0,l.zw)(a.$t("sobran","Sobran"))+" "+(0,l.zw)(i.valorSobra())+" € ",1)):(0,t.kq)("",!0),i.deudasSeleccionadas.length>0&&i.montoDeuda>0?((0,t.wg)(),(0,t.iD)("li",B,(0,l.zw)(a.$t("saldo_pendiente","Saldo pendiente"))+": "+(0,l.zw)((Math.round(100*(i.aPagar-i.montoDeuda-i.dejaCuenta))/100).toFixed(2))+"€ ",1)):(0,t.kq)("",!0)])),_:1}),(0,t._)("div",null,[(0,t.Wm)(la,{size:"lg",color:"warning",onClick:e[0]||(e[0]=a=>i.deshacer()),class:"sizeBotones"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("desahcer","Deshacer")),1)])),_:1}),(0,t.Wm)(la,{size:"lg",color:"danger",class:"sizeBotones",onClick:e[1]||(e[1]=a=>i.limpiar())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(a.$t("limpiar","Limpiar")),1)])),_:1})])])),_:1})])),_:1})]),(0,t._)("div",R,[(0,t._)("div",P,[(0,t._)("div",I,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([.01,.02,.05,.1,.2,.5,1,2],(a=>(0,t._)("img",{src:"/img/"+(a<1?100*a+"cts":1==a?"uneuro":"doseuros")+".png",class:"sizeMonedas",onClick:e=>i.sumar(a)},null,8,x))),64))])]),(0,t._)("div",N,[(0,t._)("div",j,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([5,10,20,50,100,200,500],(a=>(0,t._)("img",{src:"/img/"+a+"euros.png",class:"sizeBilletes",onClick:e=>i.sumar(a)},null,8,F))),64))])]),(0,t._)("div",S,[(0,t._)("div",Z,[(0,t._)("div",U,[(0,t._)("img",{disabled:i.loading,src:"img/img-efectivo.png",onClick:e[2]||(e[2]=a=>i.setFormaPago("EFECTIVO")),style:(0,l.j5)("EFECTIVO"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con EFECTIVO"},null,12,V),i.modalTkrsRef&&!i.prohibirTkRestaurant?((0,t.wg)(),(0,t.iD)("img",{key:0,disabled:i.loading,src:"img/img-tkrs.png",onClick:e[3]||(e[3]=a=>i.loading?null:i.modalTkrsRef.abrirModal()),style:(0,l.j5)("TKRS"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con ticket restaurante"},null,12,H)):(0,t.kq)("",!0),0===i.tipoDatafono3G?((0,t.wg)(),(0,t.iD)("img",{key:1,disabled:i.loading,src:"img/img-tarjetas.png",onClick:e[4]||(e[4]=a=>i.setFormaPago("TARJETA")),style:(0,l.j5)("TARJETA"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con TARJETA"},null,12,L)):(0,t.kq)("",!0),1===i.tipoDatafono3G?((0,t.wg)(),(0,t.iD)("img",{key:2,disabled:i.loading,src:"img/img-3g.png",onClick:e[5]||(e[5]=a=>i.setFormaPago("DATAFONO_3G")),style:(0,l.j5)("DATAFONO_3G"===i.formaPago?"zoom: 1.3;":"filter: grayscale(1);"),width:"300",alt:"Seleccionar pago con DATAFONO 3G"},null,12,$)):(0,t.kq)("",!0)])])])])])]),(0,t.Wm)(sa,{ref:"modalTkrsRef"},null,512),(0,t.Wm)(da,{id:"modalNumpad",tabindex:"-1",labelledby:"modalTkrsLabel",modelValue:i.modalNumpad,"onUpdate:modelValue":e[6]||(e[6]=a=>i.modalNumpad=a)},{default:(0,t.w5)((()=>[(0,t.Wm)(ua,null,{default:(0,t.w5)((()=>[(0,t._)("div",q,[(0,t._)("span",W,(0,l.zw)(),1)]),(0,t._)("div",G,[(0,t._)("div",J,[(0,t.Wm)(na,{ref:"numPadRef"},null,512)])])])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(la,{class:"ms-2 botoncicos-abajo volver",disabled:i.loading,color:"warning",onClick:e[7]||(e[7]=a=>i.cancelarVenta())},{default:(0,t.w5)((()=>[(0,t.Wm)(ca,{icon:"arrow-left"})])),_:1},8,["disabled"]),i.loading?((0,t.wg)(),(0,t.iD)("div",Y,[(0,t._)("div",null,[K,(0,t._)("span",Q,(0,l.zw)(i.procesoDatafono),1)])])):(0,t.kq)("",!0),(0,t.Wm)(la,{class:"botonCobrar botoncicos-abajo",color:"primary",disabled:i.loading,onClick:e[8]||(e[8]=a=>i.cobrar()),style:{right:"4vmin"}},{default:(0,t.w5)((()=>[i.loading?((0,t.wg)(),(0,t.iD)("span",X)):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,l.zw)(a.$t("pagar","Pagar")),1)])),_:1},8,["disabled"]),(0,t.Wm)(va,{ref:"CashlogyCobroViewRef"},null,512)])),_:1})])),_:1},8,["modelValue"])}o(57658);var ea=o(44870),oa=o(79066),ta=o(18763),la=o(29665),ia=o(42492),ra=o.n(ia),sa=o(33727),na=o(49242),ua=o(74313),da=o(92136),ca=o(12195),va=o(74025),ma=o(66720),pa=o(68315),ga=o(13150),_a=o(16683),fa=o(34730),Ca=o(88807);const wa=a=>((0,t.dD)("data-v-98d6db00"),a=a(),(0,t.Cn)(),a),ba={key:0,class:"w-100 h-100"},ka={key:0,class:"d-flex flex-column w-100 h-100",style:{"justify-content":"start"}},Da=["src","onClick"],ha=["src","onClick"],ya={class:"frame-Cashlogy",style:{flex:"1 1 auto"}},Aa={class:"col-9 h-100"},Ta={class:"frame-Cashlogy flex-column",style:{"justify-content":"start"}},Ea={style:{"text-align":"start","padding-top":"4rem"}},za=wa((()=>(0,t._)("br",null,null,-1))),Oa={key:0},Ma={key:1},Ba={key:2},Ra={class:"col h-100"},Pa={class:"frame-Cashlogy flex-column"},Ia=wa((()=>(0,t._)("label",null,"Importe entrada manual",-1))),xa=wa((()=>(0,t._)("br",null,null,-1))),Na={key:0,style:{flex:"0 0 20%"},class:"items-Cashlogy"},ja={key:1,style:{flex:"0 0 20%"},class:"items-Cashlogy"},Fa={key:1,class:"frame-Cashlogy flex-column"},Sa=wa((()=>(0,t._)("br",null,null,-1))),Za={key:2,class:"frame-Cashlogy flex-column"},Ua=wa((()=>(0,t._)("br",null,null,-1))),Va={key:1,class:"frame-Cashlogy flex-column"},Ha={class:"d-flex flex-column",style:{gap:"2px"}},La=wa((()=>(0,t._)("span",null,"Falta cambios para la devolución",-1))),$a={key:2,class:"frame-Cashlogy flex-column"},qa={class:"d-flex flex-column",style:{gap:"2px"}},Wa={key:3,class:"frame-Cashlogy flex-column"},Ga=wa((()=>(0,t._)("br",null,null,-1)));var Ja={__name:"CashlogyCobroView",setup(a,{expose:e}){const o=(0,ea.iH)(null),i=(0,ea.iH)(null),r=(0,ea.iH)(""),s=(0,ea.iH)(""),n=(0,ea.iH)(""),u=(0,ea.iH)(""),d=(0,ea.iH)(""),c=(0,ea.iH)(""),v=(0,ea.iH)(!1),m=(0,ea.iH)(!1),p=(0,ea.iH)(!1),g=((0,ea.iH)(!1),(0,ea.iH)(!1)),_=(0,ea.iH)("Dispensando");function f(a){return a?"CANCELAR MANUALMENTE":"DEVOLUCIÓN MANUAL"}async function C(){return ga.Z.activado()}const w=(0,ea.iH)({});function b(){m.value=!0,ga.Z.boton_pulsar("BOT_CANCELAR")}const k=(0,ea.iH)(!1);function D(){k.value=!0,y.value=(0,_a.vg)(A)}function h(a){A=(0,_a.ul)((0,_a.XX)(z())+a),y.value=(0,_a.vg)(A)}const y=(0,ea.iH)("");let A=0,T=(0,_a.vg)(1.23).charAt(1),E=2;function z(){if(!y.value)return 0;let a=y.value,[e,o]=a.split(T);e||(e="0"),o||(o="0");while(o.length<E)o+="0";let t=100*parseInt(e,10)+parseInt(o,10);return t/100}function O(a){let e=y.value,[o,t]=e.split(T);if("number"==typeof a){if(null!=t){if(t.length>=E)return}else if(o.length>=8)return;"0"==e&&(e=""),e+=a.toString(),y.value=e}else if("C"==a)e="",y.value=e;else if(a==T){if(null!=t)return;""==e&&(e="0"),e+=a,y.value=e}A=z()}function M(){k.value=!1,A=z(),ga.Z.importe_entrado_manualmente_en_cobrar(A)}function B(){k.value=!1}const R=(0,ea.iH)(""),P=new _a.JQ((a=>{n.value=(0,_a.vg)(a.importe_falta_devolver,!0),g.value=a.opcion_cancelar,R.value=f(a.cancelando),N.value="PANTALLA_FALTA_CAMBIO_DEVOLUCION"}));function I(){p.value=!0,ga.Z.boton_pulsar("BOT_ACEPTAR")}const x=(0,ea.iH)(),N=(0,ea.iH)(null);function j(a){da.socket[a]("Cashlogy.update",F)}function F(a){switch(N.value=a.proceso,a.proceso){case"COBRAR":switch(x.value=a.state,a.state){case"ENTRADA":r.value=(0,_a.vg)(a.importe_entrado,!0),v.value=a.importe_pendiente<0,v.value?n.value=(0,_a.vg)(-a.importe_pendiente,!0):s.value=(0,_a.vg)(a.importe_pendiente,!0),c.value=(0,_a.vg)(a.importe_entrado_manualmente,!0);break;case"VUELTA":case"CANCELAR":n.value=(0,_a.vg)(a.importe_a_devolver,!0);break}break;case"AÑADIR_CAMBIOS":w.value=(0,_a.c)(a),u.value=(0,_a.vg)(a.importe_entrado,!0),d.value=(0,_a.vg)(a.importe_recicladores,!0);break;case"SOLO_DISPENSAR":n.value=(0,_a.vg)(a.importe_a_devolver,!0);break}}let S=!1;async function Z(a,e,t){let l;if(S=!0,N.value=null,Ca.Z.Info({importe_a_cobrar:a,totalRecibido:e,cantidadTkrs:t},"CashlogyCobroView","run-in"),await(0,_a.R_)(o),o.value.texto_botones_para_abort("COBRAR MANUALMENTE","CANCELAR COBRO"),l=await o.value.start(),l)return Ca.Z.Info(l,"CashlogyCobroView","run-out"),S=!1,l;j("on");try{await ga.Z.saveGrupoProcesos("COBRAR",{importe_a_cobrar:a}),m.value=!1,A=e+t,await ga.Z.importe_entrado_manualmente_en_cobrar(A);let r=await ga.Z.cobrar(a);if(null!=r.importe_entrado&&(o.value.texto_botones_para_abort(f(r.operativa_cancelar)),await ga.Z.saveGrupoProcesos(null,{importe_entrado:r.importe_entrado})),l=await(o.value?.informacionAbort_y_cancel(r)),!l){l=null;let a=r.importe_falta_devolver??0,e=0,t=r.error_en_la_devolucion,s=r.operativa_cancelar;_.value=s?"Cancelando":"Dispensando";while(!l){if(N.value="ERROR_DEVOLUCION",await(0,_a.R_)(i),await i.value.run({error_en_la_devolucion:t}),0==a){l={cancelado:s,importe_falta_devolver:0,importe_anadido_en_cambios:e};break}let[n,u]=await o.value.startPantalla_withReset(P,{importe_falta_devolver:a,opcion_cancelar:!s&&0==r.importe_devuelto&&a==r.importe_falta_devolver,cancelando:s});if(u)l=u;else if("AÑADIR"==n){N.value=null,p.value=!1;let i=await ga.Z.anadir_cambios_y_devolver(a);l=await(o.value?.informacionAbort_y_cancel(i)),l?l.importe_falta_devolver=a:(t=i.error_en_la_devolucion,a=i.importe_falta_devolver,e+=i.importe_anadido_en_cambios,await ga.Z.saveGrupoProcesos(null,{importe_anadido_en_cambios:e}))}else if("CANCELAR"==n){s=!0,o.value.texto_botones_para_abort(f(!0)),a=r.importe_entrado,_.value="Cancelando";let e=await ga.Z.solo_dispensar(a);l=await(o.value?.informacionAbort_y_cancel(e)),l?l.importe_falta_devolver=a:(t=e.error_en_la_devolucion,a=e.importe_falta_devolver)}else l={cancelado:s,importe_falta_devolver:a,importe_anadido_en_cambios:e}}}l.abort_id||(await ga.Z.saveGrupoProcesos(null),await(0,fa.i_)(l.importe_anadido_en_cambios,"Añadir Cambios","ENTRADA_DINERO"))}catch(r){console.log(r),l={cancelado:!0}}return j("off"),o.value?.end(),Ca.Z.Info(l,"CashlogyCobroView","run-out"),S=!1,l}return(0,t.Ah)((()=>{S&&ga.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),e({run:Z,activado:C}),(a,e)=>((0,t.wg)(),(0,t.j4)(pa.Z,{enProceso:null!=N.value,ref_key:"CashlogyPantalla_ref",ref:o},{default:(0,t.w5)((()=>["COBRAR"==N.value?((0,t.wg)(),(0,t.iD)("div",ba,["ENTRADA"==x.value?((0,t.wg)(),(0,t.iD)("div",ka,[(0,t._)("div",{class:"text-end",style:(0,l.j5)({visibility:k.value?"visible":"hidden"})},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([1,2,5,10,20,50,100,200],(a=>(0,t._)("img",{src:(0,ea.SU)(_a.Cq)("monedas",a),class:"sizeMonedas",onClick:e=>h(a)},null,8,Da))),64))],4),(0,t._)("div",{class:"text-end",style:(0,l.j5)([{"margin-top":"2vmin"},{visibility:k.value?"visible":"hidden"}])},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)([500,1e3,2e3,5e3,1e4,2e4,5e4],(a=>(0,t._)("img",{src:(0,ea.SU)(_a.Cq)("billetes",a),class:"sizeBilletes",onClick:e=>h(a)},null,8,ha))),64))],4),(0,t._)("div",ya,[(0,t._)("div",Aa,[(0,t._)("div",Ta,[(0,t._)("div",Ea,[(0,t.Uk)(" Importe entrado: "+(0,l.zw)(r.value),1),za,v.value?((0,t.wg)(),(0,t.iD)("div",Ma," Importe a devolver: "+(0,l.zw)(n.value),1)):((0,t.wg)(),(0,t.iD)("div",Oa," Importe pendiente: "+(0,l.zw)(s.value),1)),c.value?((0,t.wg)(),(0,t.iD)("div",Ba," Importe manual: "+(0,l.zw)(c.value),1)):(0,t.kq)("",!0)])])]),(0,t._)("div",Ra,[(0,t._)("div",Pa,[(0,t._)("div",{style:(0,l.j5)([{flex:"0 0 35%","align-content":"center"},{visibility:k.value?"visible":"hidden"}])},[((0,t.wg)(),(0,t.j4)(ma.Z,{key:0,tipo_importe:"",onClickKey:O}))],4),(0,t._)("div",{style:(0,l.j5)({visibility:k.value?"visible":"hidden"})},[Ia,xa,(0,t.wy)((0,t._)("input",{type:"text",readonly:"",onFocus:e[0]||(e[0]=a=>{a.currentTarget?.blur?.()}),"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),class:"cashlogyCierreFondoCaja_selected",style:{"text-align":"end","border-radius":"4px"}},null,544),[[na.nr,y.value]])],4),k.value?((0,t.wg)(),(0,t.iD)("div",Na,[(0,t.Wm)((0,ea.SU)(ua.$v),{onClick:M,color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Aceptar ")])),_:1}),(0,t.Wm)((0,ea.SU)(ua.$v),{onClick:B,color:"danger",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cancelar ")])),_:1})])):((0,t.wg)(),(0,t.iD)("div",ja,[(0,t.Wm)((0,ea.SU)(ua.$v),{disabled:m.value,onClick:b,color:"danger",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cancelar ")])),_:1},8,["disabled"]),(0,t.Wm)((0,ea.SU)(ua.$v),{disabled:m.value,onClick:D,color:"warning",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Cobro Manual ")])),_:1},8,["disabled"])]))])])])])):(0,t.kq)("",!0),"VUELTA"==x.value?((0,t.wg)(),(0,t.iD)("div",Fa,[(0,t.Uk)(" Dispensando"),Sa,(0,t.Uk)(" Importe a devolver: "+(0,l.zw)(n.value),1)])):(0,t.kq)("",!0),"CANCELAR"==x.value?((0,t.wg)(),(0,t.iD)("div",Za,[(0,t.Uk)(" Cancelando"),Ua,(0,t.Uk)(" Importe a devolver: "+(0,l.zw)(n.value),1)])):(0,t.kq)("",!0)])):(0,t.kq)("",!0),"PANTALLA_FALTA_CAMBIO_DEVOLUCION"==N.value?((0,t.wg)(),(0,t.iD)("div",Va,[(0,t._)("div",Ha,[La,(0,t._)("span",null,"Importe falta devolver: "+(0,l.zw)(n.value),1),(0,t.Wm)((0,ea.SU)(ua.$v),{onClick:e[2]||(e[2]=a=>(0,ea.SU)(P).R("AÑADIR")),color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" añadir cambios ")])),_:1}),(0,t.Wm)((0,ea.SU)(ua.$v),{onClick:e[3]||(e[3]=a=>(0,ea.SU)(P).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,l.zw)(R.value),1)])),_:1}),g.value?((0,t.wg)(),(0,t.j4)((0,ea.SU)(ua.$v),{key:0,onClick:e[4]||(e[4]=a=>(0,ea.SU)(P).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" cancelar ")])),_:1})):(0,t.kq)("",!0)])])):(0,t.kq)("",!0),"AÑADIR_CAMBIOS"==N.value?((0,t.wg)(),(0,t.iD)("div",$a,[(0,t.Wm)(ca.Z,{tabla:w.value,style:{flex:"0 0 75%"}},null,8,["tabla"]),(0,t._)("div",qa,[(0,t._)("span",null,"Importe introducido : "+(0,l.zw)(u.value),1),(0,t._)("span",null,"Importe total: "+(0,l.zw)(d.value),1),(0,t._)("span",null,"Importe falta devolver: "+(0,l.zw)(n.value),1),(0,t.Wm)((0,ea.SU)(ua.$v),{disabled:p.value,onClick:I,color:"success",class:"boton-Cashlogy"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Aceptar ")])),_:1},8,["disabled"])])])):(0,t.kq)("",!0),"SOLO_DISPENSAR"==N.value?((0,t.wg)(),(0,t.iD)("div",Wa,[(0,t._)("div",null,[(0,t.Uk)((0,l.zw)(_.value),1),Ga,(0,t.Uk)(" Importe a devolver: "+(0,l.zw)(n.value),1)])])):(0,t.kq)("",!0),"ERROR_DEVOLUCION"==N.value?((0,t.wg)(),(0,t.j4)(va.Z,{key:4,ref_key:"CashlogyErrorDevolucion_ref",ref:i},null,512)):(0,t.kq)("",!0)])),_:1},8,["enProceso"]))}},Ya=o(40089);const Ka=(0,Ya.Z)(Ja,[["__scopeId","data-v-98d6db00"]]);var Qa=Ka,Xa=o(91076),ae=o(20065),ee=o(22483),oe={name:"CobroView",components:{CambioComponent:oa.Z,MDBCard:ua.Yl,MDBBtn:ua.$v,MDBCardBody:ua.H7,MDBCardText:ua.Pp,NumpadComponent:sa.Z,VolverComponent:ta.Z,ModalTkrsComponent:la.Z,MDBIcon:ua.vm,MDBModal:ua.j3,MDBModalBody:ua.Yz,CashlogyCobroView:Qa},setup(a,{expose:e}){const o=(0,ae.oR)(),l=(0,ee.tv)(),i=(0,ea.iH)(!1),r=(0,ea.iH)(!1),s=(0,t.Fl)((()=>o.state.Datafono.procesoActual)),n=(0,ea.iH)(null),u=(0,ea.iH)("EFECTIVO"),d=(0,ea.iH)(0),c=(0,ea.iH)(null),v=(0,ea.iH)(!1),m=(0,ea.iH)(!1),p=(0,ea.iH)(0),g=(0,ea.iH)(!1),_=(0,ea.iH)(0),f=(0,ea.iH)(0),C=(0,ea.iH)([]),w=(0,ea.iH)(null),b=(0,t.Fl)((()=>F.value?.lista)),k=(0,t.Fl)((()=>D&&"PAGO COMBINADO"==h.value?F?.value?.listaDeudas||[]:D&&"PAGO DEUDA"==h.value?F?.value?.lista||[]:null)),D=(0,t.Fl)((()=>"PAGO DEUDA"==F?.value?.modo||"PAGO COMBINADO"==F?.value?.modo)),h=(0,t.Fl)((()=>F?.value?.modo)),y=((0,t.f3)("resetGeneral"),(0,ea.iH)(null));let A=(0,t.Fl)((()=>{if(x.value&&x.value-p.value<0)return 0;if(x.value){let a=f.value==x.value?I.value:0;return x.value-(_.value+p.value+a)}if(f.value-p.value<0)return 0;{let a=f.value==x.value?I.value:0;return"RECOGER ENCARGO"!=F?.value?.modo&&"PAGO DEUDA"!=F?.value?.modo&&"PAGO COMBINADO"!=F?.value?.modo||(a=I.value),Math.round(100*(f.value-(_.value+p.value+a)))/100}}));function T(){const a=F?.value?.modo||{};return"PAGO DEUDA"==a&&x.value>0?(Math.round(100*(_.value+p.value-x.value))/100).toFixed(2):"RECOGER ENCARGO"==a?(Math.round(100*(I.value+_.value+p.value-f.value))/100).toFixed(2):(Math.round(100*(_.value+p.value+I.value-f.value))/100).toFixed(2)}const E=(0,t.Fl)((()=>o.state.Trabajadores.indexActivo)),z=(0,t.Fl)((()=>o.state.Trabajadores.arrayTrabajadores)),O=(0,t.Fl)((()=>o.state.Cestas.arrayCestas)),M=(0,t.Fl)((()=>{const a=o.state.Cestas.Descuento;return void 0===a||isNaN(a)?0:a})),B=(0,t.Fl)((()=>z.value&&void 0!=E.value&&null!=E.value&&z.value[E.value]?z.value[E.value]:null)),R=(0,t.Fl)((()=>o.state.Deudas.deudasSeleccionadas)),P=(0,t.Fl)((()=>o.state.Encargos.encargoSeleccionado)),I=(0,t.Fl)((()=>{if(R.value.length>0){let a=0;for(const e of R.value)e.dejaCuenta&&(a+=e.dejaCuenta);return a}return P.value&&"RECOGER ENCARGO"==F?.value?.modo&&P.value.dejaCuenta||0})),x=(0,t.Fl)((()=>o.state.Deudas.totalAPagar));function N(a){p.value=Number(a),a>=X(F.value)?u.value="TKRS":u.value="EFECTIVO"}function j(a){g.value||(p.value<X(F.value)&&p.value>=0?"TARJETA"===a&&p.value>0?ra().fire("Oops...","De momento el Ticket Restaurant solo se puede combinar con EFECTIVO","error"):u.value=a:ra().fire("¡Eo!","El ticket resturant ya cubre el total de la venta","error"))}const F=(0,t.Fl)((()=>{if(O.value)for(let a=0;a<O.value.length;a++)if(O.value[a]._id==z.value[E.value].idCesta)return O.value[a];return null}));async function S(a){const e=F.value?F.value.lista.filter((a=>a.pagado)).reduce(((a,e)=>a+e.subtotal),0):0;f.value=F.value?X(F.value)-e:0,i.value=!0}async function Z(){g.value?Ca.Z.Warn(`cobrar loading.value: ${g.value}`,"modalCobroView.vue"):(g.value=!0,Ca.Z.Info("cobrar inicio","modalCobroView.vue"),"PAGO COMBINADO"==F.value.modo?await U():"PAGO DEUDA"==F.value.modo?await V():await H())}async function U(){try{const a=JSON.parse(JSON.stringify(F.value.lista)),e=a.some((a=>a.pagado));if("TARJETA"==u.value){o.dispatch("Datafono/setEstado","PENDIENTE");const a=await Xa.Z.post("tickets/crearPagoCombinadoPaytef",{total:X(F.value),idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:I.value,arrayDeudas:R.value});if(!a.data)throw Error("Pago con datáfono invalido")}else{if("EFECTIVO"==u.value&&A.value>0&&await w.value.activado()){let a=await w.value.run(f.value,_.value,p.value);if(a.cancelado)throw new Error("Pago cancelado")}const a=await Xa.Z.post("tickets/crearPagoCombinado",{total:X(F.value),idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:I.value,arrayDeudas:R.value});if(!a.data)throw Error("No se ha podido crear el ticket")}ra().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),await Xa.Z.post("impresora/saludo").catch((a=>{ra().fire("Oops...",a.message,"error")})),await Xa.Z.post("cestas/deselectClient",{idCesta:o.getters["Cestas/getCestaBaseActivo"]}),await Xa.Z.post("cestas/borrarCesta",{idCesta:o.getters["Cestas/getCestaBaseActivo"],quitarCliente:!0}),W(),J(),await Q(F.value._id),u.value="EFECTIVO",K(!0)}catch(a){ra().fire("Oops...",a.message,"error")}g.value=!1,la(),Ca.Z.Info("cobrar fin","modalCobroView.vue")}async function V(){try{let a;if("TARJETA"==u.value)a=await Xa.Z.post("deudas/crearPagoDeudaPaytef",{total:X(F.value),pagoParcial:x.value,idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:p.value,formaPago:"EFECTIVO"},arrayDeudas:R.value});else{if("EFECTIVO"==u.value&&A.value>0&&await w.value.activado()){let a=await w.value.run(f.value,_.value,p.value);if(a.cancelado)throw new Error("Pago cancelado")}a=await Xa.Z.post("deudas/crearPagoDeuda",{total:X(F.value),pagoParcial:x.value,idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:p.value,formaPago:"EFECTIVO"},arrayDeudas:R.value})}if(!a.data){if("TARJETA"==u.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el pago de deuda")}ra().fire({icon:"success",title:"Pago deuda registrada correctamente",showConfirmButton:!1,timer:500}),await Xa.Z.post("impresora/saludo").catch((a=>{ra().fire("Oops...",a.message,"error")})),await Xa.Z.post("cestas/deselectClient",{idCesta:o.getters["Cestas/getCestaBaseActivo"]}),W(),J(),await Q(F.value._id),u.value="EFECTIVO",K(!0)}catch(a){ra().fire("Oops...",a.message,"error")}g.value=!1,la()}async function H(){try{const a=JSON.parse(JSON.stringify(F.value.lista)),e=a.some((a=>a.pagado));let t;const l="PAGO SEPARADO"==F.value.modo,i="RECOGER ENCARGO"==F.value.modo,r=l||i?I.value:0,s=i?F.value.nombreCliente:null,n=X(F.value);if("TARJETA"==u.value)o.dispatch("Datafono/setEstado","PENDIENTE"),t=await Xa.Z.post("tickets/crearTicketPaytef",{total:X(F.value),idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:I.value});else{if("EFECTIVO"==u.value&&A.value>0&&await w.value.activado()){let a=await w.value.run(f.value,_.value,p.value);if(a.cancelado)throw new Error("Pago cancelado")}t=await Xa.Z.post("tickets/crearTicket",{total:n,idCesta:F.value._id,idTrabajador:B.value._id,tipo:u.value,tkrsData:{cantidadTkrs:Number((Math.round(100*p.value)/100).toFixed(2)),formaPago:"EFECTIVO"},honei:e,dejaCuenta:I.value})}if(!t.data){if("TARJETA"==u.value)throw Error("Pago con datáfono invalido");throw Error("No se ha podido crear el ticket")}if(r>0&&i&&"TARJETA"!=u.value){const a=t.data;Xa.Z.post("movimientos/nuevoMovimiento",{cantidad:r,concepto:"dejaACuenta",idTrabajador:B.value._id,tipo:"SALIDA",idTicket:a,nombreCliente:s}).then((e=>{if(!e.data)throw Error("No se ha podido realizar la salida de dinero");if(r>n){const e=Math.round(100*(r-n))/100;$(e,s,B.value._id,a)}})).catch((a=>{ra().fire("Oops...",a.message,"error")}))}ra().fire({icon:"success",title:"Venta registrada correctamente",showConfirmButton:!1,timer:500}),await Xa.Z.post("impresora/saludo").catch((a=>{ra().fire("Oops...",a.message,"error")})),(m.value&&"TARJETA"!=u.value||i)&&await L(),i&&await Xa.Z.post("cestas/deselectClient",{idCesta:o.getters["Cestas/getCestaBaseActivo"]}),(l||i)&&await Q(F.value._id),i&&(Xa.Z.post("encargos/setEntregado",{id:P.value._id}),G()),q(),u.value="EFECTIVO",K(!0)}catch(a){ra().fire("Oops...",a.message,"error")}g.value=!1,la(),Ca.Z.Info("cobrar fin","modalCobroView.vue")}async function L(){await Xa.Z.post("tickets/getUltimoTicket").then((async a=>{a.data[0]?._id?await Xa.Z.post("impresora/imprimirTicket",{idTicket:a.data[0]?._id}).catch((a=>{ra().fire("Oops...",a.message,"error")})):ra().fire("AVISO","Crea un ticket en esta caja abierta","info")}))}function $(a,e,o,t){Xa.Z.post("movimientos/nuevoMovimiento",{cantidad:a,concepto:"dejaACuentaSobrante",idTrabajador:o,tipo:"SALIDA",idTicket:t,nombreCliente:e}).then((a=>{if(!a.data)throw Error("No se ha podido realizar la salida de dinero")})).catch((a=>{console.log("Oops...",a.message,"error")}))}function q(){let a=!1;O.value.forEach((e=>{if(!a&&e.trabajador===z.value[E.value]._id&&"DEVOLUCION"!=e.modo){a=!0;let o=e._id;Xa.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o,idTrabajador:z.value[E.value]._id})}}))}function W(){o.dispatch("Deudas/deleteDeudasSeleccionadas")}function G(){o.dispatch("Encargos/deleteEncargoSeleccionado")}function J(){o.dispatch("Deudas/deleteTotalAPagar")}async function Y(){Ca.Z.Info(`cancelarVenta loading:${g.value}`,"modalCobroView.vue"),K(),la(),"PAGO DEUDA"==F.value.modo||"PAGO COMBINADO"==F.value.modo?(J(),W(),await Q(F.value._id)):"PAGO SEPARADO"==F.value.modo&&await Xa.Z.post("cestas/DevolverProductosACestaSep",{cesta:o.getters["Cestas/getCestaBaseActivo"],articulos:F.value.lista}).then((async a=>{await Q(F.value._id)}))}function K(a=!1){const e=l.currentRoute.value.path;o.dispatch("ModalCobroView/cerrarModalCobroView"),"/cestas"===e&&a&&l.push("/main"),i.value=!1}async function Q(a){Xa.Z.post("cestas/fulminarCesta",{idCesta:a}).catch((a=>{ra().fire({icon:"error",title:"Error al eliminar la cesta utilizada.",showConfirmButton:!1,timer:500})})),await Xa.Z.post("cestas/cambiarCestaTrabajador",{idCesta:o.getters["Cestas/getCestaBaseActivo"],idTrabajador:z.value[o.state.Trabajadores.indexActivo]._id}).then((a=>{o.dispatch("Cestas/setCestaBaseAction",null)}))}function X(a){const e=a.detalleIva,o=Object.keys(e).filter((a=>a.startsWith("importe"))).reduce(((a,o)=>a+e[o]),0);return Math.round(100*o)/100}function aa(){Xa.Z.get("caja/estadoCaja").then((a=>{1==a.data&&ra().fire("Caja cerrada automáticamente.","La caja de ayer se ha cerrado automáticamente debido a que no se cerró.","error"),1!=a.data&&3!=a.data||void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id?void 0==o.getters["Trabajadores/getTrabajadorActivo"]?._id&&l.push("/menu/fichajes"):l.push("/abrirCaja")})).catch((a=>{ra().fire("Oops...",a.message,"error")}))}function oa(a){_.value+=a,C.value.push(a)}function ta(){C.value.pop();let a=0;C.value.forEach((e=>{a+=e})),_.value=a}function la(){_.value=0,p.value=0,C.value=[],A=(0,t.Fl)((()=>f.value-p.value<0?0:f.value-(_.value+p.value)))}function ia(a){f.value=Number(a)}return(0,t.JJ)("setTkrs",N),e({abrirModal:S}),(0,t.bv)((()=>{aa(),Xa.Z.post("parametros/getParametros").then((a=>{"3G"!==a.data?.tipoDatafono&&"0.0.0.0"!=a.data?.ipTefpay||(d.value=1),void 0!=a.data?.params?.SempreTicket?"Si"==a.data?.params?.SempreTicket&&(m.value=!0):m.value=!1,void 0!=a.data?.params?.prohibirTkRestaurant?"Si"==a.data?.params?.prohibirTkRestaurant&&(v.value=!0):v.value=!1}))})),{DescuentoCliente:M,cesta:F,getTotal:X,cobrar:Z,formaPago:u,modalTkrsRef:c,prohibirTkRestaurant:v,setFormaPago:j,loading:g,tipoDatafono3G:d,eliminarAlPagarFnc:Q,modalNumpad:r,cancelarVenta:Y,modalCobro:i,abrirModal:S,sumar:oa,totalRecibido:_,aPagar:f,numPadRef:n,deshacer:ta,limpiar:la,procesoDatafono:s,setTkrs:N,cantidadTkrs:p,setAPagar:ia,cuenta:A,productos:b,cliente:y,dejaCuenta:I,deudasSeleccionadas:R,montoDeuda:x,CashlogyCobroViewRef:w,valorSobra:T,productosDeuda:k,mostrarListaDeudas:D,modoCesta:h}}};const te=(0,Ya.Z)(oe,[["render",aa],["__scopeId","data-v-1cb56c8b"]]);var le=te}}]);
//# sourceMappingURL=580.d17e598f.js.map