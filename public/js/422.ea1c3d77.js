"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[422],{50422:function(a,e,o){o.r(e),o.d(e,{default:function(){return Q}});var t=o(73396),r=o(87139);const s={key:0,class:"row mt-2 overflow-auto sizeGeneral"},l={key:0},i={key:1},n={key:0,style:{"font-size":"1.2rem"}},d={class:"overflow-auto text-truncate listaCesta"},u={class:"list-group"},c={class:"d-inline-block text-truncate",style:{"max-width":"12rem"}},v={class:"ms-1",style:{"vertical-align":"top"}},m={class:"trabajadores"},b={key:1,class:"row sizeGeneral m-0 mt-1"},p={key:2,class:"position-absolute bottom-0 start-0"};function f(a,e,o,f,C,g){const y=(0,t.up)("MDBCardTitle"),M=(0,t.up)("MDBCardText"),w=(0,t.up)("MDBBtn"),k=(0,t.up)("MDBCardBody"),_=(0,t.up)("MDBBadge"),D=(0,t.up)("MDBCard"),h=(0,t.up)("MesasComponent"),B=(0,t.up)("CobroSeparadoMesas");return(0,t.wg)(),(0,t.iD)(t.HY,null,[!f.vistaMesas&&f.arrayTrabajadores&&f.arrayCestas&&null!=f.indexActivoTrabajador&&void 0!=f.indexActivoTrabajador?((0,t.wg)(),(0,t.iD)("div",s,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(f.totalRows,((a,e)=>((0,t.wg)(),(0,t.iD)("div",{class:"row",key:e},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(4,((a,o)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:o},[4*e+o+1<=f.arrayCestas.length&&(null!=f.arrayCestas[4*e+o].indexMesa||f.arrayCestas[4*e+o].trabajador===f.arrayTrabajadores[f.indexActivoTrabajador]._id)||"DEVOLUCION"==f.arrayCestas[4*e+o]?.modo?((0,t.wg)(),(0,t.j4)(D,{key:0,onClick:a=>f.seleccionar(f.arrayCestas[4*e+o]),class:(0,r.C_)(["cesta mb-3 ms-2 me-1",{cestaActiva:f.arrayCestas[4*e+o]._id===f.idCestaSeleccionada}]),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(k,null,{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(f.arrayCestas[4*e+o].modo)+" ",1),null===f.arrayCestas[4*e+o].indexMesa?((0,t.wg)(),(0,t.iD)("a",l,[(0,t.Uk)(" de "),(0,t._)("i",null,(0,r.zw)(f.getNombreByID(f.arrayCestas[4*e+o].trabajador)),1)])):(0,t.kq)("",!0),f.arrayMesas[4*e+o]&&null!=f.arrayCestas[4*e+o].indexMesa?((0,t.wg)(),(0,t.iD)("span",i,"Mesa: "+(0,r.zw)(f.arrayMesas[f.arrayCestas[4*e+o].indexMesa].nombre),1)):(0,t.kq)("",!0)])),_:2},1024),(0,t.Wm)(M,null,{default:(0,t.w5)((()=>["VENTA"===f.arrayCestas[4*e+o].modo?((0,t.wg)(),(0,t.iD)("span",n,"Total: "+(0,r.zw)(f.getTotal(f.arrayCestas[4*e+o]).toFixed(2))+" €",1)):(0,t.kq)("",!0),(0,t._)("div",d,[(0,t._)("ul",u,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(f.arrayCestas[4*e+o].lista,((a,e)=>((0,t.wg)(),(0,t.iD)("li",{key:e,class:"list-group-item"},[(0,t._)("span",c,(0,r.zw)(a.nombre),1),(0,t._)("span",v,"x"+(0,r.zw)(a.unidades),1)])))),128))])])])),_:2},1024),f.arrayMesas[4*e+o]&&null!=f.arrayCestas[4*e+o].indexMesa&&(f.arrayCestas[4*e+o].lista.length>1||f.arrayCestas[4*e+o].lista[0]?.unidades>1)?((0,t.wg)(),(0,t.j4)(w,{key:0,onClick:a=>f.PagarSeparado(f.arrayCestas[4*e+o],4*e+o),style:{"font-size":"16px"},color:"secondary d-inline-block"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Pagar por separado ")])),_:2},1032,["onClick"])):(0,t.kq)("",!0)])),_:2},1024),(0,t._)("div",m,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(f.arrayCestas[4*e+o].trabajadores,((a,e)=>((0,t.wg)(),(0,t.j4)(y,null,{default:(0,t.w5)((()=>[(0,t.Wm)(_,{color:"info",class:"text-dark",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(f.arrayTrabajadoresID[a]),1)])),_:2},1024)])),_:2},1024)))),256))])])),_:2},1032,["onClick","class"])):(0,t.kq)("",!0)],64)))),64))])))),128))])):(0,t.kq)("",!0),f.vistaMesas?((0,t.wg)(),(0,t.iD)("div",b,[(0,t.Wm)(h)])):(0,t.kq)("",!0),f.vistaMesas?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",p,[(0,t._)("button",{onClick:e[0]||(e[0]=a=>f.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("volver","VOLVER")),1)])),(0,t.Wm)(B,{ref:"CobroSeparadoRef"},null,512)],64)}var C=o(44870),g=o(20065),y=o(74313),M=o(54455),w=o(44161),k=o(42492),_=o.n(k);const D=["onClick"],h={class:"nombreMesa"},B={key:0,class:"trabajadores"},x={class:"position-relative footer"},z={class:"position-absolute bottom-0 start-0"},j={class:"position-absolute bottom-0 end-0"};function T(a,e,o,s,l,i){const n=(0,t.up)("MDBBadge"),d=(0,t.up)("MDBInput"),u=(0,t.up)("MDBModalBody"),c=(0,t.up)("MDBBtn"),v=(0,t.up)("MDBModalFooter"),m=(0,t.up)("MDBModal"),b=(0,t.up)("MDBIcon"),p=(0,t.up)("CobroSeparadoMesas");return(0,t.wg)(),(0,t.iD)(t.HY,null,[s.arrayMesas.length>0?((0,t.wg)(),(0,t.iD)(t.HY,{key:0},(0,t.Ko)(5,((a,e)=>(0,t._)("div",{class:"row p-0",key:e},[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(10,((a,o)=>(0,t._)("div",{class:(0,r.C_)(["mesa ms-3",[0===o?"ms-5":"",o+10*e===s.indexMesaActiva&&s.modoEdicion?"border border-4 border-dark":"",s.cestaSeleccionada===s.arrayMesas[o+10*e].idCesta?"seleccionada":"",s.tieneCosas(s.arrayMesas[o+10*e].idCesta)?"tieneCosas":"",s.arrayMesas[o+10*e].nombre?"habilitada":"deshabilitada"]]),key:o,onClick:a=>s.handleClick(o+10*e)},[(0,t._)("span",h,(0,r.zw)(s.arrayMesas[o+10*e].nombre),1),s.arrayMesas[o+10*e].nombre?((0,t.wg)(),(0,t.iD)("div",B,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(s.getCestaById(s.arrayMesas[o+10*e].idCesta)?.trabajadores,((a,e)=>((0,t.wg)(),(0,t.j4)(n,{color:"info",class:"text-dark trabajador",pill:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(s.getNombreTrabajadorById(a)),1)])),_:2},1024)))),256))])):(0,t.kq)("",!0)],10,D))),64))]))),64)):(0,t.kq)("",!0),(0,t._)("div",x,[(0,t._)("div",z,[(0,t._)("button",{onClick:e[0]||(e[0]=a=>s.volver()),class:"btn btn-warning ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("volver","Volver")),1)]),(0,t._)("div",j,[s.arrayMesas&&null!=s.indexMesaActiva&&void 0!=s.indexMesaActiva&&s.arrayMesas[s.indexMesaActiva]&&s.arrayMesas[s.indexMesaActiva].nombre&&s.modoEdicion?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:e[1]||(e[1]=a=>s.desactivarMesa()),class:"btn btn-danger ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("eliminar_cesta","Eliminar cesta")),1)):(0,t.kq)("",!0),s.arrayMesas&&null!=s.indexMesaActiva&&void 0!=s.indexMesaActiva&&s.arrayMesas[s.indexMesaActiva]&&s.arrayMesas[s.indexMesaActiva].nombre&&s.modoEdicion?((0,t.wg)(),(0,t.iD)("button",{key:1,onClick:e[2]||(e[2]=a=>s.toggleModotransferir()),class:"btn btn-secondary ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("transferir_articulos","Tranferir articulos")),1)):(0,t.kq)("",!0),s.arrayMesas&&null!=s.indexMesaActiva&&void 0!=s.indexMesaActiva&&s.arrayMesas[s.indexMesaActiva]&&s.arrayMesas[s.indexMesaActiva].nombre&&s.modoEdicion?((0,t.wg)(),(0,t.iD)("button",{key:2,onClick:e[3]||(e[3]=a=>s.modalNombreMesa=!0),class:"btn btn-info ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("cambiar_nombre","Cambiar nombre")),1)):s.modoEdicion?((0,t.wg)(),(0,t.iD)("button",{key:3,onClick:e[4]||(e[4]=a=>s.activarMesa()),class:"btn btn-success ms-2",style:{"font-size":"27px"}},(0,r.zw)(a.$t("activar_cesta","Activar cesta")),1)):s.modoEdicion?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("button",{key:4,onClick:e[5]||(e[5]=a=>s.pagarPorSeparado()),class:(0,r.C_)(["btn",s.pagarNoJunto?"btn-warning":"btn-success","ms-2"]),style:{"font-size":"27px"}},(0,r.zw)(a.$t("pagar_por_separado","Pagar por separado")),3))])]),(0,t.Wm)(m,{id:"modalNombreMesa",tabindex:"-1",modelValue:s.modalNombreMesa,"onUpdate:modelValue":e[9]||(e[9]=a=>s.modalNombreMesa=a)},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{label:"Introduce el nombre de la mesa",size:"lg",modelValue:s.inputNombre,"onUpdate:modelValue":e[6]||(e[6]=a=>s.inputNombre=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{color:"secondary",size:"lg",onClick:e[7]||(e[7]=a=>s.modalNombreMesa=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(a.$t("cerrar","Cerrar")),1)])),_:1}),(0,t.Wm)(c,{color:"primary",size:"lg",onClick:e[8]||(e[8]=a=>s.cambiarNombre())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(a.$t("guardar_cambios","Guardar cambios")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{color:"dark",floating:"",id:"editBtn",onClick:e[10]||(e[10]=a=>s.toggleEdicion())},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{icon:"edit"})])),_:1}),(0,t.Wm)(c,{color:"dark",floating:"",id:"userBtn",onClick:e[11]||(e[11]=a=>s.handleClick("",!0))},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{icon:"user"})])),_:1}),(0,t.Wm)(p,{ref:"CobroSeparadoRef"},null,512)],64)}const A=a=>((0,t.dD)("data-v-cc3f5faa"),a=a(),(0,t.Cn)(),a),S={class:"row"},H=["onClick"],E=A((()=>(0,t._)("br",null,null,-1))),F={class:"row"},N={key:0,class:"table-responsive divCesta reverso"},I={class:"table colorFuente"},P={class:"tableBody"},W=["onClick"],Z={class:"d-inline-block text-truncate",style:{"max-width":"21rem","min-width":"21rem"}};function O(a,e,o,s,l,i){const n=(0,t.up)("MDBModalTitle"),d=(0,t.up)("MDBModalHeader"),u=(0,t.up)("MDBBtn"),c=(0,t.up)("MDBModalBody"),v=(0,t.up)("MDBModalFooter"),m=(0,t.up)("MDBModal");return(0,t.wg)(),(0,t.j4)(m,{id:"modalCobroSeparado",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:s.modalCobroSeparado,"onUpdate:modelValue":e[3]||(e[3]=a=>s.modalCobroSeparado=a),staticBackdrop:"",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Wm)(n,{id:"staticBackdropLabel"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Selecciona los articulos a pagar "+(0,r.zw)(s.totalPrice.toFixed(2))+" € ",1)])),_:1})])),_:1}),(0,t.Wm)(c,{class:"modal-body"},{default:(0,t.w5)((()=>[(0,t._)("div",S,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(s.arrayArticulosMesa,((a,e)=>((0,t.wg)(),(0,t.iD)("div",{key:e,class:"col mb-3"},[(0,t._)("button",{class:"btn w-100 h-100 colorIvan1 btnSuplemento",onClick:o=>s.addArticulo(a,e)},[(0,t.Uk)((0,r.zw)(a.nombre)+" ",1),E,(0,t.Uk)(" "+(0,r.zw)((a.subtotal/a.unidades).toFixed(2))+" € ",1)],8,H)])))),128))]),(0,t._)("div",F,[s.articulosAPagar?((0,t.wg)(),(0,t.iD)("div",N,[(0,t._)("table",I,[(0,t._)("tbody",P,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(s.articulosAPagar,((a,e)=>((0,t.wg)(),(0,t.iD)("tr",{key:e,class:(0,r.C_)(["itemCesta",{seleccionado:s.itemSeleccionado===e}]),onClick:a=>s.setIndex(e)},[(0,t._)("td",null,[(0,t._)("span",Z,(0,r.zw)(a.nombre),1)]),(0,t._)("td",null,(0,r.zw)((a.subtotal/a.unidades).toFixed(2))+" €",1)],10,W)))),128))])])])):(0,t.kq)("",!0),s.deleteBtn?((0,t.wg)(),(0,t.j4)(u,{key:1,onClick:e[0]||(e[0]=a=>s.delArticulo()),color:"danger",size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(a.$t("eliminar","Eliminar")),1)])),_:1})):(0,t.kq)("",!0)])])),_:1}),(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,{color:"secondary",onClick:e[1]||(e[1]=a=>s.modalCobroSeparado=!1),size:"lg"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(a.$t("cancelar","Cancelar")),1)])),_:1}),(0,t.Wm)(u,{color:"success",size:"lg",onClick:e[2]||(e[2]=a=>s.Pago())},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(a.$t("Pagar","Pagar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}o(57658);var U=o(22483),q={name:"modalCobroSeparadoComponent",components:{MDBModal:y.j3,MDBModalHeader:y.ol,MDBModalTitle:y.wo,MDBModalBody:y.Yz,MDBModalFooter:y.ab,MDBBtn:y.$v},setup(a,{expose:e}){const o=(0,C.iH)(!1),r=(0,C.iH)(null),s=(0,C.iH)([]);let l=(0,t.Fl)((()=>n.state.Cestas.arrayCestas));const i=(0,C.iH)([]),n=(0,g.oR)(),d=(0,U.tv)(),u=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),c=(0,t.Fl)((()=>n.state.Trabajadores.arrayTrabajadores)),v=(0,t.Fl)((()=>n.state.Trabajadores.indexActivo)),m=(0,t.Fl)((()=>c.value&&void 0!=u.value&&null!=u.value&&c.value[u.value]?c.value[u.value]:null)),b=(0,C.iH)([]);let p=0;const f=(0,C.iH)(!1),y=(0,C.iH)(0);async function M(a){i.value.push(a)}async function k(a){for(let e=0;e<a.lista.length;e++)for(let o=0;o<a.lista[e].unidades;o++)M(a.lista[e])}async function D(a,e){i.value.splice(e,1),y.value+=a.subtotal/a.unidades,s.value.push(a)}async function h(){let a=r.value;i.value.push(s.value[a]),y.value-=s.value[a].subtotal/s.value[a].unidades,s.value.splice(a,1),f.value=!1,r.value=-1}function B(a){r.value==a?(r.value=-1,f.value=!1):(r.value=a,f.value=!0)}async function x(a){b.value=a,p=a._id,s.value=[],i.value=[],o.value=!0,y.value=0,f.value=!1,k(a)}async function z(){let a,e=b;n.dispatch("Cestas/setCestaBaseAction",e.value._id),e.value.lista=s.value;for(let o=0;o<e.value.lista.length;o++)e.value.lista[o].subtotal=e.value.lista[o].subtotal/e.value.lista[o].unidades,e.value.lista[o].unidades=1;w.Z.post("cestas/PagarPorSeparado",{articulos:e.value.lista}).then((async e=>{e.data&&await w.Z.post("cestas/cambiarCestaTrabajador",{idCesta:e.data,idTrabajador:c.value[v.value]._id}).then((async o=>{if(l=(0,t.Fl)((()=>n.state.Cestas.arrayCestas)),a=await(0,t.Fl)((()=>{if(l.value)for(let a=0;a<l.value.length;a++)if(l.value[a]._id==e.data)return l.value[a]})),"PAGO SEPARADO"===a.value.modo)if(a.value.idCliente&&""!=a.value.idCliente){const e=(await w.Z.post("clientes/getClienteById",{idCliente:a.value.idCliente})).data;!0===e?.albaran&&!0===e?.noPagaEnTienda?w.Z.post("tickets/crearTicket",{total:y.value,idCesta:a.value._id,idTrabajador:m.value._id,tipo:"DEUDA",tkrsData:null}).then((a=>{if(!a.data)throw Error("No se ha podido registrar la venta en modo deuda");_().fire({icon:"success",title:"Venta modo deuda registrada correctamente",showConfirmButton:!1,timer:2e3})})).catch((a=>{_().fire("Oops...",a.message,"error")})):(await w.Z.post("impresora/despedida",{precioTotal:y.value.toFixed(2)}),await d.push("/cobro").then((()=>{})))}else await w.Z.post("impresora/despedida",{precioTotal:y.value.toFixed(2)}),await d.push("/cobro").then((()=>{}))}))})),await w.Z.post("cestas/borrarUnicoItemCesta",{idCesta:e.value._id,articulos:s.value}).then((a=>{if(!a.data)throw Error("No se ha podido eliminar el artículo de la cesta")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}return e({abrirModal:x}),{articulosAPagar:s,arrayArticulosMesa:i,modalCobroSeparado:o,itemSeleccionado:r,setIndex:B,deleteBtn:f,addArticulo:D,delArticulo:h,totalPrice:y,Pago:z}}},V=o(40089);const $=(0,V.Z)(q,[["render",O],["__scopeId","data-v-cc3f5faa"]]);var Y=$,J={name:"MesasComponent",components:{MDBModal:y.j3,MDBModalBody:y.Yz,MDBModalFooter:y.ab,MDBBtn:y.$v,MDBInput:y.u2,MDBIcon:y.vm,MDBBadge:y.m_,CobroSeparadoMesas:Y},setup(){const a=(0,C.iH)([]),e=(0,C.iH)(0),o=(0,C.iH)(null),r=(0,C.iH)(""),s=(0,C.iH)(!1),l=(0,C.iH)(!1),i=(0,C.iH)(!1),n=(0,C.iH)(null),d=(0,g.oR)();let u=(0,t.Fl)((()=>d.state.Cestas.arrayCestas));const c=(0,t.Fl)((()=>d.state.Trabajadores.arrayTrabajadores)),v=a=>{const e=u.value.find((e=>e._id===a));return e},m=a=>{const e=c.value.find((e=>e._id===a));return e.nombre},b=()=>{i.value=!i.value},p=async(a,e)=>{try{const o=await w.Z.post("/cestas/transferirItemsCesta",{idCestaOrigen:a.idCesta,idCestaDestino:e.idCesta});if(!o.data)throw Error("No se han podido transferir los articulos")}catch(o){_().fire("Oops...",o.message,"error")}};async function f(o,t=!1){if(s.value)e.value=o;else{if(l.value){const t=await _().fire({icon:"question",title:`¿Quieres transferir los articulos de ${a.value[e.value].nombre} a ${a.value[o].nombre}?`,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"});if(!t.isConfirmed)return;await p(a.value[e.value],a.value[o])}if(i.value)n.value.abrirModal(v(a.value[o].idCesta));else{if(t)S(E);else{if(!a.value[o].idCesta)return;S(a.value[o].idCesta)}M.Z.back()}}}const y=()=>{l.value=!0,D()},k=document.querySelector("body");k.style.backgroundColor=s.value?"#FFFF00":"#fff5e9";const D=()=>{s.value=!s.value,k.style.backgroundColor=s.value?"#FFFF00":"#fff5e9"};async function h(e){try{const o=(await w.Z.post("cestas/onlyCrearCestaParaMesa",{indexMesa:e})).data;if(!o)throw Error("No se ha podido crear la cesta para la nueva mesa");a.value[e].idCesta=o,j()}catch(o){_().fire("Oops...",o.message,"error")}}function B(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(a.value[e.value]={nombre:"Mesa "+(e.value+1)},h(e.value))}function x(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(w.Z.post("cestas/fulminarCesta",{idCesta:a.value[e.value].idCesta}).then((a=>{if(!a.data)throw Error("No se ha podido eliminar la cesta de la mesa")})).catch((a=>{_().fire("Oops...",a.message,"error")})),a.value[e.value]={nombre:null,idCesta:null},j())}function z(){a.value&&null!=e.value&&void 0!=e.value&&a.value[e.value]&&(a.value[e.value].nombre=r.value,o.value=!1,j())}function j(){w.Z.post("mesas/guardarCambios",{arrayMesas:a.value}).then((a=>{if(!a.data)throw Error("No se han podido guardar los cambios")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}const T=a=>{if(null===a||void 0===a)return!1;const e=v(a);return e.lista.length>0},A=(0,t.f3)("volver"),S=(0,t.f3)("seleccionar"),H=(0,t.f3)("cestaSeleccionada"),E=(0,t.f3)("cestaParticular");(0,t.f3)("PagarSeparado");return(0,t.bv)((()=>{w.Z.get("mesas/getMesas").then((e=>{if(!e.data||50!==e.data.length)throw Error("Error al obtener la configuración de mesas");a.value=e.data})).catch((a=>{_().fire("Oops...",a.message,"error")}))})),{arrayMesas:a,indexMesaActiva:e,handleClick:f,volver:A,activarMesa:B,desactivarMesa:x,cambiarNombre:z,modalNombreMesa:o,inputNombre:r,modoEdicion:s,toggleEdicion:D,cestaSeleccionada:H,getCestaById:v,getNombreTrabajadorById:m,toggleModotransferir:y,tieneCosas:T,pagarPorSeparado:b,pagarNoJunto:i,CobroSeparadoRef:n}}};const R=(0,V.Z)(J,[["render",T],["__scopeId","data-v-57a2d48a"]]);var K=R,L={name:"CestasView",components:{MDBCard:y.Yl,MDBCardBody:y.H7,MDBCardTitle:y.QM,MDBCardText:y.Pp,MDBBadge:y.m_,MDBBtn:y.$v,MesasComponent:K,CobroSeparadoMesas:Y},setup(){const a=(0,g.oR)(),e=(0,C.iH)(!0),o=(0,C.iH)(null);(0,t.Fl)((()=>a.state.Configuracion.parametros));let r=(0,t.Fl)((()=>a.state.Cestas.arrayCestas));const s=(0,C.iH)([]),l=(0,C.iH)({}),i=(0,t.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),n=(0,t.Fl)((()=>a.state.Trabajadores.indexActivo)),d=(0,C.iH)(null),u=(0,C.iH)(!1);function c(){const a=document.querySelector("body");a.style.backgroundColor="#fff5e9",M.Z.back()}function v(a){i.value&&void 0!=n.value&&null!=n.value&&i.value[n.value]&&null!=a.indexMesa&&o.value.abrirModal(a)}function m(a){let e="undefined";for(let o=0;o<i.value.length;o++)i.value[o].idTrabajador==a&&(e=i.value[o].nombre);return e}function b(a){return a.detalleIva.importe1+a.detalleIva.importe2+a.detalleIva.importe3+a.detalleIva.importe4+a.detalleIva.importe5}const p=(0,t.Fl)((()=>{const a=r.value.length;let e=Math.trunc(a/4);return a%4>0&&(e+=1),e}));function f(){void 0!=n.value&&null!=n.value&&i.value&&w.Z.post("cestas/crearCesta",{idTrabajador:i.value[n.value]._id}).then((a=>{if(!a.data)throw Error("No se ha podido crear una nueva cesta, ¡Comprueba que no tengas una ya!")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}function y(){if(d.value){for(let a=0;a<r.value.length;a++)if(r.value[a]._id===d.value&&null!=r.value[a].indexMesa&&void 0!=r.value[a].indexMesa)return _().fire("Oops...","No puedes eliminar una cesta de tipo MESA","error"),!1;w.Z.post("cestas/fulminarCesta",{idCesta:d.value}).then((a=>{if(!a.data)throw Error("No se ha podido borrar la cesta")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}}function k(a){i.value&&void 0!=n.value&&null!=n.value&&i.value[n.value]?(d.value=a,w.Z.post("cestas/cambiarCestaTrabajador",{idCesta:a,idTrabajador:i.value[n.value]._id})):_().fire("Oops...","Error, no se ha podido seleccionar la cesta para el trabajador","error")}function D(){w.Z.get("mesas/getMesas").then((a=>{if(!a.data||50!==a.data.length)throw Error("Error al obtener la configuración de mesas");s.value=a.data})).catch((a=>{_().fire("Oops...",a.message,"error")}))}let h;return r.value.forEach((a=>{a.trabajador===i.value[n.value]._id&&"DEVOLUCION"!=a.modo&&(h=a._id)})),(0,t.JJ)("volver",c),(0,t.JJ)("seleccionar",k),(0,t.JJ)("cestaSeleccionada",d),(0,t.JJ)("cestaParticular",h),(0,t.JJ)("PagarSeparado",v),(0,t.bv)((()=>{if(i.value.forEach((a=>{let e=a.idTrabajador,o=a.nombre;l.value[e]=o})),null==n.value)return _().fire("Oops...","Debes fichar para usar las cestas","error");d.value=i.value[n.value].idCesta,D(),w.Z.post("parametros/getParametros").then((a=>{void 0!=a.data?.params?.mesas?"Si"==a.data?.params?.mesas&&(u.value=!0):u.value=!1}))})),{vistaMesas:e,PagarSeparado:v,arrayCestas:r,arrayTrabajadores:i,indexActivoTrabajador:n,volver:c,getTotal:b,seleccionar:k,totalRows:p,nuevaCesta:f,borrarCesta:y,arrayMesas:s,idCestaSeleccionada:d,SiMesas:u,arrayTrabajadoresID:l,CobroSeparadoRef:o,getNombreByID:m}}};const G=(0,V.Z)(L,[["render",f],["__scopeId","data-v-36618ed0"]]);var Q=G}}]);
//# sourceMappingURL=422.ea1c3d77.js.map