"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[165],{83974:function(e,a,l){l.r(a),l.d(a,{default:function(){return Ql}});var o=l(73396),n=l(44870),t=l(87139),i=l(74313),s=(l(57658),l(12195)),r=l(68315),c=l(13150),u=l(16683);const d={key:0,style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"space-evenly",height:"100%"}},_={key:1};var v={__name:"CashlogyEstado",setup(e,{expose:a}){const l=(0,n.iH)(null),t=(0,n.iH)(!1),v=(0,n.iH)(null),f=(0,n.iH)(null);let m;function A(){t.value=!0,m?.()}let C=!1;async function p(){C=!0,f.value=null,await(0,u.R_)(l);let e=await l.value.start();if(e)return void(C=!1);t.value=!1;let a=new Promise((e=>{m=e}));while(1){if(t.value)break;try{let e=await c.Z.get_estado();if(f.value="ESTADO",e.err){v.value=null,await Promise.race([(0,u.uz)(3e3),a]);continue}let l,o=e.denominaciones,n=!(0,u.kJ)(e.cantidad_caja_fuerte_pd),t={header:{cols:["Cantidad total","Cantidad reciclador","Cantidad stacker",n?"Cantidad caja fuerte":null].filter((e=>null!=e))},body:[],footer:{head:"Valoración",cols:[]}};for(let a of u.iX)for(let i=o[a].length-1;i>=0;i--){let s=o[a][i],r=e.cantidad_recicladores_pd[a][s],c=e.cantidad_stacker_pd[a][s],u=e.cantidad_caja_fuerte_pd[a][s]??0;l={mob:a,den_cents:s,cols:[{value:r+c+u},{value:r},{value:c},n?{value:u}:null].filter((e=>null!=e))},t.body.push(l)}t.footer.cols=[{value:(0,u.vg)(e.valoracion_total,!0)},{value:(0,u.vg)(e.valoracion_recicladores,!0)},{value:(0,u.vg)(e.valoracion_stacker,!0)},n?{value:(0,u.vg)(e.valoracion_caja_fuerte,!0)}:null].filter((e=>null!=e)),v.value=t,await a;break}catch(o){console.log(o)}}l.value?.end(),C=!1}return(0,o.Ah)((()=>{A()})),a({run:p}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=f.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["ESTADO"==f.value?((0,o.wg)(),(0,o.iD)("div",d,[v.value?((0,o.wg)(),(0,o.j4)(s.Z,{key:0,tabla:v.value,style:{flex:"0 0 75%"}},null,8,["tabla"])):((0,o.wg)(),(0,o.iD)("div",_,"Espere...")),(0,o.Wm)((0,n.SU)(i.$v),{disabled:t.value,onClick:A,color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" salir ")])),_:1},8,["disabled"])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const f=v;var m=f,A=l(92136),C=l(34730);const p=e=>((0,o.dD)("data-v-69af7790"),e=e(),(0,o.Cn)(),e),y={key:0,class:"frame-Cashlogy"},b={class:"col-8 h-100"},g={class:"frame-Cashlogy flex-column"},w={style:{"text-align":"center"}},R=p((()=>(0,o._)("br",null,null,-1))),k=p((()=>(0,o._)("br",null,null,-1))),h=p((()=>(0,o._)("br",null,null,-1)));var U={__name:"CashlogyAnadirCambios",setup(e,{expose:a}){const l=(0,n.iH)(null),d=(0,n.iH)(""),_=(0,n.iH)(!1),v=(0,n.iH)({});function f(){_.value=!0,c.Z.boton_pulsar("BOT_ACEPTAR")}const m=(0,n.iH)(null);function p(e){A.socket[e]("Cashlogy.update",U)}function U(e){switch(m.value=e.proceso,e.proceso){case"AÑADIR_CAMBIOS":v.value=(0,u.c)(e),d.value=(0,u.vg)(e.importe_entrado,!0);break}}let I=!1;async function E(){let e;if(I=!0,m.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return I=!1,e;p("on");try{await c.Z.saveGrupoProcesos("AÑADIR_CAMBIOS"),_.value=!1;let a=await c.Z.anadir_cambios();e=await(l.value?.informacionAbort_y_cancel(a)),e?e.importe_entrado=0:e={importe_entrado:a.importe_entrado},e.abort_id||(await c.Z.saveGrupoProcesos(null),await(0,C.i_)(e.importe_entrado,"Añadir cambios","ENTRADA_DINERO"))}catch(a){console.log(a),e={cancelado:!0}}return p("off"),l.value?.end(),I=!1,e}return(0,o.Ah)((()=>{I&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:E}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=m.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["AÑADIR_CAMBIOS"==m.value?((0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("div",b,[(0,o._)("div",g,[(0,o.Wm)(s.Z,{tabla:v.value,style:{flex:"0 0 80%"}},null,8,["tabla"])])]),(0,o._)("div",w,[(0,o.Uk)(" Importe introducido :"),R,(0,o.Uk)(" "+(0,t.zw)(d.value)+" ",1),k,h,(0,o.Wm)((0,n.SU)(i.$v),{disabled:_.value,onClick:f,color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}},I=l(40089);const E=(0,I.Z)(U,[["__scopeId","data-v-69af7790"]]);var S=E,D=l(66720),O=l(74025);const N=e=>((0,o.dD)("data-v-5d211928"),e=e(),(0,o.Cn)(),e),L={key:0,class:"w-100 h-100"},T={key:0,class:"frame-Cashlogy flex-column"},P={key:1,class:"frame-Cashlogy flex-column"},H={style:{"text-align":"start"}},Z=N((()=>(0,o._)("br",null,null,-1))),x={key:1,class:"frame-Cashlogy"},W={class:"col-8 h-100"},j={class:"frame-Cashlogy flex-column"},z={class:"col h-100"},$={class:"frame-Cashlogy flex-column"},B={style:{flex:"0 0 70%","align-content":"center"}},M={class:"d-flex flex-column",style:{gap:"2px"}},q={key:2,class:"frame-Cashlogy flex-column"},V={key:3,class:"frame-Cashlogy flex-column"},F={class:"d-flex flex-column",style:{gap:"2px"}},J={key:4,class:"frame-Cashlogy flex-column"},Y={class:"d-flex flex-column",style:{gap:"2px"}},K={key:5,class:"frame-Cashlogy flex-column"},G={style:{"text-align":"start"}},Q=1;var X={__name:"CashlogyDarCambio",setup(e,{expose:a}){const l=(0,n.iH)(null),d=(0,n.iH)(null),_=(0,n.iH)(""),v=(0,n.iH)(""),f=(0,n.iH)(""),m=(0,n.iH)(""),p=(0,n.iH)(!1),y=(0,n.iH)(!1),b=(0,n.iH)(!1);function g(e){b.value=!0,c.Z.boton_pulsar("ACEPTAR"==e?"BOT_ACEPTAR":"BOT_CANCELAR")}const w=(0,n.iH)({}),R=(0,n.iH)({});let k,h,U=0,I=(0,n.iH)(!1);function E(){let e=0;return(0,u.eh)(h).forEach((({den:a,value:l})=>{e+=l*a})),I.value=U==e,e/100}function S(){let e={header:{cols:["Cantidad actual","Cantidad retirar"]},body:[]};for(let a of u.iX)for(let l=k.denominaciones_dispensables[a].length-1;l>=0;l--){let o=k.denominaciones_dispensables[a][l],n={mob:a,den_cents:o,cols:[{value:k.cantidad_recicladores_pd[a][o]},{value:h[a][o]||"",clickable:!0}]};e.body.push(n)}w.value=e}let N=(0,n.iH)(null);function X(){N.value&&(N.value.col.input=!1,N.value.col.class=N.value.class,N.value=null)}function ee(e,a,l){N.value={row:e,col:a,td_elem:l,class:a.class},a.input=!0,a.class="cashlogyCierreFondoCaja_selected"}function ae(e,a,l,o){l==Q&&(N.value&&N.value.col==a||(X(),ee(e,a,o)))}function le(e){if(N.value){let a=N.value.row;if("number"==typeof e){let l=10*(h[a.mob][a.den_cents]??0)+e,o=k.cantidad_recicladores_pd[a.mob][a.den_cents];if(l>0&&l<=o){let e=h[a.mob][a.den_cents];h[a.mob][a.den_cents]=l,E()>k.importe_entrado?e?h[a.mob][a.den_cents]=e:delete h[a.mob][a.den_cents]:N.value.col.value=l}}"C"==e&&(delete h[a.mob][a.den_cents],N.value.col.value=""),v.value=(0,u.vg)(E(),!0)}}const oe=new u.JQ((()=>{re.value="PANTALLA_INTRODUCIR_CANTIDADES_PARA_CAMBIO"}));async function ne(){_.value=(0,u.vg)(k.importe_entrado,!0),h=(0,u.li)(),U=Math.round(100*k.importe_entrado);let e=U,a=[];for(let l of u.iX)for(let e of k.denominaciones_dispensables[l]){let o=k.cantidad_recicladores_pd[l][e];o&&a.push({recicl:o,mob:l,den_cents:e})}a.sort(((e,a)=>-(e.den_cents-a.den_cents)));for(let{recicl:l,mob:t,den_cents:i}of a)if(U>i&&e>=i){let a=Math.min(Math.floor(e/i),l);a>0&&(h[t][i]=a,e-=a*i)}e>0&&(h=(0,u.li)()),v.value=(0,u.vg)(E(),!0),S();while(1){var[o,n]=await l.value.startPantalla_withReset(oe);if(n)return[void 0,n];if("ACEPTAR"==o){if(E(),!I.value)continue;return[h,void 0]}return[null,void 0]}}const te=new u.JQ((e=>{v.value=(0,u.vg)(e,!0),re.value="PANTALLA_FALTA_CAMBIO_DEVOLUCION"}));function ie(){y.value=!0,c.Z.boton_pulsar("BOT_ACEPTAR")}const se=(0,n.iH)(),re=(0,n.iH)(null);function ce(e){A.socket[e]("Cashlogy.update",ue)}function ue(e){switch(re.value=e.proceso,e.proceso){case"DAR_CAMBIO_ENTRADA":if(e.state)switch(se.value=e.state,e.state){case"ENTRADA":_.value=(0,u.vg)(e.importe_entrado,!0);break;case"CANCELAR":v.value=(0,u.vg)(e.importe_a_devolver,!0);break}break;case"DISPENSAR_DENOMINACION":break;case"AÑADIR_CAMBIOS":R.value=(0,u.c)(e),f.value=(0,u.vg)(e.importe_entrado,!0),m.value=(0,u.vg)(e.importe_recicladores,!0);break;case"SOLO_DISPENSAR":v.value=(0,u.vg)(e.importe_a_devolver,!0);break}}async function de(e,a){let o,n=0;while(!o){re.value="ERROR_DEVOLUCION",await(0,u.R_)(d),await d.value.run(a);var[t,i]=await l.value.startPantalla_withReset(te,e);if(i)o=i;else if("AÑADIR"==t){re.value=null,y.value=!1;let t=await c.Z.anadir_cambios_y_devolver(e);o=await(l.value?.informacionAbort_y_cancel(t)),o?(o.importe_anadido_en_cambios=n,o.importe_falta_devolver=e):(n+=t.importe_anadido_en_cambios,await c.Z.saveGrupoProcesos(null,{importe_anadido_en_cambios:n}),0==t.importe_falta_devolver?o={importe_falta_devolver:0,importe_anadido_en_cambios:n}:(a=t,e=t.importe_falta_devolver))}else o={importe_falta_devolver:e,importe_anadido_en_cambios:n}}return o}let _e=!1;async function ve(){let e;if(_e=!0,re.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return _e=!1,e;ce("on");try{await c.Z.saveGrupoProcesos("DAR_CAMBIO"),b.value=!1;let n=await c.Z.dar_cambio_entrada();if(null!=n.importe_entrado&&await c.Z.saveGrupoProcesos(null,{importe_entrado:n.importe_entrado}),e=await(l.value?.informacionAbort_y_cancel(n)),!e)if(n.operativa_cancelar){p.value=!0;let a=n.importe_falta_devolver??0;0==a?e={cancelado:!0,importe_entrado:n.importe_entrado??0,importe_anadido_en_cambios:0,importe_falta_devolver:0}:(e=await de(a,n),e.cancelado=!0,e.importe_entrado=n.importe_entrado)}else{let t=n.importe_entrado;if(0==t)e={importe_entrado:0,importe_anadido_en_cambios:0};else{k=n;var[a,o]=await ne();if(o)e=o;else if(null==a){p.value=!0,v.value=(0,u.vg)(t,!0);let a=await c.Z.solo_dispensar(t);e=await(l.value?.informacionAbort_y_cancel(a)),e||(0==a.importe_falta_devolver?e={cancelado:!0,importe_entrado:t,importe_anadido_en_cambios:0}:(e=await de(a.importe_falta_devolver,a),e.cancelado=!0,e.importe_entrado=t))}else{v.value=(0,u.vg)(k.importe_entrado,!0);let o=await c.Z.dispensar_por_denominacion(a,"BOCA");e=await(l.value?.informacionAbort_y_cancel(o)),e||(0==o.importe_falta_devolver?e={importe_entrado:t,importe_falta_devolver:0,importe_anadido_en_cambios:0}:(e=await de(o.importe_falta_devolver,o),e.importe_entrado=t))}}}e.abort_id||(await c.Z.saveGrupoProcesos(null),await(0,C.i_)(e.importe_anadido_en_cambios,"Añadir Cambios","ENTRADA_DINERO"))}catch(n){console.log(n),e={cancelado:!0}}return ce("off"),l.value?.end(),_e=!1,e}return(0,o.Ah)((()=>{_e&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:ve}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=re.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["DAR_CAMBIO_ENTRADA"==re.value?((0,o.wg)(),(0,o.iD)("div",L,["ENTRADA"==se.value?((0,o.wg)(),(0,o.iD)("div",T,[(0,o._)("div",null," Importe entrado: "+(0,t.zw)(_.value),1),(0,o._)("div",null,[(0,o.Wm)((0,n.SU)(i.$v),{style:{"margin-right":"10rem"},disabled:b.value,onClick:a[0]||(a[0]=()=>g("ACEPTAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:b.value,onClick:a[1]||(a[1]=()=>g("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Cancelar ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"CANCELAR"==se.value?((0,o.wg)(),(0,o.iD)("div",P,[(0,o._)("div",H,[(0,o.Uk)(" Cancelando"),Z,(0,o.Uk)(" Importe a devolver: "+(0,t.zw)(v.value),1)])])):(0,o.kq)("",!0)])):(0,o.kq)("",!0),"PANTALLA_INTRODUCIR_CANTIDADES_PARA_CAMBIO"==re.value?((0,o.wg)(),(0,o.iD)("div",x,[(0,o._)("div",W,[(0,o._)("div",j,[(0,o.Wm)(s.Z,{tabla:w.value,onClickBody:ae,style:{flex:"0 0 80%"}},null,8,["tabla"]),(0,o._)("div",null," Importe introducido: "+(0,t.zw)(_.value)+"     Importe a devolver: "+(0,t.zw)(v.value),1)])]),(0,o._)("div",z,[(0,o._)("div",$,[(0,o._)("div",B,[(0,n.SU)(N)?((0,o.wg)(),(0,o.j4)(D.Z,{key:0,onClickKey:le})):(0,o.kq)("",!0)]),(0,o._)("div",M,[(0,o.Wm)((0,n.SU)(i.$v),{disabled:!(0,n.SU)(I),onClick:a[2]||(a[2]=()=>(0,n.SU)(oe).R("ACEPTAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[3]||(a[3]=()=>(0,n.SU)(oe).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" cancelar ")])),_:1})])])])])):(0,o.kq)("",!0),"DISPENSAR_DENOMINACION"==re.value?((0,o.wg)(),(0,o.iD)("div",q," Dispensando: "+(0,t.zw)(v.value),1)):(0,o.kq)("",!0),"PANTALLA_FALTA_CAMBIO_DEVOLUCION"==re.value?((0,o.wg)(),(0,o.iD)("div",V,[(0,o._)("div",F,[(0,o._)("span",null,"Faltan cambios para la "+(0,t.zw)(p.value?"cancelación":"devolución"),1),(0,o._)("span",null,"Importe falta devolver: "+(0,t.zw)(v.value),1),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[4]||(a[4]=e=>(0,n.SU)(te).R("AÑADIR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" añadir cambios ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[5]||(a[5]=e=>(0,n.SU)(te).R("MANUAL")),color:"warning",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(p.value?"cancelación manual":"devolución manual"),1)])),_:1})])])):(0,o.kq)("",!0),"AÑADIR_CAMBIOS"==re.value?((0,o.wg)(),(0,o.iD)("div",J,[(0,o.Wm)(s.Z,{tabla:R.value,style:{flex:"0 0 75%"}},null,8,["tabla"]),(0,o._)("div",Y,[(0,o._)("span",null,"Importe introducido : "+(0,t.zw)(f.value),1),(0,o._)("span",null,"Importe total: "+(0,t.zw)(m.value),1),(0,o._)("span",null,"Importe falta devolver: "+(0,t.zw)(v.value),1),(0,o.Wm)((0,n.SU)(i.$v),{disabled:y.value,onClick:ie,color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"SOLO_DISPENSAR"==re.value?((0,o.wg)(),(0,o.iD)("div",K,[(0,o._)("div",G," Dispensando Importe a devolver: "+(0,t.zw)(v.value),1)])):(0,o.kq)("",!0),"ERROR_DEVOLUCION"==re.value?((0,o.wg)(),(0,o.j4)(O.Z,{key:6,ref_key:"CashlogyErrorDevolucion_ref",ref:d},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const ee=(0,I.Z)(X,[["__scopeId","data-v-5d211928"]]);var ae=ee,le=l(49242);const oe=e=>((0,o.dD)("data-v-ff787b38"),e=e(),(0,o.Cn)(),e),ne={key:0,class:"frame-Cashlogy"},te={class:"col-9 h-100"},ie={class:"frame-Cashlogy flex-column"},se={class:"col h-100"},re={class:"frame-Cashlogy flex-column"},ce={style:{flex:"0 0 40%","align-content":"center"}},ue={style:{border:"2px groove grey",padding:"0.35rem 0.75rem 0.625rem 0.75rem"}},de=oe((()=>(0,o._)("legend",{style:{float:"none",width:"auto",margin:"0","font-size":"1.5rem"}},"Destino billetes",-1))),_e=["value"],ve={style:{"margin-left":"0.2rem"}},fe=oe((()=>(0,o._)("br",null,null,-1))),me={key:1,class:"frame-Cashlogy flex-column"},Ae=0,Ce=1;var pe={__name:"CashlogyRetirarEfectivo",setup(e,{expose:a}){const l=(0,n.iH)(null),d=(0,n.iH)(null),_=((0,n.iH)(""),(0,n.iH)(!1)),v=(0,n.iH)({}),f=(0,n.iH)("BOCA"),m=(0,n.iH)(["BOCA","STACKER"]);let p={monedas:{},billetes:{}};function y(){let e=0;return(0,u.eh)(p).forEach((({den:a,value:l})=>{e+=l*a})),e/100}function b(){v.value.footer.cols[Ce]={value:(0,u.vg)(y(),!0)}}let g=(0,n.iH)(null);function w(){g.value&&(g.value.col.input=!1,g.value.col.class=g.value.class,g.value=null)}function R(e,a,l){g.value={row:e,col:a,td_elem:l,class:a.class},a.input=!0,a.class="cashlogyRetirarEfectivo_col_selected"}function k(e,a,l,o){if(l==Ae)w(),p[e.mob][e.den_cents]=a.value,e.cols[Ce].value=a.value;else if(l==Ce)g.value&&g.value.col==a||(w(),R(e,a,o));else if(w(),p[e.mob][e.den_cents]){let a=(0,u.li)();a[e.mob][e.den_cents]=p[e.mob][e.den_cents],E.R(a)}b()}function h(e){if(g.value){let a=g.value.row;if("number"==typeof e){let l=10*(p[a.mob][a.den_cents]??0)+e,o=a.cols[Ae].value;l>0&&l<=o&&(p[a.mob][a.den_cents]=l,g.value.col.value=l)}"C"==e&&(delete p[a.mob][a.den_cents],g.value.col.value=""),b()}}function U(){(0,u.kJ)(p)||(w(),E.R(p))}function I(){w(),E.R(void 0)}const E=new u.JQ((()=>{S.value="PANTALLA_INTRODUCIR_CANTIDAD"}),_),S=(new u.JQ((()=>{S.value="PANTALLA_ERROR_EN_DISPENSAR"}),_),(0,n.iH)(null));function N(e){A.socket[e]("Cashlogy.update",L)}function L(e){switch(S.value=e.proceso,e.proceso){case"DISPENSAR_DENOMINACION":break}}let T=!1;async function P(){let e;if(T=!0,S.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return T=!1,e;N("on"),p=(0,u.li)();try{let n=0;await c.Z.saveGrupoProcesos("RETIRAR_EFECTIVO");let t=await c.Z.consulta_todas_denominaciones(!1);e=await(l.value?.informacionAbort_y_cancel(t)),e&&(e.importe_retirado=0);while(!e){let i=t.cantidad_caja_fuerte_pd,s=!(0,u.kJ)(i);m.value=s?["BOCA","STACKER","CAJA_FUERTE"]:["BOCA","STACKER"];let r=t.denominaciones_dispensables,_={header:{cols:["Cantidad Reciclador","Cantidad Retirar",""]},body:[],footer:{head:"Valoración total",cols:[]}},A=0;for(let e of u.iX)for(let a=r[e].length-1;a>=0;a--){let l=r[e][a],o=t.cantidad_recicladores_pd[e][l];A+=o*l,(p[e][l]??0)>o&&(p[e][l]=o);let n={mob:e,den_cents:l,cols:[{value:o,clickable:!0},{value:p[e][l]||"",clickable:!0},{value:"RETIRAR",clickable:!0,button:!0}]};_.body.push(n)}_.footer.cols=[{value:(0,u.vg)(A/100,!0)},{value:(0,u.vg)(y(),!0)},""],v.value=_;var[a,o]=await l.value.startPantalla_withReset(E);o?e=o:a?(S.value=null,t=await c.Z.dispensar_por_denominacion(a,f.value),e=await(l.value?.informacionAbort_y_cancel(t)),e?e.importe_retirado=n:(S.value="ERROR_DEVOLUCION",await(0,u.R_)(d),await d.value.run(t),n+=t.importe_devuelto,(0,u.eh)(t.cantidad_devuelta_pd).forEach((({mob:e,den:a,value:l})=>{let o=p[e][a];null!=o&&(o=Math.max(o-l,0)),o?p[e][a]=o:delete p[e][a]})),"BOCA"!=f.value&&(0,u.eh)(a).forEach((({mob:e,den:a})=>{delete p[e][a]})))):e={importe_retirado:n}}e.abort_id||(await c.Z.saveGrupoProcesos(null),await(0,C.i_)(e.importe_retirado,"Retirada Cashlogy","SALIDA"))}catch(n){console.log(n),e={cancelado:!0}}return N("off"),l.value?.end(),T=!1,e}return(0,o.Ah)((()=>{T&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:P}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=S.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_INTRODUCIR_CANTIDAD"==S.value?((0,o.wg)(),(0,o.iD)("div",ne,[(0,o._)("div",te,[(0,o._)("div",ie,[(0,o.Wm)(s.Z,{tabla:v.value,disabled:_.value,onClickBody:k,style:{flex:"0 0 80%"}},null,8,["tabla","disabled"])])]),(0,o._)("div",se,[(0,o._)("div",re,[(0,o._)("div",ce,[(0,n.SU)(g)?((0,o.wg)(),(0,o.j4)(D.Z,{key:0,onClickKey:h})):(0,o.kq)("",!0)]),(0,o._)("fieldset",ue,[de,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(m.value,(e=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.wy)((0,o._)("input",{type:"radio",value:e,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e)},null,8,_e),[[le.G2,f.value]]),(0,o._)("label",ve,(0,t.zw)((0,n.SU)(u.bW)(e)),1),fe],64)))),256))]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:_.value,onClick:U,color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Retirar todo lo marcado ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:_.value,onClick:I,color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Salir ")])),_:1},8,["disabled"])])])])):(0,o.kq)("",!0),"DISPENSAR_DENOMINACION"==S.value?((0,o.wg)(),(0,o.iD)("div",me," Dispensando ")):(0,o.kq)("",!0),"ERROR_DEVOLUCION"==S.value?((0,o.wg)(),(0,o.j4)(O.Z,{key:2,ref_key:"CashlogyErrorDevolucion_ref",ref:d},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const ye=(0,I.Z)(pe,[["__scopeId","data-v-ff787b38"]]);var be=ye;const ge=e=>((0,o.dD)("data-v-42f68d54"),e=e(),(0,o.Cn)(),e),we={key:0,class:"frame-Cashlogy flex-column"},Re={style:{"text-align":"center"}},ke=ge((()=>(0,o._)("br",null,null,-1))),he={key:0},Ue=ge((()=>(0,o._)("br",null,null,-1))),Ie={key:1,class:"w-100 h-100"},Ee={key:0,class:"frame-Cashlogy flex-column"},Se={class:"items-Cashlogy"},De={key:1,class:"frame-Cashlogy flex-column"},Oe={key:2,class:"frame-Cashlogy flex-column"},Ne={class:"items-Cashlogy"};var Le={__name:"CashlogyRecaudar",setup(e,{expose:a}){const l=(0,n.iH)(null),s=(0,n.iH)(""),d=(0,n.iH)(""),_=(0,n.iH)(""),v=(0,n.iH)(!1),f=(0,n.iH)(!1),m=new u.JQ((e=>{v.value=!(0,u.kJ)(e.cantidad_caja_fuerte_pd),s.value=(0,u.vg)(e.valoracion_stacker,!0),d.value=(0,u.vg)(e.valoracion_caja_fuerte,!0),b.value="PANTALLA_CONFIRMAR_RETIRAR"}),f);function p(){f.value=!0,c.Z.boton_pulsar("BOT_CANCELAR")}const y=new u.JQ((e=>{_.value=(0,u.vg)(e.importe_recaudado,!0),b.value="PANTALLA_VER_RESULTADO"})),b=(0,n.iH)(null),g=(0,n.iH)();function w(e){A.socket[e]("Cashlogy.update",R)}function R(e){switch(b.value=e.proceso,e.proceso){case"RECAUDAR":switch(g.value=e.state,e.state){case"RETIRAR":break;case"CANCELAR":break}break}}let k=!1;async function h(){let e;if(k=!0,b.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return k=!1,e;w("on");try{let n=await c.Z.consulta_todas_denominaciones(!0);if(e=await(l.value?.informacionAbort_y_cancel(n)),!e){var[a,o]=await l.value.startPantalla_withReset(m,n);if(o)e=o;else if("ACEPTAR"==a){b.value=null,f.value=!1,await c.Z.crearGrupoProcesosDeUnSoloProceso();let a=await c.Z.recaudar();e=await(l.value?.informacionAbort_y_cancel(a)),e||(await y.start(a),e={importe_recaudado:a.importe_recaudado,cancelado_despues_de_retirar:a.cancelado_despues_de_retirar})}else e={cancelado:!0}}null==e.abort_id&&await(0,C.i_)(e.importe_recaudado,"Recaudar","SALIDA")}catch(n){console.log(n),e={cancelado:!0}}return w("off"),l.value?.end(),k=!1,e}return(0,o.Ah)((()=>{k&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:h}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=b.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_CONFIRMAR_RETIRAR"==b.value?((0,o.wg)(),(0,o.iD)("div",we,[(0,o._)("div",null,[(0,o._)("div",Re,[(0,o.Uk)(" Importe en el Stacker : "+(0,t.zw)(s.value)+" ",1),ke,v.value?((0,o.wg)(),(0,o.iD)("span",he," Importe en la caja fuerte : "+(0,t.zw)(d.value),1)):(0,o.kq)("",!0)]),(0,o.Uk)(),Ue,(0,o.Wm)((0,n.SU)(i.$v),{disabled:f.value,onClick:a[0]||(a[0]=e=>(0,n.SU)(m).R("ACEPTAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Retirar stacker "+(0,t.zw)(v.value?"y caja fuerte":""),1)])),_:1},8,["disabled"]),(0,o.Uk)("     "),(0,o.Wm)((0,n.SU)(i.$v),{disabled:f.value,onClick:a[1]||(a[1]=e=>(0,n.SU)(m).R("CANCELAR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Cancelar ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"RECAUDAR"==b.value?((0,o.wg)(),(0,o.iD)("div",Ie,["RETIRAR"==g.value?((0,o.wg)(),(0,o.iD)("div",Ee,[(0,o._)("div",Se,[(0,o.Uk)(" Retirando "),(0,o.Wm)((0,n.SU)(i.$v),{disabled:f.value,onClick:p,color:"warning",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Interrumpir retirada ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"CANCELAR"==g.value?((0,o.wg)(),(0,o.iD)("div",De," Cancelando ")):(0,o.kq)("",!0)])):(0,o.kq)("",!0),"PANTALLA_VER_RESULTADO"==b.value?((0,o.wg)(),(0,o.iD)("div",Oe,[(0,o._)("div",Ne,[(0,o.Uk)(" Importe recaudado : "+(0,t.zw)(_.value)+" ",1),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[2]||(a[2]=e=>(0,n.SU)(y).R()),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1})])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const Te=(0,I.Z)(Le,[["__scopeId","data-v-42f68d54"]]);var Pe=Te;const He=e=>((0,o.dD)("data-v-28987bae"),e=e(),(0,o.Cn)(),e),Ze={key:0,class:"frame-Cashlogy"},xe={class:"col-9 h-100"},We={class:"frame-Cashlogy flex-column"},je={class:"col h-100"},ze={class:"frame-Cashlogy flex-column"},$e={style:{flex:"0 0 35%","align-content":"center"}},Be={key:2},Me=He((()=>(0,o._)("label",null,"Importe fondo de caja",-1))),qe=He((()=>(0,o._)("br",null,null,-1))),Ve=["disabled"],Fe=["disabled"],Je=He((()=>(0,o._)("label",{style:{"margin-left":"0.2rem"}},"Recaudar sólo billetes",-1))),Ye={key:0},Ke=He((()=>(0,o._)("br",null,null,-1))),Ge={key:1,style:{border:"2px groove grey",padding:"0.35rem 0.75rem 0.625rem 0.75rem"}},Qe=He((()=>(0,o._)("legend",{style:{float:"none",width:"auto",margin:"0","font-size":"1.5rem"}},"Destino billetes",-1))),Xe=["value"],ea={style:{"margin-left":"0.2rem"}},aa=He((()=>(0,o._)("br",null,null,-1))),la={key:2,style:{flex:"0 0 20%"},class:"items-Cashlogy"},oa={key:3,style:{flex:"0 0 20%"},class:"items-Cashlogy"},na={key:1,class:"frame-Cashlogy"},ta={style:{"text-align":"start"}},ia=He((()=>(0,o._)("br",null,null,-1))),sa=He((()=>(0,o._)("br",null,null,-1))),ra=He((()=>(0,o._)("br",null,null,-1))),ca=He((()=>(0,o._)("br",null,null,-1))),ua=He((()=>(0,o._)("br",null,null,-1))),da=He((()=>(0,o._)("br",null,null,-1))),_a={key:0,style:{color:"blue"}},va={key:1},fa=He((()=>(0,o._)("br",null,null,-1))),ma=He((()=>(0,o._)("br",null,null,-1))),Aa=He((()=>(0,o._)("br",null,null,-1))),Ca=He((()=>(0,o._)("br",null,null,-1))),pa=He((()=>(0,o._)("br",null,null,-1))),ya={key:2,class:"frame-Cashlogy"},ba={key:3,class:"frame-Cashlogy"},ga={style:{"text-align":"center"}},wa=He((()=>(0,o._)("br",null,null,-1))),Ra=He((()=>(0,o._)("br",null,null,-1))),ka={key:4,class:"w-100 h-100"},ha={key:0,class:"frame-Cashlogy flex-column"},Ua={class:"items-Cashlogy"},Ia={key:1,class:"frame-Cashlogy flex-column"},Ea={key:5,class:"frame-Cashlogy"},Sa={style:{"text-align":"start"}},Da=He((()=>(0,o._)("br",null,null,-1))),Oa=He((()=>(0,o._)("br",null,null,-1))),Na=He((()=>(0,o._)("br",null,null,-1))),La=He((()=>(0,o._)("br",null,null,-1))),Ta=He((()=>(0,o._)("br",null,null,-1))),Pa=He((()=>(0,o._)("br",null,null,-1))),Ha=0,Za=1;var xa={__name:"CashlogyCierreFondoDeCaja",setup(e,{expose:a}){const l=(0,n.iH)(null),d=(0,n.iH)(null),_=(0,n.iH)(""),v=(0,n.iH)(""),f=(0,n.iH)(""),m=(0,n.iH)(""),p=(0,n.iH)(""),y=(0,n.iH)(""),b=(0,n.iH)(""),g=(0,n.iH)(""),w=(0,n.iH)(""),R=(0,n.iH)(""),k=(0,n.iH)(!1),h=(0,n.iH)(!0),U=((0,n.iH)(""),(0,n.iH)(!1)),I=(0,n.iH)({});let E,S=!1,N=3;const L=(0,n.iH)("STACKER"),T=(0,n.iH)(["STACKER"]);function P(e,a){return E.denominaciones_dispensables[e].indexOf(a)>=0}let H={solo_billetes:!1},Z=0,x=!1,W=!1,j={monedas:{},billetes:{}};function z(){let e=0;return(0,u.eh)(j).forEach((({den:a,value:l})=>{e+=l*a})),e/100}function $(){I.value.footer.cols[N]={value:(0,u.vg)(z(),!0)}}function B(){S=!(0,u.kJ)(E.cantidad_caja_fuerte_pd),N=S?4:3,T.value=S?["STACKER","CAJA_FUERTE"]:["STACKER"],S||(L.value="STACKER");let e={header:{cols:["Cantidad actual","Cantidad reciclador","Cantidad Stacker",S?"Cantidad caja fuerte":null,"Fondo caja"].filter((e=>null!=e))},body:[],footer:{head:"Importe total:",cols:[]}};for(let a of u.iX)for(let l=E.denominaciones[a].length-1;l>=0;l--){let o=E.denominaciones[a][l],n=E.cantidad_recicladores_pd[a][o]??0,t=E.cantidad_stacker_pd[a][o]??0,i=E.cantidad_caja_fuerte_pd[a][o]??0,s="monedas"==a&&k.value,r={mob:a,den_cents:o,cols:[{value:n+t+i,clickable:!s&&P(a,o)},{value:n,clickable:!s&&P(a,o)},{value:t},S?{value:i}:null,P(a,o)?{value:j[a][o],class:"",clickable:!s}:{value:""}].filter((e=>null!=e))};e.body.push(r)}e.footer.cols=[{value:(0,u.vg)(E.valoracion_total,!0)},{value:(0,u.vg)(E.valoracion_recicladores,!0)},{value:(0,u.vg)(E.valoracion_stacker,!0)},S?{value:(0,u.vg)(E.valoracion_caja_fuerte,!0)}:null,{value:(0,u.vg)(z(),!0)}].filter((e=>null!=e)),I.value=e}let M=(0,n.iH)(null);function q(){M.value&&(""==M.value.col.value&&(M.value.col.value=0),M.value.col.input=!1,M.value.col.class=M.value.class,M.value=null)}function V(e,a,l){M.value={row:e,col:a,td_elem:l,class:a.class},a.input=!0}function F(e,a,l,o){if(te.value){if(l==Ha||l==Za){if(k.value&&"monedas"==e.mob)return;let a=e.cols[Za].value;j[e.mob][e.den_cents]=a,e.cols[N].value=a,$()}if(l==N){if(k.value&&"monedas"==e.mob)return;M.value&&M.value.col==a||(q(),V(e,a,o))}}}function J(e){if(M.value){let a=M.value.row;if("number"==typeof e){let l=10*(j[a.mob][a.den_cents]??0)+e,o=E.cantidad_recicladores_pd[a.mob][a.den_cents];l<=o&&(j[a.mob][a.den_cents]=l,M.value.col.value=l)}"C"==e&&(j[a.mob][a.den_cents]=0,M.value.col.value=""),$()}}let Y=(0,u.vg)(1.23).charAt(1),K=2;function G(e){W=!1;let a=R.value,[l,o]=a.split(Y);if("number"==typeof e){if(null!=o){if(o.length>=K)return}else if(l.length>=8)return;"0"==a&&(a=""),a+=e.toString(),R.value=a}else if("C"==e)a="",R.value=a;else if(e==Y){if(null!=o)return;""==a&&(a="0"),a+=e,R.value=a}Z=Q(),ee(),B()}function Q(){if(!R.value)return 0;let e=R.value,[a,l]=e.split(Y);a||(a="0"),l||(l="0");while(l.length<K)l+="0";let o=100*parseInt(a,10)+parseInt(l,10);return o/100}let X={monedas:{1:390,2:310,5:245,10:245,20:190,50:135,100:150,200:120},billetes:{500:50,1e3:49,2e3:47}};function ee(){let e=Math.round(100*Z),a=k.value,l=e;W=!0;let o=[];for(let n of u.iX)for(let e of E.denominaciones_dispensables[n])"monedas"==n&&a?(j[n][e]=E.cantidad_recicladores_pd[n][e],l-=j[n][e]*e):(o.push({mob:n,den_cents:e,capacidad:X[n][e]||100,cant_recicl:E.cantidad_recicladores_pd[n][e],cap_den:(X[n][e]||100)*e}),j[n][e]=0);if(l>0){let e,a;o.sort(((e,a)=>e.den_cents-a.den_cents));do{a=l/o.reduce(((e,a)=>e+a.cap_den),0),e=o.length,o=o.filter((e=>!(Math.floor(a*e.capacidad)>=e.cant_recicl)||(j[e.mob][e.den_cents]=e.cant_recicl,l-=j[e.mob][e.den_cents]*e.den_cents,!1)))}while(e!=o.length);o.forEach((e=>{let o=Math.min(Math.floor(a*e.capacidad),e.cant_recicl);j[e.mob][e.den_cents]=o,l-=o*e.den_cents,e.cant_recicl-=o})),o=o.filter((e=>e.cant_recicl>0));while(l>0&&o.length){let e,a=0,n=0,t=0;for(t=0;t<o.length;t++){if(e=o[t],a+=e.den_cents,a>=l)break;n+=e.den_cents*e.cant_recicl}o=o.slice(0,t),(e.den_cents<=l||n<l)&&a>=l?(j[e.mob][e.den_cents]++,l-=e.den_cents):(o.forEach((e=>{j[e.mob][e.den_cents]++,l-=e.den_cents,e.cant_recicl--})),o=o.filter((e=>e.cant_recicl>0)))}}B()}function ae(){q(),h.value=!0,ee(),B()}const oe=new u.JQ((()=>{me.value="PANTALLA_PROCESAR_O_MODIFICAR_FONDO",te.value=!1,U.value=!1,H={importe:Z,importe_empty:x,solo_billetes:k.value,fondo_caja_pd:(0,u.j9)(j),calculado:W},R.value=x?"":(0,u.vg)(Z),h.value=W,q(),B();let e=(0,o.YP)(k,(()=>{q(),h.value=!0,ee(),B()}));return()=>{U.value=!0,e()}}));let ne,te=(0,n.iH)(!1);function ie(){te.value=!0}function se(){Z=Q(),x=""==R.value,x||(R.value=(0,u.vg)(Z)),te.value=!1,B()}function re(){Z=H.importe,x=H.importe_empty,R.value=x?"":(0,u.vg)(Z),k.value=H.solo_billetes,j=(0,u.j9)(H.fondo_caja_pd),W=H.calculado,te.value=!1,B()}function ce(){ne="CONTINUAR",U.value=!0,c.Z.boton_pulsar("BOT_ACEPTAR")}function ue(){ne="RECALCULAR",U.value=!0,c.Z.boton_pulsar("BOT_ACEPTAR")}const de=new u.JQ((()=>{me.value="DESEA_RETIRAR_EL_STACKER"}),U);function _e(){U.value=!0,c.Z.boton_pulsar("BOT_CANCELAR")}const ve=new u.JQ((()=>{me.value="VER_RESULTADO"})),fe=(0,n.iH)(),me=(0,n.iH)(null);function Ae(e){A.socket[e]("Cashlogy.update",Ce)}function Ce(e){switch(me.value=e.proceso,e.proceso){case"DISPENSAR_DENOMINACION":break;case"AÑADIR_CAMBIOS":_.value=(0,u.vg)(Z,!0),v.value=(0,u.vg)(e.importe_recicladores,!0);let a=Z-e.importe_recicladores;f.value=(0,u.vg)(a>=0?a:0,!0),m.value="color: "+(a>0?"red":"blue"),p.value=a<0?(0,u.vg)(-a):null;break;case"RECAUDAR":switch(fe.value=e.state,e.state){case"RETIRAR":break;case"CANCELAR":break}break}}let pe=!1;async function ye(){let e;if(pe=!0,me.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return pe=!1,e;Ae("on"),j=(0,u.li)();try{await c.Z.saveGrupoProcesos("CIERRE_FONDO_DE_CAJA");let a=await c.Z.loadFondoCaja();a||(a={importe:null,solo_billetes:!1}),Z=a.importe??0,x=null==a.importe,k.value=a.solo_billetes,W=!0;let o,n=0;const t=async()=>{let a=E=await c.Z.consulta_todas_denominaciones(!0);if(e=await(l.value?.informacionAbort_y_cancel(a)),e)return{...e,importe_cambios_anadidos:n};null==o&&(o=E.valoracion_total),W?ee():(0,u.eh)(j).forEach((({mob:e,den:a,value:l})=>{let o=E.cantidad_recicladores_pd[e][a];l>o&&(j[e][a]=o)}));var[t,i]=await l.value.startPantalla_withReset(oe);if(i)return i;if("SALIR"==t)return{cancelado:!0,importe_cambios_anadidos:n};if(W&&z()<Z){me.value=null,U.value=!1;let o=await c.Z.anadir_cambios();if(e=await(l.value?.informacionAbort_y_cancel(o)),e)return{...e,importe_cambios_anadidos:n};if(n+=o.importe_entrado,"RECALCULAR"==ne)return;if(await c.Z.saveGrupoProcesos(null,{importe_cambios_anadidos:n}),a=E=await c.Z.consulta_todas_denominaciones(!0),e=await(l.value?.informacionAbort_y_cancel(a)),e)return{...e,importe_cambios_anadidos:n}}let s=a.denominaciones_dispensables,r={monedas:{},billetes:{}};for(let e of u.iX)for(let l of s[e])r[e][l]=a.cantidad_recicladores_pd[e][l]-(j[e][l]??0);me.value=null;let v,f=await c.Z.dispensar_por_denominacion(r,L.value);if(e=await(l.value?.informacionAbort_y_cancel(f)),e)return{...e,importe_cambios_anadidos:n};if(me.value="ERROR_DEVOLUCION",await(0,u.R_)(d),await d.value.run(f))return;var[m,i]=await l.value.startPantalla_withReset(de);if(i)return i;if("SI"==m){if(me.value=null,v=await c.Z.recaudar(),e=await(l.value?.informacionAbort_y_cancel(v)),e)return{...e,importe_cambios_anadidos:n};await c.Z.saveGrupoProcesos(null,{importe_recaudado:v.importe_recaudado})}let A=await c.Z.consulta_todas_denominaciones(!0);return e=await(l.value?.informacionAbort_y_cancel(A)),e||(e={}),e={...e,importe_fondo_de_caja:W?Z:z(),importe_inicial:o,importe_final:A.valoracion_total,importe_retirado:f.importe_devuelto,importe_cambios_anadidos:n,importe_recaudado:v?.importe_recaudado??0,cantidad_recicladores_pd:A.cantidad_recicladores_pd,cantidad_stacker_pd:A.cantidad_stacker_pd,cantidad_caja_fuerte_pd:A.cantidad_caja_fuerte_pd},_.value=(0,u.vg)(e.importe_fondo_de_caja,!0),y.value=(0,u.vg)(e.importe_inicial,!0),b.value=null!=e.importe_final?(0,u.vg)(e.importe_final,!0):"no disponible",g.value=(0,u.vg)(e.importe_cambios_anadidos,!0),w.value=(0,u.vg)(e.importe_recaudado,!0),await ve.start(),e};do{e=await t()}while(!e);e.cancelado||(a={importe:x?null:Z,solo_billetes:k.value},await c.Z.saveFondoCaja(a)),e.abort_id||(await c.Z.saveGrupoProcesos(null),await(0,C.i_)(e.importe_cambios_anadidos,"Añadir Cambios","ENTRADA_DINERO"),await(0,C.i_)(e.importe_retirado,"Retirada Cashlogy","SALIDA"),await(0,C.i_)(e.importe_recaudado,"Recaudar","SALIDA"))}catch(a){console.log(a),e={cancelado:!0}}return Ae("off"),l.value?.end(),pe=!1,e}return(0,o.Ah)((()=>{pe&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:ye}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=me.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_PROCESAR_O_MODIFICAR_FONDO"==me.value?((0,o.wg)(),(0,o.iD)("div",Ze,[(0,o._)("div",xe,[(0,o._)("div",We,[(0,o.Wm)(s.Z,{tabla:I.value,onClickBody:F,style:{flex:"0 0 90%"}},null,8,["tabla"])])]),(0,o._)("div",je,[(0,o._)("div",ze,[(0,o._)("div",$e,[(0,n.SU)(te)&&(0,n.SU)(M)?((0,o.wg)(),(0,o.j4)(D.Z,{key:0,onClickKey:J})):(0,n.SU)(te)&&!(0,n.SU)(M)&&h.value?((0,o.wg)(),(0,o.j4)(D.Z,{key:1,tipo_importe:"",onClickKey:G})):((0,o.wg)(),(0,o.iD)("div",Be))]),(0,o._)("div",null,[Me,qe,(0,o.wy)((0,o._)("input",{type:"text",disabled:!(0,n.SU)(te),readonly:"",onClick:ae,onFocus:a[0]||(a[0]=e=>{e.currentTarget?.blur?.()}),"onUpdate:modelValue":a[1]||(a[1]=e=>R.value=e),class:(0,t.C_)((0,n.SU)(te)&&!(0,n.SU)(M)?"cashlogyCierreFondoCaja_selected":""),style:{"text-align":"end","border-radius":"4px"}},null,42,Ve),[[le.nr,R.value]])]),(0,o._)("div",null,[(0,o.wy)((0,o._)("input",{type:"checkbox",disabled:!(0,n.SU)(te),"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e)},null,8,Fe),[[le.e8,k.value]]),Je]),1==T.value.length?((0,o.wg)(),(0,o.iD)("div",Ye,[(0,o.Uk)(" Los billetes se "),Ke,(0,o.Uk)(" retiran a "+(0,t.zw)(T.value[0]),1)])):((0,o.wg)(),(0,o.iD)("fieldset",Ge,[Qe,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(T.value,(e=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.wy)((0,o._)("input",{type:"radio",value:e,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e)},null,8,Xe),[[le.G2,L.value]]),(0,o._)("label",ea,(0,t.zw)((0,n.SU)(u.bW)(e)),1),aa],64)))),256))])),(0,n.SU)(te)?((0,o.wg)(),(0,o.iD)("div",la,[(0,o.Wm)((0,n.SU)(i.$v),{class:"boton-Cashlogy",style:{visibility:"hidden"}},{default:(0,o.w5)((()=>[(0,o.Uk)(" hidden ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:se,outline:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:re,outline:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Cancelar ")])),_:1})])):((0,o.wg)(),(0,o.iD)("div",oa,[(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:ie,color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Modificar ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:a[4]||(a[4]=e=>(0,n.SU)(oe).R("PROCESAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Procesar ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:a[5]||(a[5]=e=>(0,n.SU)(oe).R("SALIR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Salir ")])),_:1},8,["disabled"])]))])])])):(0,o.kq)("",!0),"AÑADIR_CAMBIOS"==me.value?((0,o.wg)(),(0,o.iD)("div",na,[(0,o._)("div",ta,[(0,o.Uk)(" Por favor, introduzca efectivo por el importe indicado"),ia,(0,o.Uk)(" para dejar el fondo de caja configurado: "),sa,ra,(0,o.Uk)(" Importe fondo de caja: "+(0,t.zw)(_.value)+" ",1),ca,(0,o.Uk)(" Importe reciclador: "+(0,t.zw)(v.value)+" ",1),ua,(0,o.Uk)(" Importe a introducir: "),(0,o._)("span",{style:(0,t.j5)(m.value)},(0,t.zw)(f.value),5),(0,o.Uk)(),da,p.value?((0,o.wg)(),(0,o.iD)("div",_a," Importe en exceso: "+(0,t.zw)(p.value),1)):((0,o.wg)(),(0,o.iD)("div",va," ")),fa,ma,(0,o.Uk)(" (*) Si no disponde de las monedas/billetes indicados,"),Aa,(0,o.Uk)(' puede pulsar en "Continuar Cierre"'),Ca,(0,o.Uk)(" para terminar el proceso con el almacenado actual. "),pa,(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:ue,color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Recalcular ")])),_:1},8,["disabled"]),(0,o.Uk)("      "),(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:ce,color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Continuar cierre ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"DISPENSAR_DENOMINACION"==me.value?((0,o.wg)(),(0,o.iD)("div",ya," Dispensando ")):(0,o.kq)("",!0),"DESEA_RETIRAR_EL_STACKER"==me.value?((0,o.wg)(),(0,o.iD)("div",ba,[(0,o._)("div",ga,[(0,o.Uk)(" ATENCIÓN - ¿Desea retirar el Stacker? "),wa,Ra,(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:a[6]||(a[6]=e=>(0,n.SU)(de).R("SI")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Sí ")])),_:1},8,["disabled"]),(0,o.Uk)("       "),(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:a[7]||(a[7]=e=>(0,n.SU)(de).R("NO")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" No ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"RECAUDAR"==me.value?((0,o.wg)(),(0,o.iD)("div",ka,["RETIRAR"==fe.value?((0,o.wg)(),(0,o.iD)("div",ha,[(0,o._)("div",Ua,[(0,o.Uk)(" Retirando "),(0,o.Wm)((0,n.SU)(i.$v),{disabled:U.value,onClick:_e,color:"warning",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Interrumpir retirada ")])),_:1},8,["disabled"])])])):(0,o.kq)("",!0),"CANCELAR"==fe.value?((0,o.wg)(),(0,o.iD)("div",Ia," Cancelando ")):(0,o.kq)("",!0)])):(0,o.kq)("",!0),"VER_RESULTADO"==me.value?((0,o.wg)(),(0,o.iD)("div",Ea,[(0,o._)("div",Sa,[(0,o.Uk)(" Importe fondo de caja: "+(0,t.zw)(_.value)+" ",1),Da,(0,o.Uk)(" Importe inicial: "+(0,t.zw)(y.value)+" ",1),Oa,(0,o.Uk)(" Importe final: "+(0,t.zw)(b.value)+" ",1),Na,(0,o.Uk)(" Importe cambios añadidos : "+(0,t.zw)(g.value)+" ",1),La,(0,o.Uk)(" Importe recaudado: "+(0,t.zw)(w.value)+" ",1),Ta,Pa,(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[8]||(a[8]=e=>(0,n.SU)(ve).R()),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1})])])):(0,o.kq)("",!0),"ERROR_DEVOLUCION"==me.value?((0,o.wg)(),(0,o.j4)(O.Z,{key:6,ref_key:"CashlogyErrorDevolucion_ref",ref:d},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const Wa=(0,I.Z)(xa,[["__scopeId","data-v-28987bae"]]);var ja=Wa;const za=e=>((0,o.dD)("data-v-55fa6b9d"),e=e(),(0,o.Cn)(),e),$a={key:0,class:"frame-Cashlogy flex-column"},Ba={key:1,class:"frame-Cashlogy flex-column"},Ma={style:{"text-align":"center"}},qa=za((()=>(0,o._)("br",null,null,-1)));var Va={__name:"CashlogyResolverIncidencias",setup(e,{expose:a}){const l=(0,n.iH)(null),t=((0,n.iH)(""),new u.JQ((()=>{d.value="PANTALLA_RESOLVER_INCIDENCIAS"}))),s=new u.JQ((()=>{d.value="PANTALLA_FINALIZAR"})),d=(0,n.iH)(null);let _=!1;async function v(){let e;if(_=!0,d.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return _=!1,e;try{var[a,o]=await l.value.startPantalla_withReset(t);if(o)e=o;else if("CONFIRMAR"==a){d.value=null,await c.Z.crearGrupoProcesosDeUnSoloProceso();let e=await c.Z.resolver_incidencias(),a=await(l.value?.informacionAbort_y_cancel(e));a||(await s.start(),a={})}else e={cancelado:!0}}catch(n){console.log(n),e={cancelado:!0}}return l.value?.end(),_=!1,e}return(0,o.Ah)((()=>{_&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:v}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=d.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_RESOLVER_INCIDENCIAS"==d.value?((0,o.wg)(),(0,o.iD)("div",$a,[(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[0]||(a[0]=e=>(0,n.SU)(t).R("CONFIRMAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Resolucion de desajuste en contabilidad ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[1]||(a[1]=e=>(0,n.SU)(t).R("SALIR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Salir ")])),_:1})])):(0,o.kq)("",!0),"PANTALLA_FINALIZAR"==d.value?((0,o.wg)(),(0,o.iD)("div",Ba,[(0,o._)("div",Ma,[(0,o.Uk)(" Proceso finalizado "),qa,(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[2]||(a[2]=e=>(0,n.SU)(s).R()),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1})])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const Fa=(0,I.Z)(Va,[["__scopeId","data-v-55fa6b9d"]]);var Ja=Fa;const Ya=e=>((0,o.dD)("data-v-860f6868"),e=e(),(0,o.Cn)(),e),Ka={key:0,class:"frame-Cashlogy"},Ga={class:"col-8 h-100"},Qa={class:"frame-Cashlogy flex-column"},Xa={class:"col h-100"},el={class:"frame-Cashlogy flex-column"},al={style:{flex:"0 0 20%"},class:"items-Cashlogy"},ll={key:0},ol=Ya((()=>(0,o._)("br",null,null,-1))),nl={key:1,style:{border:"2px groove grey",padding:"0.35rem 0.75rem 0.625rem 0.75rem"}},tl=Ya((()=>(0,o._)("legend",{style:{float:"none",width:"auto",margin:"0","font-size":"1.5rem"}},"Destino billetes",-1))),il=["value"],sl={style:{"margin-left":"0.2rem"}},rl=Ya((()=>(0,o._)("br",null,null,-1))),cl={style:{flex:"0 0 20%"},class:"items-Cashlogy"},ul={key:1,class:"frame-Cashlogy"};var dl={__name:"CashlogyVaciadoCompleto",setup(e,{expose:a}){const l=(0,n.iH)(null),d=(0,n.iH)(null),_=((0,n.iH)(""),(0,n.iH)(!1)),v=(0,n.iH)("STACKER"),f=(0,n.iH)([]),m=(0,n.iH)({});let p=(0,n.iH)(["STACKER"]),y=(0,n.iH)(null),b=2,g=(0,o.Fl)((()=>{let e={monedas:!1,billetes:!1},a=y.value;if(!a)return e;let l={};for(let o of u.iX){l[o]={todas:!0,ninguna:!0};for(let e of a[o]){let a=`${o},${e},${b}`,n=f.value.indexOf(a);n>=0?l[o].ninguna=!1:l[o].todas=!1}}for(let o of u.iX)l[o].todas?e[o]=!1:l[o].ninguna&&(e[o]=!0);return e}));function w(e){let a=y.value;if(!a)return;let l=[];for(let o of u.iX)for(let n of a[o]){let a=`${o},${n},${b}`;o==e?g.value[o]&&l.push(a):f.value.indexOf(a)>=0&&l.push(a)}f.value=l}function R(){let e={monedas:[],billetes:[]};f.value.forEach((a=>{let[l,o,n]=a.split(",");e[l].push(parseInt(o))}));for(let a of u.iX)e[a].sort(((e,a)=>e-a));return e}const k=new u.JQ((()=>{h.value="PANTALLA_SELECCIONAR"}),_),h=(0,n.iH)(null);function U(e){A.socket[e]("Cashlogy.update",I)}function I(e){switch(h.value=e.proceso,e.proceso){case"VACIADO_COMPLETO":break}}let E=!1;async function S(){let e;if(E=!0,h.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return E=!1,e;U("on");try{let n=0;await c.Z.saveGrupoProcesos("VACIADO");let t=await c.Z.consulta_todas_denominaciones(!1);e=await(l.value?.informacionAbort_y_cancel(t)),e&&(e.importe_vaciado_solo_monedas=0);while(!e){let i=t.cantidad_caja_fuerte_pd,s=!(0,u.kJ)(i);p.value=s?["STACKER","CAJA_FUERTE"]:["STACKER"],f.value=[];let r=t.denominaciones_dispensables,_={header:{cols:["Cantidad Reciclador","Cantidad retirado",""]},body:[],footer:{head:"Valoración total",cols:[]}},A=0;for(let e of u.iX)for(let a=r[e].length-1;a>=0;a--){let l=r[e][a],o=t.cantidad_recicladores_pd[e][l];A+=o*l;let n={mob:e,den_cents:l,cols:[{value:o},{value:""},{checkbox:!1}]};_.body.push(n)}_.footer.cols=[{value:(0,u.vg)(A/100,!0)},"",""],m.value=_,y.value=t.denominaciones_dispensables;var[a,o]=await l.value.startPantalla_withReset(k);if(o)e=o;else if("VACIAR"==a){h.value=null;let a,o=R(),i=!0,s=!0;for(let e of u.iX)for(let a of r[e]){let l=o[e].indexOf(a)>=0;l||(i=!1),("billetes"==e&&l||"monedas"==e&&!l)&&(s=!1)}a=!i&&(!!s||null),t=await c.Z.vaciado_completo(a,null==a?o:null,v.value),e=await(l.value?.informacionAbort_y_cancel(t)),e?e.importe_vaciado_solo_monedas=n:(h.value="ERROR_DEVOLUCION",await(0,u.R_)(d),await d.value.run(t),n+=t.importe_vaciado_solo_monedas)}else e={importe_vaciado_solo_monedas:n}}e.abort_id||(await c.Z.saveGrupoProcesos(null),await(0,C.i_)(e.importe_vaciado_solo_monedas,"Vaciado Cashlogy","SALIDA"))}catch(n){console.log(n),e={cancelado:!0}}return U("off"),l.value?.end(),E=!1,e}return(0,o.Ah)((()=>{E&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:S}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=h.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_SELECCIONAR"==h.value?((0,o.wg)(),(0,o.iD)("div",Ka,[(0,o._)("div",Ga,[(0,o._)("div",Qa,[(0,o.Wm)(s.Z,{tabla:m.value,disabled:_.value,checkboxs:f.value,"onUpdate:checkboxs":a[0]||(a[0]=e=>f.value=e),style:{flex:"0 0 80%"}},null,8,["tabla","disabled","checkboxs"])])]),(0,o._)("div",Xa,[(0,o._)("div",el,[(0,o._)("div",al,[(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[1]||(a[1]=e=>w("monedas")),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)((0,n.SU)(g)["monedas"]?"Todas las monedas":"Ninguna moneda"),1)])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[2]||(a[2]=e=>w("billetes")),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)((0,n.SU)(g)["billetes"]?"Todas los billetes":"Ningun billete"),1)])),_:1})]),1==(0,n.SU)(p).length?((0,o.wg)(),(0,o.iD)("div",ll,[(0,o.Uk)(" Los billetes se "),ol,(0,o.Uk)(" retiran a "+(0,t.zw)((0,n.SU)(p)[0]),1)])):((0,o.wg)(),(0,o.iD)("fieldset",nl,[tl,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,n.SU)(p),(e=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.wy)((0,o._)("input",{type:"radio",value:e,"onUpdate:modelValue":a[3]||(a[3]=e=>v.value=e)},null,8,il),[[le.G2,v.value]]),(0,o._)("label",sl,(0,t.zw)((0,n.SU)(u.bW)(e)),1),rl],64)))),256))])),(0,o._)("div",cl,[(0,o.Wm)((0,n.SU)(i.$v),{disabled:_.value,onClick:a[4]||(a[4]=e=>(0,n.SU)(k).R("VACIAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Vaciar ")])),_:1},8,["disabled"]),(0,o.Wm)((0,n.SU)(i.$v),{disabled:_.value,onClick:a[5]||(a[5]=e=>(0,n.SU)(k).R("SALIR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Salir ")])),_:1},8,["disabled"])])])])])):(0,o.kq)("",!0),"VACIADO_COMPLETO"==h.value?((0,o.wg)(),(0,o.iD)("div",ul," Vaciando ")):(0,o.kq)("",!0),"ERROR_DEVOLUCION"==h.value?((0,o.wg)(),(0,o.j4)(O.Z,{key:2,ref_key:"CashlogyErrorDevolucion_ref",ref:d},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const _l=(0,I.Z)(dl,[["__scopeId","data-v-860f6868"]]);var vl=_l;const fl=e=>((0,o.dD)("data-v-4b2d7de9"),e=e(),(0,o.Cn)(),e),ml={key:0,class:"frame-Cashlogy flex-column"},Al={key:1,class:"frame-Cashlogy"},Cl={style:{"text-align":"start"}},pl=fl((()=>(0,o._)("br",null,null,-1))),yl=fl((()=>(0,o._)("br",null,null,-1)));var bl={__name:"CashlogyPonerACero",setup(e,{expose:a}){const l=(0,n.iH)(null),s=(0,n.iH)(""),d=(0,n.iH)(""),_=new u.JQ((()=>{f.value="PANTALLA_PONER_A_CERO"})),v=new u.JQ((()=>{f.value="PANTALLA_VER_RESULTADO"})),f=(0,n.iH)(null);let m=!1;async function A(){let e;if(m=!0,f.value=null,await(0,u.R_)(l),e=await l.value.start(),e)return m=!1,e;try{var[a,o]=await l.value.startPantalla_withReset(_);if(o)e=o;else if("CONFIRMAR"==a){await c.Z.crearGrupoProcesosDeUnSoloProceso();let a=await c.Z.poner_a_cero();e=await(l.value?.informacionAbort_y_cancel(a)),e||(s.value=(0,u.vg)(a.importe_antes,!0),d.value=(0,u.vg)(a.importe_despues,!0),await v.start(),e={importe_antes:a.importe_antes,importe_despues:a.importe_despues})}else e={cancelado:!0}}catch(n){console.log(n),e={cancelado:!0}}return l.value?.end(),m=!1,e}return(0,o.Ah)((()=>{m&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:A}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=f.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["PANTALLA_PONER_A_CERO"==f.value?((0,o.wg)(),(0,o.iD)("div",ml,[(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[0]||(a[0]=e=>(0,n.SU)(_).R("CONFIRMAR")),color:"success",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" CONFIRMAR PONER A CERO LAS MONEDAS ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[1]||(a[1]=e=>(0,n.SU)(_).R("SALIR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Salir ")])),_:1})])):(0,o.kq)("",!0),"PANTALLA_VER_RESULTADO"==f.value?((0,o.wg)(),(0,o.iD)("div",Al,[(0,o._)("div",Cl,[(0,o.Uk)(" Importe total antes: "+(0,t.zw)(s.value)+" ",1),pl,(0,o.Uk)(" Importe total actual: "+(0,t.zw)(d.value)+" ",1),yl,(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[2]||(a[2]=e=>(0,n.SU)(v).R()),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1})])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const gl=(0,I.Z)(bl,[["__scopeId","data-v-4b2d7de9"]]);var wl=gl,Rl=l(75629),kl=l(37532),hl={__name:"CashlogyConsultaErrores",setup(e,{expose:a}){const l=(0,n.iH)(null),t=(0,n.iH)(null),i=((0,n.iH)(!1),(0,n.iH)(null));let s=!1;async function c(){s=!0,i.value=null,await(0,u.R_)(l);let e=await l.value.start();e||(i.value="CONSULTA_ERRORES",await(0,u.R_)(t),await t.value.run(null,null),l.value?.end()),s=!1}return(0,o.Ah)((()=>{})),a({run:c}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=i.value,ref_key:"CashlogyPantalla_ref",ref:l},{default:(0,o.w5)((()=>["CONSULTA_ERRORES"==i.value?((0,o.wg)(),(0,o.j4)(kl.Z,{key:0,ref_key:"CashlogyConsultaErrorChild_ref",ref:t,style:{"padding-left":"2rem"}},null,512)):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const Ul=hl;var Il=Ul,El=l(28571);const Sl={key:0,class:"frame-Cashlogy flex-column"},Dl={key:1,class:"frame-Cashlogy flex-column"},Ol=(0,o._)("br",null,null,-1),Nl=(0,o._)("br",null,null,-1),Ll={key:2,class:"frame-Cashlogy"},Tl=(0,o._)("br",null,null,-1),Pl=(0,o._)("br",null,null,-1),Hl=(0,o._)("br",null,null,-1),Zl={key:3,class:"frame-Cashlogy"},xl=(0,o._)("br",null,null,-1),Wl=(0,o._)("br",null,null,-1),jl=(0,o._)("br",null,null,-1),zl=(0,o._)("br",null,null,-1),$l=(0,o._)("br",null,null,-1);var Bl={__name:"CashlogyComandosInicializacion",setup(e,{expose:a}){let l=El.Z;const s=(0,n.iH)(""),d=(0,n.iH)(""),_=(0,n.iH)(""),v=(0,n.iH)(""),f=(0,n.iH)(""),m=(0,n.iH)(!1);let A=[["INICIALIZAR","I"],["RESET","Z"],["FINALIZAR","E"]],C=new Map(A);const p=new u.JQ((()=>{R.value="PANTALLA_MENU"})),y=new u.JQ((()=>{R.value="PANTALLA_REINICIAR"})),b=new u.JQ((e=>{_.value=v.value=null,e.traduccion_respuesta?v.value=e.traduccion_respuesta:_.value=e.respuesta,f.value=e.abort_info?e.abort_info.reason:null,m.value=e.finalizado,R.value="PANTALLA_RESULTADO"}));function g(){c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")}const w=(0,n.iH)(null),R=(0,n.iH)(null);let k=!1;async function h(){let e;if(k=!0,R.value=null,await(0,u.R_)(w),e=await w.value.start(),e)return k=!1,e;let a=(0,o.YP)((()=>l.state.Cashlogy.id_notificaciones),(()=>{let e=["ERR_INICIALIZACION","FINALIZADO","CONECTANDO","INICIALIZANDO"],a=e.find((e=>l.state.Cashlogy.id_notificaciones[e]));s.value=a??"OK"}));try{let a=await p.start();if("SALIR"==a)e={};else if("REINICIAR"==a)await c.Z.reiniciar(),await y.start(),e={opcion:a};else{d.value=`${a} #${C.get(a)??""}#`,R.value="PANTALLA_COMANDO";let l=await c.Z.enviar_comando_inicializacion(a),o=null;l.respuesta||(l.respuesta=""),!l.respuesta.startsWith("#ER:GENERIC#")||"INICIALIZAR"!=a&&"RESET"!=a||(o="Ha habido un error en la inicialización. Revisar cables y conexiones."),await b.start({...l,traduccion_respuesta:o}),e={opcion:a,respuesta:l.respuesta,cancelado:!!l.abort_info}}}catch(n){console.log(n),e={cancelado:!0}}return a(),w.value?.end(),k=!1,e}return(0,o.Ah)((()=>{k&&c.Z.boton_pulsar("BOT_ABORTAR_Y_CANCELAR")})),a({run:h}),(e,a)=>((0,o.wg)(),(0,o.j4)(r.Z,{enProceso:null!=R.value,ref_key:"CashlogyPantalla_ref",ref:w},{default:(0,o.w5)((()=>["PANTALLA_MENU"==R.value?((0,o.wg)(),(0,o.iD)("div",Sl,[(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[0]||(a[0]=e=>(0,n.SU)(p).R("REINICIAR")),color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" REINICIAR ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[1]||(a[1]=e=>(0,n.SU)(p).R("INICIALIZAR")),color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" INICIALIZAR #I# ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[2]||(a[2]=e=>(0,n.SU)(p).R("RESET")),color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" RESET #Z# ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[3]||(a[3]=e=>(0,n.SU)(p).R("FINALIZAR")),color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" FINALIZAR #E# ")])),_:1}),(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[4]||(a[4]=e=>(0,n.SU)(p).R("SALIR")),color:"primary",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" SALIR ")])),_:1})])):(0,o.kq)("",!0),"PANTALLA_REINICIAR"==R.value?((0,o.wg)(),(0,o.iD)("div",Dl,[(0,o._)("div",null,[(0,o.Uk)(" Reiniciando "),Ol,(0,o.Uk)(" Estado: "+(0,t.zw)(s.value)+" ",1),Nl,(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[5]||(a[5]=e=>(0,n.SU)(y).R("SALIR")),color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" SALIR ")])),_:1})])])):(0,o.kq)("",!0),"PANTALLA_COMANDO"==R.value?((0,o.wg)(),(0,o.iD)("div",Ll,[(0,o._)("div",null,[(0,o.Uk)(" Comando: "+(0,t.zw)(d.value),1),Tl,(0,o.Uk)(" Espere..."),Pl,Hl,(0,o.Wm)((0,n.SU)(i.$v),{onClick:g,color:"danger",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" CANCELAR ")])),_:1})])])):(0,o.kq)("",!0),"PANTALLA_RESULTADO"==R.value?((0,o.wg)(),(0,o.iD)("div",Zl,[(0,o._)("div",null,[(0,o.Uk)(" Comando: "+(0,t.zw)(d.value)+" ",1),xl,null!=_.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.Uk)("Respuesta: "+(0,t.zw)(_.value)+" ",1),Wl],64)):(0,o.kq)("",!0),null!=v.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o.Uk)((0,t.zw)(v.value)+" ",1),jl],64)):(0,o.kq)("",!0),f.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:2},[(0,o.Uk)("Razon Cancelado: "+(0,t.zw)(f.value)+" ",1),zl],64)):(0,o.kq)("",!0),m.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:3},[(0,o.Uk)("Operativa detenida. Vaya a reiniciar para reiniciarla")],64)):(0,o.kq)("",!0),$l,(0,o.Wm)((0,n.SU)(i.$v),{onClick:a[6]||(a[6]=e=>(0,n.SU)(b).R()),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)(" ACEPTAR ")])),_:1})])])):(0,o.kq)("",!0)])),_:1},8,["enProceso"]))}};const Ml=Bl;var ql=Ml;const Vl={class:"mx-auto buttons lista"},Fl=["disabled","onClick"],Jl={color:"success",size:"lg",class:"w-100 btnOptions2"},Yl={class:"btnTitle"};var Kl={__name:"CashlogyBackOfficeView",setup(e){const a=(0,n.iH)(null),l=(0,n.iH)(null),s=(0,n.iH)(null),r=(0,n.iH)(null),c=(0,n.iH)(null),u=(0,n.iH)(null),d=(0,n.iH)(null),_=(0,n.iH)(null),v=(0,n.iH)(null),f=(0,n.iH)(null),A=(0,n.iH)(null),C=(0,n.iH)(null),p=(0,n.iH)(!1),y=[{name:"Estado de Cashlogy",action:async()=>{a.value.run()},icon:"fas fa-eye"},{name:"Añadir cambios",action:async()=>{l.value.run()},icon:"fas fa-coins"},{name:"Dar cambio",action:async()=>{s.value.run()},icon:"fas fa-exchange-alt"},{name:"Retirar efectivo",action:async()=>{r.value.run()},icon:"fas fa-money-bill-wave"},{name:"Recaudar",action:async()=>{c.value.run()},icon:"fas fa-hand-holding-usd"},{name:"Cierre / Fondo de caja",action:async()=>{u.value.run()},icon:"fas fa-cash-register"},{name:"Resolver incidencias",action:async()=>{d.value.run()},icon:"fas fa-clipboard-list"},{name:"Vaciado completo",action:async()=>{_.value.run()},icon:"fas fa-trash-alt"},{name:"Mantenimiento",action:async()=>{f.value.run()},icon:"fas fa-tools"},{name:"Consulta errores",action:async()=>{A.value.run()},icon:"fas fa-exclamation-triangle"},{name:"Comandos inicialización",action:async()=>{C.value.run()},icon:"fas fa-cogs"}];return(e,b)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",Vl,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(y,((a,l)=>(0,o._)("div",{class:"mt-2 btnOptions1",disabled:p.value,onClick:async()=>{p.value=!0,await(a?.action()),p.value=!1}},[(0,o._)("div",Jl,[(0,o.Wm)((0,n.SU)(i.vm),{class:"iconSize",icon:a.icon},null,8,["icon"]),(0,o._)("span",Yl,(0,t.zw)(e.$t(a.name,a.name)),1)])],8,Fl))),64))]),(0,o._)("div",null,[(0,o.Wm)(m,{ref_key:"CashlogyEstado_Ref",ref:a},null,512),(0,o.Wm)(S,{ref_key:"CashlogyAnadirCambios_Ref",ref:l},null,512),(0,o.Wm)(ae,{ref_key:"CashlogyDarCambio_Ref",ref:s},null,512),(0,o.Wm)(be,{ref_key:"CashlogyRetirarEfectivo_Ref",ref:r},null,512),(0,o.Wm)(Pe,{ref_key:"CashlogyRecaudar_Ref",ref:c},null,512),(0,o.Wm)(ja,{ref_key:"CashlogyCierreFondoDeCaja_Ref",ref:u},null,512),(0,o.Wm)(Ja,{ref_key:"CashlogyResolverIncidencias_Ref",ref:d},null,512),(0,o.Wm)(vl,{ref_key:"CashlogyVaciadoCompleto_Ref",ref:_},null,512),(0,o.Wm)(wl,{ref_key:"CashlogyPonerACero_Ref",ref:v},null,512),(0,o.Wm)(Rl.Z,{ref_key:"CashlogyMantenimiento_Ref",ref:f},null,512),(0,o.Wm)(Il,{ref_key:"CashlogyConsultaErrores_Ref",ref:A},null,512),(0,o.Wm)(ql,{ref_key:"CashlogyComandosInicializacion_Ref",ref:C},null,512)])],64))}};const Gl=(0,I.Z)(Kl,[["__scopeId","data-v-c450573a"]]);var Ql=Gl},66720:function(e,a,l){l.d(a,{Z:function(){return _}});var o=l(73396),n=l(44870),t=l(87139),i=l(74313),s=l(16683);const r={style:{display:"grid","grid-template-columns":"repeat(4,1fr)","grid-template-rows":"repeat(4,1fr)"}};var c={__name:"CashlogyTecladoNumerico",props:{tipo_importe:Boolean},emits:["click-key"],setup(e,{emit:a}){const l=e;let c=(0,s.vg)(1.23).charAt(1);const u=[[7,8,9,{value:"C",style:"grid-row:1/5;grid-column:4"}],[4,5,6],[1,2,3],[{value:0,style:"grid-row:4;grid-column:1/4"}]],d=[[7,8,9,{value:"C",style:"grid-row:1/5;grid-column:4"}],[4,5,6],[1,2,3],[{value:0,style:"grid-row:4;grid-column:1/3"},c]];function _(e){a("click-key",e)}return(e,a)=>((0,o.wg)(),(0,o.iD)("div",r,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.tipo_importe?d:u,(e=>((0,o.wg)(),(0,o.iD)(o.HY,null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e,(e=>((0,o.wg)(),(0,o.j4)((0,n.SU)(i.$v),{onClick:()=>_("object"==typeof e?e.value:e),style:(0,t.j5)(["object"==typeof e?e.style:"",{margin:"1px"}]),color:"info",class:"boton-Cashlogy"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)("object"==typeof e?e.value:e),1)])),_:2},1032,["onClick","style"])))),256))],64)))),256))]))}},u=l(40089);const d=(0,u.Z)(c,[["__scopeId","data-v-1845037f"]]);var _=d}}]);
//# sourceMappingURL=165.9d2d26e4.js.map