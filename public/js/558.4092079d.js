"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[558],{78400:function(e,o,t){t.d(o,{Z:function(){return v}});var a=t(73396),l=t(87139);const n=["onClick"],r={class:"botonTecladoSpaceDiv"};function d(e,o,t,d,i,s){const u=(0,a.up)("MDBInput"),c=(0,a.up)("MDBModalHeader"),p=(0,a.up)("MDBModalBody"),v=(0,a.up)("MDBModal");return(0,a.wg)(),(0,a.j4)(v,{frame:"",position:"bottom",id:"keyBoardModal",tabindex:"-1",labelledby:"keyBoardModal",modelValue:d.keyBoardModal,"onUpdate:modelValue":o[5]||(o[5]=e=>d.keyBoardModal=e)},{default:(0,a.w5)((()=>[d.showInput?((0,a.wg)(),(0,a.j4)(c,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{style:{width:"80rem !important"},label:"Texto introducido",modelValue:d.text,"onUpdate:modelValue":o[0]||(o[0]=e=>d.text=e)},null,8,["modelValue"])])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(p,{class:"mainDiv"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.chars.length,((e,o)=>((0,a.wg)(),(0,a.iD)("div",{key:o},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.chars[e-1],((e,o)=>((0,a.wg)(),(0,a.iD)("div",{class:"btn-group-vertical mt-1 divTecla",key:o},[(0,a._)("button",{type:"button",style:(0,l.j5)([{"text-transform":"none"},d.keyStyle(e)]),class:"btn btn-outline-secondary py-3 botonTeclado",onClick:o=>d.processTecla(e)},(0,l.zw)(e),13,n)])))),128))])))),128)),(0,a._)("div",r,[(0,a._)("button",{style:(0,l.j5)([{"font-size":"1.8rem"},d.keyStyle("✎")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:o[1]||(o[1]=e=>d.processTecla("✎"))}," ✎ ",4),(0,a._)("button",{type:"button",class:"btn btn-outline-secondary py-3 botonTecladoSpace",onClick:o[2]||(o[2]=e=>d.processTecla(" "))}," ␣ "),(0,a._)("button",{style:{"font-size":"1.8rem"},type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:o[3]||(o[3]=e=>d.processTecla("@"))}," @ "),(0,a._)("button",{style:(0,l.j5)([{"font-size":"1.8rem"},d.keyStyle("#")]),type:"button",class:"btn btn-outline-secondary py-3 botonTeclado",onClick:o[4]||(o[4]=e=>d.processTecla("#"))}," Ⅳ ",4)])])),_:1})])),_:1},8,["modelValue"])}var i=t(44870),s=t(74313),u={name:"KeyBoardComponent",components:{MDBIcon:s.vm,MDBModalBody:s.Yz,MDBModal:s.j3,MDBBtn:s.$v,MDBModalHeader:s.ol,MDBModalTitle:s.wo,MDBInput:s.u2,MDBModalFooter:s.ab},props:{value:String,text:String},setup(e,{expose:o}){const t=(0,i.iH)(e.value||""),l=(0,i.iH)(!1),n=(0,i.iH)(!1),r=(0,i.iH)(!1);let d=!1;const s=(0,i.iH)(!1),u=[["q","w","e","r","t","y","u","i","o","p","←"],["a","s","d","f","g","h","j","k","l","ñ","↵"],["z","x","c","v","b","n","m",",",".","-","⇪"]],c=(0,i.iH)([]);function p(e){switch(e){case"←":b();break;case"↵":l.value=!1;break;case"⇪":d=!d,t.value.length>0&&(n.value=!n.value),y();break;case"#":r.value=!r.value,y();break;case"✎":s.value=!s.value;break;default:m(e);break}}function v(e){let o=t.value.length<=0&&!d||n.value,a="background-color: #606060 !important; color: white !important;";return r.value&&"#"==e||s.value&&"✎"==e||"⇪"==e&&o?a:o?"text-transform: uppercase":"text-transform: none;"}function m(e){let o=t.value.length<=0&&!d||n.value;d=!1,o&&(e=e.toUpperCase()),t.value+=e}function b(){t.value.length>0&&(t.value=t.value.slice(0,-1))}function y(){let e=u;const o=["á","é","í","ó","ú","ü","¡","¿"];if(r.value){let o=[["1","2","3","4","5","6","7","8","9","0","ç"]];o=o.concat(u),e=o}c.value=e.map((e=>e.map((e=>o.includes(e)?[e,e.toUpperCase()]:e))))}function g(e=""){void 0===t.value&&(t.value=""),t.value=e,l.value=!0}function _(){return[t.value,l.value]}return o({getValue:_,abrirModal:g}),(0,a.bv)((()=>{y()})),{text:t,addTecla:m,deleteTecla:b,keyBoardModal:l,processTecla:p,upperCase:n,keyStyle:v,buildKeyboard:y,abrirModal:g,showInput:s,chars:c}}},c=t(40089);const p=(0,c.Z)(u,[["render",d],["__scopeId","data-v-407fd075"]]);var v=p},75794:function(e,o,t){t.r(o),t.d(o,{default:function(){return q}});var a=t(73396),l=t(87139),n=t(49242);const r=e=>((0,a.dD)("data-v-9be6ce36"),e=e(),(0,a.Cn)(),e),d={id:"main"},i={id:"vueMenuPedido"},s={class:"pedidos"},u={class:"text-center m-auto pt-3 h5"},c={class:""},p=r((()=>(0,a._)("hr",{class:"hrPedido"},null,-1))),v={class:"productos"},m={key:0,style:{"overflow-y":"scroll",height:"28vh"}},b={class:"ms-5 h6"},y={class:"d-flex flex-column juatify-content-center"},g={style:{"max-width":"270px"}},_=["onUpdate:modelValue","onClick"],M=r((()=>(0,a._)("br",null,null,-1))),h={key:1},C=r((()=>(0,a._)("hr",{class:"hrPedido"},null,-1))),f={class:"pedidos-footer mx-5"},D=r((()=>(0,a._)("h2",{id:"emailHelp",class:"h6"},"Precio total:",-1))),k={class:"mb-0 mt-2"},w={class:""},B=["disabled"];function T(e,o,t,r,T,x){const H=(0,a.up)("ModalClientesComponent"),S=(0,a.up)("KeyBoardComponent");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",d,[(0,a._)("div",i,[(0,a._)("div",null,[(0,a._)("div",s,[(0,a._)("h1",u,(0,l.zw)(e.$t("pedido_nuevo","Pedido nuevo")),1),(0,a._)("div",c,[p,(0,a._)("div",v,[r.productos.length?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("h2",b,(0,l.zw)(e.$t("productos","Productos"))+":",1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.productos,((e,o)=>((0,a.wg)(),(0,a.iD)("div",{class:"producto d-flex justify-content-between w-75 mx-auto",key:o},[(0,a._)("div",y,[(0,a._)("span",g,"- "+(0,l.zw)(e.nombre),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.arraySuplementos,((e,o)=>((0,a.wg)(),(0,a.iD)("span",{key:o},(0,l.zw)(e.nombre),1)))),128))]),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",placeholder:"Comentario del producto...","onUpdate:modelValue":o=>e.comentario=o,readonly:"",onClick:e=>r.openKeyboard(o)},null,8,_),[[n.nr,e.comentario]])])))),128)),M])):((0,a.wg)(),(0,a.iD)("div",h,(0,l.zw)(e.$t("toc_game_no_hay_productos","No hay ningún producto seleccionado")),1))]),C,(0,a._)("div",f,[(0,a._)("div",null,[D,(0,a._)("p",k,(0,l.zw)(r.precioTotal)+"€",1)]),(0,a._)("div",w,[(0,a._)("input",{type:"button",value:"Crear pedido",class:"btn btn-primary btn-lg",onClick:o[0]||(o[0]=(...e)=>r.crearPedido&&r.crearPedido(...e)),disabled:r.botonBloqueado},null,8,B)])])])])])])]),(0,a.Wm)(H,{ref:"refModalClientes"},null,512),(0,a.Wm)(S,{ref:"keyboardRef"},null,512)],64)}t(57658);var x=t(44870),H=t(74313),S=t(20065),j=t(46626),I=t(33727),P=t(42492),z=t.n(P),V=t(87853),K=t(91076),Z=t(6411),Y=t(78400),$={name:"PedidosComponent",components:{ModalClientesComponent:j.Z,NumpadComponent:I.Z,MDBCard:H.Yl,MDBCardBody:H.H7,MDBCardTitle:H.QM,MDBCardText:H.Pp,MDBBtn:H.$v,MDBCheckbox:H.IH,MDBModal:H.j3,MDBModalHeader:H.ol,MDBModalTitle:H.wo,MDBModalBody:H.Yz,MDBModalFooter:H.ab,MDBIcon:H.vm,MDBLoading:H.J$,KeyBoardComponent:Y.Z},setup(){const e=(0,x.iH)(!1),o=(0,x.iH)(null),t=(0,S.oR)(),{t:l}=(0,V.QT)(),n=t.getters["Cestas/getCestaActiva"],r=t.getters["Cestas/getCestaActivaIndex"],d=(0,a.Fl)((()=>t.state.Trabajadores.arrayTrabajadores)),i=(0,a.Fl)((()=>t.state.Trabajadores.indexActivo)),s=(0,a.Fl)((()=>d.value&&null!=i.value&&void 0!=i.value&&d.value[i.value]?d.value[i.value]:null)),u=(0,x.iH)(null),c=(0,x.iH)(null),p={idCliente:n.idCliente,nombreCliente:n.nombreCliente},v=(0,x.iH)(null),m=(0,x.iH)(n.lista.map((e=>({id:e.idArticulo,nombre:e.nombre,total:e.subtotal,unidades:e.unidades,comentario:"",arraySuplementos:e.arraySuplementos,promocion:e.promocion})))),b=(0,x.iH)(null),y=()=>{const e=n.detalleIva,o=Object.keys(e).filter((e=>e.startsWith("importe"))).reduce(((o,t)=>o+e[t]),0);return Math.round(100*o)/100},g=()=>{if(e.value=!0,!m.value.length)return _(l("toc_game_pedidos_error_no_productos","Tienes que haber al menos un producto para crear el pedido."),"error"),void(e.value=!1);const o=new Date,t=new Date(o);t.setDate(o.getDate()+1);let a=t.getHours(),r=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,d=a>=12?"pm":"am";const i={idCliente:u.value.id,nombreCliente:u.value.nombre,opcionRecogida:2,amPm:d,fecha:t.toISOString().slice(0,10),hora:r,dias:[],dejaCuenta:0,total:y(),productos:m.value,cesta:n,idTrabajador:s.value._id,nombreDependienta:s.value.nombre,pedido:!0};K.Z.post("encargos/setEncargo",i).then((({data:o})=>o&&o.msg?o.error?(_(o.msg,"error"),void(e.value=!1)):(e.value=!1,void _(l("toc_game_pedidos_ok","pedido creado!"),"success",M)):(_(l("toc_game_pedidos_error_general","Error general"),"error"),void(e.value=!1)))).catch((o=>{e.value=!1,_(l("toc_game_pedidos_error_general","Error general"),"error")}))},_=(e,o,t=(()=>{}))=>{z().fire("error"===o?"Oops...":"Ok!!",e,o).then((()=>t()))},M=async()=>(await t.dispatch("Cestas/setModoCesta",{index:r,modo:"VENTA"}),t.dispatch("Cestas/setClienteCesta",{index:r,idCliente:null,nombreCliente:null,albaran:!1,vip:!1}),t.dispatch("EstadoDinamico/reset"),t.dispatch("Cestas/deleteLista",n._id),h("/main"),Promise.resolve()),h=e=>Z.Z.push(e);let C;async function f(e){try{const o=m.value[e];c.value.abrirModal(o.comentario),C=setInterval((()=>{const e=c.value.getValue()[0];e!==o.comentario&&(o.comentario=e),c.value.getValue()[1]||clearInterval(C)}),100)}catch(o){console.log(o),C=void 0}}return(0,a.bv)((()=>{K.Z.get("clientes/getClientePedidosTienda").then((e=>{u.value=e.data})).catch((e=>{u.value=!1})),b.value=y()})),{refModalClientes:o,cestaActiva:n,clienteData:p,productos:m,crearPedido:g,precioTotal:b,botonBloqueado:e,numpadRef:v,openKeyboard:f,keyboardRef:c}}},A=t(40089);const U=(0,A.Z)($,[["render",T],["__scopeId","data-v-9be6ce36"]]);var q=U}}]);
//# sourceMappingURL=558.4092079d.js.map