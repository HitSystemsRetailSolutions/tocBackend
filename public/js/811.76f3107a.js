"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[811],{8811:function(a,e,o){o.r(e),o.d(e,{default:function(){return U}});var r=o(3396),s=o(7139);const t={class:"row mt-2"},n={class:"row mt-4"},l={key:0,class:"col tablaDescansando table-responsive d-inline",style:{"background-color":"white"}},i={class:"table"},c={class:"tituloDescanso"},d=["onClick"],u={class:"textoNombre d-inline-block text-truncate"},f={class:"col anchoCajaConsumoPersonal"};function m(a,e,o,m,p,v){const b=(0,r.up)("MDBCardTitle"),h=(0,r.up)("MDBIcon"),_=(0,r.up)("MDBCardBody"),w=(0,r.up)("MDBCard"),j=(0,r.up)("MDBBtn"),D=(0,r.up)("FichajesModal");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",t,[(0,r.Wm)(w,{onClick:e[0]||(e[0]=a=>m.modalFichajes.abrirModal()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(_,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("iniciar_turno","Iniciar turno")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"play",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(w,{onClick:e[1]||(e[1]=a=>m.iniciarDescanso()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(_,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("iniciar_descanso","Iniciar descanso")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"pause",iconStyle:"fas",size:"6x"})])),_:1})])),_:1}),(0,r.Wm)(w,{onClick:e[2]||(e[2]=a=>m.preguntarFinalizarTurno()),class:"estiloCard ms-4"},{default:(0,r.w5)((()=>[(0,r.Wm)(_,{class:"text-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("finalizar_turno","Finalizar turno")),1)])),_:1}),(0,r.Wm)(h,{class:"mt-3",icon:"stop",iconStyle:"fas",size:"6x"})])),_:1})])),_:1})]),(0,r._)("div",n,[m.arrayTrabajadoresDescanso&&m.arrayTrabajadoresDescanso.length>0?((0,r.wg)(),(0,r.iD)("div",l,[(0,r._)("table",i,[(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",c,(0,s.zw)(a.$t("trabajadores_en_descanso_activo","Trabajadores en descanso activo")),1)])]),(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(m.arrayTrabajadoresDescanso,((a,e)=>((0,r.wg)(),(0,r.iD)("tr",{key:e,class:(0,s.C_)({activoTabla:a._id===m.idActivoDescanso}),onClick:e=>m.setActivo(a._id)},[(0,r._)("td",null,[(0,r._)("span",u,(0,s.zw)(a.nombre),1)])],10,d)))),128))])])])):(0,r.kq)("",!0),(0,r._)("div",f,[m.trabajadorActivo?((0,r.wg)(),(0,r.j4)(j,{key:0,onClick:e[3]||(e[3]=a=>m.activarConsumoPersonal()),color:"primary",class:"w-100 botonConsumoPersonal"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("consumo_personal","Consumo personal")),1)])),_:1})):(0,r.kq)("",!0),null!=m.idActivoDescanso?((0,r.wg)(),(0,r.j4)(j,{key:1,onClick:e[4]||(e[4]=a=>m.preguntarFinalDescanso()),color:"primary",class:"w-100 botonConsumoPersonal mt-4"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("finalizar_descanso","Finalizar descanso")),1)])),_:1})):(0,r.kq)("",!0)])]),(0,r.Wm)(D,{ref:"modalFichajes"},null,512)],64)}o(7658);var p=o(4834),v=o(4161),b=o(4313),h=o(2492),_=o.n(h),w=o(4870),j=o(65),D=o(9242);const C={class:"row"},B={key:0,class:"row mt-2"},g={class:"table table-striped"},M={class:"textoNombre d-inline-block text-truncate"},k={key:1,class:"row"},y={class:"sinResultados position-relative"},F={class:"textoSinResultados position-absolute top-50 start-50 translate-middle"};function T(a,e,o,t,n,l){const i=(0,r.up)("MDBModalTitle"),c=(0,r.up)("MDBModalHeader"),d=(0,r.up)("MDBBtn"),u=(0,r.up)("MDBModalBody"),f=(0,r.up)("MDBModalFooter"),m=(0,r.up)("MDBModal");return(0,r.wg)(),(0,r.j4)(m,{id:"modalFichajes",tabindex:"-1",labelledby:"staticBackdropLabel",modelValue:t.modalFichajes,"onUpdate:modelValue":e[2]||(e[2]=a=>t.modalFichajes=a),size:"xl",modalFichajes:""},{default:(0,r.w5)((()=>[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(i,{id:"staticBackdropLabel"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("fichar","Fichar")),1)])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r._)("div",C,[(0,r.wy)((0,r._)("input",{class:"form-control inputBusqueda w-100",type:"text",placeholder:"Buscar por nombre","aria-label":".form-control-lg example","onUpdate:modelValue":e[0]||(e[0]=a=>t.inputBusqueda=a)},null,512),[[D.nr,t.inputBusqueda]])]),t.arrayTrabajadores&&t.arrayTrabajadores.length>0?((0,r.wg)(),(0,r.iD)("div",B,[(0,r._)("table",g,[(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.arrayTrabajadores,((e,o)=>((0,r.wg)(),(0,r.iD)("tr",{key:o},[(0,r._)("td",null,[(0,r._)("span",M,(0,s.zw)(e.nombre),1)]),(0,r._)("td",null,[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:a=>t.fichar(e._id),class:"w-100",style:{height:"3.85rem","font-size":"1.5rem"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("fichar","Fichar")),1)])),_:2},1032,["onClick"])])])))),128))])])])):((0,r.wg)(),(0,r.iD)("div",k,[(0,r._)("div",y,[(0,r._)("span",F,(0,s.zw)(a.$t("sin_resultados","Sin resultados")),1)])]))])),_:1}),(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{color:"primary",size:"lg",onClick:e[1]||(e[1]=a=>t.modalFichajes=!1)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,s.zw)(a.$t("cerrar","Cerrar")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}var z={name:"FichajesModal",components:{MDBModal:b.j3,MDBModalHeader:b.ol,MDBModalTitle:b.wo,MDBModalBody:b.Yz,MDBModalFooter:b.ab,MDBBtn:b.$v},setup(){const a=(0,w.iH)(null),e=(0,w.iH)([]),o=(0,w.iH)("");function s(){a.value=!0}function t(){v.Z.post("trabajadores/buscar",{busqueda:o.value}).then((a=>{e.value=a.data})).catch((a=>{_().fire("Oops...",a.message,"error")}))}function n(e){v.Z.post("trabajadores/fichar",{idTrabajador:e}).then((e=>{if(!e.data)throw Error("Error, no se ha podido fichar");p.W.cargarTrabajadoresFichados(),a.value=!1})).catch((a=>{_().fire("Oops...",a.message,"error")}))}return(0,r.YP)(o,(()=>{t()})),{modalFichajes:a,abrirModal:s,arrayTrabajadores:e,inputBusqueda:o,fichar:n}}},W=o(89);const x=(0,W.Z)(z,[["render",T],["__scopeId","data-v-6f9e5052"]]);var $=x,E=o(8686),H={name:"fichajesView",components:{MDBIcon:b.vm,FichajesModal:$,MDBCard:b.Yl,MDBCardBody:b.H7,MDBCardTitle:b.QM,MDBBtn:b.$v},setup(){const a=(0,j.oR)(),e=(0,w.iH)(null),o=(0,w.iH)([]),s=(0,w.iH)(null),t=(0,r.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),n=(0,r.Fl)((()=>a.state.Trabajadores.indexActivo)),l=(0,r.Fl)((()=>t.value&&void 0!=n.value&&null!=n.value&&t.value[n.value]?t.value[n.value]:null)),i=(0,r.Fl)((()=>a.state.Cestas.arrayCestas)),c=(0,r.Fl)((()=>{if(i.value)for(let a=0;a<i.value.length;a++)if(i.value[a]._id==t.value[n.value].idCesta)return i.value[a];return null}));function d(a){s.value=a}function u(){s.value=null}function f(){v.Z.post("trabajadores/desfichar",{idTrabajador:l.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido registrar el fin de turno (backend)");p.W.cargarTrabajadoresFichados(),_().fire("OK","Fin de turno registrado correctamente","success")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}function m(a){for(let e=0;e<o.value.length;e++)if(a===o.value[e]._id)return o.value[e];return null}function b(){if(s.value){const a=m(s.value);a&&_().fire({title:"Por favor, confirma el descanso para: ",html:`${a.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&C(s.value)}))}}async function h(){if(i.value&&c.value)for(let e=0;e<i.value.length;e++)if(i.value[e]._id===c.value._id){await a.dispatch("Cestas/setModoCesta",{modo:"CONSUMO_PERSONAL",index:e}),E.Z.push("/main");break}}function D(){l.value&&_().fire({title:"Confirma. Fin de turno para: ",html:`${l.value.nombre}`,showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Confirmar"}).then((a=>{a.isConfirmed&&f()}))}function C(a){v.Z.post("trabajadores/finDescanso",{idTrabajador:a}).then((a=>{if(!a.data)throw Error("Error, no se  ha podido iniciar el descanso");p.W.cargarTrabajadoresFichados(),u(),g(),_().fire("Descanso finalizado","","success")})).catch((a=>{_().fire("Oops...",a.message,"error")}))}function B(){l.value._id?v.Z.post("trabajadores/inicioDescanso",{idTrabajador:l.value._id}).then((a=>{if(!a.data)throw Error("Error, no se ha podido iniciar el descanso");g(),p.W.cargarTrabajadoresFichados(),_().fire("OK","Descanso iniciado correctamente","success")})).catch((a=>{_().fire("Oops...",a.message,"error")})):_().fire("Importante....","Es necesario un trabajador activo para realizar esta acciÃ³n","warning")}function g(){v.Z.get("trabajadores/descansando").then((a=>{if(!a.data)throw Error("Error, no se han podido obtener los trabajadores en descanso");o.value=a.data})).catch((a=>{_().fire("Oops...",a.message,"error")}))}return(0,r.bv)((()=>{g()})),{modalFichajes:e,arrayTrabajadoresDescanso:o,idActivoDescanso:s,setActivo:d,trabajadorActivo:l,finDeTurno:f,iniciarDescanso:B,preguntarFinalDescanso:b,resetidActivoDescansando:u,preguntarFinalizarTurno:D,activarConsumoPersonal:h}}};const O=(0,W.Z)(H,[["render",m],["__scopeId","data-v-12eb3e97"]]);var U=O}}]);
//# sourceMappingURL=811.76f3107a.js.map