"use strict";(self["webpackChunktoc_game_v4"]=self["webpackChunktoc_game_v4"]||[]).push([[437],{4286:function(a,t,e){e.d(t,{Z:function(){return D}});var o=e(3396),i=e(7139);const l={class:"container"},n={key:0,class:"h3 text-center"},r={key:1,class:"h3 text-center"},c={key:2,class:"h3 text-center"},s={class:"row mt-2 container botonesCaja"},d={class:"again py-5"},u={class:"again py-5"},p={class:"again py-5"};function m(a,t,e,m,k,v){const f=(0,o.up)("MDBBtn"),g=(0,o.up)("MDBModalBody"),_=(0,o.up)("MDBModal");return(0,o.wg)(),(0,o.j4)(_,{id:"ModalErrorDatafonoQueHacerComponent",tabindex:"-1",labelledby:"tituloModalDatafono",modelValue:m.ModalErrorDatafonoQueHacerComponent,"onUpdate:modelValue":t[3]||(t[3]=a=>m.ModalErrorDatafonoQueHacerComponent=a),staticBackdrop:"",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o._)("div",l,[1==m.ticketExist?((0,o.wg)(),(0,o.iD)("p",n," Se ha cobrado el pago con datáfono pero no nos ha llegado. ¿Que hacemos? ")):(0,o.kq)("",!0),2==m.ticketExist?((0,o.wg)(),(0,o.iD)("p",r," No se ha cobrado el pago con datáfono. ¿Que hacemos? ")):(0,o.kq)("",!0),3==m.ticketExist?((0,o.wg)(),(0,o.iD)("p",c," Ultimo pago cancelado, que hacemos? ¿Que hacemos? ")):(0,o.kq)("",!0)]),(0,o._)("div",s,[1==m.ticketExist?((0,o.wg)(),(0,o.j4)(f,{key:0,color:"success",size:"1g",class:"botonEstado my-3 botones",onClick:t[0]||(t[0]=a=>m.darComoValido())},{default:(0,o.w5)((()=>[(0,o._)("span",d,(0,i.zw)(a.$t("volver_a_cobrar","Pago válido con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),m.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:1,color:"warning  ",size:"lg",class:"botonEstado my-3 botones",disabled:m.esperandoConexion?"":a.disabled,onClick:t[1]||(t[1]=a=>{m.tarjetaUltimoTicket(),m.esperandoConexion=!0})},{default:(0,o.w5)((()=>[(0,o._)("span",u,(0,i.zw)(a.$t("reintentar_pago","Reintentar pago con tarjeta")),1)])),_:1},8,["disabled"])):(0,o.kq)("",!0),m.ticketExist>1?((0,o.wg)(),(0,o.j4)(f,{key:2,color:"primary  ",size:"lg",class:"botonEstado my-3 botones",onClick:t[2]||(t[2]=a=>m.pagoDependienta())},{default:(0,o.w5)((()=>[(0,o._)("span",p,(0,i.zw)(a.$t("pago en efectivo","PAGO EN EFECTIVO O EN 3G")),1)])),_:1})):(0,o.kq)("",!0)])])),_:1})])),_:1},8,["modelValue"])}var k=e(65),v=e(4161),f=e(4313),g=e(2492),_=e.n(g),w=e(4870),h={name:"ModalErrorDatafonoQueHacerComponent",components:{MDBModal:f.j3,MDBModalBody:f.Yz,MDBBtn:f.$v},setup(a,{expose:t}){const e=(0,w.iH)(null),i=(0,w.iH)(0),l=(0,k.oR)(),n=(0,w.iH)(!1),r=(0,o.Fl)((()=>l.state.Trabajadores.arrayTrabajadores));let c=(0,w.iH)(!1);const s=(0,o.Fl)((()=>l.state.Trabajadores.indexActivo)),d=(0,o.Fl)((()=>r.value&&void 0!=s.value&&null!=s.value&&r.value[s.value]?r.value[s.value]:null));function u(a,t){if(4==t)return _().fire({icon:"success",title:"¡Todo ha salido correctamente!",showConfirmButton:!1,timer:1200});e.value=a,i.value=t,n.value=!0}async function p(){await v.Z.post("paytef/darPorValidoUltimoTicket",{idTrabajador:d.value._id}).then((()=>{n.value=!1,l.dispatch("Datafono/setEstado","APROBADA")})).catch((a=>{n.value=!0,_().fire("Oops...",a.message,"error")})),_().fire({icon:"success",title:"Pagado validado.",showConfirmButton:!1,timer:1200})}function m(){c.value=!0,v.Z.post("paytef/cobrarUltimoTicket",{idTrabajador:d.value._id}).then((()=>{n.value=!1,c.value=!1,l.dispatch("Datafono/setEstado","PENDIENTE")})).catch((a=>{c.value=!1,n.value=!0,_().fire("Oops...",a.message,"error")})),c.value=!1,_().fire({icon:"success",title:"Pago enviado al datáfono",showConfirmButton:!1,timer:1200})}function f(){_().fire({icon:"success",title:"Pagado en efectivo",showConfirmButton:!1,timer:1200}),n.value=!1}return t({abrirModal:u}),(0,o.bv)((()=>{})),{store:l,darComoValido:p,ModalErrorDatafonoQueHacerComponent:n,tarjetaUltimoTicket:m,esperandoConexion:c,arrayTrabajadores:r,indexTrabajadorActivo:s,idSeleccionado:e,pagoDependienta:f,ticketExist:i}}},T=e(89);const b=(0,T.Z)(h,[["render",m],["__scopeId","data-v-1ca4de76"]]);var D=b},8437:function(a,t,e){e.r(t),e.d(t,{default:function(){return N}});var o=e(3396),i=e(7139);const l=a=>((0,o.dD)("data-v-48ab2236"),a=a(),(0,o.Cn)(),a),n={class:"col-md-7 listaTickets"},r={class:"th-sm"},c={class:"th-sm"},s={class:"th-sm"},d={class:"th-sm"},u=["onClick"],p={key:0,class:"col-md-5"},m={id:"detalleTicket"},k={class:"text-center"},v={class:"text-center"},f=l((()=>(0,o._)("br",null,null,-1))),g=l((()=>(0,o._)("hr",null,null,-1))),_={class:"table"},w={class:"titulosTicket"},h={class:"titulosTicket"},T={class:"titulosTicket"},b=l((()=>(0,o._)("hr",null,null,-1))),D={class:"text-center"};function C(a,t,e,l,C,y){const z=(0,o.up)("MDBTable"),E=(0,o.up)("MDBIcon"),j=(0,o.up)("MDBBtn"),A=(0,o.up)("ModalErrorDatafonoComponent");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",n,[(0,o.Wm)(z,{hover:""},{default:(0,o.w5)((()=>[(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",r,(0,i.zw)(a.$t("numero_ticket","Número ticket")),1),(0,o._)("th",c,(0,i.zw)(a.$t("hora","Hora")),1),(0,o._)("th",s,(0,i.zw)(a.$t("tipo_pago","Tipo pago")),1),(0,o._)("th",d,(0,i.zw)(a.$t("total","Total")),1)])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.arrayTickets,((a,t)=>((0,o.wg)(),(0,o.iD)("tr",{key:t,class:(0,i.C_)({"table-active":a._id===l.idActivo}),onClick:t=>l.setActivo(a)},[(0,o._)("td",null,(0,i.zw)(a._id),1),(0,o._)("td",null,(0,i.zw)(l.getTiempo(a.timestamp)),1),(0,o._)("td",null,(0,i.zw)(a.tipoPago),1),(0,o._)("td",null,(0,i.zw)(a.total.toFixed(2))+" €",1)],10,u)))),128))])])),_:1})]),l.ticketSeleccionado?((0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("div",m,[(0,o._)("h2",k,(0,i.zw)(a.$t("ticket","Ticket"))+" "+(0,i.zw)(l.ticketSeleccionado._id),1),(0,o._)("h6",v,(0,i.zw)(l.getTiempo(l.ticketSeleccionado.timestamp)),1),f,g,(0,o._)("table",_,[(0,o._)("tr",null,[(0,o._)("th",w,(0,i.zw)(a.$t("producto","Producto")),1),(0,o._)("th",h,(0,i.zw)(a.$t("subtotal","Subtotal")),1),(0,o._)("th",T,(0,i.zw)(a.$t("unidades","Unidades")),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.ticketSeleccionado?.cesta?.lista,((a,t)=>((0,o.wg)(),(0,o.iD)("tr",{key:t},[(0,o._)("td",null,(0,i.zw)(a.nombre),1),(0,o._)("td",null,(0,i.zw)(a.subtotal.toFixed(2))+" €",1),(0,o._)("td",null,(0,i.zw)(a.unidades),1)])))),128))]),b,(0,o._)("h1",D,(0,i.zw)(a.$t("total","Total"))+": "+(0,i.zw)(l.ticketSeleccionado.total.toFixed(2)),1),(0,o.Wm)(j,{onClick:t[0]||(t[0]=a=>l.imprimirTicket()),color:"success",class:"w-100"},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{icon:"print",size:"3x"})])),_:1}),"EFECTIVO"===l.ticketSeleccionado.tipoPago?((0,o.wg)(),(0,o.j4)(j,{key:0,color:"primary",class:"w-100 mt-4",size:"lg",onClick:t[1]||(t[1]=a=>l.pagarConTarjeta(l.ticketSeleccionado._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_tarjeta","Pagar con tarjeta")),1)])),_:1})):(0,o.kq)("",!0),"DATAFONO_3G"===l.ticketSeleccionado.tipoPago?((0,o.wg)(),(0,o.j4)(j,{key:1,color:"primary",class:"w-100 mt-4",size:"lg",onClick:t[2]||(t[2]=a=>l.pagarEfectivo(l.ticketSeleccionado._id))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("pagar_con_efectivo","Pagar con efectivo")),1)])),_:1})):(0,o.kq)("",!0),l.prohibirAnularTicket||"DATAFONO_3G"===l.ticketSeleccionado.tipoPago&&l.prohibirAnular3g||"ANULADO"==l.ticketSeleccionado.tipoPago?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(j,{key:2,onClick:t[3]||(t[3]=a=>l.esborrarTicket()),color:"danger",class:"w-100 mt-4",size:"lg"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(a.$t("devolucion_con_tarjeta_efectivo","Devolución con tarjeta/efectivo")),1)])),_:1}))])])):(0,o.kq)("",!0),(0,o.Wm)(A,{ref:"modalErrorDatafonoRef"},null,512)],64)}e(7658);var y=e(4834),z=e(4313),E=e(4870),j=e(65),A=e(6797),M=e.n(A),B=e(4161),x=e(2492),P=e.n(x),H=e(2136),S=e(250),$=e(4286),F={name:"TicketsComponent",components:{MDBTable:z.re,MDBBtn:z.$v,MDBIcon:z.vm,ModalErrorDatafonoComponent:$.Z},setup(){const a=(0,j.oR)(),t=(0,E.iH)(null),e=(0,E.iH)(!1),i=(0,E.iH)(null),l=(0,E.iH)(!1),n=(0,o.Fl)((()=>a.state.Trabajadores.arrayTrabajadores)),r=(0,o.Fl)((()=>a.state.Trabajadores.indexActivo)),c=(0,o.Fl)((()=>n.value&&void 0!=r.value&&null!=r.value&&n.value[r.value]?n.value[r.value]:null)),s=(0,o.Fl)((()=>a.state.Caja.arrayVentas)),d=(0,E.iH)(null);function u(a){const t=new Date(a);return M()(t).format("HH:mm:ss DD/MM/YYYY")}function p(){B.Z.post("impresora/imprimirTicket",{idTicket:i.value._id}).catch((a=>{P().fire("Oops...",a.message,"error")}))}function m(a){t.value=a._id,i.value=a}function k(a){H.socket.emit("toggle3g",{idTicket:a,idTrabajador:c.value._id}),i.value=null,S.Z.push("/main")}function v(a){function t(){H.socket.emit("toggle3g",{idTicket:a,idTrabajador:c.value._id})}function e(){H.socket.emit("iniciarTransaccion",{idTicket:a,idTrabajador:c.value._id})}B.Z.post("parametros/getParametros").then((a=>{"3G"===a.data?.tipoDatafono||"0.0.0.0"==a.data?.ipTefpay?t():e()})),i.value=null,S.Z.push("/main")}function f(){null!=i.value._id&&(confirm("¿Confirma ANULACIÓN de ticket?")?B.Z.post("tickets/anularTicket",{ticketId:i.value._id}).then((a=>{a.data.res&&["EFECTIVO","DATAFONO_3G"].includes(a.data.tipoPago)?P().fire({icon:"success",title:"Ticket anulado",showConfirmButton:!1,timer:1200}):a.data.res?S.Z.push("/main"):P().fire({icon:"error",title:"Ya esta anulado",showConfirmButton:!1,timer:1400})})).catch((a=>{P().fire(a.message)})):P().fire("Primero selecciona el ticket"))}function g(a){S.Z.push(a)}return(0,o.bv)((()=>{y.W.cargarVentas(),s.value&&s.value.length>0&&m(s.value[0]),B.Z.post("parametros/getParametros").then((a=>{"Si"==a.data?.params?.ProhibirAnulacioTicket&&(e.value=!0),"Si"==a.data.params.prohibirAnular3g&&(l.value=!0)}))})),{modalErrorDatafonoRef:d,arrayTickets:s,getTiempo:u,setActivo:m,idActivo:t,ticketSeleccionado:i,pagarConTarjeta:v,imprimirTicket:p,esborrarTicket:f,prohibirAnularTicket:e,goTo:g,pagarEfectivo:k,prohibirAnular3g:l}}},O=e(89);const Z=(0,O.Z)(F,[["render",C],["__scopeId","data-v-48ab2236"]]);var N=Z}}]);
//# sourceMappingURL=437.b4fe239d.js.map